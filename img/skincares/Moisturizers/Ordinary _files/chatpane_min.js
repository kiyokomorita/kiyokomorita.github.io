(function(f){function j(){return h?(i||(i="file://"+(process.platform.match(/^win/i)?"/":"")+o("fs").realpathSync(".")),i):document.location.href}function a(k){return encodeURIComponent(k).replace(/'/g,"%27")}function d(k){k=k.replace(/\+/g," ");k=k.replace(/%([ef][0-9a-f])%([89ab][0-9a-f])%([89ab][0-9a-f])/gi,function(l,m,n,p){m=parseInt(m,16)-224;n=parseInt(n,16)-128;if(0===m&&32>n){return l}p=parseInt(p,16)-128;p=(m<<12)+(n<<6)+p;return 65535<p?l:String.fromCharCode(p)});k=k.replace(/%([cd][0-9a-f])%([89ab][0-9a-f])/gi,function(l,m,n){m=parseInt(m,16)-192;if(2>m){return l}l=parseInt(n,16)-128;return String.fromCharCode((m<<6)+l)});return k.replace(/%([0-7][0-9a-f])/gi,function(l,m){return String.fromCharCode(parseInt(m,16))})}function s(k){for(var n=/([^=&]+)(=([^&]*))?/g,l;l=n.exec(k);){var m=decodeURIComponent(l[1].replace(/\+/g," "));l=l[3]?d(l[3]):"";void 0!==this[m]&&null!==this[m]?(this[m]instanceof Array||(this[m]=[this[m]]),this[m].push(l)):this[m]=l}}function c(k,p){var l=k,n=!p,t;l||(l=j());if(h){var q=o("url").parse(l)}else{q=document.createElement("a"),q.href=l}var y=l;var u={path:!0,query:!0,hash:!0};y&&/^[a-z]+:/.test(y)&&(u.protocol=!0,u.host=!0,/[-a-z0-9]+(\.[-a-z0-9])*:\d+/i.test(y)&&(u.port=!0),/\/\/(.*?)(?::(.*?))?@/.test(y)&&(u.user=!0,u.pass=!0));y=l.match(/\/\/(.*?)(?::(.*?))?@/)||[];for(t in w){this[t]=u[t]?q[w[t]]||"":""}this.protocol=this.protocol.replace(/:$/,"");this.query=this.query.replace(/^\?/,"");this.hash=d(this.hash.replace(/^#/,""));this.user=d(y[1]||"");this.pass=d(y[2]||"");this.port=x[this.protocol]==this.port||0==this.port?"":this.port;!u.protocol&&/[^/#?]/.test(l.charAt(0))&&(this.path=l.split("?")[0].split("#")[0]);if(!u.protocol&&n){n=new c(j().match(/(.*\/)/)[0]);q=n.path.split("/");u=this.path.split("/");y=["protocol","user","pass","host","port"];var z=y.length;q.pop();for(t=0;t<z;t++){this[y[t]]=n[y[t]]}for(;".."===u[0];){q.pop(),u.shift()}this.path=("/"!==l.charAt(0)?q.join("/"):"")+"/"+u.join("/")}this.path=this.path.replace(/^\/{2,}/,"/");this.paths(this.paths());this.query=new s(this.query)}var h="undefined"===typeof window&&"undefined"!==typeof global&&"function"===typeof require,o=h?f.require:null,w={protocol:"protocol",host:"hostname",port:"port",path:"pathname",query:"search",hash:"hash"},x={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443},i;s.prototype.toString=function(){var k="",n,l;for(n in this){if(!(this[n]instanceof Function||null===this[n])){if(this[n]instanceof Array){var m=this[n].length;if(m){for(l=0;l<m;l++){k+=k?"&":"",k+=a(n)+"="+a(this[n][l])}}else{k+=(k?"&":"")+a(n)+"="}}else{k+=k?"&":"",k+=a(n)+"="+a(this[n])}}}return k};c.prototype.clearQuery=function(){for(var k in this.query){this.query[k]instanceof Function||delete this.query[k]}return this};c.prototype.queryLength=function(){var k=0,l;for(l in this){this[l]instanceof Function||k++}return k};c.prototype.isEmptyQuery=function(){return 0===this.queryLength()};c.prototype.paths=function(k){var n="",l=0,m;if(k&&k.length&&k+""!==k){this.isAbsolute()&&(n="/");for(m=k.length;l<m;l++){k[l]=!l&&k[l].match(/^\w:$/)?k[l]:a(k[l])}this.path=n+k.join("/")}k=("/"===this.path.charAt(0)?this.path.slice(1):this.path).split("/");l=0;for(m=k.length;l<m;l++){k[l]=d(k[l])}return k};c.prototype.encode=a;c.prototype.decode=d;c.prototype.isAbsolute=function(){return this.protocol||"/"===this.path.charAt(0)};c.prototype.toString=function(){return(this.protocol&&this.protocol+"://")+(this.user&&a(this.user)+(this.pass&&":"+a(this.pass))+"@")+(this.host&&this.host)+(this.port&&":"+this.port)+(this.path&&this.path)+(this.query.toString()&&"?"+this.query)+(this.hash&&"#"+this.hash)};f[f.exports?"exports":"Url"]=c})("undefined"!==typeof module&&module.exports?module:window);var insideWorkflows=new function(){var fieldTypes={Text:1,Number:2,Picklist:3,Boolean:4,DateTime:5,Rating:6,File:7};var alphanumericRegex=new RegExp('^((?![!.,?@#$%^&*(){};:"<>[]).)*$');var emailRegex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var urlRegex1=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%\*?=~_|!:,.;\[\](]*[-A-Z0-9+&@#\/%=~_|)][^\]|^>])/im;var urlRegex2=/(\b(www\.)[-A-Z0-9+&@#\/%\*?=~_|!:,.;\[\]]*[-A-Z0-9+&@#\/%=~_|][^\]|^\)|^>])/i;var _this=this;var stylesLoaded=false;var preview=false;var workflowArchiveId=0;var welcomeMessageShown=false;var device=1;var customScripts;var isChatPaneOpened=false;try{if(localStorage.getItem("insideChatPaneOpen")==null){isChatPaneOpened=true}else{isChatPaneOpened=localStorage.getItem("insideChatPaneOpen")=="true"}}catch(e){}if(typeof(_insideGraph)!="undefined"){device=_insideGraph.jQuery.inside.front.getDevice()}function init(){setStyles()}this.showWorkflowIfNeeded=showWorkflowIfNeeded;function showWorkflowIfNeeded(){if(!insideWorkflows.currentWorkflow){return}if(!insideWorkflows.currentWorkflow.isActive&&$(document.body).find("#insideWorkflowFieldCell:visible, .message.workflowMessage .picklist").length===0){startWorkflow(insideWorkflows.currentWorkflow,!isChatPaneOpened)}if(insideWorkflows.currentWorkflow.renderingPending){renderWorkflowField(insideWorkflows.currentWorkflow.step.fields[0],insideWorkflows.currentWorkflow.step)}}function showHideChatPaneInput(hide){if(hide){insideChatPane.hideInputFooter()}else{insideChatPane.showInputFooter(true)}}this.currentWorkflow=null;this.settings={};this.startWorkflow=startWorkflow;this.chatSettings={};function startWorkflow(wf,dontOpenChatpane){if(wf&&insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.workflowId==wf.workflowId&&insideWorkflows.currentWorkflow.isActive){return}delete insideChatPane.lastMessageFrom;if(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.paused){var disabledCardLinks=$(document.body).find(".message.cards[wfid="+insideWorkflows.currentWorkflow.workflowId+"] .cardLink.disabled");if(disabledCardLinks.length>0){disabledCardLinks.removeClass("disabled")}}insideWorkflows.currentWorkflow=wf;if(!wf){return}$(document.body).find(".notification.wfNotification, #inside_prechatForm").remove();insideWorkflows.currentWorkflow.isActive=true;if(!preview){insideWorkflows.currentWorkflow.assistant=insideFrontInterface.chat.getAssistant(wf.operatorId)}else{if(insideWorkflows.currentWorkflow.workflowName){window.parent.window.insideWorkFlows.updateWorkflowPreviewStatusName(insideWorkflows.currentWorkflow.workflowName)}}if(insideWorkflows.currentWorkflow.isBot){if(!chatInProgress&&!welcomeMessageShown){showWelcomeMessage()}showHideChatToHumanMenuButton()}var questionText="";if(wf.step){var step=wf.step;if(step.fields&&step.fields.length>0){for(var i=0;i<step.fields.length;i++){var field=step.fields[i];if(field){questionText=askQuestion(field,step);renderWorkflowField(field,step)}}}scaleWorkflowContainer();if(step.hideChatInput){showHideChatPaneInput(true)}else{showHideChatPaneInput()}}if(insideWorkflows.currentWorkflow.workflowId==insideChatPane.settings.chatSettings.offline.workflow){insideWorkflows.currentWorkflow.isOfflineWorkflow=true;try{_insideGraph.setCookie("inside-owfid",insideWorkflows.currentWorkflow.workflowId,0,"/")}catch(exp){}}else{if(insideWorkflows.currentWorkflow.workflowId==insideChatPane.settings.chatSettings.chatPane.preChatWorkflow){insideWorkflows.currentWorkflow.isPrechatWorkflow=true;try{_insideGraph.setCookie("inside-pcwfid",insideWorkflows.currentWorkflow.workflowId,0,"/")}catch(exp){}}}if(insideWorkflows.currentWorkflow.workflowId==insideWorkflows.settings.settingNoOpWorkflowId){insideWorkflows.currentWorkflow.isLeaveMessageWorkflow=true}if(!stylesLoaded){setStyles()}if(!dontOpenChatpane&&!preview&&!insideChatPane.chatPane.classList.contains("open")){if(insideChatPane.settings.notifications.enabled){if(questionText&&!(insideChatPane.getAvailableAssistants().length===0&&!insideChatPane.settings.offlineChat.enabled)){insideChatPane.showChatNotification({text:questionText,title:insideWorkflows.currentWorkflow.isBot?getWorkflowBotName():null,fromid:wf.operatorId})}}else{insideFrontInterface.openChatPane()}}setTimeout(function(){insideChatPane.removeStartANewChatButton();insideChatPane.removeStartChatButtonFromStaggeringList()},10)}this.stopWorkflowIfNeeded=stopWorkflowIfNeeded;function stopWorkflowIfNeeded(){if(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isPrechatWorkflow&&!insideWorkflows.currentWorkflow.paused&&insideWorkflows.currentWorkflow.isActive){$(document.body).find(".message.workflowMessage[wfid="+insideWorkflows.currentWorkflow.workflowId+"][stepid="+insideWorkflows.currentWorkflow.workflowStepId+"]").remove();cancelWorkflowFromServer(insideWorkflows.currentWorkflow.workflowId);cancelWorkflow()}}this.getWorkflowBotName=getWorkflowBotName;function getWorkflowBotName(){if(settings&&settings.chatSettings&&settings.chatSettings.general&&settings.chatSettings.general.botAlias){if(preview&&typeof(settings.chatSettings.general.botAlias)=="object"&&settings.chatSettings.general.botAlias.type=="multilangstring"){if(settings.chatSettings.general.botAlias[settings.chatSettings.language]){return settings.chatSettings.general.botAlias[settings.chatSettings.language]}else{return insideWorkflows.settings.botName}}else{return settings.chatSettings.general.botAlias}}else{if(insideWorkflows.currentWorkflow&&typeof(insideWorkflows.currentWorkflow.botAlias)=="string"){return insideWorkflows.currentWorkflow.botAlias}else{return insideWorkflows.settings.botName}}}this.getWorkflowBotImage=getWorkflowBotImage;function getWorkflowBotImage(){if(settings&&settings.chatSettings&&settings.chatSettings.general&&settings.chatSettings.general.botAliasImage){if(preview&&typeof(settings.chatSettings.general.botAliasImage)=="object"&&settings.chatSettings.general.botAliasImage.type=="multilangstring"){if(settings.chatSettings.general.botAliasImage[settings.chatSettings.language]){return settings.chatSettings.general.botAliasImage[settings.chatSettings.language]}else{return insideWorkflows.settings.botPicture}}else{return settings.chatSettings.general.botAliasImage}}else{if(insideWorkflows.currentWorkflow&&typeof(insideWorkflows.currentWorkflow.botAliasImage)=="string"){return insideWorkflows.currentWorkflow.botAliasImage}else{return insideWorkflows.settings.botPicture}}}this.showWelcomeMessage=showWelcomeMessage;function showWelcomeMessage(){if(!settings||!settings.showWelcomeMessage){return}var botImage=getWorkflowBotImage();if(botImage){var botImage=customImageUrl+botImage}if(preview||insideFrontInterface.getAvailableAssistants().length>0){if(insideWorkflows.settings.botOnlineWelcomeMessage){$(document.body).find(".message.welcomeGreeting, .message.workflowWelcomeMessage").remove();renderMessageBubble(getWorkflowBotName(),botImage,null,insideWorkflows.settings.botOnlineWelcomeMessage," workflowWelcomeMessage online ")}}else{if(insideWorkflows.settings.botOfflineWelcomeMessage){$(document.body).find(".message.welcomeGreeting, .message.workflowWelcomeMessage").remove();renderMessageBubble(getWorkflowBotName(),botImage,null,insideWorkflows.settings.botOfflineWelcomeMessage," workflowWelcomeMessage offline ")}}welcomeMessageShown=true}this.showHideChatToHumanMenuButton=showHideChatToHumanMenuButton;function showHideChatToHumanMenuButton(){try{if(_preview){preview=_preview}if((preview||insideFrontInterface.getAvailableAssistants().length>0)&&chatInProgress&&currentChatId>0&&insideWorkflows&&insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isBot&&insideChatPane.settings&&insideChatPane.settings.menu&&insideChatPane.settings.menu.showChatToHuman){$(document.body).find("#chatToHuman label").text(insideWorkflows.settings.transfertoOperatorLabel||"Chat to Human");$(document.body).find("#chatToHuman")[0].style.display="inline-block";$(document.body).find("#chatToHuman").unbind("click").click(talkToHumanHandler)}else{$(document.body).find("#chatToHuman").hide()}}catch(e){$(document.body).find("#chatToHuman").hide()}insideChatPane.setChatMenuButtonVisibility()}this.setStyles=setStyles;function setStyles(){var css="";css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field","border-radius","chatSettings.generalStyles.inputCornerRadius","px");css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field","border-color","chatSettings.generalStyles.formBorderColor");css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field.active","border-color","chatSettings.chatPane.menu.footerIconColor");css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field.valid","border-color","chatSettings.generalStyles.formSuccessColor");css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field.invalid","border-color","chatSettings.generalStyles.formErrorColor");css+=insideChatPane.addStyle("#inside_holder .surveyQuestionContainer .picklistOption, .picklist .picklistOption, .message.leaveMessageNotification .btnLeaveMessage, .flexButtonContainer .insideFlexButton, .insideSelectMenu li, .workflowLinks .workflowLink div","border-radius","chatSettings.generalStyles.buttonCornerRadius","px");css+=insideChatPane.addStyle(".insideSelect","border-radius","chatSettings.generalStyles.inputCornerRadius","px");css+=insideChatPane.addStyle("#workflows .picklist .picklistOption, .picklist .picklistOption, .message.leaveMessageNotification .btnLeaveMessage, .flexButtonContainer .insideFlexButton, .insideSelect, .insideSelect, .insideSelectMenu li, .workflowLinks .workflowLink div","border-color","chatSettings.generalStyles.brandColor");css+=insideChatPane.addStyle(".picklist .picklistOption, .message.leaveMessageNotification .btnLeaveMessage, .flexButtonContainer .insideFlexButton, .insideSelect, .insideSelectMenu li, .workflowLinks .workflowLink div","padding-left","chatSettings.generalStyles.buttonPaddingHorizontal","px");css+=insideChatPane.addStyle(".picklist .picklistOption, .message.leaveMessageNotification .btnLeaveMessage, .flexButtonContainer .insideFlexButton, .insideSelect, .insideSelectMenu li, .workflowLinks .workflowLink div","padding-right","chatSettings.generalStyles.buttonPaddingHorizontal","px");css+=insideChatPane.addStyle(".picklist .picklistOption, .message.leaveMessageNotification .btnLeaveMessage, .flexButtonContainer .insideFlexButton, .insideSelect, .insideSelectMenu li, .workflowLinks .workflowLink div","padding-top","chatSettings.generalStyles.buttonPaddingVertical","px");css+=insideChatPane.addStyle(".picklist .picklistOption, .message.leaveMessageNotification .btnLeaveMessage, .flexButtonContainer .insideFlexButton, .insideSelect, .insideSelectMenu li, .workflowLinks .workflowLink div","padding-bottom","chatSettings.generalStyles.buttonPaddingVertical","px");css+=insideChatPane.addStyle("#workflows .picklist .picklistOption, .picklist .picklistOption, .message.leaveMessageNotification .btnLeaveMessage, .flexButtonContainer .insideFlexButton, .insideSelect, .workflowLinks .workflowLink div","color","chatSettings.generalStyles.brandColor");css+=insideChatPane.addStyle("#workflows .picklist .picklistOption:hover, .message.workflowMessage:not(.disabled) .picklist .picklistOption:hover, .message.leaveMessageNotification .btnLeaveMessage:hover, .flexButtonContainer .insideFlexButton:hover, .workflowLinks .workflowLink div:hover","background-color","getOpacityColor(chatSettings.generalStyles.brandColor, 0.1)");css+=insideChatPane.addStyle(".picklist .picklistOption:hover, .picklist .picklistOption.selected","background-color","getOpacityColor(chatSettings.generalStyles.brandColor, 0.1)");css+=insideChatPane.addStyle(".message.workflowMessage .picklist .picklistOption span.icon-add","color","getRgbFromHexCode(chatSettings.generalStyles.brandColor, 20)");css+=insideChatPane.addStyle("#inside_holder .surveyQuestionContainer .picklist .picklistOption span.icon-add","color","getRgbFromHexCode(chatSettings.generalStyles.brandColor, 25)");css+=insideChatPane.addStyle(".message.workflowMessage .picklistBottomButton","background-color","chatSettings.generalStyles.brandColor");css+=insideChatPane.addStyle(".message.workflowMessage .picklistBottomButton","color","chatSettings.generalStyles.secondaryTextColor");css+=insideChatPane.addStyle(".message.workflowMessage .picklistBottomButton","color","chatSettings.chatPane.messages.operatorBackground");css+=insideChatPane.addStyle(".message.workflowMessage .picklistBottomButton","border-bottom-left-radius","chatSettings.chatPane.messages.radius","px");css+=insideChatPane.addStyle(".message.workflowMessage .picklistBottomButton","border-bottom-right-radius","chatSettings.chatPane.messages.radius","px");css+=insideChatPane.addStyle(".insideSelect","border-color","getRgbFromHexCode(chatSettings.generalStyles.primaryTextColor, 40)");css+=insideChatPane.addStyle(".insideSelect","color","chatSettings.generalStyles.primaryTextColor");css+=insideChatPane.addStyle(".insideSelectMenu li","color","chatSettings.generalStyles.primaryTextColor");css+=insideChatPane.addStyle(".insideSelectMenu h2","color","chatSettings.generalStyles.primaryTextColor");css+=insideChatPane.addStyle(".insideSelectMenu span.icon-close","color","getRgbFromHexCode(chatSettings.generalStyles.primaryTextColor, 25)");css+=insideChatPane.addStyle(".insideSelectMenu span.icon-close:hover","color","getRgbFromHexCode(chatSettings.generalStyles.primaryTextColor, 100)");css+=insideChatPane.addStyle(".insideSearchInputHolder.searchCrossIcon","color","getRgbFromHexCode(chatSettings.generalStyles.brandColor, 100)");css+=insideChatPane.addStyle("#workflows #quickResponseLeftScroll span, #workflows #quickResponseRightScroll span","color","chatSettings.generalStyles.primaryTextColor");css+=insideChatPane.addStyle("#insideFieldHelpButton","color","getRgbFromHexCode(chatSettings.generalStyles.primaryTextColor, 30)");css+=insideChatPane.addStyle("#insideFieldHelpButton:hover","color","chatSettings.generalStyles.brandColor");css+=insideChatPane.addStyle("#insideFieldHelpButton:hover, #workflows .picklist .picklistOption","color","chatSettings.chatPane.menu.footerIconColor");css+=insideChatPane.addStyle("#workflows .picklist .picklistOption","border-color","chatSettings.chatPane.menu.footerIconColor");css+=insideChatPane.addStyle("#workflows .picklist .picklistOption:hover","background-color","getRgbFromHexCode(chatSettings.chatPane.menu.footerIconColor, 10)");css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field .countryCode .countryCodeText","color","chatSettings.generalStyles.primaryTextColor");css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field input, #insideWorkflowFieldCell .inside-field textarea","color","chatSettings.generalStyles.primaryTextColor");css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field input::placeholder","color","getRgbFromHexCode(chatSettings.generalStyles.primaryTextColor, 50)");css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field.percentageField span.symbol","color","getRgbFromHexCode(chatSettings.generalStyles.primaryTextColor, 50)");css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field span.symbol","color","getRgbFromHexCode(chatSettings.generalStyles.primaryTextColor, 100)");css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field #disablingOverlay","background-color","getRgbFromHexCode(chatSettings.generalStyles.brandColor, 10)");css+=insideChatPane.addStyle(".message .inside_assistMessageFace span.icon-help","color","chatSettings.generalStyles.brandColor");css+=insideChatPane.addStyle(".message .inside_assistMessageFace span.icon-error","color","chatSettings.generalStyles.formErrorColor");var operatorBackground=insideChatPane.settings.chatSettings.chatPane.messages.operatorBackground;if(operatorBackground&&operatorBackground.length>0&&operatorBackground!="#ffffff"){css+=insideChatPane.addStyle(".message.workflowMessage .picklistBottomButton","background-color","chatSettings.chatPane.messages.operatorTextColor");css+=insideChatPane.addStyle(".message .inside_assistMessageFace span.icon-help, .message .inside_assistMessageFace span.icon-error","color","chatSettings.chatPane.messages.operatorTextColor");css+=insideChatPane.addStyle(".picklist .picklistOption, .message.leaveMessageNotification .btnLeaveMessage, .flexButtonContainer .insideFlexButton, .insideSelect, .workflowLinks .workflowLink div","color","chatSettings.chatPane.messages.operatorTextColor");css+=insideChatPane.addStyle(".picklist .picklistOption, .message.leaveMessageNotification .btnLeaveMessage, .flexButtonContainer .insideFlexButton, .insideSelect, .insideSelect, .insideSelectMenu li, .workflowLinks .workflowLink div","border-color","chatSettings.chatPane.messages.operatorTextColor");css+=insideChatPane.addStyle(".message.workflowMessage:not(.disabled) .picklist .picklistOption:hover, .message.leaveMessageNotification .btnLeaveMessage:hover, .flexButtonContainer .insideFlexButton:hover, .workflowLinks .workflowLink div:hover","background-color","getRgbFromHexCode(chatSettings.chatPane.messages.operatorTextColor, 10)");css+=insideChatPane.addStyle("#workflows .picklist .picklistOption:hover, .message.workflowMessage:not(.disabled) .picklist .picklistOption:hover, .message.leaveMessageNotification .btnLeaveMessage:hover, .flexButtonContainer .insideFlexButton:hover, .workflowLinks .workflowLink div:hover, .picklist .picklistOption:hover, .picklist .picklistOption:focus, .picklist .picklistOption.selected","background-color","getRgbFromHexCode(chatSettings.chatPane.messages.operatorBackground, 85)");css+=insideChatPane.addStyle(".surveyQuestionContainer .picklist .picklistOption, .insideSelectMenu li","background-color","'white'");css+=insideChatPane.addStyle(".surveyQuestionContainer .picklist .picklistOption:hover, .surveyQuestionContainer .picklist:not(.multiple) .picklistOption.selected, .insideSelectMenu li:hover","background-color","getRgbFromHexCode(chatSettings.generalStyles.brandColor, 10)");css+=insideChatPane.addStyle(".insideSelectMenu li, .message.workflowMessage .picklistBottomButton","border","'1px solid white'");css+=insideChatPane.addStyle(".insideSelectMenu li","margin-bottom","'9px'");css+=insideChatPane.addStyle(".surveyQuestionContainer .picklist .picklistOption, .insideSelectMenu li","border-color","chatSettings.generalStyles.brandColor");css+=insideChatPane.addStyle(".surveyQuestionContainer .picklist .picklistOption, .insideSelectMenu li","color","chatSettings.generalStyles.brandColor");css+=insideChatPane.addStyle(".message.workflowMessage .picklistBottomButton","border-color","chatSettings.chatPane.messages.operatorBackground")}css+=insideChatPane.addStyle(".message.system.leaveMessageNotification .bubble","color","getRgbFromHexCode(chatSettings.generalStyles.primaryTextColor, 100)");if(insideChatPane.settings.chatSettings.generalStyles.hideInputBorder==true&&(typeof insideChatPane.settings.chatSettings.generalStyles.inputBackground=="undefined"||insideChatPane.settings.chatSettings.generalStyles.inputBackground.length==0)){css+=insideChatPane.addStyle("#insideWorkflowFieldCell .inside-field.invalid input, #insideWorkflowFieldCell .inside-field.invalid textarea","color","chatSettings.generalStyles.formErrorColor")}insideChatPane.addStyleString(css,"insideWorkflowStyles");stylesLoaded=true;_this.stylesLoaded=true}this.getWorkflowPreview=getWorkflowPreview;function getWorkflowPreview(id){insideAPI.post("api/workflow/SendWorkflowArchiveForPreview",{workflowArchiveId:id},function(response){workflowArchiveId=id})}this.showWorkflowPreview=showWorkflowPreview;function showWorkflowPreview(data){if(!data||!data.obj){return}preview=true;if(data.type==="message"){if(data.obj){if(data.obj.datetime){data.obj.date=new Date(data.obj.datetime)}if(data.obj.metadata&&data.obj.metadata.cards){data.obj.data={cards:data.obj.metadata.cards}}var botNameAlias=getWorkflowBotName();if(botNameAlias){data.obj.fromname=botNameAlias}var botImageAlias=getWorkflowBotImage();if(botImageAlias){data.obj.fromImageURL=customImageUrl+botImageAlias}insideChatPane.addMessage(data.obj)}}else{if(data.type==="workflowReceived"){var workflow=data.obj.workflowAction;if(workflow&&(!insideWorkflows.currentWorkflow||workflow.workflowId!==insideWorkflows.currentWorkflow.workflowId||!insideWorkflows.currentWorkflow.isActive)){insideWorkflows.currentWorkflow=null;startWorkflow(workflow);setTimeout(function(){window.parent.window.insideWorkFlows.showHidePreviewStatus()},1000)}}else{if(data.type==="userVerified"){}else{if(data.type==="chataccepted"){if(data.obj&&data.obj.opname){insideChatPane.showOperatorTakesChatMessage(data.obj.opname,true)}}}}}}function hideWorkflowWidgets(dontDisableCardLinks){$(insideChatPane.chatPaneContent).find(".workflowHelpBubble").remove();$(document.body).find("#insideWorkflowFieldCell").hide();$(document.body).find("#chatInputCell").show();$(document.body).find(".message.workflowHelpBubble, .message.workflowErrorMessage").remove();$(document.body).find(".message.workflowMessage.noQuestion").remove();$(document.body).find(".message.workflowMessage .picklist, .message.workflowMessage .picklistBottomButton").remove();$(document.body).find(".message.workflowMessage.fullWidth").removeClass("fullWidth");$(document.body).find(".message.workflowMessage .insideSelect").remove();$(document.body).find("#inside_holder .insideSelectMenu").remove();$(document.body).find(".message.operator .flexButtonContainer").remove();$(document.body).find("#workflows").removeClass("chatInputHidden").empty().hide();insideChatPane.chatPane.querySelector("#insideChatPaneFooter").classList.remove("bottomAligned");if(!dontDisableCardLinks){$(document.body).find(".message.cards .cardLink[onclick]").addClass("disabled")}if(insideWorkflows.currentWorkflow){insideWorkflows.currentWorkflow.isActive=false}$(document.body).find("#chatToHuman").hide();insideChatPane.setChatMenuButtonVisibility();insideChatPane.setSendButton();insideChatPane.scaleChatInput();insideChatPane.setInputAvailability();if(insideChatPane.startANewChatButtonShowing()){}else{showHideChatPaneInput()}}this.pauseWorkflow=pauseWorkflow;function pauseWorkflow(){$(document.body).find("#insideWorkflowFieldCell").hide();$(document.body).find("#chatInputCell").show();$(document.body).find(".message.workflowHelpBubble").remove();$(document.body).find(".message.operator .flexButtonContainer").remove();insideChatPane.chatPane.querySelector("#insideChatPaneFooter").classList.remove("bottomAligned");insideWorkflows.currentWorkflow.paused=true;insideWorkflows.currentWorkflow.isActive=false;insideChatPane.setSendButton();insideChatPane.scaleChatInput()}this.cancelWorkflow=cancelWorkflow;function cancelWorkflow(){hideWorkflowWidgets();insideWorkflows.currentWorkflow=null;if(preview){window.parent.window.insideWorkFlows.showHidePreviewStatus()}}this.abort=abortWorkflow;function abortWorkflow(){cancelWorkflow()}this.cancelWorkflowFromServer=cancelWorkflowFromServer;function cancelWorkflowFromServer(wfid,successCallback){insideAPI.post("api/workflow/CancelWorkflow",{workflowId:wfid},function(response){if(typeof(successCallback)=="function"){successCallback()}})}this.scaleWorkflowContainer=scaleWorkflowContainer;function scaleWorkflowContainer(){var chatpane=$("#inside_holder .inside_chatPane, #inside_holder #inside_chatPane_custom");var messageContainer=$("#inside_chatWindow, #inside_holder #inside_chatPane_custom_chatHolder");var wfContainer=$("#inside_holder #inside_workflowcontainer");var w=messageContainer.width()-20;var h=messageContainer.height();wfContainer.css({width:w+"px"})}this.disableInputField=disableInputField;function disableInputField(customPlaceholderMessage){if(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isActive){$(document.body).find("#insideWorkflowFieldCell").addClass("inputDisabled");var target=$(document.body).find("#insideWorkflowFieldCell input, #insideWorkflowFieldCell textarea");if(target.length>0&&!target.attr("disabled")){if(typeof customPlaceholderMessage=="undefined"){target.attr("placeholder",insideChatPane.translate("Reconnecting").toLowerCase()+"...")}target.attr("disabled","true");target.css("opacity","0.3");$(document.body).find("#insideWorkflowFieldCell #insideFieldHelpButton").hide();$(document.activeElement).blur()}if($(document.body).find(".message.workflowMessage .picklist").length>0){$(document.body).find(".message.workflowMessage .picklist").parents(".message.workflowMessage").addClass("disabled")}if($(document.body).find(".message.workflowMessage .insideSelect").length>0){$(document.body).find(".message.workflowMessage .insideSelect").addClass("disabled");$(document.body).find(".message.workflowMessage .insideSelect").parents(".message.workflowMessage").addClass("disabled")}if($(document.body).find("#workflows .picklist").length>0){$(document.body).find("#workflows").addClass("disabled")}if(typeof customPlaceholderMessage!="undefined"){if(customPlaceholderMessage!=""){target.attr("placeholder",customPlaceholderMessage)}}}}this.enableInputField=enableInputField;function enableInputField(){if(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isActive){$(document.body).find("#insideWorkflowFieldCell").removeClass("inputDisabled");var target=$(document.body).find("#insideWorkflowFieldCell input, #insideWorkflowFieldCell textarea");target.removeAttr("disabled").css("opacity","1");$(document.body).find("#insideWorkflowFieldCell #insideFieldHelpButton").show();try{if(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.step&&insideWorkflows.currentWorkflow.step.fields&&insideWorkflows.currentWorkflow.step.fields[0]){if(insideWorkflows.currentWorkflow.step.fields[0].placeHolderText){target.attr("placeholder",insideWorkflows.currentWorkflow.step.fields[0].placeHolderText)}else{if(insideWorkflows.currentWorkflow.step.fields[0].fieldType===fieldTypes.Number&&insideWorkflows.currentWorkflow.step.fields[0].field&&insideWorkflows.currentWorkflow.step.fields[0].field.type===3){var hdnPhoneField=$(document.body).find("#hdnCCPhoneField");target.attr("placeholder",hdnPhoneField.attr("placeholder"))}else{target.attr("placeholder","")}}}else{target.attr("placeholder","")}}catch(exp){target.attr("placeholder","")}if($(document.body).find(".message.workflowMessage .picklist").length>0){$(document.body).find(".message.workflowMessage .picklist").parents(".message.workflowMessage").removeClass("disabled")}if($(document.body).find(".message.workflowMessage .insideSelect").length>0){$(document.body).find(".message.workflowMessage .insideSelect").removeClass("disabled");$(document.body).find(".message.workflowMessage .insideSelect").parents(".message.workflowMessage").removeClass("disabled")}if($(document.body).find("#workflows .picklist").length>0){$(document.body).find("#workflows").removeClass("disabled")}}}this.getWorkflowLinksHtml=getWorkflowLinksHtml;function getWorkflowLinksHtml(links){var linkHtml='<div class="workflowLinks">';for(var i=0;i<links.length;i++){var link=links[i];if(link.type===1){linkHtml+='<a class="workflowLink" href="'+((device==2||device==3)&&link.appValue?link.appValue:link.value)+'" target="_top"><div><span class="icon-external-link"></span>'+link.text+"</div></a>"}else{if(link.type===2){linkHtml+='<a class="workflowLink" href="'+((device==2||device==3)&&link.appValue?link.appValue:link.value)+'" target="_blank"><div><span class="icon-external-link"></span>'+link.text+"</div></a>"}else{if(link.type===3){linkHtml+='<a class="workflowLink phone" href="tel:'+link.value+'" target="_blank"><div><span class="icon-phone1"></span>'+link.text+"</div></a>"}else{if(link.type===4){linkHtml+='<a class="workflowLink email" href="mailto:'+link.value+'" target="_blank"><div><span class="icon-email"></span>'+link.text+"</div></a>"}}}}}linkHtml+="</div>";return linkHtml}this.getCardsCarouselHtml=getCardsCarouselHtml;function getCardsCarouselHtml(cards){console.log(cards);var carousel="<div class='cardsContainer' cindex='1'>";if(cards.length>1&&device===1){carousel+="<div class='cardsScrollLeft' style='display:none;'><span class='icon-arrow-left'></span></div>"}for(var i=0;i<cards.length;i++){carousel+=createCard(cards[i])}carousel+="<div style='float:left;width:18px;min-width:18px;'></div>";if(cards.length>1&&device===1){carousel+="<div class='cardsScrollRight'><span class='icon-arrow-right'></span></div>"}return carousel+"</div>"}var cards=[];function createCard(card){card.id=cards.length;cards.push(card);var cardUrl=card.url?card.url.replace(/^http(s?):\/\//,""):"";var cardHtml="<div class='card'><span onclick='insideWorkflows.executeCardAction(null, null, null, "+card.id+")'><div class='cardImage'><canvas imageUrl='"+card.image+"'></canvas></div><div class='cardTitle'>"+insideChatPane.truncateString(card.title?card.title:"",80)+"</div><div class='cardSubtitle'>"+insideChatPane.truncateString(card.subtitle?card.subtitle:"",80)+"</div><div class='cardUrl'>"+insideChatPane.truncateString(cardUrl,50)+"</div></span><a class='cardtemplink'></a>";if(card.links&&card.links.length>0){cardHtml+="<div class='cardLinksHolder'><div class='cardLinks'>";for(var i=0;i<card.links.length;i++){var link=card.links[i],text=link.text;if(link.linkAction){var action=link.linkAction;if(action.links&&action.links.length>0){var type=action.links[0].type;var value=action.links[0].value;var appValue=action.links[0].appValue;if(type===1){cardHtml+="<div class='cardLink externalLink'><a target='_top' href='"+((device==2||device==3)&&appValue?appValue:value)+"'>"+text+"</a></div>"}else{if(type===2){cardHtml+="<div class='cardLink externalLink'><a target='_blank' href='"+((device==2||device==3)&&appValue?appValue:value)+"'>"+text+"</a></div>"}else{if(type===3){cardHtml+="<div class='cardLink externalLink'><a target='_blank' href='tel:"+value+"'>"+text+"</a></div>"}else{if(type===4){cardHtml+="<div class='cardLink externalLink'><a target='_blank' href='mailto:"+value+"'>"+text+"</a></div>"}}}}}else{if(action.nextStepType>0){cardHtml+="<div class='cardLink' onclick='insideWorkflows.executeCardAction("+action.nextStepType+","+action.jumpStepId+",null,null,"+action.jumpStepId+","+action.jumpWorkflowId+","+action.jumpWorkflowStepId+","+action.startaNewWorkflow+","+action.endConversation+","+action.transferAndStartAWorkflow+","+action.endWorkflowTransfer+","+(action.transferTeamIds?'"['+action.transferTeamIds+']"':"undefined")+","+(action.transferChannelIds?'"['+action.transferChannelIds+']"':"undefined")+","+action.workflowStatus+");'><label>"+text+"</label></div>"}else{if(typeof(action.triggerCustomScript)!="undefined"){if(!customScripts){customScripts={}}var key=Object.keys(customScripts).length;customScripts[key]=action.triggerCustomScript;cardHtml+="<div class='cardLink' onclick='insideWorkflows.executeCardAction(null, null, \""+key+"\")'>"+text+"</div>"}}}}}cardHtml+="</div></div>"}cardHtml+="</div>";return cardHtml}this.executeCardAction=executeCardAction;function executeCardAction(nextStepType,stepId,scriptId,cardId,jumpStepId,jumpWorkflowId,jumpWorkflowStepId,startaNewWorkflow,endConversation,transferAndStartAWorkflow,endWorkflowTransfer,transferTeamIds,transferChannelIds,workflowStatus){var cardElement=$(event.target).parents(".card");if(cardId!==null&&typeof(cardId)!=="undefined"&&cardId>=0){var card=cards[cardId];if(card){var action;if(card.cardAction){action=card.cardAction}else{for(var i=0;i<card.links.length>0;i++){var link=card.links[i];if(link["default"]){action=link.linkAction;break}}}if(action){processAction(action)}}}else{if(scriptId){try{eval(customScripts[scriptId])}catch(e){console.log(e)}}else{if(!preview&&!chatInProgress){insideChatPane.showSystemMessage(insideChatPane.translate("Sorry, this link is no longer available as the Chat has ended."));return}var mid=$(event.target).parents(".message.cards").attr("mid");var wfid=$(event.target).parents(".message.cards").attr("wfid");var wfstepid=$(event.target).parents(".message.cards").attr("stepid");if(typeof(transferTeamIds)=="string"){try{transferTeamIds=JSON.parse(transferTeamIds)}catch(ex){transferTeamIds=undefined}}if(typeof(transferChannelIds)=="string"){try{transferChannelIds=JSON.parse(transferChannelIds)}catch(ex){transferChannelIds=undefined}}if(event){if($(event.target).hasClass("disabled")||$(event.currentTarget).hasClass("disabled")||$(event.target).parents(".cardLink").hasClass("disabled")){return}if(event.target&&$(event.target).hasClass(".cardLink")){$(event.target).addClass("disabled")}else{if(event.currentTarget&&$(event.currentTarget).hasClass("cardLink")){$(event.currentTarget).addClass("disabled")}else{if(event.target){$(event.target).parents(".cardLink").addClass("disabled")}}}}insideAPI.post(preview?"api/workflow/TriggerWorkflowArchiveAction":"api/workflow/TriggerWorkflowAction",{action:{NextStepType:nextStepType,JumpStepId:jumpStepId,JumpWorkflowId:jumpWorkflowId,JumpWorkflowStepId:jumpWorkflowStepId,EndConversation:endConversation,TransferAndStartAWorkflow:transferAndStartAWorkflow,EndWorkflowTransfer:endWorkflowTransfer,TransferTeamIds:transferTeamIds,TransferChannelIds:transferChannelIds,StartaNewWorkflow:startaNewWorkflow,WorkflowStatus:workflowStatus},messageId:mid,workflowId:wfid,workflowStepId:wfstepid,workflowArchiveId:workflowArchiveId},function(response){if(typeof(response)=="string"){insideChatPane.showSystemMessage(insideChatPane.translate(response))}else{if(response&&typeof(response)=="object"&&response.status!==4){cancelWorkflow()}}})}}function processAction(action){if(action.links&&action.links.length>0){var type=action.links[0].type;var value=action.links[0].value;var appValue=action.links[0].appValue;var link=cardElement.find(".cardtemplink");if(link){if(type===1||type===2){link.attr("href",((device==2||device==3)&&appValue?appValue:value));link.attr("target",type===1?"_top":"_blank")}else{if(type===3){value="tel:"+value}else{if(type===4){value="mailto:"+value}}link.attr("href",value);link.attr("target","_blank")}link[0].click()}}else{if(action.nextStepType>0){if(!chatInProgress){insideChatPane.showSystemMessage(insideChatPane.translate("Sorry, this link is no longer available as the Chat has ended."));return}executeCardAction(action.nextStepType,action.jumpStepId,null,null,action.jumpStepId,action.jumpWorkflowId,action.jumpWorkflowStepId,action.startaNewWorkflow,action.endConversation,action.transferAndStartAWorkflow,action.endWorkflowTransfer,action.transferTeamIds,action.transferChannelIds,action.workflowStatus)}else{if(typeof(action.triggerCustomScript)!="undefined"){if(!customScripts){customScripts={}}var key=Object.keys(customScripts).length;customScripts[key]=action.triggerCustomScript;executeCardAction(null,null,key)}}}}}this.bindCardsCarouselEvents=bindCardsCarouselEvents;function bindCardsCarouselEvents(message){$(message).find(".cardImage canvas").each(function(){var imageUrl=$(this).attr("imageUrl");if(!imageUrl){$(this).hide();return}crop(imageUrl,1.91/1,$(this)[0])});$(message).find(".card").each(function(){$(this).find(".cardLinksHolder").css("height",($(this).find(".cardLink").length*40+20)+"px")});var scrollInProgress=false;$(message).find(".cardsScrollLeft, .cardsScrollRight").click(function(){if(scrollInProgress){return}scrollInProgress=true;var cardElement=$(this).parent();var cardIndex=parseInt(cardElement.attr("cindex"));var cardWidth=cardElement.find(".card").outerWidth();var cardCount=cardElement.find(".card").length;var scrollWidth=(cardCount*cardWidth)+(cardCount*18);var l=cardElement[0].scrollLeft;if($(this).hasClass("cardsScrollLeft")){cardIndex=(cardIndex-1)<1?1:cardIndex-1;var x=l-cardWidth-18;x=x<0?0:x;if(cardIndex+1===cardCount){x-=18}cardElement.scrollLeft(x)}else{if(l>=scrollWidth){return}cardIndex=(cardIndex+1)>=cardCount?cardCount:cardIndex+1;var x=l+cardWidth+18;if(cardIndex===cardCount){x+=18}cardElement.scrollLeft(x)}if(cardIndex===1){cardElement.find(".cardsScrollLeft").fadeOut(250)}else{cardElement.find(".cardsScrollLeft").fadeIn(250)}if(cardIndex>=cardCount){cardElement.find(".cardsScrollRight").fadeOut(250)}else{cardElement.find(".cardsScrollRight").fadeIn(250)}cardElement.attr("cindex",cardIndex);setTimeout(function(){scrollInProgress=false},300)})}function crop(url,aspectRatio,canvas){var inputImage=new Image();inputImage.onload=function(){console.log(url);var inputWidth=inputImage.naturalWidth;var inputHeight=inputImage.naturalHeight;var inputImageAspectRatio=inputWidth/inputHeight;var outputWidth=inputWidth;var outputHeight=inputHeight;var x=0,y=0;var canvasWidth,canvasHeight;if(outputWidth>258||outputHeight>258){if(inputImageAspectRatio>aspectRatio){outputWidth=inputHeight*aspectRatio}else{if(inputImageAspectRatio<aspectRatio){outputHeight=inputWidth/aspectRatio}}canvasWidth=outputWidth<258?258:outputWidth;canvasHeight=outputHeight<150?150:outputHeight}else{canvasWidth=outputWidth<258?258:outputWidth;canvasHeight=outputHeight<150?150:outputHeight;x=canvasWidth/2-outputWidth/2;y=canvasHeight/2-outputHeight/2}canvas.width=canvasWidth;canvas.height=canvasHeight;canvas.getContext("2d").drawImage(inputImage,x,y)};inputImage.src=url}function bindInputFocus(el){el.find("input, textarea").focus(function(){insideChatPane.inputFocus()}).blur(function(){insideChatPane.inputFocus()})}function getUserCC(){var countryCode="us";try{if($.inside.front.settingsData&&$.inside.front.settingsData.location&&$.inside.front.settingsData.location.cc&&$.inside.front.settingsData.location.cc.length>0){countryCode=$.inside.front.settingsData.location.cc.toLowerCase()}}catch(e){countryCode="us"}return countryCode}function renderWorkflowField(f,step){if(f.fieldType==fieldTypes.Text||f.fieldType==fieldTypes.Number){$(document.body).find("#chatInputCell, #attachButton").hide();$(document.body).find("#insideWorkflowFieldCell").empty().show();var inputField=$("<div class='inside-field "+getDatafieldCssClass(f,step)+"' fid='"+f.dataFieldId+"'>"+getInputFieldHtml(f)+"<span tabindex='2' role='button' id='insideFieldHelpButton' class='icon-footer-info' aria-label='"+insideChatPane.translate("Help")+"'></span></div>");bindInputFocus(inputField);if(f.placeHolderText&&f.placeHolderText.length>0){inputField.find("input, textarea").attr("placeholder",f.placeHolderText).attr("aria-label",f.placeHolderText)}if(f.defaultValue&&f.defaultValue.length>0){inputField.find("input, textarea").val(f.defaultValue)}if(f.fieldType===fieldTypes.Text){var element;if(f.field&&f.field.type===4){element=inputField.find("textarea");if(f.placeHolderText&&f.placeHolderText.length>0){element.attr("placeholder",f.placeHolderText)}insideChatPane.chatPane.querySelector("#insideChatPaneFooter").classList.add("bottomAligned")}else{element=inputField.find("input")}if(typeof(f.height)!="undefined"&&f.height>0){element.css("height",f.height)}if(typeof(f.width)!=="undefined"&&f.width>0){element.css("width",f.width)}if(typeof(f.field.maxCharacters)!="undefined"&&f.field.maxCharacters>0){element.attr("maxlength",f.field.maxCharacters)}if(step.allDataAlreadyExist===3&&typeof(f.existingValue)!="undefined"&&f.existingValue.length>0){element.val(f.existingValue)}}else{if(f.fieldType===fieldTypes.Number){if(f.field.type===3){inputField.prepend("<div class='countryCode'><div class='countryCodeText'>+1</div><div class='arrowIcon icon-minimise_2'></div></div>");var _onComplete=function(){setTimeout(function(){validateInputField(null,f,inputField.find("input, textarea").val(),inputField.find("input, textarea"));hdnPhoneField=$(document.body).find("#hdnCCPhoneField");if(step.allDataAlreadyExist===3&&typeof(f.existingValue)!="undefined"&&f.existingValue.length>0){hdnPhoneField.intlTelInput("setNumber",f.existingValue);var countryData=hdnPhoneField.intlTelInput("getSelectedCountryData");if(countryData){inputField.find(".countryCodeText").text("+"+countryData.dialCode)}inputField.find("input").val(f.existingValue.replace("+"+countryData.dialCode,""));setSendButton()}else{if(f.defaultCountryCode){hdnPhoneField.intlTelInput("setCountry",f.defaultCountryCode);var countryData=hdnPhoneField.intlTelInput("getSelectedCountryData");if(countryData){inputField.find(".countryCodeText").text("+"+countryData.dialCode)}}else{hdnPhoneField.intlTelInput("setCountry",getUserCC());var countryData=hdnPhoneField.intlTelInput("getSelectedCountryData");if(countryData){inputField.find(".countryCodeText").text("+"+countryData.dialCode)}}}inputField.find("input").attr("placeholder",hdnPhoneField.attr("placeholder"))},500)};insideChatPane.setupCountryCodeDropdown(_onComplete)}else{if(f.field.iscompany){if(step.allDataAlreadyExist===3&&typeof(f.existingValue)!="undefined"&&f.existingValue.length>0){inputField.find("input").val(f.existingValue)}}else{if(typeof(f.field.minNumber)!="undefined"&&parseInt(f.field.minNumber)>0){inputField.find("input").attr("min",f.field.minNumber)}if(typeof(f.field.maxNumber)!="undefined"&&parseInt(f.field.maxNumber)>0){inputField.find("input").attr("max",f.field.maxNumber)}if(typeof(f.field.decimalPlaces)!="undefined"){}if(step.allDataAlreadyExist===3&&typeof(f.existingValue)!="undefined"&&f.existingValue.length>0){inputField.find("input").val(f.existingValue)}}}}}inputField.find("input, textarea").on("keyup blur",f,validateInputField);inputField.find("input, textarea").on("keyup",f,setSendButton);inputField.find("input").focus(function(){if(!inputField.hasClass("valid")&&!inputField.hasClass("invalid")){inputField.addClass("active")}}).blur(function(){if(inputField.hasClass("active")){inputField.removeClass("active")}});bindInputFocus(inputField);inputField.find("textarea").keyup(scaleTextarea);inputField.find("#insideFieldHelpButton").click(function(){showHelpMessage(f,step)}).clickableByKeyboard();$(document.body).find("#insideWorkflowFieldCell").append(inputField);if(f.fieldType===fieldTypes.Number&&f.field.type===3){$(document.body).find("#insideWorkflowFieldCell .countryCode").click(function(){if($(document.body).find(".insideSelectMenu").length===0){var countryCode="us";if(step.allDataAlreadyExist===3&&typeof(f.existingValue)!="undefined"&&f.existingValue.length>0){var hdnPhoneField=$(document.body).find("#hdnCCPhoneField");var countryData=hdnPhoneField.intlTelInput("getSelectedCountryData");if(countryData){countryCode=countryData.iso2}}else{if(f.defaultCountryCode){countryCode=f.defaultCountryCode}}}insideChatPane.showCountryCodeDropdown(countryCode,$(document.body).find("#insideWorkflowFieldCell .countryCodeText"),$(document.body).find("#insideWorkflowFieldCell .inside-field input"),function(elem){validateInputField(null,f,inputField.find("input, textarea").val(),inputField.find("input, textarea"))})})}else{validateInputField(null,f,inputField.find("input, textarea").val(),inputField.find("input, textarea"))}if(f.fieldType===fieldTypes.Text&&f.field&&f.field.type===4){scaleTextarea();setTimeout(scaleTextarea,100)}else{scaleInputField();setTimeout(scaleInputField,100)}if(device!=2){inputField.find("input, textarea").focus();setTimeout(function(){inputField.focus()},100)}setTimeout(setSendButton,100);if(step.questionTextExistingData==""&&step.questionTextNoExistingData==""){insideChatPane.removeOpTypingMessage()}}else{if(f.fieldType==fieldTypes.Boolean||f.fieldType==fieldTypes.Picklist){var wfMessageBubble;if(chatInProgress&&insideWorkflows.currentWorkflow.messageId){wfMessageBubble=$(document.body).find(".message.workflowMessage[mid="+insideWorkflows.currentWorkflow.messageId+"]");renderPicklist(f,step,wfMessageBubble)}else{if(preview){setTimeout(function(){wfMessageBubble=$(document.body).find(".message.workflowMessage:last");renderPicklist(f,step,wfMessageBubble);insideChatPane.scrollToBottom()},2000)}else{wfMessageBubble=$(document.body).find(".message.workflowMessage:last");renderPicklist(f,step,wfMessageBubble)}}}}setTimeout(insideChatPane.setFrameHeight,101)}this.scaleInputField=scaleInputField;function scaleInputField(){var inputFieldWrapper=$(document.body).find("#insideWorkflowFieldCell .inside-field");var inputField=inputFieldWrapper.find("input");if(inputField.length>0){var h=insideChatPane.settings.chatSettings.generalStyles.inputPaddingVertical*2+22;if(h<22){h=22}inputFieldWrapper.css("height",h+"px")}if(inputFieldWrapper.find(".symbol").length>0){inputField.css("width","calc(100% - "+(inputFieldWrapper.find(".symbol").width()+20)+"px)")}}var textareaMinHeight;this.scaleTextarea=scaleTextarea;function scaleTextarea(){if(!textareaMinHeight){calculateTextareaMinHeight()}var maxHeight=$(document.body).find("#insideChatPane").outerHeight()/2;var element=$(document.body).find("#insideWorkflowFieldCell textarea");if(element.length>0){element.css("height","5px");var h=element[0].scrollHeight;h=h>maxHeight?maxHeight:h;h=h<textareaMinHeight?textareaMinHeight:h;element.css("height",h+"px");element.parents(".inside-field.textareaHolder").css("height",(h+2)+"px")}insideChatPane.chatPane.querySelector("#insideChatPaneFooter").style.height="";insideChatPane.chatPane.querySelector("#insideChatPaneInputFooter").style.height=""}function calculateTextareaMinHeight(){textareaMinHeight=120;var textarea=$(document.body).find("#insideWorkflowFieldCell textarea");var lineHeight=textarea.css("line-height");if(lineHeight){try{lineHeight=parseFloat(lineHeight.replace("px",""))}catch(exp){lineHeight=0}}var paddingTop=textarea.css("padding-top");var paddingBottom=textarea.css("padding-bottom");try{paddingTop=parseFloat(paddingTop.replace("px",""))}catch(exp){paddingTop=0}try{paddingBottom=parseFloat(paddingBottom.replace("px",""))}catch(exp){paddingBottom=0}textareaMinHeight=(lineHeight*3)+paddingTop+paddingBottom}function getSortedPicklistOptions(data){var sortAlphabetically=data.sortAlphabetically;var field=data.field;var sortFunction;if(sortAlphabetically){sortFunction=function(a,b){var textA=a.value.toUpperCase();var textB=b.value.toUpperCase();return(textA<textB)?-1:(textA>textB)?1:0}}else{sortFunction=function(a,b){return parseInt(a.order)-parseInt(b.order)}}return field.optionList.filter(function(f){return!f.isDeleted}).sort(sortFunction)}function renderPicklist(f,step,wfMessageBubble){if(wfMessageBubble.length===0){insideWorkflows.currentWorkflow.renderingPending=true;return}insideWorkflows.currentWorkflow.renderingPending=false;if(insideWorkflows.currentWorkflow.isBot&&f.picklistStyle!==4){showHideChatPaneInput(true)}var options=[];if(f.fieldType==fieldTypes.Boolean){options.push({id:1,label:f.field.trueLabel});options.push({id:0,label:f.field.falseLabel})}else{if(f.fieldType==fieldTypes.Picklist){options=getSortedPicklistOptions(f)}}var dataAlreadyExist=false;if(step.allDataAlreadyExist===3&&typeof(f.existingValue)!="undefined"&&f.existingValue.length>0){dataAlreadyExist=true}var fieldElement;if(f.picklistStyle===1){fieldElement=$("<div tabindex='2' class='insideSelect' selectedval='"+(dataAlreadyExist?f.existingValue:"")+"' fid='"+f.dataFieldId+"'><span class='insideSelectLabel'>"+(f.placeHolderText?insideFrontInterface.escapeHtml(f.placeHolderText):"Select")+"</span><span class='insideSelectIcon icon-minimise_2'></span></div>")}else{fieldElement=$("<div class='picklist "+(f.picklistStyle===2?" vertical ":" wrapping ")+(f.fieldType===fieldTypes.Picklist&&f.field.type===2?" multiple ":"")+"' fid='"+f.dataFieldId+"'><div class='picklistOptions'>"+getPicklistOptionsHtml(f,options)+getPicklistButtonsHtml(f,step)+"</div></div>")}wfMessageBubble.find(".bubble").attr({role:"menu","aria-label":wfMessageBubble.find(".content").text(),}).focus();if(f.picklistStyle!==4){wfMessageBubble.find(".messageContent .content").append(fieldElement);wfMessageBubble.addClass("fullWidth")}if(f.picklistStyle===1){wfMessageBubble.find(".content .insideSelect").click(function(){if($(this).hasClass("disabled")){return}if($(document.body).find(".insideSelectMenu").length===0){var dropdownLabel=insideFrontInterface.escapeHtml(f.placeHolderText?f.placeHolderText:"Select");$(document.body).find("#inside_holder").append("<div class='insideSelectMenu'><div><h2>"+dropdownLabel+"</h2><span tabindex='2' aria-label='"+insideChatPane.translate("Close")+"' class='insideSelectMenuClose icon-close'></span></div><div class='insideSelectList' role='menu' tabindex='2' aria-label='"+dropdownLabel+"'>"+getDropdownOptions(options,f,step,dataAlreadyExist)+"</div></div>");$(document.body).find(".insideSelectMenu").show();if(dataAlreadyExist){$(document.body).find(".insideSelectList li[value='"+f.existingValue+"']").addClass("selected")}$(document.body).find(".insideSelectMenu .icon-close").click(function(){insideChatPane.closeDropdown();$(insideChatPane.chatPaneContent).find("[tabindex]:last").focus()}).clickableByKeyboard();$(document.body).find(".insideSelectMenu li").click(function(){$(document.body).find(".insideSelectMenu li.selected").removeClass("selected");$(this).addClass("selected");wfMessageBubble.find(".insideSelect").attr("selectedval",$(this).attr("value"));wfMessageBubble.find(".insideSelect span.insideSelectLabel").html($(this).html());insideChatPane.closeDropdown();var selectedval=$(this).attr("value");if(selectedval=="insidecancelstep"){submitWorkflowStep(step,2);return}if(dataAlreadyExist){if($(document.body).find(".insideSelectList li.selected").length>0){wfMessageBubble.find(".picklistBottomButton.skipButton").hide();wfMessageBubble.find(".picklistBottomButton.submitButton").show()}else{wfMessageBubble.find(".picklistBottomButton.skipButton").show();wfMessageBubble.find(".picklistBottomButton.submitButton").hide()}}else{if(selectedval=="insideskipstep"){submitWorkflowStep(step,3)}else{submitWorkflowStep(step,1)}}}).clickableByKeyboard();insideChatPane.scaleDropdown()}else{insideChatPane.scaleDropdown()}$(document.body).find(".insideSelectList").focus()}).clickableByKeyboard();if(dataAlreadyExist){var selectedOption=options.filter(function(o){return o.id==f.existingValue});if(selectedOption.length>0){wfMessageBubble.find(".insideSelect .insideSelectLabel").html(selectedOption.label)}renderPicklistButtons(wfMessageBubble,step)}}else{if(f.picklistStyle===4){$(document.body).find("#workflows").append("<div id='quickResponseLeftScroll'><span class='icon-arrow-left'></span></div><div class='picklist'>"+getPicklistOptionsHtml(f,options)+getPicklistButtonsHtml(f,step)+"<div class='picklistDummyOption'></div></div><div tabindex='2' id='quickResponseRightScroll'><span class='icon-arrow-right'></span></div>").show();$(document.body).find("#workflows #quickResponseLeftScroll, #workflows #quickResponseRightScroll").click(function(){var l=$(document.body).find("#workflows .picklist")[0].scrollLeft;if($(this).attr("id")==="quickResponseLeftScroll"){if(l===0){return}var x=l-300;x=x<0?0:x;$(document.body).find("#workflows .picklist").animate({scrollLeft:x},900)}else{var x=l+300;$(document.body).find("#workflows .picklist").animate({scrollLeft:x},900)}}).clickableByKeyboard();if(step.hideChatInput){$(document.body).find("#workflows").addClass("chatInputHidden")}$(document.body).find("#workflows .picklist .picklistOption").click(function(){$(this).addClass("selected");submitWorkflowStep(step,1)}).clickableByKeyboard();setTimeout(function(){if(insideChatPane.isOpen()&&$(document.body).find("#workflows .picklist")[0].scrollWidth<=$(document.body).find("#workflows .picklist").outerWidth()){$(document.body).find("#workflows #quickResponseLeftScroll, #workflows #quickResponseRightScroll").hide()}},1000)}else{if(f.fieldType===fieldTypes.Picklist&&f.field.type===2){renderPicklistButtons(wfMessageBubble,step);wfMessageBubble.find(".picklistOptions .picklistOption").prepend("<span class='icon-add'></span>");wfMessageBubble.find(".picklistOptions .picklistOption").click(function(){$(this).toggleClass("selected");if($(this).hasClass("selected")){$(this).find("span").removeClass("icon-add").addClass("icon-tick")}else{$(this).find("span").removeClass("icon-tick").addClass("icon-add")}if(step.canSkip){showHidePicklistButtons(wfMessageBubble)}}).clickableByKeyboard();if(dataAlreadyExist){if(f.existingValue){var values=f.existingValue.split(",");if(values&&values.length>0){for(var i=0;i<values.length;i++){if(values[i]!==""){wfMessageBubble.find(".picklistOption[value='"+values[i]+"']").click()}}}}}}else{if(dataAlreadyExist){wfMessageBubble.find(".picklistOption[value='"+f.existingValue+"']").addClass("selected");wfMessageBubble.find(".picklistOption.skipButton").remove();renderPicklistButtons(wfMessageBubble,step);showHidePicklistButtons(wfMessageBubble)}wfMessageBubble.find(".picklistOptions .picklistOption").click(function(){wfMessageBubble.find(".picklistOptions .picklistOption").removeClass("selected");$(this).addClass("selected");if($(this).hasClass("cancelButton")){submitWorkflowStep(step,2);return}else{if($(this).hasClass("skipButton")){submitWorkflowStep(step,3);return}else{if(!dataAlreadyExist){submitWorkflowStep(step,1)}}}showHidePicklistButtons(wfMessageBubble)}).clickableByKeyboard()}}}}function renderPicklistButtons(wfMessageBubble,step){wfMessageBubble.find(".bubble").css("position","relative");wfMessageBubble.find(".picklist, .insideSelect").css("margin-bottom","50px");wfMessageBubble.find(".bubble").append("<div tabindex='2' class='picklistBottomButton submitButton'>"+insideChatPane.translate("Submit")+"</div>");if(step.canSkip){var skipAlias=insideChatPane.translate("Skip");if(step.skipAlias){skipAlias=step.skipAlias}else{if(insideWorkflows.currentWorkflow.skipAlias){skipAlias=insideWorkflows.currentWorkflow.skipAlias}}wfMessageBubble.find(".bubble").append("<div tabindex='2' class='picklistBottomButton skipButton'>"+skipAlias+"</div>");wfMessageBubble.find(".submitButton").hide()}wfMessageBubble.find(".picklistBottomButton").click(function(){if($(this).hasClass("submitButton")){submitWorkflowStep(step,1)}else{if($(this).hasClass("skipButton")){submitWorkflowStep(step,3)}}}).clickableByKeyboard()}function showHidePicklistButtons(wfMessageBubble){if(wfMessageBubble.find(".picklistOption.selected").length>0){wfMessageBubble.find(".picklistBottomButton.skipButton").hide();wfMessageBubble.find(".picklistBottomButton.submitButton").show()}else{wfMessageBubble.find(".picklistBottomButton.skipButton").show();wfMessageBubble.find(".picklistBottomButton.submitButton").hide()}}function getDropdownOptions(options,f,step,dataAlreadyExist){var html="<ul>";if(options){for(var i=0;i<options.length;i++){html+="<li tabindex='2' role='menuitem' value='"+options[i].id+"'>"+options[i].label+"</li>"}}html+=getPicklistButtonsHtml(f,step,dataAlreadyExist);html+="</ul>";return html}function getDatafieldCssClass(f,step){if(f.fieldType===fieldTypes.Text&&f.field&&f.field.type===4){return" textareaHolder "}else{if(f.fieldType===fieldTypes.Number){if(f.field.type===3){return" phoneField "}if(f.field.type===1){return" percentageField "}}}return""}function getPicklistOptionsHtml(f,options){var html="";for(var i=0;i<options.length;i++){html+="<div role='menuitem' class='picklistOption' value='"+options[i].id+"' aria-label='"+insideFrontInterface.escapeHtml(options[i].label)+"' role='button' tabindex='2'>"+insideFrontInterface.escapeHtml(options[i].label)+"</div>"}if(f.picklistStyle===4){}return html}function getPicklistButtonsHtml(f,step,dataAlreadyExist){var html="";if(f.fieldType===fieldTypes.Boolean||(f.fieldType===fieldTypes.Picklist&&f.field.type!==2)){if(step.canCancel){var cancelLabel=step.cancelAlias?step.cancelAlias:(insideWorkflows.currentWorkflow.cancelAlias?insideWorkflows.currentWorkflow.cancelAlias:insideChatPane.translate("Cancel"));cancelLabel=insideFrontInterface.escapeHtml(cancelLabel);if(f.picklistStyle===1){html+="<li tabindex='2' value='insidecancelstep'>"+cancelLabel+"</li>"}else{html+="<div role='menuitem' class='picklistOption cancelButton' aria-label='"+cancelLabel+"' tabindex='2'>"+cancelLabel+"</div>"}}if(step.canSkip){var skipLabel=step.skipAlias?step.skipAlias:(insideWorkflows.currentWorkflow.skipAlias?insideWorkflows.currentWorkflow.skipAlias:insideChatPane.translate("Skip"));skipLabel=insideFrontInterface.escapeHtml(skipLabel);if(f.picklistStyle===1){html+=dataAlreadyExist?"":"<li tabindex='2' value='insideskipstep'>"+skipLabel+"</li>"}else{html+="<div role='menuitem' class='picklistOption skipButton' aria-label='"+skipLabel+"' tabindex='2'>"+skipLabel+"</div>"}}}return html}function getInputFieldHtml(f){var inputType="text";if(f.field){if(f.fieldType==fieldTypes.Text){switch(f.field.type){case 1:inputType="text";break;case 2:inputType="email";break;case 3:inputType="url";break;case 4:return"<textarea tabindex='2'></textarea>"}}else{if(f.fieldType==fieldTypes.Number){if(f.field.iscompany){inputType="text"}else{if(f.field.type===0){inputType="number"}else{if(f.field.type===1){return"<span class='symbol'>%</span><input type='number' tabindex='2' style='width: calc(100% - 34px);' />"}else{if(f.field.type===2){return"<span class='symbol'>"+f.currencySymbol+"</span><input type='number' tabindex='2' style='width: calc(100% - 32px);' />"}else{if(f.field.type===3){inputType="text"}}}}}}}}return"<input tabindex='2' type='"+inputType+"' />"}function askQuestion(f,step){if((step.questionTextExistingData!==""||step.questionTextNoExistingData!=="")&&(chatInProgress||preview)){return}var questionText="";if(typeof(step.allDataAlreadyExist)=="undefined"||step.allDataAlreadyExist===1||step.allDataAlreadyExist===2||f.existingValue=="undefined"||f.existingValue==null||f.existingValue==""){if(step.questionTextNoExistingData&&step.questionTextNoExistingData.length>0){questionText=step.questionTextNoExistingData}}else{if(step.allDataAlreadyExist===3&&f.existingValue!=null&&typeof(f.existingValue)!="undefined"&&f.existingValue!=""){if(step.questionTextNoExistingData&&step.questionTextExistingData.length>0){questionText=step.questionTextExistingData}}}if((f.fieldType!==fieldTypes.Boolean&&f.fieldType!==fieldTypes.Picklist&&f.picklistStyle!==4)&&(!questionText||questionText.length===0)){return""}var opImageUrl=getWorkflowBotImage();if(insideWorkflows.currentWorkflow.isBot&&opImageUrl){opImageUrl=customImageUrl+opImageUrl}insideChatPane.removeOpTypingMessage();questionText=insideFrontInterface.safeSanitizeHtml(questionText);renderMessageBubble(insideWorkflows.currentWorkflow.isBot?getWorkflowBotName():null,opImageUrl,null,questionText," workflowMessage "+(questionText==""?" noQuestion ":""));return questionText}function showHelpMessage(f,step){if($(insideChatPane.chatPaneContent).find(".workflowHelpBubble").length>0){return}$(document.body).find(".message.operator .flexButtonContainer").remove();renderMessageBubble(insideWorkflows.settings.helpTitle?insideWorkflows.settings.helpTitle:insideChatPane.translate("Help"),null,"icon-help",(f&&f.helpHoverDescription&&f.helpHoverDescription.length>0?f.helpHoverDescription:"")+getHelpHtml()," workflowHelpBubble ",true);bindHelpButtonEvents()}this.showErrorMessageBubble=showErrorMessageBubble;function showErrorMessageBubble(errorMessage){$(document.body).find(".message.workflowErrorMessage").remove();renderMessageBubble(insideWorkflows.settings.errorTitle?insideWorkflows.settings.errorTitle:insideChatPane.translate("Oops!"),null,"icon-error",insideChatPane.translate(errorMessage)+getHelpHtml()," workflowErrorMessage ",true);bindHelpButtonEvents();if(device==2){$(document.activeElement).blur();$(topWindow.document.activeElement).blur()}}function renderMessageBubble(opName,imageUrl,iconClass,messageText,classes,dontHideSenderInfo){if((!opName||opName==="")&&(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.assistant&&insideWorkflows.currentWorkflow.assistant.name)){opName=insideWorkflows.currentWorkflow.assistant.name}opName=insideFrontInterface.escapeHtml(opName);var faceImage="";if(iconClass){faceImage='<span class="'+iconClass+'"></span>'}else{if(imageUrl){faceImage='<img src="'+imageUrl+'" />'}else{if(typeof(insideChatPane.settings.chatSettings.chatPane.globalOperatorImage)!="undefined"&&insideChatPane.settings.chatSettings.chatPane.globalOperatorImage!=null&&insideChatPane.settings.chatSettings.chatPane.globalOperatorImage!=""){faceImage='<img src="'+customImageUrl+insideChatPane.settings.chatSettings.chatPane.globalOperatorImage+'" />'}else{if(typeof(insideChatPane.settings.chatSettings.chatPane.defaultOperatorImage)!="undefined"&&insideChatPane.settings.chatSettings.chatPane.defaultOperatorImage!=""){faceImage='<img src="'+customImageUrl+insideChatPane.settings.chatSettings.chatPane.defaultOperatorImage+'" />'}else{if(!preview&&insideWorkflows.currentWorkflow){faceImage='<img src="'+insideFrontInterface.chat.getFaceURL(insideWorkflows.currentWorkflow.assistant)+'" />'}}}}}var messageHTML='<div class="messageContent"><div class="bubble" tabindex="2" '+(classes.search("workflowErrorMessage")>-1?'role="alert"':"")+'><div class="fromImage"><div class="inside_assistMessageFace">'+faceImage+'</div></div><div class="fromName title">'+(insideFrontInterface.escapeHtml(opName)||"")+'</div><div class="content"><div>'+insideFrontInterface.safeSanitizeHtml(messageText)+"</div></div>"+(isRTL?'<div class="date small"></div></div>':'</div><div class="date small"></div></div>');var message=document.createElement("div");message.className="workflowBubble message operator transition "+(classes||"");if(insideWorkflows.currentWorkflow){message.setAttribute("wfid",insideWorkflows.currentWorkflow.workflowId);message.setAttribute("stepid",insideWorkflows.currentWorkflow.workflowStepId)}message.innerHTML=messageHTML;insideChatPane.chatPaneContent.appendChild(message);var date=new Date();message.querySelector(".date").innerHTML=insideChatPane.getTime(date);message.querySelector(".date").date=date;var isLastMessageSame=(typeof(message)!="undefined"&&typeof(insideChatPane.lastMessage)!="undefined"&&$(insideChatPane.lastMessage).attr("wfid")==$(message).attr("wfid")&&$(insideChatPane.lastMessage).attr("stepid")==$(message).attr("stepid"));if(!isLastMessageSame&&!dontHideSenderInfo&&insideChatPane.lastMessageFrom&&insideWorkflows.currentWorkflow&&((insideChatPane.lastMessageFrom.indexOf("assistant:")===0&&!insideWorkflows.currentWorkflow.isBot)||(insideWorkflows.currentWorkflow.isBot&&insideChatPane.lastMessageFrom=="bot:"))){message.querySelector(".fromName").style.display="none";message.querySelector(".fromImage").style.display="none";message.classList.add("subsequent");insideChatPane.lastMessage.classList.add("grouped");var d=insideChatPane.lastMessage.querySelector(".date");d.style.lineHeight=d.getBoundingClientRect().height+"px";d.style.opacity=1;setTimeout(function(){d.style.lineHeight="0px";d.style.opacity=0},100)}insideChatPane.lastMessage=message;if(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isBot){insideChatPane.lastMessageFrom="bot:"}else{if(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.assistant&&insideWorkflows.currentWorkflow.assistant.id){insideChatPane.lastMessageFrom=insideWorkflows.currentWorkflow.assistant.id}else{insideChatPane.lastMessageFrom="assistant:"}}insideChatPane.showMessage(message);insideChatPane.scrollToBottom()}function getHelpHtml(){if(!insideWorkflows.currentWorkflow){return""}var step=insideWorkflows.currentWorkflow.step;var promptText='<div style="margin-top: 0.3em;">'+(insideWorkflows.settings.needHelpLabel?insideFrontInterface.escapeHtml(insideWorkflows.settings.needHelpLabel):insideChatPane.translate("Having trouble?"))+"</div>";var html='<div class="flexButtonContainer">';var flag=false;if(insideWorkflows.currentWorkflow.isBot){if(preview||insideFrontInterface.getAvailableAssistants().length>0){html+='<div class="talkToHumanBtn insideFlexButton">'+(insideFrontInterface.escapeHtml(insideWorkflows.settings.transfertoOperatorLabel)||insideChatPane.translate("Talk to Human"))+"</div>";flag=true}else{if(!insideWorkflows.currentWorkflow.isLeaveMessageWorkflow&&insideWorkflows.settings.settingNoOpWorkflowId>0){html+='<div class="leaveMessageBtn insideFlexButton">'+(insideFrontInterface.escapeHtml(insideWorkflows.settings.leaveAMessageLabel)||insideChatPane.translate("Leave a Message"))+"</div>";flag=true}}}else{if(chatInProgress&&currentChatId>0){html+='<div class="returnToOperatorBtn insideFlexButton" tabindex="2">'+(insideFrontInterface.escapeHtml(insideWorkflows.settings.returnToOperatorLabel)||insideChatPane.translate("Ask Operator a Question"))+"</div>";flag=true}}if(insideWorkflows.currentWorkflow.isBot&&insideWorkflows.currentWorkflow.cancelAlias){html+='<div class="returnToMainMenuBtn insideFlexButton">'+insideWorkflows.currentWorkflow.cancelAlias+"</div>";flag=true}if(step.canSkip){html+='<div class="skipThisInfoBtn insideFlexButton">'+(insideWorkflows.currentWorkflow.skipAlias?insideWorkflows.currentWorkflow.skipAlias:insideChatPane.translate("Skip this Info"))+"</div>";flag=true}html+="</div>";if(flag){html=promptText+html}return html}function bindHelpButtonEvents(){$(document.body).find(".message .talkToHumanBtn").click(talkToHumanHandler);$(document.body).find(".message .leaveMessageBtn").click(function(){insideAPI.post("api/workflow/LeaveAMessage",{chatId:currentChatId||0},function(response){})});$(document.body).find(".message .returnToOperatorBtn").unbind("click").click(function(){insideAPI.post("api/workflow/PauseWorkflow",{chatId:currentChatId,workflowId:insideWorkflows.currentWorkflow.workflowId},function(response){if(response){pauseWorkflow()}})});$(document.body).find(".message .returnToMainMenuBtn").click(function(){submitWorkflowStep(insideWorkflows.currentWorkflow.step,2)});$(document.body).find(".message .skipThisInfoBtn").click(function(){submitWorkflowStep(insideWorkflows.currentWorkflow.step,3)})}this.talkToHumanHandler=talkToHumanHandler;function talkToHumanHandler(){if($(this).attr("id")==="chatToHuman"){$(document.body).find("#chatMenuButton").click()}if(preview||insideFrontInterface.getAvailableAssistants().length>0){insideAPI.post("api/workflow/TalkToHuman",{chatId:currentChatId},function(response){if(response){hideWorkflowWidgets();insideWorkflows.currentWorkflow=null;if(preview){window.parent.window.insideWorkFlows.showHidePreviewStatus()}}})}else{showLeaveMessageNotification(true)}}this.showLeaveMessageNotification=showLeaveMessageNotification;function showLeaveMessageNotification(addNotification,fromQueueNotificaton){var notification=$(document.body).find(".notification.wfNotification, .notification.queue");if(notification.length===0&&addNotification){insideChatPane.showNotification(insideWorkflows.settings.noOperatorAvailableNotification||"","wfNotification");notification=$(document.body).find(".notification.wfNotification")}if(notification.hasClass("wfNotification")){notification.addClass("wfNotification")}if(notification.find(".leaveMessageButtoncontainer").length===0){var html="<div class='leaveMessageButtoncontainer'>"+(insideWorkflows.settings.settingNoOpWorkflowId>0?("<div class='button leaveMessageBtn'>"+(insideFrontInterface.escapeHtml(insideWorkflows.settings.leaveAMessageLabel)||insideChatPane.translate("Leave a Message"))+"</div>"):"");if(!fromQueueNotificaton){html+="<div class='button cancel cancelNotification'>"+insideChatPane.translate("Cancel")+"</div>"}html+="</div>";notification.find(".content").append(html);notification.find(".leaveMessageBtn").click(function(){insideAPI.post("api/workflow/LeaveAMessage",{chatId:currentChatId||0},function(response){notification[0].close();insideChatPane.removeStartANewChatButton()})});notification.find(".cancelNotification").click(function(){$(document.body).find(".notification.wfNotification, .notification.queue")[0].close()})}}this.setSendButton=setSendButton;function setSendButton(event){if(event&&event.keyCode===13&&!event.shiftKey&&event.data&&event.data.field&&event.data.field.fieldType===fieldTypes.Text&&event.data.field.type===4){event.preventDefault();return}else{if(event&&event.keyCode===13&&!event.shiftKey){event.preventDefault();submitWorkflowStep(null,1);return}}var element=$(document.body).find("#insideWorkflowFieldCell input, #insideWorkflowFieldCell textarea");if(!element||element.length===0){return}if(element.val()==""&&!(insideChatPane.isIOSDevice()&&event&&event.data&&event.data.field&&event.data.field.fieldType===fieldTypes.Number)){$(document.body).find("#insideWorkflowFieldCell .inside-field").addClass("disabled");$(document.body).find("#chatSendButton").addClass("disabled").hide();$(document.body).find("#attachButton").addClass("disabled").hide()}else{$(document.body).find("#insideWorkflowFieldCell .inside-field").removeClass("disabled");$(document.body).find("#attachButton").addClass("disabled").hide();$(document.body).find("#chatSendButton").removeClass("disabled").show()}setTimeout(scaleTextarea,100)}function validateInputField(event,field,fieldValue,fieldElement,submitting){var f=event?event.data:(field?field:null);var value=null;if(typeof(fieldValue)!="undefined"&&fieldValue!=null){value=fieldValue}else{if(event!=null&&event.target!=null){value=event.target.value?event.target.value.trim():event.target.value}}var element=fieldElement||$(this);if(!f||(!submitting&&(!value||value.length==0))){clearValidation();return}var isValid=true;var errorMessage="";if(typeof(value)=="undefined"||value==null||value.length===0){isValid=false;errorMessage="Required field"}else{if(f.fieldType==fieldTypes.Text){if(f.field.minCharacters>0&&value.length<f.field.minCharacters){isValid=false;errorMessage="Too small text"}if(isValid&&f.field.maxCharacters>0&&value.length>f.field.maxCharacters){isValid=false;errorMessage="Too large text"}if(isValid){if(f.field.type===1||f.field.type===4){if(f.field.validation===0){isValid=true}else{if(f.field.validation===1){if(!alphanumericRegex.test(value)){isValid=false;errorMessage="Invalid input"}}else{if(f.field.validation===2&&f.field.customValidationRegex){var regex=new RegExp(f.field.customValidationRegex);if(!regex.test(value)){isValid=false;errorMessage="Invalid input"}}}}}else{if(f.field.type===2){if(!emailRegex.test(value)){isValid=false;errorMessage="Invalid email address"}}else{if(f.field.type===3){if(!urlRegex1.test(value)&&!urlRegex2.test(value)){isValid=false;errorMessage="Invalid url"}}}}}}else{if(f.fieldType===fieldTypes.Number){if(f.field.iscompany){if(f.field.minCharacters>0&&value.length<f.field.minCharacters){isValid=false;errorMessage="Too small text"}if(isValid&&f.field.maxCharacters>0&&value.length>f.field.maxCharacters){isValid=false;errorMessage="Too large text"}}else{if(f.field.type===0||f.field.type===1||f.field.type===2){var minNumber=f.field.minNumber;var maxNumber=f.field.maxNumber;var decimalPlaces=f.field.decimalPlaces;if(isNaN(value)){isValid=false;errorMessage="Not a valid number"}if(typeof(minNumber)!="undefined"&&value<minNumber){isValid=false;errorMessage="Too small number"}if(isValid&&typeof(maxNumber)!="undefined"&&value>maxNumber){isValid=false;errorMessage="Too large number"}if(isValid&&typeof(decimalPlaces)!="undefined"){try{var num=value.split(".");if(num&&num.length===2){if(num[1].length>decimalPlaces){isValid=false;errorMessage="Only "+decimalPlaces+" decimal places are allowed"}}}catch(exp){console.log(exp)}}}else{if(f.field.type===3){fieldElement=fieldElement||(event?event.target:null);hdnPhoneField=$(document.body).find("#hdnCCPhoneField");hdnPhoneField.intlTelInput("setNumber",$(document.body).find("#insideWorkflowFieldCell .countryCode").text()+$(fieldElement).val());var isValidNumber=hdnPhoneField.intlTelInput("isValidNumber");var numberType=hdnPhoneField.intlTelInput("getNumberType");if(!isValidNumber){isValid=false;errorMessage="Invalid phone/mobile number"}if(isValid&&typeof(f.field.canAcceptLandlineNumber)!="undefined"&&f.field.canAcceptLandlineNumber==false&&(numberType==intlTelInputUtils.numberType.FIXED_LINE)){isValid=false;errorMessage="Landline numbers are not allowed"}if(isValid&&typeof(f.field.canAcceptMobileNumber)!="undefined"&&f.field.canAcceptMobileNumber==false&&(numberType==intlTelInputUtils.numberType.MOBILE)){isValid=false;errorMessage="Mobile numbers are not allowed"}}}}}else{if(f.fieldType===fieldTypes.Picklist){if(f.picklistStyle===1&&f.mandatory){if(typeof(fieldValue)=="undefined"||fieldValue==null||fieldValue==""){isValid=false;errorMessage="Please select any value"}}}}}}clearValidation();if(isValid){$(document.body).find(".message.workflowErrorMessage").remove();element.parents(".inside-field").addClass("valid")}else{if(submitting||!event||event.type!="keyup"){element.parents(".inside-field").addClass("invalid");if(f&&f.validationMessage&&f.validationMessage.length>0){errorMessage=f.validationMessage}if(submitting){showErrorMessageBubble(errorMessage)}}}return isValid;function clearValidation(){element.parents(".inside-field").removeClass("valid invalid");element.parents(".inside-field").find(".inside-error-message").html("");element.parents(".inside-field").find(".inside-validation-mark").removeClass("inside_tickmark").html("")}}function showHideProgressIndicator(){if(inProgress){$(document.body).find("#attachButton").hide();$(document.body).find("#chatSendButton").css("opacity",0.5);$(document.body).find("#insideWorkflowFieldCell .inside-field").append("<div id='disablingOverlay'></div>");$(document.body).find("#insideWorkflowFieldCell .inside-field").find("input, textarea").attr("disabled","disabled");$(document.activeElement).blur()}else{$(document.body).find("#attachButton").hide();$(document.body).find("#chatSendButton").css("opacity",1);$(document.body).find("#insideWorkflowFieldCell .inside-field #disablingOverlay").remove();$(document.body).find("#insideWorkflowFieldCell .inside-field").find("input, textarea").removeAttr("disabled");if($(document.body).find("#insideWorkflowFieldCell").is(":visible")){setSendButton()}else{insideChatPane.setSendButton()}}}var inProgress=false;this.submitWorkflowStep=submitWorkflowStep;function submitWorkflowStep(step,type){if(inProgress||(!preview&&!$.inside.isConnected())){return}var payload={workflowId:insideWorkflows.currentWorkflow.workflowId,workflowStepId:insideWorkflows.currentWorkflow.workflowStepId,chatId:currentChatId,submitionType:type,values:{}};step=insideWorkflows.currentWorkflow.step;var field;if(type==1){for(var i=0;i<step.fields.length>0;i++){field=step.fields[i];var fieldValue;if(field.fieldType===fieldTypes.Text||field.fieldType===fieldTypes.Number){var fieldElement=$(document.body).find("#insideWorkflowFieldCell .inside-field[fid='"+field.dataFieldId+"'] input");if(field.fieldType===fieldTypes.Text&&field.field&&field.field.type===4){fieldElement=$(document.body).find("#insideWorkflowFieldCell .inside-field[fid='"+field.dataFieldId+"'] textarea");fieldValue=fieldElement.val()}else{if(field.fieldType==fieldTypes.Number&&field.field.type==3){fieldValue=$(document.body).find("#hdnCCPhoneField").intlTelInput("getNumber")}else{fieldValue=$(document.body).find("#insideWorkflowFieldCell .inside-field[fid='"+field.dataFieldId+"'] input").val()}}if(field.fieldType===fieldTypes.Number&&field.field.type===2&&field.currencySymbol){payload.currencySymbol=field.currencySymbol;payload.currencyCode=field.currencyCode}if(validateInputField(null,field,fieldValue,fieldElement,true)){payload.values[field.dataFieldId]=fieldValue}else{return}}else{if(field.fieldType===fieldTypes.Boolean){fieldValue=$(document.body).find(".message.workflowMessage .picklistOption.selected").attr("value");if(typeof(fieldValue)!="undefined"&&fieldValue!=null){payload.values[field.dataFieldId]=parseInt(fieldValue)}else{return}}else{if(field.fieldType===fieldTypes.Picklist){if(field.picklistStyle===1){fieldValue=$(document.body).find(".insideSelect").attr("selectedval");if(validateInputField(null,field,fieldValue,fieldElement,true)){payload.values[field.dataFieldId]=fieldValue}else{return}}else{if(field.picklistStyle===4){$(document.body).find("#workflows .picklist .picklistOption.selected").each(function(){payload.values[field.dataFieldId]=$(this).attr("value")})}else{if(field.field.type===1){$(document.body).find(".message.workflowMessage .picklistOption.selected").each(function(){payload.values[field.dataFieldId]=$(this).attr("value")})}else{if(field.field.type===2){var arr="";$(document.body).find(".message.workflowMessage .picklistOption.selected").each(function(){arr+=$(this).attr("value")+","});payload.values[field.dataFieldId]=arr}}}}}}}}}inProgress=true;if(field&&typeof(field.fieldType)!="undefined"&&field.fieldType!==fieldTypes.Boolean&&field.fieldType!==fieldTypes.Picklist){showHideProgressIndicator()}insideAPI.post(preview?"api/workflow/SubmitWorkflowArchiveStepForPreview":"api/workflow/SubmitWorkflowStep",payload,function(response){if(preview){if(response==null||response==false){inProgress=false;if(field&&typeof(field.fieldType)!="undefined"&&field.fieldType!==fieldTypes.Boolean&&field.fieldType!==fieldTypes.Picklist){showHideProgressIndicator();$(document.body).find("#insideWorkflowFieldCell").find("input, textarea").val("");$(document.body).find("#insideWorkflowFieldCell .inside-field").removeClass("valid invalid");$(document.body).find("#hdnCCPhoneField").val()}return}hideWorkflowWidgets();if(response&&(response.step||(response.links&&response.links.length>0))){insideWorkflows.currentWorkflow=response;insideWorkflows.startWorkflow(response)}else{insideWorkflows.currentWorkflow=null;showHideChatPaneInput();if(response){if(response.workflowName){window.parent.window.insideWorkFlows.updateWorkflowPreviewStatusName(response.workflowName)}if(response.status===1||response.status===2||response.status===3){window.parent.window.insideWorkFlows.showHidePreviewStatus(true)}}}inProgress=false;if(field&&typeof(field.fieldType)!="undefined"&&field.fieldType!==fieldTypes.Boolean&&field.fieldType!==fieldTypes.Picklist){showHideProgressIndicator()}}},function(xhr,textStatus,errorThrown){inProgress=false;if(field&&typeof(field.fieldType)!="undefined"&&field.fieldType!==fieldTypes.Boolean&&field.fieldType!==fieldTypes.Picklist){showHideProgressIndicator()}if(xhr.responseJSON&&xhr.responseJSON.msg&&xhr.responseJSON.msg!==""){showErrorMessageBubble(xhr.responseJSON.msg);return}hideWorkflowWidgets();insideWorkflows.currentWorkflow=null})}this.nextWorkflowAction=nextWorkflowAction;function nextWorkflowAction(nextAction){var field=null;if(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.step&&insideWorkflows.currentWorkflow.step.fields.length>0&&insideWorkflows.currentWorkflow.step.fields[0]){field=insideWorkflows.currentWorkflow.step.fields[0]}if(nextAction==null||nextAction==false){inProgress=false;if(field&&typeof(field.fieldType)!="undefined"&&field.fieldType!==fieldTypes.Boolean&&field.fieldType!==fieldTypes.Picklist){showHideProgressIndicator();$(document.body).find("#insideWorkflowFieldCell").find("input, textarea").val("");$(document.body).find("#insideWorkflowFieldCell .inside-field").removeClass("valid invalid");$(document.body).find("#hdnCCPhoneField").val()}return}hideWorkflowWidgets(nextAction&&nextAction.status===4);if(nextAction&&(nextAction.step||(nextAction.links&&nextAction.links.length>0))){insideWorkflows.currentWorkflow=nextAction;insideWorkflows.startWorkflow(nextAction)}else{if(nextAction.status==5){insideWorkflows.currentWorkflow.paused=true}if(nextAction.status==5&&nextAction.willAutoResume==true){showHideChatPaneInput(true)}else{insideWorkflows.currentWorkflow=null;if(insideChatPane.startANewChatButtonShowing()){}else{showHideChatPaneInput()}}}if(inProgress){inProgress=false;$(document.body).find("#chatSendButton").css("opacity",1);if(field&&typeof(field.fieldType)!="undefined"&&field.fieldType!==fieldTypes.Boolean&&field.fieldType!==fieldTypes.Picklist){showHideProgressIndicator()}}}};document.addEventListener("DOMContentLoaded",function(){setTimeout(insideWorkflows.init,0)});var currentChatId=0;var prevChatId=0;var activeChat=false;var visitorHasChatted=false;var chatInProgress=false;var chatLinkVisitor=false;var isBlocked=false;var canBeAssignedToOtherChannel=false;var hideMessageOnlyForm=false;var keyboardOpen=false;var keyboardOpenSet=false;var isIE=false;var isRTL=false;var customFormShown=false;var topInsideHolder;(function(c){var d;if(!c.matchesSelector){for(d in c){if(/^\S+MatchesSelector$/.test(d)){c.matchesSelector=c[d];break}}}})(Element.prototype);Document.prototype.on=Element.prototype.on=function(c,f,i){this.addEventListener(c,function j(d){var h=d.target,k=d.type,l=[];if(d.detail&&d.detail.selector===f&&d.detail.handler===i){return this.removeEventListener(k,j,!0)}for(;h;){h.matchesSelector&&h.matchesSelector(f)&&(h.addEventListener(k,i,!1),l.push(h)),h=h.parentNode}setTimeout(function(){for(var m=l.length-1;0<=m;){l[m].removeEventListener(k,i,!1),--m}},0)},!0)};Document.prototype.off=Element.prototype.off=function(c,f,h){var i=document.createEvent("CustomEvent");i.initCustomEvent(c,!1,!1,{selector:f,handler:h});this.dispatchEvent(i)};var defaultOnlineSVGs={default1:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60"><g fill="none" fill-rule="evenodd"><circle cx="30" cy="30" r="30" fill="#1BB9DA"/><path fill="#FFF" d="M32.644 42.097l-.04 5.167-6.552-5.167h-9.3a5.64 5.64 0 0 1-5.64-5.64V21.543a5.64 5.64 0 0 1 5.64-5.64h25.495a5.64 5.64 0 0 1 5.64 5.64v14.914a5.64 5.64 0 0 1-5.64 5.64h-9.603z"/><path fill="#1BB9DA" d="M22.62 32c-1.085 0-1.965-.895-1.965-2s.88-2 1.966-2c1.085 0 1.965.895 1.965 2s-.88 2-1.965 2zm6.88 0c-1.086 0-1.966-.895-1.966-2s.88-2 1.966-2c1.086 0 1.966.895 1.966 2s-.88 2-1.966 2zm6.88 0c-1.086 0-1.966-.895-1.966-2s.88-2 1.965-2c1.086 0 1.966.895 1.966 2s-.88 2-1.966 2z"/></g></svg>',default2:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60"><g fill="none" fill-rule="evenodd"><circle cx="30" cy="30" r="30" fill="#1BB9DA"/><path stroke="#F9F9F9" stroke-width="2" d="M32.644 42.097l-.04 5.167-6.552-5.167h-9.3a5.64 5.64 0 0 1-5.64-5.64V21.543a5.64 5.64 0 0 1 5.64-5.64h25.495a5.64 5.64 0 0 1 5.64 5.64v14.914a5.64 5.64 0 0 1-5.64 5.64h-9.603z"/></g></svg>',default3:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 61 70" class="svgreplace replaced-svg"><g fill="none" fill-rule="evenodd"><path fill="#1BB9DA" d="M30.278 61.583a30.1 30.1 0 0 0 3.454-.198l10.339 8.398a1 1 0 0 0 1.63-.777V58.15c9.724-5.124 14.855-15.452 14.855-27.358C60.556 13.786 47 0 30.278 0S0 13.786 0 30.791c0 17.006 13.556 30.792 30.278 30.792z"></path><path fill="#FFF" d="M19.683 34c-1.629 0-2.95-1.343-2.95-3s1.321-3 2.95-3c1.63 0 2.95 1.343 2.95 3s-1.32 3-2.95 3zM30.5 34c-1.63 0-2.95-1.343-2.95-3s1.32-3 2.95-3c1.63 0 2.95 1.343 2.95 3s-1.32 3-2.95 3zm10.817 0c-1.63 0-2.95-1.343-2.95-3s1.32-3 2.95-3c1.629 0 2.95 1.343 2.95 3s-1.321 3-2.95 3z"></path></g></svg>',default4:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60" class="svgreplace replaced-svg"><g fill="none" fill-rule="evenodd"><circle cx="30" cy="30" r="30" fill="#1BB9DA" fill-rule="nonzero"></circle><path stroke="#FFF" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M38.28 39.548v6.52l-7.693-6.52H17.7a1.488 1.488 0 0 1-1.475-1.5V21c0-.828.66-1.5 1.475-1.5h23.787c.814 0 1.475.672 1.475 1.5v17.048c0 .828-.66 1.5-1.475 1.5H38.28z"></path></g></svg>',default5:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60" class="svgreplace replaced-svg"><g fill="none" fill-rule="nonzero"><circle cx="30" cy="30" r="30" fill="#1BB9DA"></circle><path fill="#FFF" d="M29.594 46c4.019 0 7.753-1.012 10.847-2.744l9.735 1.654-3.774-6.958C48.03 35.61 48.96 32.895 48.96 30c0-8.837-8.67-16-19.365-16C18.9 14 10.23 21.163 10.23 30s8.67 16 19.365 16z"></path></g></svg>',default6:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60"><g fill="none" fill-rule="nonzero">	 <circle cx="30" cy="30" r="30" fill="#1BB9DA"/><path fill="#FFF" d="M17.983 20H41.77c.543 0 .983.448.983 1v17.048c0 .552-.44 1-.983 1h-3.697V45l-7.024-5.952H17.983a.992.992 0 0 1-.983-1V21c0-.552.44-1 .983-1z"/></g></svg>',default7:'<?xml version="1.0" encoding="UTF-8"?><svg width="119px" height="33px" viewBox="0 0 119 33" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>1B6F7EA9-2573-4783-86AD-15DD810AAACE</title><desc>Created with sketchtool.</desc><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">  <g id="Chat-Tab/Styling" transform="translate(-338.000000, -1202.000000)"><g id="chat-tab-2" transform="translate(338.000000, 1202.000000)"><rect id="Rectangle-2-Copy" fill="#1BB9DA" x="0" y="0" width="119" height="32.8999999" rx="4.69999999"></rect><path d="M25.9522868,22.2949544 L25.9224674,26.0257792 L21.3732377,22.4999999 L15.98,22.4999999 C12.865114,22.4999999 10.34,19.9748859 10.34,16.86 L10.34,14.04 C10.34,10.925114 12.865114,8.39999998 15.98,8.39999998 L24.4399999,8.39999998 C27.5548859,8.39999998 30.0799999,10.925114 30.0799999,14.04 L30.0799999,16.86 C30.0799999,19.4510416 28.3327885,21.6340001 25.9522868,22.2949544 Z" id="Combined-Shape-Copy-2" fill="#FFFFFF"></path><text id="LIVE-CHAT" font-family="Nunito-ExtraBold, Nunito" font-size="13.16" font-weight="600" fill="#FFFFFF"><tspan x="38.7199999" y="20.58">LIVE CHAT</tspan></text></g>  </g></g></svg>'};var defaultOfflineSVGs={default1:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60"><g fill="none" fill-rule="evenodd"><circle cx="30" cy="30" r="30" fill="#1BB9DA"/><path fill="#FFF" d="M32.644 42.097l-.04 5.167-6.552-5.167h-9.3a5.64 5.64 0 0 1-5.64-5.64V21.543a5.64 5.64 0 0 1 5.64-5.64h25.495a5.64 5.64 0 0 1 5.64 5.64v14.914a5.64 5.64 0 0 1-5.64 5.64h-9.603z"/><path fill="#1BB9DA" d="M22.62 32c-1.085 0-1.965-.895-1.965-2s.88-2 1.966-2c1.085 0 1.965.895 1.965 2s-.88 2-1.965 2zm6.88 0c-1.086 0-1.966-.895-1.966-2s.88-2 1.966-2c1.086 0 1.966.895 1.966 2s-.88 2-1.966 2zm6.88 0c-1.086 0-1.966-.895-1.966-2s.88-2 1.965-2c1.086 0 1.966.895 1.966 2s-.88 2-1.966 2z"/></g></svg>',default2:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60"><g fill="none" fill-rule="evenodd"><circle cx="30" cy="30" r="30" fill="#1BB9DA"/><path stroke="#F9F9F9" stroke-width="2" d="M32.644 42.097l-.04 5.167-6.552-5.167h-9.3a5.64 5.64 0 0 1-5.64-5.64V21.543a5.64 5.64 0 0 1 5.64-5.64h25.495a5.64 5.64 0 0 1 5.64 5.64v14.914a5.64 5.64 0 0 1-5.64 5.64h-9.603z"/></g></svg>',default3:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 61 70" class="svgreplace replaced-svg"><g fill="none" fill-rule="evenodd"><path fill="#1BB9DA" d="M30.278 61.583a30.1 30.1 0 0 0 3.454-.198l10.339 8.398a1 1 0 0 0 1.63-.777V58.15c9.724-5.124 14.855-15.452 14.855-27.358C60.556 13.786 47 0 30.278 0S0 13.786 0 30.791c0 17.006 13.556 30.792 30.278 30.792z"></path><path fill="#FFF" d="M19.683 34c-1.629 0-2.95-1.343-2.95-3s1.321-3 2.95-3c1.63 0 2.95 1.343 2.95 3s-1.32 3-2.95 3zM30.5 34c-1.63 0-2.95-1.343-2.95-3s1.32-3 2.95-3c1.63 0 2.95 1.343 2.95 3s-1.32 3-2.95 3zm10.817 0c-1.63 0-2.95-1.343-2.95-3s1.32-3 2.95-3c1.629 0 2.95 1.343 2.95 3s-1.321 3-2.95 3z"></path></g></svg>',default4:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60" class="svgreplace replaced-svg"><g fill="none" fill-rule="evenodd"><circle cx="30" cy="30" r="30" fill="#1BB9DA" fill-rule="nonzero"></circle><path stroke="#FFF" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M39.03 40.298v7.389l-8.718-7.389H17.7c-1.232 0-2.225-1.01-2.225-2.25V21c0-1.24.993-2.25 2.225-2.25h23.787c1.232 0 2.225 1.01 2.225 2.25v17.048c0 1.24-.993 2.25-2.225 2.25H39.03z"></path><path fill="#FFF" fill-rule="nonzero" d="M26.566 34h-6.028v-.973l4.248-6.392h-4.132v-1.201h5.796v.984l-4.263 6.38h4.379V34zm6.096 0H27.83v-.85l3.22-4.576h-3.024V27.52h4.546v.96l-3.152 4.465h3.244V34zm6.133 0h-4.834v-.85l3.222-4.576h-3.026V27.52h4.546v.96l-3.152 4.465h3.245V34z"></path></g></svg>',default5:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60" class="svgreplace replaced-svg"><g fill="none" fill-rule="nonzero"><circle cx="30" cy="30" r="30" fill="#1BB9DA"></circle><path fill="#FFF" d="M29.594 46c4.019 0 7.753-1.012 10.847-2.744l9.735 1.654-3.774-6.958C48.03 35.61 48.96 32.895 48.96 30c0-8.837-8.67-16-19.365-16C18.9 14 10.23 21.163 10.23 30s8.67 16 19.365 16z"></path><path fill="#1BB9DA" d="M26.346 36H18.8v-1.374l4.86-6.87h-4.728v-1.75h7.28v1.367L21.36 34.25h4.986V36zm7.35 0h-6.123v-1.23l3.59-4.82h-3.375v-1.593h5.781v1.354l-3.494 4.696h3.62V36h.001zm7.434 0h-6.122v-1.23l3.59-4.82h-3.375v-1.593h5.781v1.354l-3.494 4.696h3.62V36z"></path></g></svg>',default6:'<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60"><g fill="none" fill-rule="nonzero"><circle cx="30" cy="30" r="30" fill="#1BB9DA"/><path fill="#FFF" d="M17.983 20H41.77c.543 0 .983.448.983 1v17.048c0 .552-.44 1-.983 1h-3.697V45l-7.024-5.952H17.983a.992.992 0 0 1-.983-1V21c0-.552.44-1 .983-1z"/></g></svg>'};var normalizeNonFiniteValue=function(c){c=+c;return isNaN(c)||Infinity==c||-Infinity==c?0:c};Element.prototype.scroll||(Element.prototype.scroll=function(){var h=arguments.length,j=this.ownerDocument,k=j.defaultView,l="BackCompat"==j.compatMode,m=document.getElementsByTagName("BODY")[0],i={};if(j==window.document&&k&&0!==h){if(1===h){h=arguments[0];if("object"!=typeof h){throw"Failed to execute 'scrollBy' on 'Element': parameter 1 ('options') is not an object."}"left"in h&&(i.left=normalizeNonFiniteValue(h.left));"top"in h&&(i.top=normalizeNonFiniteValue(h.top));h="left"in i?i.left:this.scrollLeft;j="top"in i?i.top:this.scrollTop}else{i.left=h=normalizeNonFiniteValue(arguments[0]),i.top=j=normalizeNonFiniteValue(arguments[1])}this==document.documentElement?l||k.scroll("scrollX"in k?k.scrollX:"pageXOffset"in k?k.pageXOffset:this.scrollLeft,j):this==m&&l&&!isBodyPotentiallyScrollable(m)?k.scroll(i.left,i.top):(this.scrollLeft=h,this.scrollTop=j)}});(function(a){a.forEach(function(c){c.hasOwnProperty("prepend")||Object.defineProperty(c,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:function(){var d=Array.prototype.slice.call(arguments),f=document.createDocumentFragment();d.forEach(function(h){f.appendChild(h instanceof Node?h:document.createTextNode(String(h)))});this.insertBefore(f,this.firstChild)}})})})([Element.prototype,Document.prototype,DocumentFragment.prototype]);$.fn.clickableByKeyboard=function(){if(!$(this).attr("role")){$(this).attr("role","button")}$(this).keydown(function(a){if(a.keyCode==32||a.keyCode==13){a.preventDefault();this.click()}});return this};if(typeof URLSearchParams=="undefined"){(function(a){a.URLSearchParams=a.URLSearchParams||function(c){var d=this;d.searchString=c;d.get=function(f){var h=new RegExp("[?&]"+f+"=([^&#]*)").exec(d.searchString);if(h==null){return null}else{return decodeURI(h[1])||0}};d.has=function(f){var h=new RegExp("[?&]"+f+"([&=#]|$)").exec(d.searchString);if(h==null){return null}else{return true}}}})(window)}if(typeof(html_sanitize)!="function"){(function(){var h=void 0,t=!0,w=null,i=!1,o=["aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,snow,springgreen,steelblue,tan,teal,thistle,tomato,transparent,turquoise,violet,wheat,white,whitesmoke,yellow,yellowgreen".split(","),"all-scroll,col-resize,crosshair,default,e-resize,hand,help,move,n-resize,ne-resize,no-drop,not-allowed,nw-resize,pointer,progress,row-resize,s-resize,se-resize,sw-resize,text,vertical-text,w-resize,wait".split(","),"armenian,decimal,decimal-leading-zero,disc,georgian,lower-alpha,lower-greek,lower-latin,lower-roman,square,upper-alpha,upper-latin,upper-roman".split(","),"100,200,300,400,500,600,700,800,900,bold,bolder,lighter".split(","),"block-level,inline-level,table-caption,table-cell,table-column,table-column-group,table-footer-group,table-header-group,table-row,table-row-group".split(","),"condensed,expanded,extra-condensed,extra-expanded,narrower,semi-condensed,semi-expanded,ultra-condensed,ultra-expanded,wider".split(","),"inherit,inline,inline-block,inline-box,inline-flex,inline-grid,inline-list-item,inline-stack,inline-table,run-in".split(","),"behind,center-left,center-right,far-left,far-right,left-side,leftwards,right-side,rightwards".split(","),"large,larger,small,smaller,x-large,x-small,xx-large,xx-small".split(","),"dashed,dotted,double,groove,outset,ridge,solid".split(","),"ease,ease-in,ease-in-out,ease-out,linear,step-end,step-start".split(","),"at,closest-corner,closest-side,ellipse,farthest-corner,farthest-side".split(","),"baseline,middle,sub,super,text-bottom,text-top".split(","),"caption,icon,menu,message-box,small-caption,status-bar".split(","),"fast,faster,slow,slower,x-fast,x-slow".split(","),["above","below","higher","level","lower"],["cursive","fantasy","monospace","sans-serif","serif"],["loud","silent","soft","x-loud","x-soft"],["no-repeat","repeat-x","repeat-y","round","space"],["blink","line-through","overline","underline"],["block","flex","grid","table"],["high","low","x-high","x-low"],["nowrap","pre","pre-line","pre-wrap"],["absolute","relative","static"],["alternate","alternate-reverse","reverse"],["border-box","content-box","padding-box"],["capitalize","lowercase","uppercase"],["child","female","male"],["=","opacity"],["backwards","forwards"],["bidi-override","embed"],["bottom","top"],["break-all","keep-all"],["clip","ellipsis"],["contain","cover"],["continuous","digits"],["end","start"],["flat","preserve-3d"],["hide","show"],["horizontal","vertical"],["inside","outside"],["italic","oblique"],["left","right"],["ltr","rtl"],["no-content","no-display"],["paused","running"],["suppress","unrestricted"],["thick","thin"],[","],["/"],["all"],["always"],["auto"],["avoid"],["both"],["break-word"],["center"],["circle"],["code"],["collapse"],["contents"],["fixed"],["hidden"],["infinite"],["inset"],["invert"],["justify"],["list-item"],["local"],["medium"],["mix"],["none"],["normal"],["once"],["repeat"],["scroll"],["separate"],["small-caps"],["spell-out"],["to"],["visible"]],p={animation:{cssPropBits:517,cssLitGroup:[o[10],o[24],o[29],o[45],o[48],o[54],o[63],o[71],o[72]],cssFns:["cubic-bezier()","steps()"]},"animation-delay":{cssPropBits:5,cssLitGroup:[o[48]],cssFns:[]},"animation-direction":{cssPropBits:0,cssLitGroup:[o[24],o[48],o[72]],cssFns:[]},"animation-duration":"animation-delay","animation-fill-mode":{cssPropBits:0,cssLitGroup:[o[29],o[48],o[54],o[71]],cssFns:[]},"animation-iteration-count":{cssPropBits:5,cssLitGroup:[o[48],o[63]],cssFns:[]},"animation-name":{cssPropBits:512,cssLitGroup:[o[48],o[71]],cssFns:[]},"animation-play-state":{cssPropBits:0,cssLitGroup:[o[45],o[48]],cssFns:[]},"animation-timing-function":{cssPropBits:0,cssLitGroup:[o[10],o[48]],cssFns:["cubic-bezier()","steps()"]},appearance:{cssPropBits:0,cssLitGroup:[o[71]],cssFns:[]},azimuth:{cssPropBits:5,cssLitGroup:[o[7],o[42],o[56]],cssFns:[]},"backface-visibility":{cssPropBits:0,cssLitGroup:[o[59],o[62],o[80]],cssFns:[]},background:{cssPropBits:23,cssLitGroup:[o[0],o[18],o[25],o[31],o[34],o[42],o[48],o[49],o[52],o[56],o[61],o[68],o[71],o[74],o[75]],cssFns:"image(),linear-gradient(),radial-gradient(),repeating-linear-gradient(),repeating-radial-gradient(),rgb(),rgba()".split(",")},"background-attachment":{cssPropBits:0,cssLitGroup:[o[48],o[61],o[68],o[75]],cssFns:[]},"background-color":{cssPropBits:2,cssLitGroup:[o[0]],cssFns:["rgb()","rgba()"]},"background-image":{cssPropBits:16,cssLitGroup:[o[48],o[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"background-position":{cssPropBits:5,cssLitGroup:[o[31],o[42],o[48],o[56]],cssFns:[]},"background-repeat":{cssPropBits:0,cssLitGroup:[o[18],o[48],o[74]],cssFns:[]},"background-size":{cssPropBits:5,cssLitGroup:[o[34],o[48],o[52]],cssFns:[]},border:{cssPropBits:7,cssLitGroup:[o[0],o[9],o[47],o[62],o[64],o[69],o[71]],cssFns:["rgb()","rgba()"]},"border-bottom":"border","border-bottom-color":"background-color","border-bottom-left-radius":{cssPropBits:5,cssFns:[]},"border-bottom-right-radius":"border-bottom-left-radius","border-bottom-style":{cssPropBits:0,cssLitGroup:[o[9],o[62],o[64],o[71]],cssFns:[]},"border-bottom-width":{cssPropBits:5,cssLitGroup:[o[47],o[69]],cssFns:[]},"border-collapse":{cssPropBits:0,cssLitGroup:[o[59],o[76]],cssFns:[]},"border-color":"background-color","border-left":"border","border-left-color":"background-color","border-left-style":"border-bottom-style","border-left-width":"border-bottom-width","border-radius":{cssPropBits:5,cssLitGroup:[o[49]],cssFns:[]},"border-right":"border","border-right-color":"background-color","border-right-style":"border-bottom-style","border-right-width":"border-bottom-width","border-spacing":"border-bottom-left-radius","border-style":"border-bottom-style","border-top":"border","border-top-color":"background-color","border-top-left-radius":"border-bottom-left-radius","border-top-right-radius":"border-bottom-left-radius","border-top-style":"border-bottom-style","border-top-width":"border-bottom-width","border-width":"border-bottom-width",bottom:{cssPropBits:5,cssLitGroup:[o[52]],cssFns:[]},box:{cssPropBits:0,cssLitGroup:[o[60],o[71],o[72]],cssFns:[]},"box-shadow":{cssPropBits:7,cssLitGroup:[o[0],o[48],o[64],o[71]],cssFns:["rgb()","rgba()"]},"box-sizing":{cssPropBits:0,cssLitGroup:[o[25]],cssFns:[]},"caption-side":{cssPropBits:0,cssLitGroup:[o[31]],cssFns:[]},clear:{cssPropBits:0,cssLitGroup:[o[42],o[54],o[71]],cssFns:[]},clip:{cssPropBits:0,cssLitGroup:[o[52]],cssFns:["rect()"]},color:"background-color",content:{cssPropBits:8,cssLitGroup:[o[71],o[72]],cssFns:[]},cue:{cssPropBits:16,cssLitGroup:[o[71]],cssFns:[]},"cue-after":"cue","cue-before":"cue",cursor:{cssPropBits:16,cssLitGroup:[o[1],o[48],o[52]],cssFns:[]},direction:{cssPropBits:0,cssLitGroup:[o[43]],cssFns:[]},display:{cssPropBits:0,cssLitGroup:[o[4],o[6],o[20],o[52],o[67],o[71]],cssFns:[]},"display-extras":{cssPropBits:0,cssLitGroup:[o[67],o[71]],cssFns:[]},"display-inside":{cssPropBits:0,cssLitGroup:[o[20],o[52]],cssFns:[]},"display-outside":{cssPropBits:0,cssLitGroup:[o[4],o[71]],cssFns:[]},elevation:{cssPropBits:5,cssLitGroup:[o[15]],cssFns:[]},"empty-cells":{cssPropBits:0,cssLitGroup:[o[38]],cssFns:[]},filter:{cssPropBits:0,cssFns:["alpha()"]},"float":{cssPropBits:0,cssLitGroup:[o[42],o[71]],cssFns:[]},font:{cssPropBits:73,cssLitGroup:[o[3],o[8],o[13],o[16],o[41],o[48],o[49],o[69],o[72],o[77]],cssFns:[]},"font-family":{cssPropBits:72,cssLitGroup:[o[16],o[48]],cssFns:[]},"font-size":{cssPropBits:1,cssLitGroup:[o[8],o[69]],cssFns:[]},"font-stretch":{cssPropBits:0,cssLitGroup:[o[5],o[72]],cssFns:[]},"font-style":{cssPropBits:0,cssLitGroup:[o[41],o[72]],cssFns:[]},"font-variant":{cssPropBits:0,cssLitGroup:[o[72],o[77]],cssFns:[]},"font-weight":{cssPropBits:0,cssLitGroup:[o[3],o[72]],cssFns:[]},height:"bottom",left:"bottom","letter-spacing":{cssPropBits:5,cssLitGroup:[o[72]],cssFns:[]},"line-height":{cssPropBits:1,cssLitGroup:[o[72]],cssFns:[]},"list-style":{cssPropBits:16,cssLitGroup:[o[2],o[40],o[57],o[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"list-style-image":{cssPropBits:16,cssLitGroup:[o[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"list-style-position":{cssPropBits:0,cssLitGroup:[o[40]],cssFns:[]},"list-style-type":{cssPropBits:0,cssLitGroup:[o[2],o[57],o[71]],cssFns:[]},margin:"bottom","margin-bottom":"bottom","margin-left":"bottom","margin-right":"bottom","margin-top":"bottom","max-height":{cssPropBits:1,cssLitGroup:[o[52],o[71]],cssFns:[]},"max-width":"max-height","min-height":{cssPropBits:1,cssLitGroup:[o[52]],cssFns:[]},"min-width":"min-height",opacity:{cssPropBits:1,cssFns:[]},outline:{cssPropBits:7,cssLitGroup:[o[0],o[9],o[47],o[62],o[64],o[65],o[69],o[71]],cssFns:["rgb()","rgba()"]},"outline-color":{cssPropBits:2,cssLitGroup:[o[0],o[65]],cssFns:["rgb()","rgba()"]},"outline-style":"border-bottom-style","outline-width":"border-bottom-width",overflow:{cssPropBits:0,cssLitGroup:[o[52],o[62],o[75],o[80]],cssFns:[]},"overflow-wrap":{cssPropBits:0,cssLitGroup:[o[55],o[72]],cssFns:[]},"overflow-x":{cssPropBits:0,cssLitGroup:[o[44],o[52],o[62],o[75],o[80]],cssFns:[]},"overflow-y":"overflow-x",padding:"opacity","padding-bottom":"opacity","padding-left":"opacity","padding-right":"opacity","padding-top":"opacity","page-break-after":{cssPropBits:0,cssLitGroup:[o[42],o[51],o[52],o[53]],cssFns:[]},"page-break-before":"page-break-after","page-break-inside":{cssPropBits:0,cssLitGroup:[o[52],o[53]],cssFns:[]},pause:"border-bottom-left-radius","pause-after":"border-bottom-left-radius","pause-before":"border-bottom-left-radius",perspective:{cssPropBits:5,cssLitGroup:[o[71]],cssFns:[]},"perspective-origin":{cssPropBits:5,cssLitGroup:[o[31],o[42],o[56]],cssFns:[]},pitch:{cssPropBits:5,cssLitGroup:[o[21],o[69]],cssFns:[]},"pitch-range":"border-bottom-left-radius","play-during":{cssPropBits:16,cssLitGroup:[o[52],o[70],o[71],o[74]],cssFns:[]},position:{cssPropBits:0,cssLitGroup:[o[23]],cssFns:[]},quotes:{cssPropBits:8,cssLitGroup:[o[71]],cssFns:[]},resize:{cssPropBits:0,cssLitGroup:[o[39],o[54],o[71]],cssFns:[]},richness:"border-bottom-left-radius",right:"bottom",speak:{cssPropBits:0,cssLitGroup:[o[71],o[72],o[78]],cssFns:[]},"speak-header":{cssPropBits:0,cssLitGroup:[o[51],o[73]],cssFns:[]},"speak-numeral":{cssPropBits:0,cssLitGroup:[o[35]],cssFns:[]},"speak-punctuation":{cssPropBits:0,cssLitGroup:[o[58],o[71]],cssFns:[]},"speech-rate":{cssPropBits:5,cssLitGroup:[o[14],o[69]],cssFns:[]},stress:"border-bottom-left-radius","table-layout":{cssPropBits:0,cssLitGroup:[o[52],o[61]],cssFns:[]},"text-align":{cssPropBits:0,cssLitGroup:[o[42],o[56],o[66]],cssFns:[]},"text-decoration":{cssPropBits:0,cssLitGroup:[o[19],o[71]],cssFns:[]},"text-indent":"border-bottom-left-radius","text-overflow":{cssPropBits:8,cssLitGroup:[o[33]],cssFns:[]},"text-shadow":"box-shadow","text-transform":{cssPropBits:0,cssLitGroup:[o[26],o[71]],cssFns:[]},"text-wrap":{cssPropBits:0,cssLitGroup:[o[46],o[71],o[72]],cssFns:[]},top:"bottom",transform:{cssPropBits:0,cssLitGroup:[o[71]],cssFns:"matrix(),perspective(),rotate(),rotate3d(),rotatex(),rotatey(),rotatez(),scale(),scale3d(),scalex(),scaley(),scalez(),skew(),skewx(),skewy(),translate(),translate3d(),translatex(),translatey(),translatez()".split(",")},"transform-origin":"perspective-origin","transform-style":{cssPropBits:0,cssLitGroup:[o[37]],cssFns:[]},transition:{cssPropBits:1029,cssLitGroup:[o[10],o[48],o[50],o[71]],cssFns:["cubic-bezier()","steps()"]},"transition-delay":"animation-delay","transition-duration":"animation-delay","transition-property":{cssPropBits:1024,cssLitGroup:[o[48],o[50]],cssFns:[]},"transition-timing-function":"animation-timing-function","unicode-bidi":{cssPropBits:0,cssLitGroup:[o[30],o[72]],cssFns:[]},"vertical-align":{cssPropBits:5,cssLitGroup:[o[12],o[31]],cssFns:[]},visibility:"backface-visibility","voice-family":{cssPropBits:8,cssLitGroup:[o[27],o[48]],cssFns:[]},volume:{cssPropBits:1,cssLitGroup:[o[17],o[69]],cssFns:[]},"white-space":{cssPropBits:0,cssLitGroup:[o[22],o[72]],cssFns:[]},width:"min-height","word-break":{cssPropBits:0,cssLitGroup:[o[32],o[72]],cssFns:[]},"word-spacing":"letter-spacing","word-wrap":"overflow-wrap","z-index":"bottom",zoom:"line-height","cubic-bezier()":"animation-delay","steps()":{cssPropBits:5,cssLitGroup:[o[36],o[48]],cssFns:[]},"image()":{cssPropBits:18,cssLitGroup:[o[0],o[48]],cssFns:["rgb()","rgba()"]},"linear-gradient()":{cssPropBits:7,cssLitGroup:[o[0],o[31],o[42],o[48],o[79]],cssFns:["rgb()","rgba()"]},"radial-gradient()":{cssPropBits:7,cssLitGroup:[o[0],o[11],o[31],o[42],o[48],o[56],o[57]],cssFns:["rgb()","rgba()"]},"repeating-linear-gradient()":"linear-gradient()","repeating-radial-gradient()":"radial-gradient()","rgb()":{cssPropBits:1,cssLitGroup:[o[48]],cssFns:[]},"rgba()":"rgb()","rect()":{cssPropBits:5,cssLitGroup:[o[48],o[52]],cssFns:[]},"alpha()":{cssPropBits:1,cssLitGroup:[o[28]],cssFns:[]},"matrix()":"animation-delay","perspective()":"border-bottom-left-radius","rotate()":"border-bottom-left-radius","rotate3d()":"animation-delay","rotatex()":"border-bottom-left-radius","rotatey()":"border-bottom-left-radius","rotatez()":"border-bottom-left-radius","scale()":"animation-delay","scale3d()":"animation-delay","scalex()":"border-bottom-left-radius","scaley()":"border-bottom-left-radius","scalez()":"border-bottom-left-radius","skew()":"animation-delay","skewx()":"border-bottom-left-radius","skewy()":"border-bottom-left-radius","translate()":"animation-delay","translate3d()":"animation-delay","translatex()":"border-bottom-left-radius","translatey()":"border-bottom-left-radius","translatez()":"border-bottom-left-radius"},u;for(u in p){"string"===typeof p[u]&&Object.hasOwnProperty.call(p,u)&&(p[u]=p[p[u]])}"undefined"!==typeof window&&(window.cssSchema=p);var x,y;(function(){function C(E){var I=parseInt(E.substring(1),16);return 65535<I?(I-=65536,String.fromCharCode(55296+(I>>10),56320+(I&1023))):I==I?String.fromCharCode(I):" ">E[1]?"":E[1]}function G(E,I){return'"'+E.replace(/[\u0000-\u001f\\\"<>]/g,I)+'"'}function D(E){return s[E]||(s[E]="\\"+E.charCodeAt(0).toString(16)+" ")}function H(E){return n[E]||(n[E]=("\u0010">E?"%0":"%")+E.charCodeAt(0).toString(16))}var s={"\\":"\\\\"},n={"\\":"%5c"},F=RegExp("\\uFEFF|U[+][0-9A-F?]{1,6}(?:-[0-9A-F]{1,6})?|url[(][\\t\\n\\f ]*(?:\"(?:'|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*\"|'(?:\"|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*'|(?:[\\t\\x21\\x23-\\x26\\x28-\\x5b\\x5d-\\x7e]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*)[\\t\\n\\f ]*[)]|(?!url[(])-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*[(]|(?:@?-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))|#)(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*|\"(?:'|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*\"|'(?:\"|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*'|[-+]?(?:[0-9]+(?:[.][0-9]+)?|[.][0-9]+)(?:%|-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*)?|<!--|-->|[\\t\\n\\f ]+|/(?:[*][^*]*[*]+(?:[^/][^*]*[*]+)*/|/[^\\n\\f]*)|[~|^$*]=|[^\"'\\\\/]|/(?![/*])","gi"),B=RegExp("\\\\(?:(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff])|[\\n\\f])","g"),c=RegExp("^url\\([\\t\\n\\f ]*[\"']?|[\"']?[\\t\\n\\f ]*\\)$","gi");y=function(E){return E.replace(B,C)};x=function(J){for(var J=("\uffff"+J).replace(/^\uffff/,""),J=J.replace(/\r\n?/g,"\n"),J=J.match(F)||[],E=0,L=" ",I=0,O=J.length;I<O;++I){var M=y(J[I]),N=M.length,K=M.charCodeAt(0),M=34==K||39==K?G(M.substring(1,N-1),D):47==K&&1<N||"\\"==M||"-->"==M||"<!--"==M||"\ufeff"==M||32>=K?" ":/url\(/i.test(M)?"url("+G(M.replace(c,""),H)+")":M;if(L!=M||" "!=M){J[E++]=L=M}}J.length=E;return J}})();"undefined"!==typeof window&&(window.lexCss=x,window.decodeCss=y);var z=function(){function D(E){E=(""+E).match(G);return!E?w:new s(I(E[1]),I(E[2]),I(E[3]),I(E[4]),I(E[5]),I(E[6]),I(E[7]))}function J(L,E){return"string"==typeof L?encodeURI(L).replace(E,H):w}function H(E){E=E.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(E>>4&15)+"0123456789ABCDEF".charAt(E&15)}function K(L){if(L===w){return w}for(var L=L.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/"),E=C,M;(M=L.replace(E,"$1"))!=L;L=M){}return L}function B(L,P){var N=L.T(),E=P.K();E?N.ga(P.j):E=P.X();E?N.da(P.n):E=P.Y();E?N.ea(P.k):E=P.$();var O=P.g,Q=K(O);if(E){N.ca(P.V()),Q=Q&&Q.replace(c,"")}else{if(E=!!O){if(47!==Q.charCodeAt(0)){var Q=K(N.g||"").replace(c,""),M=Q.lastIndexOf("/")+1,Q=K((M?Q.substring(0,M):"")+K(O)).replace(c,"")}}else{Q=Q&&Q.replace(c,""),Q!==O&&N.G(Q)}}E?N.G(Q):E=P.aa();E?N.O(P.l):E=P.Z();E&&N.fa(P.o);return N}function s(M,E,P,N,L,O,Q){this.j=M;this.n=E;this.k=P;this.h=N;this.g=L;this.l=O;this.o=Q}function I(E){return"string"==typeof E&&0<E.length?E:w}var C=RegExp(/(\/|^)(?:[^./][^/]*|\.{2,}(?:[^./][^/]*)|\.{3,}[^/]*)\/\.\.(?:\/|$)/),c=/^(?:\.\.\/)*(?:\.\.$)?/;s.prototype.toString=function(){var E=[];w!==this.j&&E.push(this.j,":");w!==this.k&&(E.push("//"),w!==this.n&&E.push(this.n,"@"),E.push(this.k),w!==this.h&&E.push(":",this.h.toString()));w!==this.g&&E.push(this.g);w!==this.l&&E.push("?",this.l);w!==this.o&&E.push("#",this.o);return E.join("")};s.prototype.T=function(){return new s(this.j,this.n,this.k,this.h,this.g,this.l,this.o)};s.prototype.W=function(){return this.j&&decodeURIComponent(this.j).toLowerCase()};s.prototype.ga=function(E){this.j=E?E:w};s.prototype.K=function(){return w!==this.j};s.prototype.da=function(E){this.n=E?E:w};s.prototype.X=function(){return w!==this.n};s.prototype.ea=function(E){this.k=E?E:w;this.G(this.g)};s.prototype.Y=function(){return w!==this.k};s.prototype.V=function(){return this.h&&decodeURIComponent(this.h)};s.prototype.ca=function(E){if(E){E=Number(E);if(E!==(E&65535)){throw Error("Bad port number "+E)}this.h=""+E}else{this.h=w}};s.prototype.$=function(){return w!==this.h};s.prototype.U=function(){return this.g&&decodeURIComponent(this.g)};s.prototype.G=function(E){E?(E=""+E,this.g=!this.k||/^\//.test(E)?E:"/"+E):this.g=w};s.prototype.O=function(E){this.l=E?E:w};s.prototype.aa=function(){return w!==this.l};s.prototype.ba=function(M){if("object"===typeof M&&!(M instanceof Array)&&(M instanceof Object||"[object Array]"!==Object.prototype.toString.call(M))){var E=[],P=-1,N;for(N in M){var L=M[N];"string"===typeof L&&(E[++P]=N,E[++P]=L)}M=E}for(var E=[],P="",O=0;O<M.length;){N=M[O++],L=M[O++],E.push(P,encodeURIComponent(N.toString())),P="&",L&&E.push("=",encodeURIComponent(L.toString()))}this.l=E.join("")};s.prototype.fa=function(E){this.o=E?E:w};s.prototype.Z=function(){return w!==this.o};var G=/^(?:([^:/?#]+):)?(?:\/\/(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,n=/[#\/\?@]/g,F=/[\#\?]/g;s.parse=D;s.create=function(L,E,M,O,P,S,R){L=new s(J(L,n),J(E,n),"string"==typeof M?encodeURIComponent(M):w,0<O?O.toString():w,J(P,F),w,"string"==typeof R?encodeURIComponent(R):w);S&&("string"===typeof S?L.O(S.replace(/[^?&=0-9A-Za-z_\-~.%]/g,H)):L.ba(S));return L};s.N=B;s.ma=K;s.ha={ua:function(E){return/\.html$/.test(D(E).U())?"text/html":"application/javascript"},N:function(L,E){return L?B(D(L),D(E)).toString():""+E}};return s}();"undefined"!==typeof window&&(window.INSIDE_URI=z);var d=h,f=h,j=h,A=h;(function(){function D(E){return"string"===typeof E?'url("'+E.replace(s,I)+'")':'url("about:blank")'}function I(E){return H[E]}function G(E,K){return E?z.ha.N(E,K):K}function J(M,K,E){if(!E){return w}var L=(""+M).match(C);return L&&(!L[1]||c.test(L[1]))?E(M,K):w}function B(E){return E.replace(/^-(?:apple|css|epub|khtml|moz|mso?|o|rim|wap|webkit|xv)-(?=[a-z])/,"")}var s=/[\n\f\r\"\'()*<>]/g,H={"\n":"%0a","\u000c":"%0c","\r":"%0d",'"':"%22","'":"%27","(":"%28",")":"%29","*":"%2a","<":"%3c",">":"%3e"},C=/^(?:([^:/?# ]+):)?/,c=/^(?:https?|mailto|tel)$/i;d=function(){var E={};return function K(V,M,Y,U,ad){var V=B(V),al=p[V];if(!al||"object"!==typeof al){M.length=0}else{for(var ab=al.cssPropBits,ag=ab&80,O=ab&1536,W=NaN,ah=0,ae=0;ah<M.length;++ah){var aa=M[ah].toLowerCase(),Z=aa.charCodeAt(0),ai,am,af,aj,Q,an;if(32===Z){aa=""}else{if(34===Z){aa=16===ag?Y?D(J(G(U,y(M[ah].substring(1,aa.length-1))),V,Y)):"":ab&8&&!(ag&ag-1)?aa:""}else{if("inherit"!==aa){if(Q=al.cssLitGroup){var X;if(!(X=al.cssLitMap)){X={};for(var ac=Q.length;0<=--ac;){for(var L=Q[ac],ak=L.length;0<=--ak;){X[L[ak]]=E}}X=al.cssLitMap=X}Q=X}else{Q=E}if(!(an=Q,an[B(aa)]===E)){if(35===Z&&/^#(?:[0-9a-f]{3}){1,2}$/.test(aa)){aa=ab&2?aa:""}else{if(48<=Z&&57>=Z){aa=ab&1?aa:""}else{if(ai=aa.charCodeAt(1),am=aa.charCodeAt(2),af=48<=ai&&57>=ai,aj=48<=am&&57>=am,43===Z&&(af||46===ai&&aj)){aa=ab&1?(af?"":"0")+aa.substring(1):""}else{if(45===Z&&(af||46===ai&&aj)){aa=ab&4?(af?"-":"-0")+aa.substring(1):ab&1?"0":""}else{if(46===Z&&af){aa=ab&1?"0"+aa:""}else{if('url("'===aa.substring(0,5)){aa=Y&&ab&16?D(J(G(U,M[ah].substring(5,aa.length-2)),V,Y)):""}else{if("("===aa.charAt(aa.length-1)){E:{Q=M;X=ah;aa=1;ac=X+1;for(Z=Q.length;ac<Z&&aa;){L=Q[ac++],aa+=")"===L?-1:/^[^"']*\($/.test(L)}if(!aa){aa=Q[X].toLowerCase();Z=B(aa);Q=Q.splice(X,ac-X,"");X=al.cssFns;ac=0;for(L=X.length;ac<L;++ac){if(X[ac].substring(0,Z.length)==Z){Q[0]=Q[Q.length-1]="";K(X[ac],Q,Y,U);aa=aa+Q.join(" ")+")";break E}}}aa=""}}else{aa=O&&/^-?[a-z_][\w\-]*$/.test(aa)&&!/__$/.test(aa)?ad&&512===O?M[ah]+ad:1024===O&&p[aa]&&"number"===typeof p[aa].oa?aa:"":/^\w+$/.test(aa)&&64===ag&&ab&8?W+1===ae?(M[W]=M[W].substring(0,M[W].length-1)+" "+aa+'"',""):(W=ae,'"'+aa+'"'):""}}}}}}}}}}}aa&&(M[ae++]=aa)}1===ae&&'url("about:blank")'===M[0]&&(ae=0);M.length=ae}}}();var F=RegExp("^(active|after|before|blank|checked|default|disabled|drop|empty|enabled|first|first-child|first-letter|first-line|first-of-type|fullscreen|focus|hover|in-range|indeterminate|invalid|last-child|last-of-type|left|link|only-child|only-of-type|optional|out-of-range|placeholder-shown|read-only|read-write|required|right|root|scope|user-error|valid|visited)$"),n={};n[">"]=n["+"]=n["~"]=n;f=function(E,L,O){function P(X,ab){function Z(ad,ag,ah){var ap,af,aj,ak,am,al=t;ap="";if(ad<ag){if(am=E[ad],"*"===am){++ad,ap=am}else{if(/^[a-zA-Z]/.test(am)&&(af=V(am.toLowerCase(),[]))){"tagName"in af&&(am=af.tagName),++ad,ap=am}}}for(ak=aj=af="";al&&ad<ag;++ad){if(am=E[ad],"#"===am.charAt(0)){/^#_|__$|[^\w#:\-]/.test(am)?al=i:af+=am+U}else{if("."===am){++ad<ag&&/^[0-9A-Za-z:_\-]+$/.test(am=E[ad])&&!/^_|__$/.test(am)?af+="."+am:al=i}else{if(ad+1<ag&&"["===E[ad]){++ad;var ai=E[ad++].toLowerCase();am=a.m[ap+"::"+ai];am!==+am&&(am=a.m["*::"+ai]);var ao;L.ia?(ao=L.ia(ap,ai),"string"!==typeof ao&&(al=i,ao=ai),al&&am!==+am&&(am=a.d.NONE)):(ao=ai,am!==+am&&(al=i));var an=ai="",ae=i;/^[~^$*|]?=$/.test(E[ad])&&(ai=E[ad++],an=E[ad++],/^[0-9A-Za-z:_\-]+$/.test(an)?an='"'+an+'"':"]"===an&&(an='""',--ad),/^"([^\"\\]|\\.)*"$/.test(an)||(al=i),(ae="i"===E[ad])&&++ad);"]"!==E[ad]&&(++ad,al=i);switch(am){case a.d.CLASSES:case a.d.LOCAL_NAME:case a.d.NONE:break;case a.d.GLOBAL_NAME:case a.d.ID:case a.d.IDREF:("="===ai||"~="===ai||"$="===ai)&&'""'!=an&&!ae?an='"'+an.substring(1,an.length-1)+U+'"':"|="===ai||""===ai||(al=i);break;case a.d.URI:case a.d.URI_FRAGMENT:""!==ai&&(al=i);break;default:al=i}al&&(aj+="["+ao.replace(/[^\w-]/g,"\\$&")+ai+an+(ae?" i]":"]"))}else{if(ad<ag&&":"===E[ad]){if(am=E[++ad],F.test(am)){ak+=":"+am}else{break}}else{break}}}}}ad!==ag&&(al=i);al&&(ad=(ap+af).replace(/[^ .*#\w-]/g,"\\$&")+aj+ak+ah)&&W.push(ad);return al}" "===E[X]&&++X;ab-1!==X&&" "===E[ab]&&--ab;for(var W=[],Y=X,aa=t,ac=X;aa&&ac<ab;++ac){var N=E[ac];if(n[N]===n||" "===N){Z(Y,ac,N)?Y=ac+1:aa=i}}Z(Y,ab,"")||(aa=i);return aa?(W.length&&(Y=W.join(""),M!==w&&(Y="."+M+" "+Y),R.push(Y)),t):!O||O(E.slice(X,ab))}var M=L.na,U=L.L,V=L.Aa,R=[],T=0,Q,S=0,K;for(Q=0;Q<E.length;++Q){if(K=E[Q],"("==K||"["==K?(++S,t):")"==K||"]"==K?(S&&--S,t):!(" "==E[Q]&&(S||n[E[Q-1]]===n||n[E[Q+1]]===n))){E[T++]=E[Q]}}E.length=T;T=E.length;for(Q=S=0;Q<T;++Q){if(","===E[Q]){if(!P(S,Q)){return w}S=Q+1}}return!P(S,T)?w:R};(function(){var E=/^\w/,K=RegExp("^(?:(?:(?:(?:only|not) )?(?:all|aural|braille|embossed|handheld|print|projection|screen|speech|tty|tv)|\\( (?:(?:min-|max-)?(?:(?:device-)?(?:aspect-ratio|height|width)|color(?:-index)?|monochrome|orientation|resolution)|grid|hover|luminosity|pointer|scan|script) (?:: -?(?:[a-z]\\w+(?:-\\w+)*|\\d+(?: / \\d+|(?:\\.\\d+)?(?:p[cxt]|[cem]m|in|dpi|dppx|dpcm|%)?)) )?\\))(?: and ?\\( (?:(?:min-|max-)?(?:(?:device-)?(?:aspect-ratio|height|width)|color(?:-index)?|monochrome|orientation|resolution)|grid|hover|luminosity|pointer|scan|script) (?:: -?(?:[a-z]\\w+(?:-\\w+)*|\\d+(?: / \\d+|(?:\\.\\d+)?(?:p[cxt]|[cem]m|in|dpi|dppx|dpcm|%)?)) )?\\))*)(?: , (?:(?:(?:(?:only|not) )?(?:all|aural|braille|embossed|handheld|print|projection|screen|speech|tty|tv)|\\( (?:(?:min-|max-)?(?:(?:device-)?(?:aspect-ratio|height|width)|color(?:-index)?|monochrome|orientation|resolution)|grid|hover|luminosity|pointer|scan|script) (?:: -?(?:[a-z]\\w+(?:-\\w+)*|\\d+(?: / \\d+|(?:\\.\\d+)?(?:p[cxt]|[cem]m|in|dpi|dppx|dpcm|%)?)) )?\\))(?: and ?\\( (?:(?:min-|max-)?(?:(?:device-)?(?:aspect-ratio|height|width)|color(?:-index)?|monochrome|orientation|resolution)|grid|hover|luminosity|pointer|scan|script) (?:: -?(?:[a-z]\\w+(?:-\\w+)*|\\d+(?: / \\d+|(?:\\.\\d+)?(?:p[cxt]|[cem]m|in|dpi|dppx|dpcm|%)?)) )?\\))*))*$","i");A=function(L){for(var L=L.slice(),N=L.length,O=0,P=0;P<N;++P){var M=L[P];" "!=M&&(L[O++]=M)}L.length=O;L=L.join(" ");return L=!L.length?"":!K.test(L)?"not all":E.test(L)?L:"not all , "+L}})();(function(){function E(L){var M=/^\s*[']([^']*)[']\s*$/,N=/^\s*url\s*[(]["]([^"]*)["][)]\s*$/,O=/^\s*url\s*[(][']([^']*)['][)]\s*$/,P=/^\s*url\s*[(]([^)]*)[)]\s*$/,Q;return(Q=/^\s*["]([^"]*)["]\s*$/.exec(L))||(Q=M.exec(L))||(Q=N.exec(L))||(Q=O.exec(L))||(Q=P.exec(L))?Q[1]:w}function K(N,P,Q,M,V,W,U){function R(){T=O.length&&O[O.length-1]===w}var S=h,L=U||[0],O=[],T=i;k(P,{startStylesheet:function(){S=[]},endStylesheet:function(){},startAtrule:function(Y,Z){if(T){Y=w}else{if("@media"===Y){S.push("@media"," ",A(Z))}else{if("@keyframes"===Y||"@-webkit-keyframes"===Y){var aa=Z[0];1===Z.length&&!/__$|[^\w\-]/.test(aa)?(S.push(Y," ",aa+Q.L),Y="@keyframes"):Y=w}else{if("@import"===Y&&0<Z.length){if(Y=w,"function"===typeof W){var ab=A(Z.slice(1));if("not all"!==ab){++L[0];var ac=[];S.push(ac);var X=J(G(N,E(Z[0])),function(ad){var ae=K(X,ad.qa,Q,M,V,W,L);--L[0];ad=ab?{toString:function(){return"@media "+ab+" {"+ae.result+"}"}}:ae.result;ac[0]=ad;W(ad,!!L[0])},V)}}else{window.console&&window.console.log("@import "+Z.join(" ")+" elided")}}}}}T=!Y;O.push(Y)},endAtrule:function(){O.pop();T||S.push(";");R()},startBlock:function(){T||S.push("{")},endBlock:function(){T||(S.push("}"),T=t)},startRuleset:function(X){if(!T){var Y=h;"@keyframes"===O[O.length-1]?(Y=X.join(" ").match(/^ *(?:from|to|\d+(?:\.\d+)?%) *(?:, *(?:from|to|\d+(?:\.\d+)?%) *)*$/i),T=!Y,Y&&(Y=Y[0].replace(/ +/g,""))):(X=f(X,Q),!X||!X.length?T=t:Y=X.join(", "));T||S.push(Y,"{")}O.push(w)},endRuleset:function(){O.pop();T||S.push("}");R()},declaration:function(X,Y){if(!T){var Z=i,aa=Y.length;2<=aa&&"!"===Y[aa-2]&&"important"===Y[aa-1].toLowerCase()&&(Z=t,Y.length-=2);d(X,Y,M,N,Q.L);Y.length&&S.push(X,":",Y.join(" "),Z?" !important;":";")}}});return{result:{toString:function(){return S.join("")}},va:!!L[0]}}j=function(L,M,N,O){return K(L,M,N,O,h,h).result.toString()}})()})();"undefined"!==typeof window&&(window.sanitizeCssProperty=d,window.sanitizeCssSelectorList=f,window.sanitizeStylesheet=j,window.sanitizeMediaQuery=A);var k,l;(function(){function s(J,E,K,G,L){for(var H=E++;E<K&&"{"!==J[E]&&";"!==J[E];){++E}if(E<K&&(L||";"===J[E])){var L=H+1,I=E;L<K&&" "===J[L]&&++L;I>L&&" "===J[I-1]&&--I;G.startAtrule&&G.startAtrule(J[H].toLowerCase(),J.slice(L,I));E="{"===J[E]?D(J,E,K,G):E+1;G.endAtrule&&G.endAtrule()}return E}function D(H,E,J,G){++E;for(G.startBlock&&G.startBlock();E<J;){var I=H[E].charAt(0);if("}"==I){++E;break}E=" "===I||";"===I?E+1:"@"===I?s(H,E,J,G,i):"{"===I?D(H,E,J,G):B(H,E,J,G)}G.endBlock&&G.endBlock();return E}function B(I,E,J,G){var K=E,H=F(I,E,J,t);if(0>H){return H=~H,H===K?H+1:H}var L=I[H];if("{"!==L){return H===K?H+1:H}E=H+1;H>K&&" "===I[H-1]&&--H;for(G.startRuleset&&G.startRuleset(I.slice(K,H));E<J;){L=I[E];if("}"===L){++E;break}E=" "===L?E+1:c(I,E,J,G)}G.endRuleset&&G.endRuleset();return E}function F(J,E,K,G){for(var L,H=[],I=-1;E<K;++E){if(L=J[E].charAt(0),"["===L||"("===L){H[++I]=L}else{if("]"===L&&"["===H[I]||")"===L&&"("===H[I]){--I}else{if("{"===L||"}"===L||";"===L||"@"===L||":"===L&&!G){break}}}}0<=I&&(E=~(E+1));return E}function n(G,E,H){for(;E<H&&";"!==G[E]&&"}"!==G[E];){++E}return E<H&&";"===G[E]?E+1:E}function c(J,E,K,G){var L=J[E++];if(!C.test(L)){return n(J,E,K)}E<K&&" "===J[E]&&++E;if(E==K||":"!==J[E]){return n(J,E,K)}++E;E<K&&" "===J[E]&&++E;var H=F(J,E,K,i);if(0>H){H=~H}else{for(var I=[],M=0,N=E;N<H;++N){E=J[N]," "!==E&&(I[M++]=E)}if(H<K){do{E=J[H];if(";"===E||"}"===E){break}M=0}while(++H<K);";"===E&&++H}M&&G.declaration&&G.declaration(L.toLowerCase(),I)}return H}k=function(I,E){var H=x(I);E.startStylesheet&&E.startStylesheet();for(var G=0,J=H.length;G<J;){G=" "===H[G]?G+1:G<J?"@"===H[G].charAt(0)?s(H,G,J,E,t):B(H,G,J,E):G}E.endStylesheet&&E.endStylesheet()};var C=/^-?[a-z]/i;l=function(H,E){for(var J=x(H),G=0,I=J.length;G<I;){G=" "!==J[G]?c(J,G,I,E):G+1}}})();"undefined"!==typeof window&&(window.parseCssStylesheet=k,window.parseCssDeclarations=l);var a={d:{NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13}};a.atype=a.d;a.m={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onerror":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::ontouchcancel":2,"*::ontouchend":2,"*::ontouchenter":2,"*::ontouchleave":2,"*::ontouchmove":2,"*::ontouchstart":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::tabindex":0,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"audio::src":1,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::pattern":0,"input::placeholder":0,"input::readonly":0,"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::optimum":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::src":1,"video::width":0};a.ATTRIBS=a.m;a.c={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256};a.eflags=a.c;a.f={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:4,img:2,input:2,ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,"var":0,video:0,wbr:2};a.ELEMENTS=a.f;a.Q={a:"HTMLAnchorElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement","var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"};a.ELEMENT_DOM_INTERFACES=a.Q;a.P={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2};a.ueffects=a.P;a.J={"a::href":2,"area::href":2,"audio::src":1,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0,"video::poster":1,"video::src":1};a.URIEFFECTS=a.J;a.M={UNSANDBOXED:2,SANDBOXED:1,DATA:0};a.ltypes=a.M;a.I={"a::href":2,"area::href":2,"audio::src":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1,"video::src":2};a.LOADERTYPES=a.I;"undefined"!==typeof window&&(window.html4=a);var m=function(Y){function az(B){if(ag.hasOwnProperty(B)){return ag[B]}var D=B.match(ap);return D?String.fromCharCode(parseInt(D[1],10)):(D=B.match(C))?String.fromCharCode(parseInt(D[1],16)):ar&&X.test(B)?(ar.innerHTML="&"+B+";",D=ar.textContent,ag[B]=D):"&"+B+";"}function al(B,D){return az(D)}function aA(B){return B.replace(ae,al)}function O(B){return(""+B).replace(at,"&amp;").replace(ao,"&lt;").replace(au,"&gt;").replace(J,"&#34;")}function L(B){return B.replace(ad,"&amp;$1").replace(ao,"&lt;").replace(au,"&gt;")}function ax(B){var D={z:B.z||B.cdata,A:B.A||B.comment,B:B.B||B.endDoc,t:B.t||B.endTag,e:B.e||B.pcdata,F:B.F||B.rcdata,H:B.H||B.startDoc,w:B.w||B.startTag};return function(E,I){var G;var M=/(<\/|<\!--|<[!?]|[&<>])/g;G=E+"";if(Z){G=G.split(M)}else{for(var F=[],K=0,N;(N=M.exec(G))!==w;){F.push(G.substring(K,N.index)),F.push(N[0]),K=N.index+N[0].length}F.push(G.substring(K));G=F}c(D,G,0,{r:i,C:i},I)}}function W(B,D,F,E,G){return function(){c(B,D,F,E,G)}}function c(F,I,aC,M,aF){try{F.H&&0==aC&&F.H(aF);for(var P,aL,Q,R=I.length;aC<R;){var V=I[aC++],S=I[aC];switch(V){case"&":ac.test(S)?(F.e&&F.e("&"+S,aF,n,W(F,I,aC,M,aF)),aC++):F.e&&F.e("&amp;",aF,n,W(F,I,aC,M,aF));break;case"</":if(P=/^([-\w:]+)[^\'\"]*/.exec(S)){if(P[0].length===S.length&&">"===I[aC+1]){aC+=2,Q=P[1].toLowerCase(),F.t&&F.t(Q,aF,n,W(F,I,aC,M,aF))}else{var T=I,aD=aC,aE=F,aG=aF,aH=n,aK=M,aI=s(T,aD);aI?(aE.t&&aE.t(aI.name,aG,aH,W(aE,T,aD,aK,aG)),aC=aI.next):aC=T.length}}else{F.e&&F.e("&lt;/",aF,n,W(F,I,aC,M,aF))}break;case"<":if(P=/^([-\w:]+)\s*\/?/.exec(S)){if(P[0].length===S.length&&">"===I[aC+1]){aC+=2;Q=P[1].toLowerCase();F.w&&F.w(Q,[],aF,n,W(F,I,aC,M,aF));var G=Y.f[Q];G&ah&&(aC=ab(I,{name:Q,next:aC,c:G},F,aF,n,M))}else{var T=I,aD=F,aE=aF,aG=n,aH=M,aJ=s(T,aC);aJ?(aD.w&&aD.w(aJ.name,aJ.R,aE,aG,W(aD,T,aJ.next,aH,aE)),aC=aJ.c&ah?ab(T,aJ,aD,aE,aG,aH):aJ.next):aC=T.length}}else{F.e&&F.e("&lt;",aF,n,W(F,I,aC,M,aF))}break;case"<!--":if(!M.C){for(aL=aC+1;aL<R&&!(">"===I[aL]&&/--$/.test(I[aL-1]));aL++){}if(aL<R){if(F.A){var K=I.slice(aC,aL).join("");F.A(K.substr(0,K.length-2),aF,n,W(F,I,aL+1,M,aF))}aC=aL+1}else{M.C=t}}M.C&&F.e&&F.e("&lt;!--",aF,n,W(F,I,aC,M,aF));break;case"<!":if(/^\w/.test(S)){if(!M.r){for(aL=aC+1;aL<R&&">"!==I[aL];aL++){}aL<R?aC=aL+1:M.r=t}M.r&&F.e&&F.e("&lt;!",aF,n,W(F,I,aC,M,aF))}else{F.e&&F.e("&lt;!",aF,n,W(F,I,aC,M,aF))}break;case"<?":if(!M.r){for(aL=aC+1;aL<R&&">"!==I[aL];aL++){}aL<R?aC=aL+1:M.r=t}M.r&&F.e&&F.e("&lt;?",aF,n,W(F,I,aC,M,aF));break;case">":F.e&&F.e("&gt;",aF,n,W(F,I,aC,M,aF));break;case"":break;default:F.e&&F.e(V,aF,n,W(F,I,aC,M,aF))}}F.B&&F.B(aF)}catch(N){if(N!==n){throw N}}}function ab(B,D,E,F,N,I){var P=B.length;av.hasOwnProperty(D.name)||(av[D.name]=RegExp("^"+D.name+"(?:[\\s\\/]|$)","i"));for(var G=av[D.name],K=D.next,M=D.next+1;M<P&&!("</"===B[M-1]&&G.test(B[M]));M++){}M<P&&(M-=1);P=B.slice(K,M).join("");if(D.c&Y.c.CDATA){E.z&&E.z(P,F,N,W(E,B,M,I,F))}else{if(D.c&Y.c.RCDATA){E.F&&E.F(L(P),F,N,W(E,B,M,I,F))}else{throw Error("bug")}}return M}function s(B,D){var E=/^([-\w:]+)/.exec(B[D]),G={};G.name=E[1].toLowerCase();G.c=Y.f[G.name];for(var F=B[D].substr(E[0].length),I=D+1,M=B.length;I<M&&">"!==B[I];I++){F+=B[I]}if(!(M<=I)){for(var K=[];""!==F;){if(E=af.exec(F)){if(E[4]&&!E[5]||E[6]&&!E[7]){for(var E=E[4]||E[6],P=i,F=[F,B[I++]];I<M;I++){if(P){if(">"===B[I]){break}}else{0<=B[I].indexOf(E)&&(P=t)}F.push(B[I])}if(M<=I){break}F=F.join("")}else{var P=E[1].toLowerCase(),N;if(E[2]){N=E[3];var Q=N.charCodeAt(0);if(34===Q||39===Q){N=N.substr(1,N.length-2)}N=aA(N.replace(an,""))}else{N=""}K.push(P,N);F=F.substr(E[0].length)}}else{F=F.replace(/^[\s\S][^a-z\s]*/,"")}}G.R=K;G.next=I+1;return G}}function aa(B){function D(G,I){F||I.push(G)}var E,F;return ax({startDoc:function(){E=[];F=i},startTag:function(G,I,K){if(!F&&Y.f.hasOwnProperty(G)){var N=Y.f[G];if(!(N&Y.c.FOLDABLE)){var P=B(G,I);if(P){if("object"!==typeof P){throw Error("tagPolicy did not return object (old API?)")}if("attribs"in P){I=P.attribs}else{throw Error("tagPolicy gave no attribs")}var M;"tagName"in P?(M=P.tagName,P=Y.f[M]):(M=G,P=N);if(N&Y.c.OPTIONAL_ENDTAG){var Q=E[E.length-1];Q&&Q.D===G&&(Q.v!==M||G!==M)&&K.push("</",Q.v,">")}N&Y.c.EMPTY||E.push({D:G,v:M});K.push("<",M);G=0;for(Q=I.length;G<Q;G+=2){var R=I[G],S=I[G+1];S!==w&&S!==h&&K.push(" ",R,'="',O(S),'"')}K.push(">");N&Y.c.EMPTY&&!(P&Y.c.EMPTY)&&K.push("</",M,">")}else{F=!(N&Y.c.EMPTY)}}}},endTag:function(G,I){if(F){F=i}else{if(Y.f.hasOwnProperty(G)){var K=Y.f[G];if(!(K&(Y.c.EMPTY|Y.c.FOLDABLE))){if(K&Y.c.OPTIONAL_ENDTAG){for(K=E.length;0<=--K;){var M=E[K].D;if(M===G){break}if(!(Y.f[M]&Y.c.OPTIONAL_ENDTAG)){return}}}else{for(K=E.length;0<=--K&&E[K].D!==G;){}}if(!(0>K)){for(M=E.length;--M>K;){var N=E[M].v;Y.f[N]&Y.c.OPTIONAL_ENDTAG||I.push("</",N,">")}K<E.length&&(G=E[K].v);E.length=K;I.push("</",G,">")}}}}},pcdata:D,rcdata:D,cdata:D,endDoc:function(G){for(;E.length;E.length--){G.push("</",E[E.length-1].v,">")}}})}function H(B,D,E,F,G){if(!G){return w}try{var I=z.parse(""+B);if(I&&(!I.K()||ai.test(I.W()))){var K=G(I,D,E,F);return K?K.toString():w}}catch(M){}return w}function aB(B,D,E,G,F){E||B(D+" removed",{S:"removed",tagName:D});if(G!==F){var I="changed";G&&!F?I="removed":!G&&F&&(I="added");B(D+"."+E+" "+I,{S:I,tagName:D,la:E,oldValue:G,newValue:F})}}function aj(B,D,E){D=D+"::"+E;if(B.hasOwnProperty(D)){return B[D]}D="*::"+E;if(B.hasOwnProperty(D)){return B[D]}}function ay(B,D,F,E,G){for(var K=0;K<D.length;K+=2){var M=D[K],I=D[K+1],N=I,P=w,Q;if((Q=B+"::"+M,Y.m.hasOwnProperty(Q))||(Q="*::"+M,Y.m.hasOwnProperty(Q))){P=Y.m[Q]}if(P!==w){switch(P){case Y.d.NONE:break;case Y.d.SCRIPT:I=w;G&&aB(G,B,M,N,I);break;case Y.d.STYLE:if("undefined"===typeof am){I=w;G&&aB(G,B,M,N,I);break}var R=[];am(I,{declaration:function(S,T){var V=S.toLowerCase();aw(V,T,F?function(aC){return H(aC,Y.P.ja,Y.M.ka,{TYPE:"CSS",CSS_PROP:V},F)}:w);T.length&&R.push(V+": "+T.join(" "))}});I=0<R.length?R.join(" ; "):w;G&&aB(G,B,M,N,I);break;case Y.d.ID:case Y.d.IDREF:case Y.d.IDREFS:case Y.d.GLOBAL_NAME:case Y.d.LOCAL_NAME:case Y.d.CLASSES:I=E?E(I):I;G&&aB(G,B,M,N,I);break;case Y.d.URI:I=H(I,aj(Y.J,B,M),aj(Y.I,B,M),{TYPE:"MARKUP",XML_ATTR:M,XML_TAG:B},F);G&&aB(G,B,M,N,I);break;case Y.d.URI_FRAGMENT:I&&"#"===I.charAt(0)?(I=I.substring(1),I=E?E(I):I,I!==w&&I!==h&&(I="#"+I)):I=w;G&&aB(G,B,M,N,I);break;default:I=w,G&&aB(G,B,M,N,I)}}else{I=w,G&&aB(G,B,M,N,I)}D[K+1]=I}return D}function U(B,D,E){return function(F,G){if(Y.f[F]&Y.c.UNSAFE){E&&aB(E,F,h,h,h)}else{return{attribs:ay(F,G,B,D,E)}}}}function aq(B,D){var E=[];aa(D)(B,E);return E.join("")}var am,aw;"undefined"!==typeof window&&(am=window.parseCssDeclarations,aw=window.sanitizeCssProperty);var ag={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:"\u00a0"},ap=/^#(\d+)$/,C=/^#x([0-9A-Fa-f]+)$/,X=/^[A-Za-z][A-za-z0-9]+$/,ar="undefined"!==typeof window&&window.document?window.document.createElement("textarea"):w,an=/\0/g,ae=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,ac=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,at=/&/g,ad=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,ao=/[<]/g,au=/>/g,J=/\"/g,af=/^\s*([-.:\w]+)(?:\s*(=)\s*((")[^"]*("|$)|(')[^']*('|$)|(?=[a-z][-\w]*\s*=)|[^"'\s]*))?/i,Z=3==="a,b".split(/(,)/).length,ah=Y.c.CDATA|Y.c.RCDATA,n={},av={},ai=/^(?:https?|mailto|tel)$/i,ak={};ak.pa=ak.escapeAttrib=O;ak.ra=ak.makeHtmlSanitizer=aa;ak.sa=ak.makeSaxParser=ax;ak.ta=ak.makeTagPolicy=U;ak.wa=ak.normalizeRCData=L;ak.xa=ak.sanitize=function(B,D,E,F){return aq(B,U(D,E,F))};ak.ya=ak.sanitizeAttribs=ay;ak.za=ak.sanitizeWithPolicy=aq;ak.Ba=ak.unescapeEntities=aA;return ak}(a),q=m.sanitize;"undefined"!==typeof window&&(window.html=m,window.html_sanitize=q)})();if(!Array.prototype.indexOf||[].indexOf("")!=-1){Array.prototype.indexOf=function(d,f){for(var a=(f||0),c=this.length;a<c;a++){if(this[a]===d){return a}}return-1}}html4.ATTRIBS["a::target"]=0;html4.ATTRIBS["input::data-post"]=0;html4.ATTRIBS["span::data-say"]=0}var insideChatPane=new function(){var frame,body;var initted=false;var chatFrameCreated=false;var imageurl,customImageUrl;var chatPaneContent,chatPane,chatPanePreviousContent;var chatPaneOpen=false;var chatSettings;var preview=false;var workflowArchiveId;var _this=this;var disconnected=false;var TweenLite,Back;var availableAssistants=[];var defaultBoxShadow="0px 0px 10px rgba(0, 0, 0, 0.25)";var moment;var langCode="en";this.langCode=langCode;var rtlLangs=["ar","he"];var device=1;var showHeaderForTab=false;var animationsDisabled=false;var sendButton;var chatInput,chatInputCell,header,headerContainer,footer;var chatEndedByCustomer=false;var messagesList=[];var emailRegex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var iOSVersion="";var iOSMobile=false;var iOSiPad=false;var iosChrome=false;var isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);var isFirefox=navigator.userAgent.indexOf("Firefox")!=-1;var isEdge=/Edge\/\d/.test(navigator.userAgent);var initialVhValue=0;var iconset="rounded";var justInitted=true;var isMessageOnly=false;Array.prototype.forEach||(Array.prototype.forEach=function(c){var d,a;if(null==this){throw new TypeError("this is null or not defined")}var b=Object(this),e=b.length>>>0;if("function"!==typeof c){throw new TypeError(c+" is not a function")}1<arguments.length&&(d=arguments[1]);for(a=0;a<e;){if(a in b){var f=b[a];c.call(d,f,a,b)}a++}});this.init=init;function init(){try{iOSMobile=(navigator.userAgent.match(/(iPhone|iPod)/g)?true:false);if(iOSMobile){iOSVersion=parseInt(navigator.appVersion.split("Version/")[1].split(" ")[0]);if(iOSVersion<=9){document.getElementById("inside_holder").classList.add("oldIos")}}}catch(e){}iOSiPad=(navigator.userAgent.match(/(iPad)/g)?true:false)||(navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1);isIE=!!navigator.userAgent.match(/Trident.*rv\:11\./)||window.navigator.userAgent.indexOf("MSIE ")>0;if(navigator.userAgent.indexOf("CriOS")!=-1){iosChrome=true}if(isFirefox){document.getElementById("inside_holder").classList.add("firefox")}else{if(isIE){document.getElementById("inside_holder").classList.add("ie")}else{if(iosChrome){document.getElementById("inside_holder").classList.add("iosChrome")}else{if(isEdge){document.getElementById("inside_holder").classList.add("edge")}}}}chatSettings=settings.chatSettings;workflowArchiveId=settings.workflowArchiveId;_this.settings=settings;iconset=chatSettings.chatPane.iconset;if(iOSiPad&&chatSettings.chatPane.dynamicHeight){chatSettings.chatPane.dynamicHeight=false}isRTL=!preview&&typeof(insideFrontInterface)!="undefined"&&insideFrontInterface.labelTranslations&&insideFrontInterface.labelTranslations.langCode&&rtlLangs.indexOf(insideFrontInterface.labelTranslations.langCode)>-1;setRTLChatpane();if(initted){return}initted=true;insideChatPane.ready=true;customImageUrl=_insideCDN+"custom/";imageurl=_insideCDN+"images/";window.imageurl=imageurl;window.customImageUrl=customImageUrl;_this.jQuery=$;if(_preview){preview=_preview}if(!preview){insideFrontInterface.chat.version=2}topWindow.onresize=windowScale;topInsideHolder=topWindow.document.getElementById("inside_holder");frame=window;try{device=$.inside.front.getDevice()}catch(e){device=1}_this.device=device;setFooterLink();if(typeof insideFrontInterface=="undefined"){window.insideFrontInterface={chat:{}}}bindInsideEvents();if(!window.insideFrontInterface.chat){insideFrontInterface.chat={}}insideFrontInterface.chat.settings=settings;insideFrontInterface.chat.open=openChatPane;insideFrontInterface.chat.scrollChatToBottom=scrollToBottom;insideFrontInterface.regexContainsHtmlTag=new RegExp(/<[a-z][\s\S]*/i);insideFrontInterface.smellsHTML=function(str){return insideFrontInterface.regexContainsHtmlTag.test(str)};insideFrontInterface.safeSanitizeHtml=function(str){function urlX(url){if(/^https?:\/\//.test(url)||/^tel:/.test(url)||/^mailto:/.test(url)){return url}}function idX(id){return id}str=html_sanitize(str,urlX,idX);var div=document.createElement("div");div.innerHTML=str;$(div).find("script, canvas, iframe, frame, frameset, applet, object, embed").remove();return div.innerHTML};insideFrontInterface.escapeHtml=function(str,check,forceEscape){if(str==null||str==undefined){return str}if(typeof str!="string"&&(str!=null&&(str.type==="multilangstring"||str.type==="multilangobject"))){return str}if(forceEscape!=true&&str&&!insideFrontInterface.smellsHTML(str)){return str}var encode=true;if(check){encode=regexContainsHtmlTag.test(str)}if(encode){var div=document.createElement("div");div.appendChild(document.createTextNode(str));return div.innerHTML}return str};try{if($.inside.front.settingsData&&$.inside.front.settingsData.workflows){_insideGraph.initModule("workflow");insideWorkflows.settings=$.inside.front.settingsData.workflows;insideWorkflows.workflowBotId=$.inside.front.settingsData.workflowBotId}}catch(e){}try{var data=_insideGraph.jQuery.inside.front.settingsData;if(data.settings&&data.settings.workflows){_insideGraph.initModule("workflow");insideWorkflows.settings=data.settings.workflows;insideWorkflows.workflowBotId=data.workflowBotId}}catch(e){}var localStorageChatOpen=localStorage.getItem("insideChatPaneOpen")=="true";try{initModules();chatReceived($.inside.front.settingsData.chats,"connected")}catch(e){}if(!preview&&device==1&&localStorageChatOpen&&availableAssistants.length>0&&activeChat){openChatPane()}else{if(!preview&&(typeof(insideWebApp)=="undefined"||!insideWebApp)){_frame.classList.add("notransition");windowScale();_frame.style.display="none";if(device===1&&localStorageChatOpen&&activeChat||checkHeaderTabIsShowing()){insideChatPane.close()}_frame.classList.remove("notransition");setTimeout(windowScale,1000)}}try{connectedToInside(_insideGraph.jQuery.inside.front.settingsData,true)}catch(e){console.trace(e)}insideFrontInterface.animateOpenChatPane=openChatPane;setInterval(updateTimes,30000);setTimeout(function(){_frame.style.opacity=1;_frame.style.visibility="";scrollToBottom(0)},0);if(!preview){if(availableAssistants.length>0){insideFrontInterface.chat.setOnlineChatTab()}else{insideFrontInterface.chat.setOfflineChatTab()}}if(device==2&&chatSettings.chatPane.disableHashOnMobile===false){$(topWindow).bind("hashchange",hashChange)}window.addEventListener("focus",windowFocused);window.addEventListener("blur",windowBlurred);var supportsOrientationChange="onorientationchange"in window,orientationEvent=supportsOrientationChange?"orientationchange":"resize";try{window.addEventListener(orientationEvent,orientationChange,false)}catch(e){}if(preview){initModules()}setTimeout(function(){justInitted=false;if(typeof readyCallback2=="function"){readyCallback2()}},1000);function handleFirstTab(e){if(e.keyCode===9){document.body.classList.add("user-is-tabbing");window.removeEventListener("keydown",handleFirstTab)}}window.addEventListener("keydown",handleFirstTab);if(iOSiPad){initialVhValue=insideFrontInterface.vhCheck("inside-vh").value;var isScrolling,scrollPosBefore=0;topWindow.addEventListener("scroll",function(event){if(keyboardOpen){topWindow.clearTimeout(isScrolling);if(scrollPosBefore==0){scrollPosBefore=$(topWindow).scrollTop()}isScrolling=topWindow.setTimeout(function(){if($(topWindow).scrollTop()-scrollPosBefore<0){chatInput.blur()}scrollPosBefore=0},100)}},false)}}this.start=start;function start(){setFramePosition2()}function orientationChange(){if(device===2||device===3){if(document.activeElement.tagName=="TEXTAREA"||document.activeElement.tagName=="INPUT"){document.activeElement.blur()}}}this.isIOSDevice=isIOSDevice;function isIOSDevice(){return iOSMobile||iOSiPad}var frameFocused;function windowFocused(){if(preview){return}frameFocused=true;if($.inside.isConnected()===false){disconnectedFromInside();_insideGraph.jQuery.inside.start()}else{$.inside.server.active()}}function windowBlurred(){if(preview){return}frameFocused=false;if(device===2||device===3){if(document.activeElement.tagName=="TEXTAREA"||document.activeElement.tagName=="INPUT"){document.activeElement.blur()}}setTimeout(function(){if(insideFrontInterface.windowFocused){}else{$.inside.server.inactive()}},0)}function setFooterLink(){var footerLink=document.querySelector("#chatPaneMenuFooter a");if(!footerLink){return}var href=footerLink.getAttribute("href");if(device==1){href+="&utm_medium=desktop";footerLink.setAttribute("href",href)}else{if(device==2){href+="&utm_medium=mobile";footerLink.setAttribute("href",href)}}}function hashChange(){if(topWindow.document.location.hash.indexOf("insidechat")==-1&&chatPaneOpen){insideChatPane.close()}}var modulesInitted=false;function initModules(){if(modulesInitted){return}modulesInitted=true;readyCallback();initChatPane();videoChat.init();fileUploader.init();windowScale()}function connectedToInside(data,fromInit){if(!fromInit){initModules()}insideFrontInterface.updateAssistants();$.inside.videoChat=false;if(disconnected){if($(document.body).find("#emailInputCell").is(":visible")){clearEmailInputField()}if(typeof(insideWorkflows)!="undefined"){insideWorkflows.enableInputField()}if(!chatInProgress){insideChatPane.close()}setTimeout(function(){if(chatPaneOpen&&chatInProgress&&getAvailableAssistants().length===0&&insideChatPane.settings.chatSettings.offline.workflow!==""&&insideWorkflows.currentWorkflow==null){showStartANewChatButton()}},0)}if(disconnected===true&&chatInProgress){reloadConversation()}disconnected=false;if(data){if(data.labels){isRTL=!preview&&data.labels.langCode&&rtlLangs.indexOf(data.labels.langCode)>-1;setRTLChatpane();translateItems()}insideChatPane.settings.preChat=data.preChat;if(data.chatEndedByCustomer){chatEndedByCustomer=data.chatEndedByCustomer;document.getElementById("insideChatPaneCloseButton").style.display="none"}if(data.blocked){isBlocked=true}if(data.settings&&data.settings.workflows){_insideGraph.initModule("workflow");insideWorkflows.settings=data.settings.workflows;insideWorkflows.workflowBotId=data.workflowBotId}try{if(data.workflow){_insideGraph.initModule("workflow");insideWorkflows.chatSettings=chatSettings;if(insideWorkflows&&(!insideWorkflows.currentWorkflow||insideWorkflows.currentWorkflow.workflowId!==data.workflow.workflowId||insideWorkflows.currentWorkflow.workflowStepId!==data.workflow.workflowStepId)){insideWorkflows.currentWorkflow=data.workflow}insideWorkflows.showWorkflowIfNeeded()}else{if(typeof(insideWorkflows)!="undefined"&&insideWorkflows.currentWorkflow){insideWorkflows.abort()}}}catch(e){}if(data.queuePos){queuePos(data.queuePos)}insideFrontInterface.virtualassistant_enabled=data.virtualassistant_enabled;topWindow.insidePreChatForm.prechatFilled=data.prechatfilled;topWindow.insidePreChatForm.prechatTaskFilled=data.prechattaskfilled;var chatlinkObj=null;try{var chatlinkObj={};insideFrontInterface.getQueryStringParameterByName("insidechatlink").split("|").forEach(function(x){var arr=x.split("=");arr[1]&&(chatlinkObj[arr[0]]=arr[1])})}catch(ex){chatlinkObj=null}if(data.chatlinkvisitor){chatlinkObj={key:data.chatlinkvisitor.hashkey,prechat:data.chatlinkvisitor.prechatsurveyenabled,autoStartChat:data.chatlinkvisitor.autostartchatenabled,operators:data.chatlinkvisitor.operators,channels:data.chatlinkvisitor.channels,teams:data.chatlinkvisitor.teams,offlinemessage:data.chatlinkvisitor.offlinemessage,allowconnectotheroperator:data.chatlinkvisitor.allowconnectotheroperator,operatoravailablemessage:data.chatlinkvisitor.operatoravailablemessage,schedulingonly:data.chatlinkvisitor.schedulingonly,awaitingoperatormessage:data.chatlinkvisitor.awaitingoperatormessage}}if(chatlinkObj){insideFrontInterface.chatLinkVisitor=chatlinkObj}if(data.video){settingsData.video=data.video;videoChat.setupVideoChat(true)}if(insideFrontInterface.chatLinkVisitor){insideFrontInterface.canBeAssignedToOtherChannel=data.canBeAssignedToOtherChannel;insideChatPane.open(true);if(isIOSDevice()){var tryToScaleChatInput=function(){if($(_frame).is(":visible")){scaleChatInput()}else{setTimeout(tryToScaleChatInput,30)}};tryToScaleChatInput()}setTimeout(topWindow.insidePreChatForm.startChatLinkConversation,500)}}if(isProductUrl()){openChatPane()}removeAllNotifications();setTabOffsetPosition();setInputAvailability();if(isBlocked){if(insideChatPane.showHeaderForTab){$("#insideChatFrame").hide()}}var currentStream=sessionStorage.getItem("inside_currentStream");if(currentStream!=""&&currentStream!=null){if(!topWindow.insideStreamingCheck.bundleLoaded){topWindow.insideStreamingCheck.loadStreamingBundle()}setTimeout(function(){videoChat.pauseVideo(true,true)},5000)}if(typeof topWindow.insideStreaming!=="undefined"){topWindow.insideStreaming.refreshStreamList()}}function isProductUrl(){return new URLSearchParams(location.search).has("insideproduct")}this.disconnectedFromInside=disconnectedFromInside;function disconnectedFromInside(){if(disconnected){return}disconnected=true;removeElements(".notification.connection");chatPaneContent.classList.remove("notificationsShowing");var msg=translate("Sorry, your chat has been disconnected. Trying to reconnect...");if(insideFrontInterface.chatSettings.chatPane.disconnectedMessage){msg=getLanguageValue(insideFrontInterface.chatSettings.chatPane.disconnectedMessage)}showNotification(msg,"connection",null,false,true);disableInput(translate("Reconnecting")+"...");if(typeof(insideWorkflows)!="undefined"){insideWorkflows.disableInputField()}}this.reconnectedToInside=reconnectedToInside;function reconnectedToInside(data){if(data.video){settingsData.video=data.video;videoChat.setupVideoChat(true)}}this.reloadConversation=reloadConversation;function reloadConversation(){insideAPI.post("/api/chat/GetPublicCurrentChatMessages",{},function(response){var messages=response.data;if(!messages||messages.length===0){chatReceived([{fromid:"system",text:"/stopchat"}])}else{if(isWorkflowActive()){return}clearChats()}if(typeof(messages)!="undefined"&&messages!=null){chatReceived(messages)}})}function clearChats(){messageList=[];insideChatPane.lastMessageFrom=null;insideChatPane.lastMessage=null;chatPaneContent.innerHTML=""}function bindInsideEvents(){if(preview){return}if(typeof $.inside!="object"){return}$.inside.bind("updateUsers",updateUsers);$.inside.bind("removeUsers",removeUsers);$.inside.bind("chat",chatReceived);$.inside.bind("chatdata",chatDataReceived);$.inside.bind("queuePos",queuePos);$.inside.bind("chataccepted",chatAccepted);$.inside.bind("connected",connectedToInside);$.inside.bind("disconnected",disconnectedFromInside);$.inside.bind("reconnected",reconnectedToInside);$.inside.bind("workflow",activateWorkflow);$.inside.bind("nextWorkflowAction",nextWorkflowAction);$.inside.bind("workflowCanceled",cancelWorkflow);$.inside.bind("showLeaveMessage",function(){insideWorkflows.showLeaveMessageNotification(true)});$.inside.bind("prechatsubmitted",function(){topWindow.insidePreChatForm.prechatTaskFilled=true});$.inside.bind("coBrowse",coBrowseHandShakeHandler);$.inside.bind("hideProactiveMessage",hideProactiveMessage);$.inside.bind("flags",flagsUpdated);$.inside.bind("showWarningMessage",function(data){removeNotification("censorshipWarningMsg");var notif=showNotification(data,"censorshipWarningMsg");setTimeout(function(){notif.close()},10000)});$.inside.bind("canBeAssignedToOtherChannel",canBeAssignedToOtherChannel);$.inside.bind("broadcastAcceptTimeout",broadcastAcceptTimeout)}function broadcastAcceptTimeout(data){if(data&&data.message&&data.message.length>0){showNotification(data.message)}}function flagsUpdated(data){insideFrontInterface.chat.data.flags=data;if(data&&data.indexOf("blocked")>-1){isBlocked=true;removeStartANewChatButton();if(!chatPaneOpen&&insideChatPane.showHeaderForTab){$("#insideChatFrame").hide()}}else{if(isBlocked){isBlocked=false;if(insideChatPane.showHeaderForTab){$("#insideChatFrame").show()}}}}function hideProactiveMessage(data){$(document.body).find("#inside_holder #insideChatPane .message[mid='"+data.mid+"']").remove();windowScale()}function coBrowseHandShakeHandler(state){if(typeof insideCoBrowse=="undefined"&&typeof top.insideCoBrowse!=="undefined"){insideCoBrowse=top.insideCoBrowse}if(typeof insideCoBrowse=="undefined"){setTimeout(function(){coBrowseHandShakeHandler(state)},100);return}switch(state){case"/request":setCoBrowseHtml("request");break;case"/dispose":setCoBrowseHtml("dispose");break;default:}}if(typeof insideFrontInterface!="undefined"){insideFrontInterface.chat.setCoBrowseHtml=setCoBrowseHtml}function setCoBrowseHtml(state){var requestText="The agent is requesting a Co-Browse Session with you.";var requestYesText="Ok";var requestNoText="Decline";if(typeof $.inside.front.settingsData.cobrowse!="undefined"&&$.inside.front.settingsData.cobrowse!=null){var cbSettings=$.inside.front.settingsData.cobrowse;if(typeof cbSettings.requestText!="undefined"&&cbSettings.requestText!=""){requestText=insideFrontInterface.escapeHtml(cbSettings.requestText)}if(typeof cbSettings.requestYesText!="undefined"&&cbSettings.requestYesText!=""){requestYesText=insideFrontInterface.escapeHtml(cbSettings.requestYesText)}if(typeof cbSettings.requestNoText!="undefined"&&cbSettings.requestNoText!=""){requestNoText=insideFrontInterface.escapeHtml(cbSettings.requestNoText)}}switch(state){case"request":$("#insideChatFrame").contents().find(".inside_cobrowseRequest").closest(".notification").remove();if(!("MutationObserver"in window)){$.inside.server.coBrowseNotSupported();return}var html="<div class='inside_cobrowseRequest'><div class='inside_cobrowseRequestMsg'>"+requestText+"</div><span class='button inside_cobrowseAcceptBtn'>"+requestYesText+"</span><span class='button cancel inside_cobrowseRejectBtn'>"+requestNoText+"</span></div>";insideFrontInterface.openChatPane();var requestNotif=showNotification(insideFrontInterface.safeSanitizeHtml(html));document.querySelector(".inside_cobrowseAcceptBtn").addEventListener("click",function(){requestNotif.close();$.inside.server.acceptCoBrowseRequest().done(function(userid){if(userid){var hostName=window.location.hostname;var siteNameFragments=hostName.split(".");var siteName=siteNameFragments[1];var domain=siteNameFragments.slice(1,siteNameFragments.length).join(".");var cbCookieUser="Inside_cobrowse_userid";var cbCookieAgent="Inside_cobrowse_agent_"+siteName;var cbCookieActiveTab="Inside_cobrowse_"+siteName;setCBCookie(cbCookieUser,userid,domain);var currentAgentName="";if(typeof(availableAssistants)!="undefined"&&availableAssistants.length>0){currentAgentName=availableAssistants[0].name}setCBCookie(cbCookieAgent,currentAgentName,domain);setCBCookie(cbCookieActiveTab,$.connection.hub.id,domain);setCoBrowseHtml("accept")}})});document.querySelector(".inside_cobrowseRejectBtn").addEventListener("click",function(){requestNotif.close();$.inside.server.rejectCoBrowseRequest().done(function(){setCoBrowseHtml("reject")})});break;case"reject":$(".inside_cobrowseRequest").parent().remove();break;case"accept":$(".inside_cobrowseRequest").parent().remove();if(device==2){insideChatPane.close()}break;case"dispose":$(".inside_cobrowseRequest").parent().remove();break}}function setCBCookie(cname,cvalue,domain){var d=new Date();d.setTime(d.getTime()+(1*24*60*60*1000));var expires="expires="+d.toUTCString();var sameSite="";if(window.location.protocol.indexOf("https")==0&&(domain&&window.location.hostname.indexOf(domain)==-1)){sameSite=";SameSite=None;Secure"}document.cookie=cname+"="+cvalue+"; "+expires+";domain="+domain+";path=/"+sameSite}var currentQueuePos=0;function queuePos(response){if(response.pos==0){setTimeout(showOperatorTakesChatMessage,500);currentQueuePos=0;return}removeQueueMessage();var msg="";if(insideFrontInterface.chatLinkVisitor&&insideFrontInterface.canBeAssignedToOtherChannel!==true&&insideFrontInterface.chatLinkVisitor.awaitingoperatormessage){msg=getLanguageValue(insideFrontInterface.chatLinkVisitor.awaitingoperatormessage)}else{msg=getLanguageValue(settings.queueMessage)}if(settings.preChat&&settings.preChat.disableChatOnVideoCall==true&&settings.queueVideoOnlyMessage&&settings.queueVideoOnlyMessage!=null&&insideChatPane.chatPane.classList.contains("disableChatOnVideoCall")){var videomsg=getLanguageValue(settings.queueVideoOnlyMessage);if(videomsg.length>0){msg=videomsg}}if(msg){currentQueuePos=response.pos;if(msg.indexOf("{position}")!==-1){msg=msg.split("{position}").join(response.pos)}if(msg.indexOf("{time}")!==-1){var time=Math.round(response.time/60);msg=msg.split("{time}").join(time<=1?("1 "+insideFrontInterface.chat.translate("minute")):(time+" "+insideFrontInterface.chat.translate("minutes")))}showNotification(msg,"queue",false,false,true)}if(insideFrontInterface.virtualassistant_enabled&&insideWorkflows&&insideWorkflows.settings&&insideWorkflows.settings.settingNoOpWorkflowId){insideWorkflows.showLeaveMessageNotification(undefined,true)}}function chatAccepted(response){showOperatorTakesChatMessage(response.opname)}this.showChatStartedText=showChatStartedText;function showChatStartedText(opname){if(!chatSettings.chatPane.chatStartedText||chatSettings.chatPane.chatStartedText==""){}else{var assistantName=getOperatorName();var str=getLanguageValue(chatSettings.chatPane.chatStartedText);if(str!=""){removeElements(".inside_chatStartedText[chatid='"+currentChatId+"']");var msg=showSystemMessage(str,"inside_chatStartedText");if(msg){msg.setAttribute("chatid",currentChatId)}}}assistantName=getOperatorName();if(assistantName!=""&&!currentQueuePos){showOperatorTakesChatMessage()}setFrameHeight()}this.showOperatorTakesChatMessage=showOperatorTakesChatMessage;function showOperatorTakesChatMessage(opname,force){if(_preview&&!force){return}removeQueueMessage();if(typeof(insideFrontInterface)!="undefined"&&typeof(insideFrontInterface.getLastMessageAssistantName)==="function"){opName=insideFrontInterface.getLastMessageAssistantName()||(opname||"")}else{if(opname){opName=opname}}var str=getLanguageValue(settings.operatorTakesMessage||settings.chatSettings.chatPane.operatorTakesMessage);if(opName!=""&&str!=""){var reg=/{operator}/gi;var msg=str.replace(reg,opName);removeElements(".inside_chatStartedMessage");for(var i=0;i<staggerMessageList.length;i++){if(typeof staggerMessageList[i].addClass!="undefined"&&staggerMessageList[i].addClass.indexOf("inside_chatStartedMessage")!=-1){return true}}showSystemMessage(insideFrontInterface.escapeHtml(msg),"inside_chatStartedMessage")}removeAllNotifications()}this.removeQueueMessage=removeQueueMessage;function removeQueueMessage(){var queueItems=document.querySelectorAll(".notification.queue");for(var i=0;i<queueItems.length;i++){queueItems[i].close()}}function removeElements(selector){try{var items=document.querySelectorAll(selector);for(var i=0;i<items.length;i++){items[i].parentNode.removeChild(items[i])}}catch(e){console.error(e)}}function chatDataReceived(chatData){if(!!chatPaneOpen&&!!chatData){if(chatData[2]=="typingOn"){addOpTypingMessage(chatData[1])}else{if(chatData[2]=="typingOff"){removeOpTypingMessage()}else{if(chatData[2]=="closeChatPane"){insideChatPane.close()}else{if(chatData[2]=="videoChatHold"){var text="Call on hold...";if(chatData[0]){text="Screen share on hold..."}var vidContainer=document.getElementById("vidcontainer");if(vidContainer){vidContainer.setAttribute("data-before-content",translate(text));vidContainer.classList.add("video_on_hold")}}else{if(chatData[2]=="videoChatResume"){document.getElementById("vidcontainer").classList.remove("video_on_hold")}else{return}}}}}}}function activateWorkflow(data){_insideGraph.initModule("workflow");insideWorkflows.chatSettings=chatSettings;insideWorkflows.startWorkflow(data)}function nextWorkflowAction(data){insideWorkflows.nextWorkflowAction(data)}function cancelWorkflow(data){if(data&&data.cancelMessage){insideChatPane.showSystemMessage(data.cancelMessage)}if(!chatInProgress||!(currentChatId>0)){showStartANewChatButton()}insideWorkflows.cancelWorkflow()}this.startANewChatButtonClick=startANewChatButtonClick;function startANewChatButtonClick(){if(disconnected){return}chatEndedByCustomer=false;customFormShown=false;removeElements(".startANewChatButton");if(settings.restrictPrintConversation==true||insideChatPane.settings.showPreviousChatSessionWithin!="currentsession"){removeElements("#insideChatPaneContent .message.broadcastExpiryMsg")}if(getAvailableAssistants().length===0){if(chatSettings.offline.method=="workflow"&&chatSettings.offline.workflow&&chatSettings.offline.workflow!=""){insideAPI.post("api/workflow/StartWorkflow",{workflowId:chatSettings.offline.workflow},function(response){},startANewChatError);hideInputFooter()}else{if(chatSettings.offline.method=="form"&&!chatPane.querySelector("#inside_leaveMessageForm")&&!displayingPreviousSessionChat&&chatSettings.offline.enabled==true){insideFrontInterface.showLeaveMessageForm()}}}else{var showingCustomPrechat=checkCustomPrechat();if(!showingCustomPrechat){var check=topWindow.insidePreChatForm.check(true);if(check!=true){showInputFooter();if(device==1){setTimeout(function(){chatInput.focus()},500)}}}}}function startANewChatError(response){showServerError(response);showStartANewChatButton()}function showServerError(response){insideChatPane.showNotification(translate("Error connecting to server. Please try again later."),"allowClose")}this.startANewChatButtonShowing=startANewChatButtonShowing;function startANewChatButtonShowing(){if(document.querySelectorAll(".startANewChatButton").length>0&&currentChatId==0){return true}for(var i=0;i<staggerMessageList.length;i++){if(typeof staggerMessageList[i].addClass!="undefined"&&staggerMessageList[i].addClass.indexOf("startANewChatButton")!=-1){return true}}return false}this.showStartANewChatButton=showStartANewChatButton;function showStartANewChatButton(){try{var startANewChatText=translate("Start a new chat");if(chatSettings.general.startNewChatLabel&&getLanguageValue(chatSettings.general.startNewChatLabel)!=""){startANewChatText=getLanguageValue(chatSettings.general.startNewChatLabel)}insideChatPane.showSystemMessage("<div role='button' id='startANewChatButton' class='workflowMessage picklist vertical'><div class='vertical picklistOption'>"+startANewChatText+"</div></div>","startANewChatButton");insideChatPane.hideInputFooter();if(insideWorkflows.stylesLoaded!=true){insideWorkflows.setStyles()}if(currentChatId!=0){prevChatId=currentChatId}currentChatId=0;activeChat=false;insideChatPane.activeChat=activeChat;chatInProgress=false;insideFrontInterface.chatInProgress=false;chatPane.classList.remove("activechat");topInsideHolder.classList.remove("activeChat");document.getElementById("endChatItem").style.display="none";setChatMenuButtonVisibility();if($(document.body).find("#emailInputCell").is(":visible")){clearEmailInputField()}}catch(exp){console.error(exp)}}this.removeStartANewChatButton=removeStartANewChatButton;function removeStartANewChatButton(){removeElements(".message.startANewChatButton");if(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.step&&insideWorkflows.currentWorkflow.step.hideChatInput==true){hideInputFooter()}else{showInputFooter()}}this.removeStartChatButtonFromStaggeringList=removeStartChatButtonFromStaggeringList;function removeStartChatButtonFromStaggeringList(){for(var i=0;i<staggerMessageList.length;i++){if(typeof staggerMessageList[i].addClass!="undefined"&&staggerMessageList[i].addClass.indexOf("startANewChatButton")!=-1){staggerMessageList.splice(i,1);break}}}function setChatEndPrechatFilledStatus(){if(!settings.preChatWorkflow&&insideFrontInterface.chat.settings.preChat&&insideFrontInterface.chat.settings.preChat.prechatSurveyExpiry==="chatend"){topWindow.insidePreChatForm.prechatFilled=false}if(settings.preChatWorkflow&&settings.prechatExpiry==="chatend"){topWindow.insidePreChatForm.prechatTaskFilled=false}}function chatReceived(messages,fromEvent){if(typeof messages=="undefined"||messages==null){return}var chatJustStarted=!chatInProgress;if(messages.length===1&&messages[0].text==="/stopchat"){if(chatInProgress){_insideGraph.doEvent("chatended",{chatid:currentChatId,opid:insideFrontInterface.getLastMessageOperatorId(),visitorname:($.inside&&$.inside.front&&$.inside.front.settingsData?($.inside.front.settingsData.user_name||""):""),endedBy:"operator"})}chatInProgress=false;insideFrontInterface.chatInProgress=false;activeChat=false;insideChatPane.activeChat=activeChat;insideFrontInterface.lastMessageOperatorId="";removeQueueMessage();if(messages[0].metadata&&messages[0].metadata.blocked){isBlocked=true}if(currentChatId!=0){prevChatId=currentChatId;setChatEndPrechatFilledStatus();showStartANewChatButton()}currentChatId=0;setTimeout(setMenuItems,0);chatPane.classList.remove("activechat");document.getElementById("endChatItem").style.display="none";$(document.body).find(".message.cards .cardLink[onclick]").addClass("disabled");removeOpTypingMessage();if($(topInsideHolder).hasClass("liveShowOpen")||$(topInsideHolder).hasClass("liveShowMinimised")){topWindow.insideStreaming.chatEnded()}if(settings.hideProactiveNotification){removeChatNotifications()}if(!isBlocked&&(insideFrontInterface.virtualassistant_enabled&&(getAvailableAssistants().length===0&&chatSettings.offline.workflow&&chatSettings.offline.workflow!="")||(getAvailableAssistants().length>=0&&chatSettings.chatPane.preChatWorkflow&&chatSettings.chatPane.preChatWorkflow!==""))){if(currentQueuePos===0){showStartANewChatButton()}}return}else{if(messages.length==1&&messages[0].metadata&&messages[0].metadata.isEndChatMessage){activeChat=false;chatInProgress=false;insideFrontInterface.chatInProgress=false;insideFrontInterface.lastMessageOperatorId=""}else{insideFrontInterface.chat.setMessageReceived(true);if(activeChat!==true){setTimeout(setMenuItems,0);removeElements(".startANewChatButton");if(!isWorkflowActive()&&getAvailableAssistants().length>0&&footer.classList.contains("hidden")){showInputFooter()}if(chatInput.classList.contains("disabled")){enableInput()}}chatInProgress=true;if(messages[0].chatid){currentChatId=messages[0].chatid}document.getElementById("insideChatPaneCloseButton").style.display="";if(insideChatPane.settings.onlyAllowOperatorToEndChat!=true||(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isBot)){document.getElementById("endChatItem").style.display=""}else{document.getElementById("endChatItem").style.display="none"}setChatMenuButtonVisibility();removeElements("#inside_prechatForm, .custom_prechat");chatPane.classList.remove("prechat")}}insideChatPane.activeChat=activeChat;removeElements("#inside_leaveMessageForm, .custom_offline");for(var i=0;i<messages.length;i++){if(chatJustStarted){chatJustStarted=false;if(typeof(insideWorkflows)!="undefined"&&!(currentChatId>0)&&messages[i].fromid.indexOf("user:")>-1&&!(messages[i].metadata&&messages[i].metadata.dataFieldId)){insideWorkflows.stopWorkflowIfNeeded()}if(messages[i].metadata&&messages[i].metadata.workflowStepId>0){var duplicateWfMessages=$(document.body).find("#inside_holder #insideChatPane .message.workflowMessage[wfid="+messages[i].metadata.workflowId+"][stepid="+messages[i].metadata.workflowStepId+"]");if(messages[i].metadata&&duplicateWfMessages.length>0){var skipMessage=false;duplicateWfMessages.each(function(){if(!$(this).attr("mid")||parseInt($(this).attr("mid"))>0&&messages[i].id==parseInt($(this).attr("mid"))){skipMessage=true}});if(skipMessage){continue}}}}addMessage(messages[i])}var silentMessage=messages.length>0&&messages[0].contentType=="data/silent";var localStorageChatOpen=localStorage.getItem("insideChatPaneOpen")=="true";if(!chatPaneOpen&&(!localStorageChatOpen||!activeChat)){insideChatPane.close()}else{if(chatSettings.chatPane.dynamicHeight){setTimeout(setFrameHeight,200)}}if(device==2&&chatSettings.chatPane.notifications.enabledOnMobile==false){insideFrontInterface.chat.showChatTabNotification(null,setUnreadMessages())}else{if(!silentMessage&&!chatPaneOpen&&!preview&&insideChatPane.lastMessageFrom!="system"&&insideChatPane.lastMessageFrom.indexOf("user:")!=0&&lastMessageData.deliverystatus!=3&&lastMessageData.addClass!="welcomeGreeting"&&lastMessageData.addClass!="welcomeGreeting"){showChatNotification({messageId:lastMessageData.id,text:lastMessageData.text,title:lastMessageData.fromname,fromid:lastMessageData.fromid,message:lastMessageData})}}if(chatPane.classList.contains("video")&&insideChatPane.lastMessageFrom&&insideChatPane.lastMessageFrom.indexOf("user:")!=0){videoChat.showChatNotification()}}var unreadMessageCount=0;function setUnreadMessages(){unreadMessageCount=0;if(messagesList&&messagesList.length>0){for(var i=0;i<messagesList.length;i++){if(messagesList[i].chatid==currentChatId&&messagesList[i].fromid.indexOf("assistant")==0&&messagesList[i].deliverystatus!=3){unreadMessageCount++}}}insideFrontInterface.chat.unreadMessageCount=unreadMessageCount;return unreadMessageCount}this.showNotification=showNotification;function showNotification(text,addClass,showInFooterMenu,allowClose,showLoadingAnim,closeCallback){if(typeof text!="string"){text=getLanguageValue(text)}if(!text){return}if(showLoadingAnim){text+='<div class="sk-fading-circle"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>'}var html="<div class='bubble' tabindex='2'><div class='content'>"+text+"</div><div class='closeButton' role='button' aria-label='close notification'><span class='icon-close'></span></div></div>";var notif=document.createElement("div");notif.className="notification";notif.role="alert";notif.innerHTML=insideFrontInterface.safeSanitizeHtml(html);if(typeof(addClass)=="string"){notif.classList.add(addClass);removeElements(".notification."+addClass)}if(showInFooterMenu){document.getElementById("menu_notifications").prepend(notif);scaleMenu()}else{document.getElementById("notifications").prepend(notif);notif.style.transform="translateY(-100%)"}setTimeout(function(){notif.style.transform=""},100);setTimeout(function(){document.getElementById("notifications").classList.add("showing");var scrollPos=chatPaneContent.scrollTop;if(showInFooterMenu!=true){chatPaneContent.classList.add("notificationsShowing")}scrollIt(chatPaneContent,scrollPos+200,0)},500);notif.close=function(_time){notif.style.height=notif.getBoundingClientRect().height+"px";setTimeout(function(){notif.style.transform="translateY(-100%)";notif.style.opacity="0"},0);if(_time==0){notif.parentNode.removeChild(notif)}else{setTimeout(function(){try{notif.parentNode.removeChild(notif)}catch(e){}},250)}setTimeout(function(){if(document.querySelectorAll(".notification").length<=1){document.getElementById("notifications").classList.remove("showing");chatPaneContent.classList.remove("notificationsShowing")}},1000);if(typeof(closeCallback)=="function"){closeCallback()}};notif.querySelector(".closeButton").addEventListener("click",notif.close);if($(topWindow.document.activeElement).is("input")==false){$(notif).find("[tabindex]").focus()}if(allowClose){notif.querySelector(".closeButton").style.display="block"}return notif}function removeAllNotifications(){var notifs=document.querySelectorAll(".notification");for(var i=0;i<notifs.length;i++){notifs[i].close()}}this.removeNotification=removeNotification;function removeNotification(className){if(typeof className=="undefined"){return}var notifs=document.querySelectorAll(".notification");for(var i=0;i<notifs.length;i++){if(notifs[i].classList.contains(className)){notifs[i].close();return}}}function calculateTruncation(el){var text;while(el.clientHeight<el.scrollHeight-2){text=el.innerHTML.trim();var words=text.split(" ");if(words.length<=1){break}words.pop();el.innerHTML=words.join(" ")+"..."}}this.truncateString=truncateString;function truncateString(str,len){if(!str||!len){return str}if(str.length>len){return str.substring(0,len)+"..."}return str}this.showChatNotification=showChatNotification;function showChatNotification(ob){if(insideFrontInterface.chat&&insideFrontInterface.chat.data&&insideFrontInterface.chat.data.flags.indexOf("dnd")!==-1){return}if(justInitted){setTimeout(function(){showChatNotification(ob)},1000);return}if(!chatSettings.chatPane.notifications||!chatSettings.chatPane.notifications.enabled&&!preview){openChatPane();setTimeout(scrollToBottom,1000);return}if(chatPaneOpen){return}if(!ob.text){return}if(!preview&&typeof(sessionStorage)!="undefined"&&ob.messageId&&sessionStorage.getItem("closedProactiveMessageId")==ob.messageId){return}setFrameForNotifications();insideChatPane.hideTabs();setTimeout(insideChatPane.hideTabs,1000);setUnreadMessages();if(typeof(_insideGraph)!="undefined"){var msg=$.extend({},getLastMessageFromOperator()||ob.message||ob);if(msg.unparsedText){msg.text=msg.unparsedText;delete msg.unparsedText}if(msg.contentType=="text/inside.legacy"){msg.text=$("<span></span>").html(msg.text).text()}_insideGraph.doEvent("chatnotification",{message:msg,unreadMessageCount:unreadMessageCount})}if(document.querySelectorAll(".chatNotification").length>0){var notifNumber=document.querySelectorAll(".chatNotification")[0].querySelector(".chatNotifNumber");var num=unreadMessageCount;notifNumber.innerText=num>99?"9+":num;notifNumber.style.display="block";return}var chatNotification=document.createElement("div");chatNotification.className="chatNotification";var html="<div class='chatNotifOverflow'><div class='chatNotifImage'></div><div class='chatNotifContent'><div id='chatNotifTextHolder'><div class='chatNotifTitle title' style='width: 240px;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;'></div><div class='chatNotifText'></div></div></div></div></div><div class='closeButton'><span class='icon-close'></span></div><div class='chatNotifNumber'>"+unreadMessageCount+"</div>";chatNotification.innerHTML=html;chatNotification.setAttribute("message-id",ob.messageId);var titleNode=chatNotification.querySelector(".chatNotifTitle");if(chatSettings.chatPane.notifications.title=="none"){titleNode.innerText=""}else{if(chatSettings.chatPane.notifications.title=="operatorName"&&ob.title){titleNode.innerText=ob.title}else{if(chatSettings.chatPane.notifications.customTitle&&chatSettings.chatPane.notifications.customTitle!=""){titleNode.innerText=chatSettings.chatPane.notifications.customTitle}else{if(ob.title){titleNode.innerText=ob.title}}}}titleNode.title=titleNode.innerText;chatNotification.querySelector(".chatNotifText").innerText=stripHTML(ob.text);if(ob.text.indexOf("[Image:")==0){chatNotification.querySelector(".chatNotifText").innerText=translate("Sent an image")}if(ob.text.indexOf("[Audio:")==0){chatNotification.querySelector(".chatNotifText").innerText=translate("Sent an audio file")}if(ob.text.indexOf("[File:")==0){chatNotification.querySelector(".chatNotifText").innerText=translate("Sent a file")}document.getElementById("chatNotifications").appendChild(chatNotification);chatNotification.style.transform="translateY(100%)";setTimeout(function(){chatNotification.style.transform="translateY(0%)"},0);if(unreadMessageCount>1){var notifNumber=chatNotification.querySelector(".chatNotifNumber");notifNumber.style.display="block"}var imageHolder=chatNotification.querySelector(".chatNotifImage");if(chatSettings.chatPane.notifications.image=="custom"&&chatSettings.chatPane.notifications.customImage!=""){imageHolder.innerHTML="<img role='presentation' alt='' src='"+customImageUrl+chatSettings.chatPane.notifications.customImage+"' />"}else{if(chatSettings.chatPane.notifications.image=="none"){}else{var faceurl=getFaceURL({fromid:ob.fromid});if(faceurl!=""){imageHolder.innerHTML="<img role='presentation' alt='' src='"+faceurl+"' />"}}}var img=imageHolder.querySelector("img");if(img!=null){img.onload=function(){calculateTruncation(chatNotification.querySelector(".chatNotifText"))}}else{calculateTruncation(chatNotification.querySelector(".chatNotifText"))}chatNotification.addEventListener("click",function(e){if(preview){return}if(e.target.className!="closeButton"&&e.target.className!="icon-close"){_frame.classList.add("notransition");insideChatPane.close();chatPane.style.display="";setTimeout(function(){_frame.classList.remove("notransition");insideChatPane.open()},100)}else{if(!visitorHasChatted){if(settings.dndFromNotificationClose==true){applyDND()}insideChatPane.hideTabs()}else{insideChatPane.showTabs()}if(typeof(sessionStorage)!="undefined"){sessionStorage.setItem("closedProactiveMessageId",chatNotification.getAttribute("message-id"))}chatNotification.parentNode.removeChild(chatNotification);_frame.style.opacity=0;removeChatNotifications();insideChatPane.close();setTimeout(function(){_frame.style.opacity=1},250)}$(_frame).off("keydown")});_frame.setAttribute("title",stripHTML(ob.text));_frame.setAttribute("role","alert");if($(topWindow.document.activeElement).is("input")==false){_frame.focus()}$(_frame).on("keydown",function(event){var spaceOrEnter=event.keyCode==32||event.keyCode==13;if(spaceOrEnter){$(chatNotification).click()}});try{if(!_preview&&!insideFrontInterface.windowFocused){insideFrontInterface.chat.flashNewMessage()}}catch(e){}}this.showChatNotificationFromChat=showChatNotificationFromChat;function showChatNotificationFromChat(chatMessage){parseMessage(chatMessage);showChatNotification({messageId:chatMessage.id,text:chatMessage.text,title:chatMessage.fromname,fromid:chatMessage.fromid,message:chatMessage})}function setFrameForNotifications(){_frame.style.transform="";_frame.style.height="150px";if(parseInt(chatSettings.chatPane.notifications.height)>=110){_frame.style.height=(parseInt(chatSettings.chatPane.notifications.height)+40)+"px"}topInsideHolder.classList.add("notificationMode");_frame.classList.add("notificationMode");_frame.style.boxShadow="none";_frame.style.border="none";_frame.style.display="block";chatPane.style.display="none";chatPane.classList.add("notificationMode");document.getElementById("inside_holder").classList.add("notificationMode");removeElements("#inside_leaveMessageForm, .custom_offline");windowScale();if(iOSMobile||iOSiPad){setTimeout(windowScale,0);setTimeout(windowScale,500)}}function setFrameForChat(){topInsideHolder.classList.remove("notificationMode");_frame.classList.remove("notificationMode");if(chatPaneOpen){setFrameHeight();return}chatPane.style.display="";chatPane.style.transform="";chatPane.classList.remove("notificationMode");document.getElementById("inside_holder").classList.remove("notificationMode");setShadowAndBorder()}function getLastMessageFromOperator(){var i=messagesList.length-1;while(i>=0&&messagesList[i].fromid.indexOf("assistant")!=0){i--}return messagesList[i]||null}this.clearNotifications=removeChatNotifications;function removeChatNotifications(){if(!preview){insideFrontInterface.chat.clearNotifications()}var notif=document.querySelector(".chatNotification");if(notif){notif.parentNode.removeChild(notif)}else{if(!notif&&!chatPane.classList.contains("notificationMode")){return}}insideChatPane.showTabs();setFrameForChat()}function updateUsers(data){setChatPaneState();setChatHeader();setInputAvailability();$(document.body).find(".notification.wfNotification").remove()}function removeUsers(data){setChatPaneState();setChatHeader();setInputAvailability();if(availableAssistants.length===0&&!visitorHasChatted&&_frame.classList.contains("notificationMode")){removeChatNotifications()}}this.getAvailableAssistants=getAvailableAssistants;function getAvailableAssistants(){if(preview&&chatPane&&chatPane.classList.contains("offline")){return[]}if(preview){return[{name:"test",id:1}]}return insideFrontInterface.getAvailableAssistants()}this.setInputAvailability=setInputAvailability;function setInputAvailability(){availableAssistants=getAvailableAssistants();if(!disconnected&&(availableAssistants.length>0||insideFrontInterface.chatLinkVisitor)&&!_this.prechatLoading){enableInput();if(insideFrontInterface.chatLinkVisitor){if(insideFrontInterface.chatLinkVisitor&&!insideFrontInterface.canBeAssignedToOtherChannel&&insideFrontInterface.chatLinkVisitor.operators&&insideFrontInterface.chatLinkVisitor.operators>0&&availableAssistants.length>0&&checkOperatorExsits(insideFrontInterface.chatLinkVisitor.operators[0])){removeNotification("chatLinkNoOpMessage")}if(insideFrontInterface.chatLinkVisitor.operators&&insideFrontInterface.chatLinkVisitor.operators.length>0&&!insideFrontInterface.chatLinkVisitor.allowconnectotheroperator&&insideFrontInterface.canBeAssignedToOtherChannel){disableInput();document.getElementById("chatMenuButton").classList.add("disabled")}else{if(!document.getElementById("inside_prechatForm")&&insideFrontInterface.chatLinkVisitor.allowconnectotheroperator){topWindow.insidePreChatForm.check()}}}}else{disableInput()}if(availableAssistants==0){disableInput()}scaleChatInput()}this.disableInput=disableInput;if(typeof insideFrontInterface!="undefined"){insideFrontInterface.chat.disableChat=disableInput}function disableInput(customPlaceholderMessage,empty,reason){if(_this.prechatLoading&&typeof customPlaceholderMessage=="undefined"){return}try{chatInput.setAttribute("disabled",true);var str=getLanguageValue(chatSettings.chatPane.inputDisabledPlaceholder);chatInput.setAttribute("placeholder",str||translate("OFFLINE"));chatInput.classList.add("disabled");if(chatInput.getAttribute("typed-message")==null){chatInput.setAttribute("typed-message",chatInput.value);chatInput.value=""}footer.classList.add("disabled");if(typeof(insideWorkflows)=="undefined"||insideWorkflows==null||insideWorkflows.currentWorkflow==null||!insideWorkflows.currentWorkflow.isActive||insideWorkflows.currentWorkflow.paused||$(document.body).find("#insideWorkflowFieldCell").css("display")==="none"||$(document.body).find("#insideWorkflowFieldCell input, #insideWorkflowFieldCell textarea").length===0){sendButton.classList.add("disabled")}setMenuItems()}catch(e){chatInput.setAttribute("placeholder",translate("OFFLINE"))}if(typeof customPlaceholderMessage!="undefined"&&customPlaceholderMessage!=""){chatInput.setAttribute("placeholder",customPlaceholderMessage)}if(reason=="print"){var str=getLanguageValue(chatSettings.chatPane.inputPlaceholder);chatInput.setAttribute("placeholder",str||translate("type here"))}if(empty==true){chatInput.value=customPlaceholderMessage;scaleChatInput()}if(empty==true&&typeof(insideWorkflows)!="undefined"){insideWorkflows.disableInputField("")}}if(typeof insideFrontInterface!="undefined"){insideFrontInterface.chat.enableChat=enableInput}this.enableInput=enableInput;function enableInput(clear){try{if(disconnected||(availableAssistants.length===0&&!insideFrontInterface.canBeAssignedToOtherChannel)){return}var focus=false;if(chatInput.getAttribute("disabled")){focus=true}chatInput.removeAttribute("disabled");var str=getLanguageValue(chatSettings.chatPane.inputPlaceholder);chatInput.setAttribute("placeholder",str||translate("type here"));chatInput.classList.remove("disabled");if(chatInput.getAttribute("typed-message")!==null){chatInput.value=chatInput.getAttribute("typed-message");chatInput.removeAttribute("typed-message");setTimeout(setSendButton,100)}footer.classList.remove("disabled");sendButton.classList.remove("disabled");if(device==1&&focus&&chatPaneOpen&&$(topWindow.document.activeElement).is("input")==false){if(preview||(document.activeElement&&(document.activeElement.tagName=="TEXTAREA"||document.activeElement.tagName=="INPUT"))){}else{chatInput.focus()}}}catch(e){chatInput.setAttribute("placeholder",translate("type here"))}if(clear){chatInput.value="";windowFocused();chatInput.style.pointerEvents="all !important";if(isChrome){insideChatPaneInputFooter.addEventListener("click",chatInputWindowPopupFocus,false)}}if(clear==true&&typeof(insideWorkflows)!="undefined"){insideWorkflows.enableInputField(clear)}scaleChatInput()}function chatInputWindowPopupFocus(){var w=window.open();w.close();insideChatPaneInputFooter.removeEventListener("click",chatInputWindowPopupFocus,false)}function endChat(){if(typeof insideWebApp!="undefined"&&insideWebApp==true){_insideGraph.doEvent("chatended",{chatid:currentChatId,opid:insideFrontInterface.getLastMessageOperatorId(),visitorname:($.inside&&$.inside.front&&$.inside.front.settingsData?($.inside.front.settingsData.user_name||""):""),endedBy:"visitor"});var operatorMessages=[],visitorMessages=[];for(var i=0;i<messagesList.length;i++){var message=messagesList[i];if(message.chatid==currentChatId){if(message.fromid.search("user")>-1){visitorMessages.push(message)}else{if(message.fromid.search("assistant")>-1){operatorMessages.push(message)}}}}var showSurvey=operatorMessages.length>0&&visitorMessages.length>1;if(typeof($.inside.front.settings.showPostChatSurveyWhenVisitorEndsChat)=="undefined"||$.inside.front.settings.showPostChatSurveyWhenVisitorEndsChat==false||showSurvey==false){_insideGraph.doEvent("closechat",false);chatPaneOpen=false}chatInProgress=false;insideFrontInterface.chatInProgress=false;$.inside.server.stopChat(currentChatId);chatPane.classList.remove("activechat");insideFrontInterface.lastMessageOperatorId="";return showSurvey}_insideGraph.doEvent("chatended",{chatid:currentChatId,opid:insideFrontInterface.getLastMessageOperatorId(),visitorname:($.inside&&$.inside.front&&$.inside.front.settingsData?($.inside.front.settingsData.user_name||""):""),endedBy:"visitor"});$.inside.server.stopChat(currentChatId);chatInProgress=false;insideFrontInterface.chatInProgress=false;insideFrontInterface.lastMessageOperatorId="";if(currentChatId!=0){prevChatId=currentChatId}currentChatId=0;chatEndedByCustomer=true;setChatEndPrechatFilledStatus();try{if(insideCoBrowse&&insideCoBrowse.started){insideCoBrowse.stop()}}catch(e){}}function applyDND(){insideAPI.post("/api/visitor/set_flag",{flag:"dnd",value:true})}function removeDND(){insideAPI.post("/api/visitor/set_flag",{flag:"dnd",value:false})}function getLanguageValue(ob){if(typeof(ob)=="undefined"||!ob){return""}if(typeof ob=="string"){return ob}else{if(typeof ob[langCode]!="undefined"){return ob[langCode]}else{if(langCode.indexOf("-")!=-1&&typeof ob[langCode.split("-")[0]]=="string"){return ob[langCode.split("-")[0]]}else{if(Object.keys(ob).length>0&&Object.keys(ob)[0]!="type"){return ob[Object.keys(ob)[0]]}else{return""}}}}}function updateTimes(){var dates=document.querySelectorAll(".message:not(.typing) .date");chatPaneContent.setAttribute("aria-live","off");for(var i=0;i<dates.length;i++){var d=new Date(dates[i].date);dates[i].innerText=moment(d).fromNow()}}function scrollIt(el,destination,duration,easing,callback){if(typeof easing=="undefined"){easing="easeOutQuad"}var easings={linear:function(a){return a},easeInQuad:function(a){return a*a},easeOutQuad:function(a){return a*(2-a)},easeInOutQuad:function(a){return 0.5>a?2*a*a:-1+(4-2*a)*a},easeInCubic:function(a){return a*a*a},easeOutCubic:function(a){return--a*a*a+1},easeInOutCubic:function(a){return 0.5>a?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},easeInQuart:function(a){return a*a*a*a},easeOutQuart:function(a){return 1- --a*a*a*a},easeInOutQuart:function(a){return 0.5>a?8*a*a*a*a:1-8*--a*a*a*a},easeInQuint:function(a){return a*a*a*a*a},easeOutQuint:function(a){return 1+--a*a*a*a*a},easeInOutQuint:function(a){return 0.5>a?16*a*a*a*a*a:1+16*--a*a*a*a*a}};var rect=el.getBoundingClientRect();var startTime="now"in window.performance?performance.now():new Date().getTime();var elHeight=rect.height;var scrollHeight=el.scrollHeight-elHeight;var scrollTop=el.scrollTop;var from=el.scrollTop;var to=typeof destination==="number"?destination:destination.offsetTop;if(to>el.scrollHeight-rect.height){to=el.scrollHeight-rect.height}var tweenId=Math.random();el.thisTween={id:tweenId};el.thisTween.complete=false;function scroll(){if(el.thisTween.complete==true){return}if(el.thisTween.id!=tweenId){return}var now="now"in window.performance?performance.now():new Date().getTime();var time=Math.min(1,((now-startTime)/duration));var timeFunction=easings[easing](time);el.scroll(0,Math.ceil((timeFunction*(to-from))+from));if(el.scrollTop===to||now-startTime>=duration){el.scrollTop=to;el.thisTween.complete=true;if(callback){callback()}return}requestAnimationFrame(scroll)}scroll()}this.setChatPaneState=setChatPaneState;function setChatPaneState(){availableAssistants=getAvailableAssistants();if(availableAssistants.length===0){setOffline()}else{setOnline()}}this.setOffline=setOffline;function setOffline(){chatPane.classList.add("offline");setChatHeader();setMenuItems();checkHeaderTabIsShowing();if(document.querySelector("#inside_prechatForm, .custom_prechat")!=null){removeElements("#inside_prechatForm, .custom_prechat");chatPane.classList.remove("prechat");if(!insideFrontInterface.chatLinkVisitor){insideChatPane.close()}}}this.setOnline=setOnline;function setOnline(){if(chatPane.classList.contains("offline")&&chatPaneOpen&&currentChatId===0&&prevChatId!=0){showStartANewChatButton()}chatPane.classList.remove("offline");setChatHeader();setMenuItems();checkHeaderTabIsShowing()}this.setActiveChatStatus=setActiveChatStatus;function setActiveChatStatus(_val){activeChat=_val}this.setDevice=setDevice;function setDevice(_val){device=_val}this.updateSettings=updateSettings;function updateSettings(_chatSettings,languageTranslations){chatSettings=_chatSettings;if(typeof insideFrontInterface=="undefined"){window.insideFrontInterface={chat:{}}}if(typeof insideFrontInterface.chat.settings=="undefined"){insideFrontInterface.chat.settings=settings}insideFrontInterface.chat.settings.chatSettings=chatSettings;isRTL=false;if(preview&&_chatSettings.language&&rtlLangs.indexOf(_chatSettings.language)>-1){isRTL=true}setSettings();if(preview&&typeof(languageTranslations)!=="undefined"){insideFrontInterface.labelTranslations=languageTranslations;translateItems()}try{setStyling()}catch(e){console.error(e)}scaleChatInput();setMessages();setInputAvailability();if(!preview){insideFrontInterface.chat.defaultOnlineSVGs=cloneSvgs(defaultOnlineSVGs);insideFrontInterface.chat.defaultOfflineSVGs=cloneSvgs(defaultOfflineSVGs,settings.chatSettings.chatTab.offlineColor||"#cccccc")}else{insideChatPane.defaultOnlineSVGs=cloneSvgs(defaultOnlineSVGs);insideChatPane.defaultOfflineSVGs=cloneSvgs(defaultOfflineSVGs,"currentColor")}if(_frame.classList.contains("notificationMode")){setFrameForNotifications()}if(preview){clearMessages();animationsDisabled=true;chatPane.classList.add("notransition");showPreviewMessages();chatPane.classList.remove("notransition");animationsDisabled=false;toggleMinisedIcon(true);if(el=document.querySelector("#inside_leaveMessageForm")!=null){showLeaveMessageForm()}if(workflowArchiveId){if(typeof(_insideGraph)!="undefined"){_insideGraph.initModule("workflow")}assistantData={sessionId:settings.sessionId};insideWorkflows.getWorkflowPreview(workflowArchiveId)}}}function checkHeaderTabIsShowing(){if(!chatPane){return}if(chatPane.classList.contains("video")&&chatPane.classList.contains("desktopVideo")){showHeaderForTab=false;return}if(chatSettings.chatTab.showChatPaneHeaderAsChatTab&&showChatPaneHeaderForDevice(getAvailableAssistants().length===0)){showHeaderForTab=true;insideChatPane.showHeaderForTab=true;if(!chatPaneOpen){insideChatPane.close()}try{insideChatPane.removeTabs()}catch(e){}}else{showHeaderForTab=false;insideChatPane.showHeaderForTab=false;if(chatPane.classList.contains("headerShowing")&&!chatPaneOpen){insideChatPane.close();chatPane.classList.remove("headerShowing")}}}var chatPaneInitted=false;this.initChatPane=initChatPane;function initChatPane(){if(chatPaneInitted){return}chatPaneInitted=true;checkHeaderTabIsShowing();document.getElementById("insideChatPaneCloseButton").addEventListener("click",closeClick);document.getElementById("insideChatPaneLeaveShowButton").addEventListener("click",leaveShowClick);document.getElementById("insideChatPaneMinimiseButton").addEventListener("click",minimiseClick);header=document.getElementById("insideChatPaneHeader");header.addEventListener("click",headerClick);footer=document.getElementById("insideChatPaneInputFooter");chatPaneContent=document.getElementById("insideChatPaneContent");_this.chatPaneContent=chatPaneContent;$(chatPaneContent).on("click","#startANewChatButton",startANewChatButtonClick);chatPaneContent.addEventListener("focus",function(e){if($(chatPane).hasClass("minimised")){document.body.classList.add("user-is-tabbing");$(document).find("#insideChatPaneMinimiseButton").focus()}});chatPaneContent.addEventListener("scroll",chatPaneScroll);chatPane=document.getElementById("insideChatPane");_this.chatPane=chatPane;chatInput=chatPane.querySelector("#chatInput");_this.chatInput=chatInput;chatInputCell=chatPane.querySelector("#chatInputCell");sendButton=chatPane.querySelector("#chatSendButton");attachButton=chatPane.querySelector("#attachButton");if(attachButton){attachButton.style.display=settings.attachmentEnabled==false?"none":"block"}sendButton.style.display="none";if(device==2){attachButton.innerHTML="<span class='icon-camera'></span>";document.getElementById("inside_holder").classList.add("mobile-device");chatPane.classList.add("mobile-device")}sendButton.addEventListener("click",chatSendClick);$(sendButton).clickableByKeyboard();sendButton.addEventListener("touchend",chatSendClick);chatPane.querySelector("#chatMenuButton").addEventListener("click",menuButtonClick);$(chatPane.querySelector("#chatMenuButton")).clickableByKeyboard();$(document).find("#insideChatPaneCloseButton, #insideChatPaneMinimiseButton").clickableByKeyboard().keydown(function(e){var lastButton=$(document).find("#insideChatPaneButtons > div:visible:last")[0];if(lastButton.id==this.id&&e.keyCode==9){if(e.shiftKey){var button=$(document).find("#chatSendButton:visible, #attachButton:visible, #offlineSubmitButton:visible, #prechatSubmitButton:visible");button.focus()}else{if(document.querySelector("#inside_prechatForm")){document.querySelectorAll("#inside_prechatForm")[0].focus()}else{if(document.querySelector("#inside_leaveMessageForm")){document.querySelectorAll("#inside_leaveMessageForm")[0].focus()}else{chatPaneContent.focus()}}}e.preventDefault()}});$(document).find("#inside_holder").on("keydown",function(e){var containers=["insideChatPaneContent","inside_leaveMessageForm","inside_prechatForm"];var navigateBackToHeader=(e.shiftKey&&e.keyCode==9&&$.inArray(document.activeElement.id,containers)>-1);var sendButtons=["offlineSubmitButton","prechatSubmitButton","chatSendButton","attachButton"];var targetIsNotHeaderIcon=!e.target.classList.contains("insideChatPaneHeaderButton");var navigateToHeader=(targetIsNotHeaderIcon&&!e.shiftKey&&e.keyCode==9&&$.inArray(document.activeElement.id,sendButtons)>-1);if(navigateToHeader||navigateBackToHeader){focusOnHeaderIcon();e.preventDefault()}});chatFrameCreated=true;if(iOSMobile){chatPane.classList.add("iosMobile");chatPane.classList.add("ios_"+iOSVersion)}document.addEventListener("touchstart",{});document.addEventListener("mouseenter",function(e){});sendButton.classList.add("disabled");chatInput.addEventListener("input",function(){if($(document.activeElement)[0]!=chatInput){return}if(document.querySelector("#inside_prechatForm")!=null){return}setSendButton();scaleChatInput()});scaleChatInput();chatInputCell.addEventListener("touchstart",inputCellTouch);document.getElementById("insideWorkflowFieldCell").addEventListener("touchstart",inputCellTouch);$(document.body).find("#insideWorkflowFieldCell").on("keyup","textarea, input",function(){userTyping(this)});document.getElementById("emailInputCell").addEventListener("touchstart",inputCellTouch);function inputCellTouch(e){if(menuOpen&&device==2){chatInput.style.pointerEvents="";closeMenu(0);chatInput.focus()}}chatInput.addEventListener("keydown",function(e){var code=(e.keyCode?e.keyCode:e.which);if(code==13&&!e.shiftKey){e.preventDefault();sendChat();scaleChatInput();return}});chatInput.addEventListener("keyup",function(e){var code=(e.keyCode?e.keyCode:e.which);if(code==13){return}userTyping(this)});chatInput.addEventListener("focus",function(e){if(device==2||iOSiPad){inputFocus(e)}});chatInput.addEventListener("blur",function(e){inputFocus(e)});setMenuActions();updateSettings(chatSettings);_frame.addEventListener("transitionend",function(){if(!chatPaneOpen){if(showHeaderForTab||document.querySelectorAll(".chatNotification").length>0){}else{_frame.style.display="none"}}});document.on("click",".inside_chatOption",function(e){var answer=e.currentTarget.getAttribute("data-say");if($(document.body).find("#insideWorkflowFieldCell").is(":visible")){chatPane.querySelector("#insideWorkflowFieldCell input").value=answer}else{chatPane.querySelector("#chatInput").value=answer}chatSendClick();e.currentTarget.classList.add("selected");e.currentTarget.parentNode.parentNode.classList.add("disabled")});unreadMessageIndicator=document.getElementById("unreadMessageIndicator");unreadMessageIndicator.addEventListener("click",unreadMessageIndicatorClick);availableAssistants=getAvailableAssistants();setChatPaneState();setChatMenuButtonVisibility();if(iOSMobile||iOSiPad){bodyScrollLock(document.getElementById("insideChatPaneInputFooter"));bodyScrollLock(document.getElementById("insideChatPaneHeader"));bodyScrollLock(chatPaneContent)}chatPane.addEventListener("click",function(e){if(disconnected){_insideGraph.jQuery.inside.start()}});translateItems()}var typingTimout;function userTyping(input){if(currentChatId==null||currentChatId==0){return}if($.inside&&$.inside.sendCall){var chatData=[currentChatId,"typingOn",false];if(settings.showTypingText){var str=input.value;if(settings.disable_cc_masking!=true){str=strictReplaceNumbers(str)}chatData=[currentChatId,"/prev:"+str,false]}$.inside.sendCall("chatData",chatData)}clearTimeout(typingTimout);typingTimout=setTimeout(stoppedTyping,2000);chatPane.classList.remove("user-typing")}function strictReplaceNumbers(str){var ccReg=/\b([0-9](.?)){4,99}\b/g;var matches=str.match(ccReg);if(matches!=null&&matches.length>0){for(var i=0;i<matches.length;i++){var val=matches[i];matches[i]=matches[i].replace(/[0-9]/g,"*");str=str.replace(val,matches[i])}}return str}function stoppedTyping(){if(currentChatId==null||currentChatId==0||preview){return}$.inside.sendCall("chatData",[currentChatId,"typingOff",false]);chatPane.classList.add("user-typing")}function translateItems(){if(language.indexOf("en")==0){return}document.getElementById("endChatItem").querySelector("label").innerText=translate("End Chat");if(getLanguageValue(chatSettings.chatPane.attachButtonLabel)==""&&document.getElementById("attachFileItem")){document.getElementById("attachFileItem").querySelector("label").innerText=translate("Attach File")}if(getLanguageValue(chatSettings.chatPane.emailButtonLabel)==""&&document.getElementById("emailTranscriptItem")){document.getElementById("emailTranscriptItem").querySelector("label").innerText=translate("Email transcript")}if(getLanguageValue(chatSettings.chatPane.printButtonLabel)==""&&document.getElementById("printTranscriptItem")){document.getElementById("printTranscriptItem").querySelector("label").innerText=translate("Print transcript")}if(getLanguageValue(chatSettings.chatPane.callmeButtonLabel)==""&&document.getElementById("clickToCallItem")){document.getElementById("clickToCallItem").querySelector("label").innerText=translate("Click to Call")}if(getLanguageValue(chatSettings.chatPane.joinTheCallLabel)==""&&document.getElementById("joinTheCallItem")){document.getElementById("joinTheCallItem").querySelector("label").innerText=translate("Join the Call")}if(getLanguageValue(chatSettings.chatPane.chatToHumanLabel)==""&&document.getElementById("chatToHuman")){document.getElementById("chatToHuman").querySelector("label").innerText=translate("Chat to Human")}document.getElementById("insideBrandingText").innerText=translate("we run on")+" ";if(sendButton){sendButton.setAttribute("title",translate("Send"))}if(attachButton){attachButton.setAttribute("title",translate("Attach File"))}setLabel((chatSettings.chatPane.leaveAMessageLabel||insideWorkflows.settings.leaveAMessageLabel||translate("Leave a Message")),"#leaveAMessageItem label",{parentNodeTitle:true});setLabel(chatSettings.chatPane.callmeButtonLabel,"#clickToCallItem label",{parentNodeTitle:true});setLabel(chatSettings.chatPane.joinTheCallLabel,"#joinTheCallItem label",{parentNodeTitle:true});setLabel(chatSettings.chatPane.chatToHumanLabel,"#chatToHuman label",{parentNodeTitle:true});translateElement("#orientPhoneLabel")}function translateElement(selector){var el=document.querySelector(selector);el.innerText=translate(el.innerText)}this.setChatMenuButtonVisibility=setChatMenuButtonVisibility;var setMenuVisibTimer;function setChatMenuButtonVisibility(){clearTimeout(setMenuVisibTimer);var setMenuVisibTimer=setTimeout(setChatMenuButtonVisibilityCont,0)}function setChatMenuButtonVisibilityCont(){var count=0;$(document.body).find("#chatPaneMenu .menuItem").each(function(){if($(this).css("display")!="none"){count++;return}});if(count===0){document.getElementById("chatMenuButton").style.display="none";document.getElementById("insideChatPaneInputFooter").classList.add("menuButtonHidden");if(menuOpen){closeMenu()}}else{document.getElementById("chatMenuButton").style.display="block";document.getElementById("insideChatPaneInputFooter").classList.remove("menuButtonHidden")}if(iOSMobile||iOSiPad){iosMenuRenderFix()}}var iosSetFrameHeightTimeout;_this.inputFocus=inputFocus;function inputFocus(e){if(device==2&&menuOpen){closeMenu()}if(chatPaneContent.classList.contains("notificationsShowing")&&document.querySelectorAll(".notification").length==0){chatPaneContent.classList.remove("notificationsShowing")}if(device==2||iOSiPad){if(document.activeElement.tagName=="TEXTAREA"||document.activeElement.tagName=="INPUT"){keyboardOpen=true;document.getElementById("inside_holder").classList.add("keyboardOpen");topWindow.document.getElementById("inside_holder").classList.add("keyboardOpen");if(iOSiPad){var addressBarCollapsed=insideFrontInterface.vhCheck("inside-vh").value===0;if(addressBarCollapsed){var insideChatFrame=topWindow.document.getElementById("insideChatFrame");insideChatFrame.style.top=(parseInt(insideChatFrame.style.top)-initialVhValue)+"px"}}}else{setTimeout(function(){keyboardOpen=false;keyboardOpenSet=false;document.getElementById("inside_holder").classList.remove("keyboardOpen");topWindow.document.getElementById("inside_holder").classList.remove("keyboardOpen")},500)}}if(device==2){clearTimeout(iosSetFrameHeightTimeout);keyboardOpenSet=false;if(typeof(insideWebApp)==="undefined"||insideWebApp!=true){iosSetFrameHeightTimeout=setTimeout(function(){insideChatPane.setFrameHeight();clearTimeout(iosSetFrameHeightTimeout);chatPaneContent.scrollTop=chatPaneContent.scrollHeight;iosSetFrameHeightTimeout=setTimeout(function(){chatPaneContent.scrollTop=chatPaneContent.scrollHeight},1000)},500)}else{iosSetFrameHeightTimeout=setTimeout(function(){insideChatPane.setFrameHeight();clearTimeout(iosSetFrameHeightTimeout);$(topWindow).scrollTop(0);chatPaneContent.scrollTop=chatPaneContent.scrollHeight;if(keyboardOpen){header.scrollIntoView();iosSetFrameHeightTimeout=setTimeout(function(){header.scrollIntoView();chatPaneContent.scrollTop=chatPaneContent.scrollHeight},100)}},500)}}}function chatPaneScroll(){chatIsAtBottom=scrollIsAtBottom();if(chatIsAtBottom){clearUnreadMessageCount()}}this.scaleChatInput=scaleChatInput;function scaleChatInput(){if(!chatPaneOpen||footerClosed||!chatPane){return}var el=chatPane.querySelector("#chatInput");el.style.height="5px";var scrollHeight=el.scrollHeight;if(scrollHeight==0){setTimeout(scaleChatInput,200);return}el.style.height=(scrollHeight+4)+"px";if(!preview&&device==1&&chatPaneOpen&&$(topWindow.document.activeElement).is("input")==false){$(el).focus()}}function scaleEmailInput(){var el=chatPane.querySelector("#emailInput");el.style.height="5px";var fontSize=parseInt(window.getComputedStyle(el,null).getPropertyValue("font-size"));var padding=parseInt(window.getComputedStyle(el,null).getPropertyValue("padding-top"));el.style.height=((fontSize*1.2)+4+padding+padding)+"px"}function setMenuActions(){document.getElementById("emailTranscriptItem").addEventListener("click",emailTranscriptClicked);document.getElementById("printTranscriptItem").addEventListener("click",printChat);document.getElementById("endChatItem").addEventListener("click",endChatMenuItemClick);document.getElementById("requestVideoChat").addEventListener("click",function(){requestVideoChat(null,customInsideForms.allowVideoChatRequest)});document.getElementById("joinTheCallItem").addEventListener("click",joinTheCall);if(typeof clickToCall!="undefined"){document.getElementById("clickToCallItem").addEventListener("click",clickToCall.clickToCall)}document.getElementById("leaveAMessageItem").addEventListener("click",function(){if(!preview){insideWorkflows.stopWorkflowIfNeeded();if(insideWorkflows.settings.settingNoOpWorkflowId&&insideWorkflows.settings.settingNoOpWorkflowId!=""&&insideWorkflows.settings.settingNoOpWorkflowId!="0"){insideAPI.post("api/workflow/StartWorkflow",{workflowId:insideWorkflows.settings.settingNoOpWorkflowId,force:true},function(response){},function(){})}else{insideAPI.post("api/workflow/StartWorkflow",{workflowId:settings.chatSettings.offline.workflow,force:true},function(response){},function(){})}}closeMenu()});$(document.querySelectorAll(".menuItem")).clickableByKeyboard()}function cobrowseClick(){}function endChatMenuItemClick(){if(activeChat){showCloseChatMessage(true)}else{insideChatPane.close();if(topWindow.insideStreaming){topWindow.insideStreaming.chatPaneClosed()}}}this.clearEmailInputField=clearEmailInputField;function clearEmailInputField(){$(document.body).find("#emailTranscriptItem span").removeClass("brandColorFont");$(document.body).find("#insideWorkflowFieldCell").hide();$(document.body).find("#chatInputCell").hide();$(document.body).find("#emailInputCell").hide();$(document.body).find("#emailInputCell").removeClass("visible");document.getElementById("insideChatPaneInputFooter").style.paddingBottom="";$(lastVisibleCell).show();var emailInput=document.getElementById("emailInput");emailInput.removeEventListener("keydown",onEmailInputKeyDown);$(emailInput).off("blur input",onEmailInputKeyUp);emailInput.value="";document.getElementById("chatMenuIcon").classList.remove("transitionHidden");document.getElementById("chatMenuCloseIcon").classList.add("transitionHidden");emailInput.classList.remove("invalid");emailInput.classList.remove("valid");document.getElementById("chatSendButton").style.display="none";if(hadFooterHidden){$(document.body).find("#insideChatPaneInputFooter").addClass("hidden");$(document.body).find("#insideChatPaneInputFooter").height("0px")}if(wasBottomAligned){document.getElementById("insideChatPaneFooter").classList.add("bottomAligned")}if($(document.body).find("#insideWorkflowFieldCell").is(":visible")){insideWorkflows.setSendButton()}else{setSendButton()}scaleChatInput()}var lastVisibleCell;var hadFooterHidden;var wasBottomAligned;function emailTranscriptClicked(){var footer=document.querySelector("#insideChatPaneInputFooter");if(device==2){closeMenu(0,true)}else{closeMenu(null,true)}hadFooterHidden=false;if(footer.classList.contains("hidden")){footer.classList.remove("hidden");footer.style.height="";hadFooterHidden=true;if(iOSMobile){document.querySelector("#chatMenuButtonCell").style.display="none";setTimeout(function(){document.querySelector("#chatMenuButtonCell").style.display=""},300)}}var emailInput=document.getElementById("emailInput");if($(document.body).find("#insideWorkflowFieldCell").is(":visible")){lastVisibleCell=$(document.body).find("#insideWorkflowFieldCell")}else{if($(document.body).find("#chatInputCell").is(":visible")){lastVisibleCell=$(document.body).find("#chatInputCell")}}wasBottomAligned=document.getElementById("insideChatPaneFooter").classList.contains("bottomAligned");document.getElementById("insideChatPaneFooter").classList.remove("bottomAligned");$(document.body).find("#insideWorkflowFieldCell").hide();$(document.body).find("#chatInputCell").hide();$(document.body).find("#emailInputCell").show();$(document.body).find("#emailInputCell").addClass("visible");document.getElementById("chatSendButton").style.display="none";var enterEmailText=translate("Enter email to receive transcript");if(settings.emailInputText&&getLanguageValue(settings.emailInputText)!=""){enterEmailText=getLanguageValue(settings.emailInputText)}emailInput.value="";emailInput.placeholder=enterEmailText;emailInput.addEventListener("keydown",onEmailInputKeyDown);$(emailInput).on("blur input",onEmailInputKeyUp);if(device==2||iOSiPad){emailInput.addEventListener("focus",inputFocus);emailInput.addEventListener("blur",inputFocus)}scaleEmailInput();$(emailInput).focus()}function onEmailInputKeyDown(event){if(event.keyCode===13||event.keyCode===32){event.preventDefault();sendChat();return}}function onEmailInputKeyUp(event){var emailInput=document.getElementById("emailInput");var email=emailInput.value.trim();if(email!=""){if(emailRegex.test(email)){emailInput.classList.remove("invalid");emailInput.classList.remove("pending");emailInput.classList.add("valid");removeElements(".invalidEmail")}else{emailInput.classList.remove("invalid");emailInput.classList.remove("valid");emailInput.classList.add("pending")}document.getElementById("chatSendButton").classList.remove("disabled");$(document).find("#chatSendButton").show()}else{if(!emailRegex.test(email)){emailInput.classList.remove("valid");emailInput.classList.remove("pending");emailInput.classList.add("invalid");document.getElementById("chatSendButton").style.display="none";document.getElementById("chatSendButton").classList.remove("disabled")}}}function emailChatTranscript(){var input=chatPane.querySelector("#emailInput");if(input.classList.contains("disabled")){return}var email=input.value.trim();removeElements(".invalidEmail");if(emailRegex.test(email)==false||input.classList.contains("invalid")||email.length==0){if(email.length>0){showErrorBubble(translate("Invalid email address"),"invalidEmail")}return}document.getElementById("chatMenuButton").classList.add("disabled");input.classList.add("disabled");input.setAttribute("disabled","disabled");document.getElementById("chatSendButton").style.display="none";var dateFormat=insideFrontInterface.getLocaleDateString();var chatids=getAllVisibleConversationIds();var ob={email:email,offset:new Date().getTimezoneOffset(),dateformat:dateFormat};if(settings.restrictPrintConversation==true){ob.chatids=chatids}else{if(settings.showPreviousChatSessionWithin!="currentsession"||insideFrontInterface.currentChatId==0){ob.chatids=chatids}}if(isRTL){ob.isRTL=isRTL}scaleEmailInput();insideAPI.post("api/chat/EmailSessionChatv2",ob,function(response){input.classList.remove("disabled");input.removeAttribute("disabled");var msg=translate("Sorry email could not be sent.");if(response=="true"){msg=translate("The chat transcript has been sent to")+" "+email}clearEmailInputField();showSystemMessage(msg);scrollToBottom();$(document.body).find("#chatMenuButton").removeClass("disabled")})}function printChat(){closeMenu();if(!!preview){return}insideFrontInterface.chat.print(undefined,isRTL)}function joinTheCall(){$(document).find("#joinTheCallItem").addClass("disabled");$(document).find("#joinTheCallItem span.icon-join-the-call-2").addClass("shrink-enlarge");$.when(insideFrontInterface.chat.getVisitorCobrowsePasscode()).done(function(response){var joinTheCallText=getLanguageValue(settings.sessionCodeLabel);if(joinTheCallText===""&&insideFrontInterface.chat.clickToCallSettings&&insideFrontInterface.chat.clickToCallSettings.joinTheCallMsg){joinTheCallText=insideFrontInterface.chat.clickToCallSettings.joinTheCallMsg}if(joinTheCallText===""){joinTheCallText="Session Code:"}var msg=joinTheCallText+" "+response.data;showSystemMessage(msg)}).fail(function(response){var msg=settings.joinTheCallFailMsg||"Could not get Join the Call code!";showSystemMessage(msg)}).always(function(){setTimeout(function(){menuButtonClick();scrollToBottom();$(document).find("#joinTheCallItem").removeClass("disabled");$(document).find("#joinTheCallItem span.icon-join-the-call-2").removeClass("shrink-enlarge")},300)})}this.setupCountryCodeDropdown=setupCountryCodeDropdown;function setupCountryCodeDropdown(_onComplete){if($("#hdnCCPhoneField").length==0){$(document.body).append("<div style='display:none;'><input type='text' id='hdnCCPhoneField' style='display:none;' /></div>")}var hdnPhoneField=$(document.body).find("#hdnCCPhoneField");try{var countryCode=insideFrontInterface.getUserCC()||"us"}catch(e){countryCode="us"}countryCode=countryCode==="uk"?"gb":countryCode;hdnPhoneField.intlTelInput({autoPlaceholder:"polite",initialCountry:!preview?countryCode:"us",separateDialCode:true,utilsScript:_insideCDN+"/js/intlTelInput/utils.js"});try{window.intlTelInputGlobals.instances[0].promise.then(_onComplete)}catch(e){_onComplete()}}this.showCountryCodeDropdown=showCountryCodeDropdown;function showCountryCodeDropdown(countryCode,ccElement,ccInpElement,onSelectCallback){if(device==2){setTimeout(function(){countryCodeContinue(countryCode,ccElement,ccInpElement,onSelectCallback)},500)}else{countryCodeContinue(countryCode,ccElement,ccInpElement,onSelectCallback)}}function countryCodeContinue(countryCode,ccElement,ccInpElement,onSelectCallback){if(!countryCode){countryCode=$(document.body).find("#hdnCCPhoneField").intlTelInput("getSelectedCountryData").iso2}if($(document.body).find(".insideSelectMenu").length===0){$(document.body).find("#inside_holder").append("<div class='insideSelectMenu'><div><h2>"+translate("Choose a Country")+"</h2><span class='insideSelectMenuClose icon-close'></span><div class='insideSearchInputHolder'><input id='insideSelectListSearchInput' type='text' placeholder='"+translate("Search")+"' autocomplete='off' /><span class='icon-close'></span></div></div><div class='insideSelectList animateHeight'>"+getCountriesList()+"</div></div>");$(document.body).find(".insideSelectMenu").show();$(document.body).find(".insideSelectMenu .insideSelectMenuClose").click(function(){closeDropdown()}).clickableByKeyboard();$(document.body).find(".insideSelectMenu li").click(function(){$(document.body).find(".insideSelectMenu li.selected").removeClass("selected");$(this).addClass("selected");$(document.body).find("#hdnCCPhoneField").intlTelInput("setCountry",$(this).attr("code"));$(document).find(ccElement).html("+"+$(this).attr("value"));$(document).find(ccInpElement).attr("placeholder",$(document.body).find("#hdnCCPhoneField").attr("placeholder"));if(typeof(onSelectCallback)=="function"){onSelectCallback(this)}closeDropdown()}).clickableByKeyboard();$(document.body).find(".insideSelectMenu #insideSelectListSearchInput").keyup(function(){var searchTerm=$(this).val().toLowerCase();if(searchTerm.length>0){$(document.body).find(".insideSelectMenu .insideSearchInputHolder").addClass("searchCrossIcon")}else{$(document.body).find(".insideSelectMenu .insideSearchInputHolder").removeClass("searchCrossIcon")}$(document.body).find(".insideSelectMenu li").each(function(){if($(this).text().toLowerCase().indexOf(searchTerm)>-1){$(this).show()}else{$(this).hide()}})});$(document.body).find(".insideSelectMenu .insideSearchInputHolder span.icon-close").on("mousedown",function(e){$(document.body).find("#insideSelectListSearchInput").val("");$(document.body).find(".insideSelectMenu .insideSearchInputHolder").removeClass("searchCrossIcon");$(document.body).find(".insideSelectMenu li").show()});scaleDropdown()}else{$(document.body).find("#insideSelectListSearchInput").val("");$(document.body).find(".insideSelectMenu .insideSearchInputHolder").removeClass("searchCrossIcon");$(document.body).find(".insideSelectMenu li").show();if(device===2){$(document.body).find(".insideSelectMenu .insideSelectList").addClass("animateHeight")}scaleDropdown()}setTimeout(function(){if(device!=2){$(document.body).find(".insideSelectMenu #insideSelectListSearchInput").focus()}$(document.body).find(".insideSelectMenu li[code="+countryCode+"]").addClass("selected")[0].scrollIntoView({behavior:"smooth",block:"center"})},200)}this.getCountriesList=getCountriesList;function getCountriesList(){var countries=$(document.body).find("#hdnCCPhoneField").intlTelInput("getAllCountries");var html="<ul>";if(countries){for(var i=0;i<countries.length;i++){html+="<li value='"+countries[i].dialCode+"' code='"+countries[i].iso2+"'><span class='iti-flag "+countries[i].iso2+"'></span><span class='countryName' title='"+countries[i].name+"'>"+countries[i].name+"</span><span class='dialCode' dir='ltr'>+"+countries[i].dialCode+"</span></li>"}}html+="</ul>";return html}this.scaleDropdown=scaleDropdown;function scaleDropdown(){var dropdown=$(document.body).find("#inside_holder .insideSelectMenu");var listElement=$(document.body).find(".insideSelectMenu .insideSelectList");var maxHeight=$(document.body).find("#insideChatPane").outerHeight()-$(document.body).find("#insideChatPane #insideChatPaneHeader").outerHeight()-40-120;listElement.css({height:""});dropdown.css({bottom:"-2000px"}).show();var height=dropdown.find("ul").outerHeight();dropdown.hide().css("bottom","0px");listElement.css("height",(height<maxHeight?height+24:maxHeight)+"px");dropdown.show();if(device===2){setTimeout(function(){listElement.removeClass("animateHeight")},3000)}scrollToBottom(0)}this.closeDropdown=closeDropdown;function closeDropdown(remove){$(document.body).find("#inside_holder .insideSelectMenu .insideSelectList").css("height","0px");setTimeout(function(){if(remove){$(document.body).find("#inside_holder .insideSelectMenu, #inside_holder .insideSelectMenuOverlay").remove()}else{$(document.body).find("#inside_holder .insideSelectMenu, #inside_holder .insideSelectMenuOverlay").hide()}},200)}this.setupDropdown=setupDropdown;function setupDropdown(){$(document.body).find("select").each(function(){$(this).attr("tabindex",-1);var label=$(this).closest(".inside-prechat-field").find(".inside-label, .inside_dept_selector_title").text();if(typeof label=="undefined"||label==""){label=translate("Select")}var customSelect=$('<div class="custom-select" tabindex="0" aria-label="'+label+'"><span class="icon-minimise_2"></span></div>').insertBefore(this);customSelect.width($(this).outerWidth());customSelect.height($(this).outerHeight())});insideWorkflows.setStyles();$(document.body).find(".custom-select").click(function(e){$(document.body).find("#inside_holder .insideSelectMenu, #inside_holder .insideSelectMenuOverlay").remove();var customSelect=$(this);var select=$(this).next("select");var placeholder="Select";var options="<ul>";select.find("option").each(function(index){if(typeof this.value=="undefined"||this.value==""){placeholder=this.innerHTML}else{options+='<li index="'+index+'" role="menuitem" value="'+this.value+'" tabindex="0">'+this.innerHTML+"</li>"}});options+="</ul>";$(document.body).find("#inside_holder").append("<div class='insideSelectMenuOverlay'></div>");$(document.body).find("#inside_holder").append("<div class='insideSelectMenu'><div><h2>"+translate(placeholder)+"</h2><span class='insideSelectMenuClose icon-close' tabindex='0' aria-label='"+translate("Close")+"'></span></div><div class='insideSelectList animateHeight' role='menu' tabindex='0' aria-label='"+translate(placeholder)+"'>"+options+"</div></div>");$(document.body).find(".insideSelectMenu").show();scaleDropdown();$(document.body).find(".insideSelectMenu .insideSelectList").focus();$(document.body).find(".insideSelectMenu .insideSelectMenuClose, .insideSelectMenuOverlay").click(function(){customSelect.focus();closeDropdown(true)});$(document.body).find(".insideSelectMenu .insideSelectMenuClose").clickableByKeyboard();$(document.body).find(".insideSelectMenu li").click(function(){$(document.body).find(".insideSelectMenu li.selected").removeClass("selected");$(this).addClass("selected");select[0].selectedIndex=$(this).attr("index");customSelect.focus();closeDropdown(true)}).clickableByKeyboard()}).clickableByKeyboard()}function setSettings(){var pane=document.getElementById("insideChatPane");if(!pane){return}setLanguage();if(!preview&&chatSettings.chatPane.draggable==true&&device==1){setDraggable()}if(!preview&&chatSettings.chatTab.draggable===false){$(topWindow.document.querySelector("#inside_tabs")).unbind("mousedown touchstart")}try{top.document.documentElement.style.setProperty("--inside-header-height",(chatSettings.chatPane.headerHeight||60)+"px");_frame.contentWindow.document.documentElement.style.setProperty("--inside-header-height",(chatSettings.chatPane.headerHeight||60)+"px");top.document.documentElement.style.setProperty("--inside-chatpane-offset-x",(chatSettings.chatPane.sideOffset||0)+"px");top.document.documentElement.style.setProperty("--inside-chatpane-width",(chatSettings.chatPane.width||400)+"px");_frame.contentWindow.document.documentElement.style.setProperty("--inside-chatpane-width",(chatSettings.chatPane.width||400)+"px")}catch(e){}}function cloneSvgs(svgs,_colour){var colour=chatSettings.generalStyles.brandColor;if(typeof _colour!="undefined"){colour=_colour}var newSVGs={};for(var i in svgs){newSVGs[i]=svgs[i].split("#1BB9DA").join(colour)}return newSVGs}this.getOpacityColor=getOpacityColor;function getOpacityColor(rgb,opacity){return getOpacityColorOnBackground(rgb,opacity,"#ffffff")}this.getOpacityColorOnBackground=getOpacityColorOnBackground;function getOpacityColorOnBackground(rgb,opacity,backgroundRBG){try{if(typeof(rgb)=="undefined"){rgb="#000000"}if(typeof(backgroundRBG)=="undefined"||backgroundRBG.length==0){backgroundRBG="#ffffff"}if(rgb.indexOf("#")!=-1){rgb=rgb.substring(1);backgroundRBG=backgroundRBG.substring(1)}var r1=parseInt(rgb.substr(0,2),16);var g1=parseInt(rgb.substr(2,2),16);var b1=parseInt(rgb.substr(4,2),16);var r2=parseInt(backgroundRBG.substr(0,2),16);var g2=parseInt(backgroundRBG.substr(0,2),16);var b2=parseInt(backgroundRBG.substr(0,2),16);var r3=r2+(r1-r2)*opacity;var g3=g2+(g1-g2)*opacity;var b3=b2+(b1-b2)*opacity;return"#"+parseInt(r3).toString(16)+""+parseInt(g3).toString(16)+""+parseInt(b3).toString(16)}catch(e){return"#000000"}}this.getRgbFromHexCode=getRgbFromHexCode;function getRgbFromHexCode(hex,opacity){hex=hex.replace("#","");r=parseInt(hex.substring(0,2),16);g=parseInt(hex.substring(2,4),16);b=parseInt(hex.substring(4,6),16);result="rgba("+r+","+g+","+b+","+opacity/100+")";return result}this.addStyle=addStyle;function addStyle(selector,property,valueString,after,before){var cssString="";if(typeof(after)=="undefined"){after=""}if(typeof(before)=="undefined"){before=""}try{value=eval(valueString);if(typeof(value)=="undefined"||value==null||value===""){return cssString}cssString+=selector+"{ "+property+": "+before+value+after+"}";return cssString}catch(e){console.warn("CSS property issue: ",valueString);return""}}this.setStyling=setStyling;function setStyling(_chatSettings){if(!frame||!document){return}if(typeof _chatSettings!="undefined"){chatSettings=_chatSettings}if(!chatFrameCreated){initChatPane()}var pane=document.getElementById("insideChatPane");if(!pane){return}if(!chatSettings){chatSettings=insideFrontInterface.chat.settings.chatSettings}if(chatSettings.chatPane.header.inverse){header.style.backgroundColor=chatSettings.generalStyles.secondaryTextColor||"";header.style.color=chatSettings.generalStyles.brandColor||""}else{header.style.backgroundColor=chatSettings.generalStyles.brandColor||"";header.style.color=chatSettings.generalStyles.secondaryTextColor||""}if(device==1&&chatSettings.chatPane.borderRadius){chatPane.style.borderRadius=chatSettings.chatPane.borderRadius+"px";_frame.style.borderRadius=chatSettings.chatPane.borderRadius+"px";chatPane.style.overflow="hidden"}else{chatPane.style.borderRadius="";chatPane.style.overflow="";_frame.style.borderRadius=""}if(isRTL){pane.classList.add("rtl");document.getElementsByTagName("html")[0].setAttribute("dir","rtl")}else{pane.classList.remove("rtl");document.getElementsByTagName("html")[0].removeAttribute("dir")}setChatHeader(pane);setMenuItems();setIcons();if(chatSettings.chatPane.logoSize){var img=pane.querySelector("#insideChatPaneHeaderImageWrapper img");var dim=chatSettings.chatPane.logoSize.split(",");img.style.width=dim[0]+"px";if(dim.length>1){img.style.height=dim[1]+"px"}}pane.querySelector("#insideChatPaneContent").style.background=chatSettings.chatPane.background||"";setShadowAndBorder();if(chatSettings.chatPane.inputPlaceholder){pane.querySelector("#chatInput").setAttribute("placeholder",getLanguageValue(chatSettings.chatPane.inputPlaceholder))}setFrameHeight();if(device==1&&!preview){if(chatSettings.chatPane.sideOffset){_frame.style.right=chatSettings.chatPane.sideOffset+"px"}}var css="";css+=addStyle("#inside_leaveMessageForm, div#inside_prechatForm, .customForm","background","chatSettings.chatPane.background");css+=addStyle(".message.welcomeGreeting.system .bubble, .message.nobubble","color","chatSettings.generalStyles.primaryTextColor");css+=addStyle(".message.welcomeGreeting.system .bubble, .message.nobubble, #inside_holder .c2cContainer .c2cPhoneDiv .c2cCountryCodeSpan","color","chatSettings.generalStyles.primaryTextColor");css+=addStyle(".message.operator .bubble, .message.leaveMessageNotification .bubble","color","chatSettings.generalStyles.primaryTextColor");css+=addStyle("#chatInput, #emailInput, textarea, input:not([type='button']):not([type='range']):not([type='checkbox']):not([type='radio']), .inside-prechat-field select","color","chatSettings.generalStyles.primaryTextColor");css+=addStyle(".date, .message.relatedIntents .messageContent .bubble .inside_relatedintents li span","color","getOpacityColor(chatSettings.generalStyles.primaryTextColor, 0.5)");css+=addStyle("#chatInput::placeholder, #emailInput::placeholder, textarea::placeholder, #attachButton","color","getOpacityColor(chatSettings.generalStyles.primaryTextColor, 0.3)");css+=addStyle("#inside_holder #insideChatPane #chatInput:-ms-input-placeholder, #inside_holder #insideChatPane input:-ms-input-placeholder, #inside_holder #insideChatPane textarea:-ms-input-placeholder, .inside-prechat-field select:-ms-input-placeholder","color","getOpacityColor(chatSettings.generalStyles.primaryTextColor, 0.3)","!important");css+=addStyle("#emailInput:focus:not(.valid)","border-color","chatSettings.generalStyles.formBorderColor");css+=addStyle("#chatInput:focus, .menuItem:focus","border-color","chatSettings.generalStyles.brandColor");css+=addStyle("#chatInput:focus, .menuItem:focus","border-color","chatSettings.chatPane.menu.footerIconColor");css+=addStyle("#chatInput","border-color","getOpacityColor(chatSettings.generalStyles.primaryTextColor, 0.3)");css+=addStyle("input:focus, textarea:focus, select:focus, .custom-select:focus + select","border-color","chatSettings.generalStyles.brandColor");css+=addStyle("input:not([type='button'])::placeholder, textarea::placeholder, .intl-tel-input.allow-dropdown input::placeholder","color","getOpacityColor(chatSettings.generalStyles.primaryTextColor, 0.3)");css+=addStyle(".message.visitor .bubble","color","chatSettings.generalStyles.secondaryTextColor");if(chatSettings.chatPane&&chatSettings.chatPane.messages&&chatSettings.chatPane.messages.visitorTextColor){css+=addStyle(".message.visitor .bubble a","color","chatSettings.chatPane.messages.visitorTextColor")}else{css+=addStyle(".message.visitor .bubble a","color","chatSettings.generalStyles.primaryTextColor")}css+=addStyle(".message.visitor .bubble","color","chatSettings.chatPane.messages.visitorTextColor");css+=addStyle(".message.visitor .bubble","background","chatSettings.generalStyles.brandColor");css+=addStyle(".message.visitor .bubble","background","chatSettings.chatPane.messages.visitorBackground");css+=addStyle("#chatMenuButton, #attachButton:hover, #chatSendButton, .brandColorFont","color","chatSettings.generalStyles.brandColor");css+=addStyle("#chatMenuButton, #chatSendButton, #attachButton:hover","color","chatSettings.chatPane.menu.footerIconColor");css+=addStyle(".brandColor::-webkit-slider-thumb","background","chatSettings.generalStyles.brandColor");css+=addStyle(".message.system, .message.workflowMessage.plain .bubble","color","chatSettings.generalStyles.primaryTextColor");css+=addStyle(".message.system.nobubble .bubble, .message.system.welcomeGreeting .bubble","color","chatSettings.generalStyles.primaryTextColor");css+=addStyle(".message.operator .fromName, .chatNotifTitle","color","chatSettings.generalStyles.primaryTextColor");css+=addStyle(".message.operator .fromName, .chatNotifTitle","color","chatSettings.chatPane.messages.operatorTitleColor");css+=addStyle(".message.operator .bubble, .picklist .picklistOption, .message.cards .card, .message.cards .cardsScrollLeft, .message.cards .cardsScrollRight","background-color","chatSettings.chatPane.messages.operatorBackground");if(chatSettings.chatPane&&chatSettings.chatPane.messages&&chatSettings.chatPane.messages.operatorTextColor){css+=addStyle(".message.operator .bubble a","color","chatSettings.chatPane.messages.operatorTextColor")}else{css+=addStyle(".message.operator .bubble a","color","chatSettings.generalStyles.primaryTextColor")}css+=addStyle(".message.operator .bubble","color","chatSettings.chatPane.messages.operatorTextColor");css+=addStyle(".message.operator .bubble, .message.leaveMessageNotification .bubble, .chatNotification, #chatNotifications.style2 .chatNotification .chatNotifContent","border","chatSettings.chatPane.messages.operatorBorder",""," 1px solid ");if(chatSettings.chatPane.messages.operatorTextColor){css+=addStyle(".message.cards .cardTitle, .message.cards .cardSubtitle, .message.cards .card .cardLink, .message.cards .bubble .card .cardLink a","color","chatSettings.chatPane.messages.operatorTextColor");css+=addStyle(".message.cards .cardUrl","color","chatSettings.chatPane.messages.operatorTextColor");css+=addStyle(".message.cards .cardUrl","opacity","0.5");css+=addStyle(".message.cards .cardLink","border-color","getOpacityColor(chatSettings.chatPane.messages.operatorTextColor, 0.3)");css+=addStyle(".message.cards .cardsScrollLeft, .message.cards .cardsScrollRight","border","getOpacityColor(chatSettings.chatPane.messages.operatorTextColor, 0.3)",""," 1px solid ")}else{css+=addStyle(".message.cards .cardTitle, .message.cards .cardSubtitle, .message.cards .card .cardLink, .message.cards .bubble .card .cardLink a","color","chatSettings.generalStyles.primaryTextColor");css+=addStyle(".message.cards .cardUrl","color","chatSettings.generalStyles.primaryTextColor");css+=addStyle(".message.cards .cardUrl","opacity","0.5");css+=addStyle(".message.cards .cardLink","border-color","getOpacityColor(chatSettings.generalStyles.primaryTextColor, 0.3)");css+=addStyle(".message.cards .cardsScrollLeft, .message.cards .cardsScrollRight","border","getOpacityColor(chatSettings.generalStyles.primaryTextColor, 0.3)",""," 1px solid ")}if(typeof(chatSettings.chatPane.messages.visitorBorder)!="undefined"&&chatSettings.chatPane.messages.visitorBorder!=""){css+=".message.visitor .bubble { border: 1px solid "+chatSettings.chatPane.messages.visitorBorder+";}"}if(typeof(chatSettings.chatPane.messages.operatorBorder)!="undefined"&&chatSettings.chatPane.messages.operatorBorder!=""){css+=".message.operator .bubble, .message.cards .card { border: 1px solid "+chatSettings.chatPane.messages.operatorBorder+";}"}css+=addStyle("#menu_notifications .notification","color","chatSettings.generalStyles.brandColor");css+=addStyle("#menu_notifications .notification .button, .message.videochat .button","background-color","chatSettings.generalStyles.brandColor");css+=addStyle("#menu_notifications .notification .button, .message.videochat .button","border-color","chatSettings.generalStyles.brandColor");css+=addStyle("#menu_notifications .notification .button.cancel, .message.videochat .button.cancel","color","chatSettings.generalStyles.brandColor");css+=addStyle("#insideChatPaneButtons","color","chatSettings.chatPane.headerIconColor");if(typeof(chatSettings.chatPane.headerBorder)!="undefined"&&chatSettings.chatPane.headerBorder!=""){css+="#insideChatPaneHeader { border-bottom: 1px solid "+chatSettings.chatPane.headerBorder+";}"}css+=addStyle("#insideChatPaneHeader","color","chatSettings.chatPane.iconColor");css+=addStyle("#insideChatPaneHeader","height","chatSettings.chatPane.headerHeight","px");css+=addStyle("#insideChatPaneHeader","min-height","chatSettings.chatPane.headerHeight","px");css+=addStyle("#insideChatPaneHeaderImageWrapper","line-height","chatSettings.chatPane.headerHeight","px");css+=addStyle("#insideChatPaneHeaderImageWrapper","height","chatSettings.chatPane.headerHeight","px");if(typeof(chatSettings.chatPane.headerHeight)!="undefined"&&chatSettings.chatPane.headerHeight!=""){css+=addStyle("#insideChatPaneButtons","top","Math.max(0, (chatSettings.chatPane.headerHeight - 30)) * 0.5","px")}if(chatSettings.chatPane.footerShadow==false){css+="#insideChatPaneFooter { box-shadow: none; }"}if(typeof(chatSettings.chatPane.footerBorder)!="undefined"&&chatSettings.chatPane.footerBorder!=""){css+="#insideChatPaneFooter { border-top: 1px solid "+chatSettings.chatPane.footerBorder+";}"}css+=addStyle("div#insideChatPaneHeaderImageWrapper img","width","chatSettings.chatPane.logoWidth","px");css+=addStyle("div#insideChatPaneHeaderImageWrapper img","height","chatSettings.chatPane.logoHeight","px");css+=addStyle("div#insideChatPaneHeaderImageWrapper img","max-height","chatSettings.chatPane.logoHeight","px");css+=addStyle(".offline div#insideChatPaneHeaderImageWrapper img","width","chatSettings.offline.logoWidth","px");css+=addStyle(".offline div#insideChatPaneHeaderImageWrapper img","height","chatSettings.offline.logoHeight","px");css+=addStyle(".offline div#insideChatPaneHeaderImageWrapper img","max-height","chatSettings.offline.logoHeight","px");css+=addStyle("#insideChatPaneFooter, #chatPaneMenuContent","background","chatSettings.chatPane.footerBackground");css+=addStyle("#insideChatPaneContent, #insideChatPaneFooterBuffer","background","chatSettings.chatPane.background");css+=addStyle(".message.system .bubble, .message.workflowMessage.plain","color","chatSettings.generalStyles.primaryTextColor");css+=addStyle(".notification .bubble","color","chatSettings.chatPane.notifications.text");css+=addStyle(".notification .button:not(.cancel)","color","chatSettings.chatPane.notifications.background");css+=addStyle(".notification .button:not(.cancel)","background","chatSettings.chatPane.notifications.text");css+=addStyle(".notification .button:not(.cancel)","border","chatSettings.chatPane.notifications.text");css+=addStyle(".notification .button.cancel","color","chatSettings.chatPane.notifications.text");css+=addStyle(".notification .button.cancel","border-color","chatSettings.chatPane.notifications.text");css+=addStyle(".notification .bubble, .notification .button.cancel","background","getRgbFromHexCode(chatSettings.chatPane.notifications.background, 98)");css+=addStyle(".message .fromName","color","chatSettings.chatPane.nameColor");css+=addStyle(".message .bubble","padding","chatSettings.chatPane.messages.padding","px");css+=addStyle(".message .date","padding-left","chatSettings.chatPane.messages.padding","px");css+=addStyle(".message .bubble, .message.cards .card","border-radius","chatSettings.chatPane.messages.radius","px");if(chatSettings.chatPane.messages.padding!=""){var tbpadding=chatSettings.chatPane.messages.padding*0.75;css+=".message .bubble { padding-top: "+tbpadding+"px; padding-bottom: "+tbpadding+"px;}"}css+=addStyle(".message .bubble, .cardsScrollLeft, .cardsScrollRight","border-radius","chatSettings.chatPane.messages.radius","px");css+=addStyle(".message .inside_assistMessageFace","border","chatSettings.chatPane.imageBorder","","1px solid ");css+=addStyle("#chatInput, #emailInput, textarea, input:not([type='button']):not([type='range']):not([type='checkbox']):not([type='radio']), .inside-prechat-field select, #inside_holder .c2cContainer .c2cPhoneDiv, .formScrollerText, #insideChatPane .schedulingFormContainer select","border-radius","chatSettings.generalStyles.inputCornerRadius","px");css+=addStyle("#insideWorkflowFieldCell .inside-field, #chatInput, #emailInput, textarea, input:not([type='button']):not([type='range']):not([type='checkbox']):not([type='radio']), .inside-prechat-field select, #inside_holder .c2cContainer .c2cPhoneDiv, #insideChatPane .schedulingFormContainer select","background-color","chatSettings.generalStyles.inputBackground");css+=addStyle("#chatInput, #emailInput, textarea, input:not([type='button']):not([type='range']):not([type='checkbox']):not([type='radio']), .inside-prechat-field select, #insideChatPane .schedulingFormContainer select","padding-top","chatSettings.generalStyles.inputPaddingVertical","px");css+=addStyle("#chatInput, #emailInput, textarea, input:not([type='button']):not([type='range']):not([type='checkbox']):not([type='radio']), .inside-prechat-field select, #insideChatPane .schedulingFormContainer select","padding-bottom","chatSettings.generalStyles.inputPaddingVertical","px");css+=addStyle("#chatInput, #emailInput, textarea, input:not([type='button']):not([type='range']):not([type='checkbox']):not([type='radio']), .inside-prechat-field select, #insideChatPane .schedulingFormContainer select","padding-left","chatSettings.generalStyles.inputPaddingHorizontal","px");css+=addStyle("#chatInput, #emailInput, textarea, input:not([type='button']):not([type='range']):not([type='checkbox']):not([type='radio']), .inside-prechat-field select, #insideChatPane .schedulingFormContainer select","padding-right","chatSettings.generalStyles.inputPaddingHorizontal","px");var operatorCornerPos=isRTL?"right":"left";var visitorCornerPos=isRTL?"left":"right";if(chatSettings.chatPane.messages.stylizedTail=="top"){css+=".message.operator .bubble, .message.workflowMessage .bubble .picklistBottomButton, .message.cards .card { border-top-"+operatorCornerPos+"-radius: 0; }";css+=".message.visitor .bubble { border-top-"+visitorCornerPos+"-radius: 0; }"}else{if(chatSettings.chatPane.messages.stylizedTail=="bottom"){css+=".message.operator .bubble, .message.workflowMessage .bubble .picklistBottomButton, .message.cards .card { border-bottom-"+operatorCornerPos+"-radius: 0; }";css+=".message.visitor .bubble { border-bottom-"+visitorCornerPos+"-radius: 0; }"}}css+=addStyle(".message .button, .notification .button, input[type='button'], .inside_sendButton, .inside_adminButton, .insideSubmitButton","border-radius","chatSettings.generalStyles.buttonCornerRadius","px");css+=addStyle(".message .button, .notification .button, input[type='button'], .inside_sendButton, .inside_adminButton, .insideSubmitButton","padding-top","chatSettings.generalStyles.buttonPaddingVertical","px");css+=addStyle(".message .button, .notification .button, input[type='button'], .inside_sendButton, .inside_adminButton, .insideSubmitButton","padding-bottom","chatSettings.generalStyles.buttonPaddingVertical","px");css+=addStyle(".message .button, .notification .button, input[type='button'], .inside_sendButton, .inside_adminButton, .insideSubmitButton","padding-left","chatSettings.generalStyles.buttonPaddingHorizontal","px");css+=addStyle(".message .button, .notification .button, input[type='button'], .inside_sendButton, .inside_adminButton, .insideSubmitButton","padding-right","chatSettings.generalStyles.buttonPaddingHorizontal","px");css+=insideChatPane.addStyle(".inside_chatOption","border-radius","chatSettings.generalStyles.buttonCornerRadius","px");css+=insideChatPane.addStyle(".inside_chatOption","border-color","chatSettings.generalStyles.brandColor");css+=insideChatPane.addStyle(".inside_chatOption","padding-left","chatSettings.generalStyles.buttonPaddingHorizontal","px");css+=insideChatPane.addStyle(".inside_chatOption","padding-right","chatSettings.generalStyles.buttonPaddingHorizontal","px");css+=insideChatPane.addStyle(".inside_chatOption","padding-top","chatSettings.generalStyles.buttonPaddingVertical","px");css+=insideChatPane.addStyle(".inside_chatOption","padding-bottom","chatSettings.generalStyles.buttonPaddingVertical","px");css+=insideChatPane.addStyle(".inside_chatOption","color","chatSettings.generalStyles.brandColor");css+=addStyle("input[type='button'], .insideSubmitButton, .inside_chatOption, .brandColor","background-color","chatSettings.generalStyles.brandColor");css+=addStyle("input[type='button'], .insideSubmitButton, .inside_chatOption, .secondaryTextColor","color","chatSettings.generalStyles.secondaryTextColor");css+=addStyle(".insideSubmitButton.cancel","background-color","chatSettings.generalStyles.secondaryTextColor");css+=addStyle(".insideSubmitButton.cancel","color","chatSettings.generalStyles.brandColor");css+=addStyle(".insideSubmitButton.cancel","border","chatSettings.generalStyles.brandColor","","1px solid ");css+=addStyle("input[type='button'], .insideSubmitButton, .inside_chatOption","border-radius","chatSettings.generalStyles.buttonCornerRadius","px");css+=addStyle("input[type='button'].alt, .insideCancelButton","background-color","chatSettings.generalStyles.buttonAltBackgroundColor");css+=addStyle("input[type='button'].alt, .insideCancelButton","color","chatSettings.generalStyles.buttonAltFontColor");css+=addStyle("input[type='button'].alt, .insideCancelButton","border","chatSettings.generalStyles.buttonAltBorderColor","","1px solid ");css+=addStyle("#insideChatPane, #insideChatPane div, #insideChatPane span","color","chatSettings.generalStyles.inputMainTextColor");css+=addStyle("#insideChatPane div.alt, #insideChatPane span.alt ","color","chatSettings.generalStyles.inputAltTextColor");css+=addStyle("input:not([type='button']), textarea, .intl-tel-input.allow-dropdown input","border","chatSettings.generalStyles.inputMainBorderColor","","1px solid ");css+=addStyle("input:not([type='button']).light, textarea.light","border ","chatSettings.generalStyles.inputBorderLightColor","","1px solid ");css+=addStyle("input:not([type='button']).dark, textarea.dark","border","chatSettings.generalStyles.inputBorderLightColor","","1px solid ");css+=addStyle("input:not([type='button']), textarea, .intl-tel-input.allow-dropdown input","color","chatSettings.generalStyles.inputFontColor");css+=addStyle("input:not([type='button']), textarea, .intl-tel-input.allow-dropdown input"," padding","chatSettings.generalStyles.inputPadding");css+=addStyle("input:not([type='button']), .intl-tel-input.allow-dropdown input"," height","chatSettings.generalStyles.inputHeight");css+=addStyle("textarea","height","chatSettings.generalStyles.textareaHeight");css+=addStyle(".menuItem:hover svg, .menuItem:hover span, .menuItem:hover span:before","color","chatSettings.generalStyles.brandColor");css+=addStyle(".menuItem:hover svg, .menuItem:hover span, .menuItem:hover span:before","color","chatSettings.chatPane.footerIcons");css+=addStyle(".menuItem:hover svg, .menuItem:hover span, .menuItem:hover span:before","color","chatSettings.chatPane.menu.hoverIconColor");css+=addStyle("#chatMenuButton:hover, #chatSendButton:hover","color","chatSettings.chatPane.menu.hoverFooterIconColor");css+=addStyle(".menuItem","border-radius","chatSettings.chatPane.menu.cornerRadius","px");css+=addStyle("textarea:focus,input:not([type='button']):not([type='range']):not([type='checkbox']):not([type='radio']):focus,select:focus,#inside_holder .c2cContainer input:focus","border-color","chatSettings.generalStyles.brandColor");css+=addStyle(".starSelectHolder .star.selected","color","chatSettings.generalStyles.brandColor");css+=addStyle(".starSelectHolder .star, .npsContainer li","color","getOpacityColor(chatSettings.generalStyles.primaryTextColor, 0.25)");css+=addStyle("input[type='button'], .insideSubmitButton, .inside_chatOption, .npsContainer ul","border-radius","chatSettings.generalStyles.buttonCornerRadius","px");css+=addStyle("#inside_holder .npsContainer li.selected, #inside_holder .npsContainer li.selected + li, #inside_holder .npsContainer li:hover, #inside_holder .npsContainer li:hover + li","border-color","chatSettings.generalStyles.brandColor");css+=addStyle("#inside_holder .npsContainer li.selected, #inside_holder .npsContainer li:hover","background-color","chatSettings.generalStyles.brandColor");css+=addStyle(".insideSelectMenu li:focus, .insideSelectMenu li:hover, .insideSelectMenu li.selected","background-color","getOpacityColor(chatSettings.generalStyles.brandColor, 0.1)");css+=addStyle(".insideSelectMenu li:focus, .insideSelectMenu li:hover, .insideSelectMenu li.selected, .message.relatedIntents .messageContent .bubble .inside_relatedintents li label:hover","color","chatSettings.generalStyles.brandColor");css+=addStyle(".insideSchedulingLoadingContainer .sk-fading-circle .sk-circle:before","background-color","chatSettings.generalStyles.brandColor");css+=addStyle(".chatNotification","width","chatSettings.chatPane.notifications.width","px");if(chatSettings.chatPane.notifications.title=="none"){css+=".chatNotifTitle { display: none; }";css+=".chatNotifText { align-items: center; }"}if(typeof chatSettings.chatPane.notifications.height=="undefined"||chatSettings.chatPane.notifications.height.length==0){chatSettings.chatPane.notifications.height=96}css+=addStyle(".chatNotification","height","chatSettings.chatPane.notifications.height","px");css+=addStyle(".chatNotification .chatNotifContent","height","chatSettings.chatPane.notifications.height - 2","px");css+=addStyle(".chatNotification #chatNotifTextHolder","height","chatSettings.chatPane.notifications.height - 20","px");css+=addStyle(".chatNotification .closeButton","color","getOpacityColor(chatSettings.generalStyles.primaryTextColor, 0.3)");css+=addStyle(".chatNotification .chatNotifImage img","max-width","chatSettings.chatPane.notifications.imageWidth","px");css+=addStyle(".chatNotification .chatNotifImage img","max-height","chatSettings.chatPane.notifications.imageHeight!=''?chatSettings.chatPane.notifications.imageHeight:chatSettings.chatPane.notifications.height-2","px");css+=addStyle(".chatNotification .chatNotifImage","padding-bottom","chatSettings.chatPane.notifications.bottomPadding","px");css+=addStyle(".chatNotification .chatNotifImage","padding-left","chatSettings.chatPane.notifications.leftPadding","px");css+=addStyle(".chatNotification .chatNotifImage","padding-top","chatSettings.chatPane.notifications.topPadding","px");css+=addStyle(".chatNotification .chatNotifImage","padding-right","chatSettings.chatPane.notifications.rightPadding","px");css+=addStyle(".chatNotification, .chatNotifImage, .chatNotifOverflow","border-radius","chatSettings.chatPane.notifications.radius","px");if(chatSettings.chatPane&&chatSettings.chatPane.messages&&chatSettings.chatPane.messages.operatorTextColor){css+=addStyle(".chatNotification .chatNotifText","color","chatSettings.chatPane.messages.operatorTextColor")}else{css+=addStyle(".chatNotification .chatNotifText","color","chatSettings.generalStyles.primaryTextColor")}css+=addStyle(".chatNotifNumber","background","chatSettings.chatPane.notifications.numberBgColor");css+=addStyle(".chatNotifNumber","color","chatSettings.chatPane.notifications.numberColor");css+=addStyle("#chatInputCell textarea.valid, #emailInputCell .valid, #emailInputCell .valid:focus","border-color","chatSettings.generalStyles.formSuccessColor");css+=addStyle("#chatInputCell textarea.invalid, #emailInputCell .invalid:not(:focus)","border-color","chatSettings.generalStyles.formErrorColor");css+=addStyle(".message.errorBubble [class^=icon] ","color","chatSettings.generalStyles.formErrorColor");css+=addStyle("#inside_leaveMessageForm input:focus, #inside_leaveMessageForm textarea:focus","border-color","chatSettings.generalStyles.formBorderColor");css+=addStyle("#inside_leaveMessageForm input.beenFocused:invalid:not(:focus), #inside_leaveMessageForm textarea.beenFocused:invalid:not(:focus)","border-color","chatSettings.generalStyles.formErrorColor");css+=addStyle("#inside_leaveMessageForm input.beenFocused:valid:not(.invalid), #inside_leaveMessageForm textarea.beenFocused:valid:not(.invalid)","border-color","chatSettings.generalStyles.formSuccessColor");css+=addStyle("#inside_leaveMessageForm input.beenFocused.valid, #inside_leaveMessageForm textarea.beenFocused.valid","border-color","chatSettings.generalStyles.formSuccessColor");css+=addStyle("#inside_leaveMessageForm input.invalid:not(:focus), #inside_leaveMessageForm textarea.invalid:not(:focus), .customForm input.invalid:not(:focus):not([type='radio']):not([type='button']):not([type='range']), .popupForm input.invalid:not(:focus):not([type='radio']):not([type='button']):not([type='range'])","border-color","chatSettings.generalStyles.formErrorColor");css+=addStyle("#inside_prechatForm_form input:focus, #inside_prechatForm_form textarea:focus, #inside_prechatForm_form select:focus, #inside_prechatForm_form .custom-select:focus + select","border-color","chatSettings.generalStyles.formBorderColor");css+=addStyle("#inside_prechatForm_form input.beenFocused.valid, #inside_prechatForm_form textarea.beenFocused.valid","border-color","chatSettings.generalStyles.formSuccessColor");css+=addStyle("#inside_prechatForm_form input.invalid:not(:focus), #inside_prechatForm_form textarea.invalid:not(:focus)","border-color","chatSettings.generalStyles.formErrorColor");var borderAmt=0;if(typeof chatSettings.chatPane.headerBorder!="undefined"&&chatSettings.chatPane.headerBorder!=""){borderAmt=1}css+=addStyle("div#inside_prechatForm, .customForm","top","parseInt(chatSettings.chatPane.headerHeight) + "+parseInt(borderAmt),"px");css+="div#inside_prechatForm, .customForm { height: calc(100% - "+(parseInt(chatSettings.chatPane.headerHeight)+parseInt(borderAmt))+"px); }";if(chatSettings.generalStyles.inputBackground&&chatSettings.generalStyles.inputBackground.length>0){css+=addStyle("#insideWorkflowFieldCell .inside-field, #emailInput:focus:not(.valid)","background-color","getOpacityColor(chatSettings.generalStyles.formBorderColor, 0.1)");css+=addStyle("#insideWorkflowFieldCell .inside-field.valid, #chatInputCell textarea.valid, #emailInputCell .valid, #emailInputCell .valid:focus","background-color","getOpacityColor(chatSettings.generalStyles.formSuccessColor, 0.1)");css+=addStyle("#insideWorkflowFieldCell .inside-field.invalid, #chatInputCell textarea.invalid, #emailInputCell .invalid:not(:focus)","background-color","getOpacityColor(chatSettings.generalStyles.formErrorColor, 0.1)");css+=addStyle("#inside_leaveMessageForm input:focus, #inside_leaveMessageForm textarea:focus","background-color","getOpacityColor(chatSettings.generalStyles.formBorderColor, 0.1)");css+=addStyle("#inside_leaveMessageForm input.beenFocused:invalid:not(:focus), #inside_leaveMessageForm textarea.beenFocused:invalid:not(:focus)","background-color","getOpacityColor(chatSettings.generalStyles.formErrorColor, 0.1)");css+=addStyle("#inside_leaveMessageForm input.beenFocused:valid:not(.invalid), #inside_leaveMessageForm textarea.beenFocused:valid:not(.invalid)","background-color","getOpacityColor(chatSettings.generalStyles.formSuccessColor, 0.1)");css+=addStyle("#inside_leaveMessageForm input.beenFocused.valid, #inside_leaveMessageForm textarea.beenFocused.valid","background-color","getOpacityColor(chatSettings.generalStyles.formSuccessColor, 0.1)");css+=addStyle("#inside_leaveMessageForm input.invalid:not(:focus), #inside_leaveMessageForm textarea.invalid:not(:focus)","background-color","getOpacityColor(chatSettings.generalStyles.formErrorColor, 0.1)");css+=addStyle("#inside_prechatForm_form input:focus, #inside_prechatForm_form textarea:focus, #inside_prechatForm_form select:focus, #inside_prechatForm_form .custom-select:focus + select","background-color","getOpacityColor(chatSettings.generalStyles.formBorderColor, 0.1)");css+=addStyle("#inside_prechatForm_form input.beenFocused.valid, #inside_prechatForm_form textarea.beenFocused.valid","background-color","getOpacityColor(chatSettings.generalStyles.formSuccessColor, 0.1)");css+=addStyle("#inside_prechatForm_form input.invalid:not(:focus), #inside_prechatForm_form textarea.invalid:not(:focus)","background-color","getOpacityColor(chatSettings.generalStyles.formErrorColor, 0.1)")}css+=addStyle(".mediaicon","color","chatSettings.generalStyles.brandColor");css+=addStyle(".mediaicon","border-color","chatSettings.generalStyles.brandColor");css+=addStyle("#video_permissionForm h2, #video_permissionForm p","color","chatSettings.generalStyles.primaryTextColor");if(chatSettings.generalStyles.formSuccessColor){css+=addStyle("#video_permissionForm .mediaicon.ready:after","background-color","chatSettings.generalStyles.formSuccessColor")}css+=addStyle("div.schedulingFormContainer input[type='text'].invalid:not(:focus)","border-color","chatSettings.generalStyles.formErrorColor");css+=addStyle(".menuItem > span","color","chatSettings.chatPane.menu.iconColor");css+=addStyle(".menuItem label","color","chatSettings.chatPane.menu.textColor");css+=addStyle("#unreadMessageIndicator","background","chatSettings.chatPane.messages.unreadMessageIndicatorBg || chatSettings.generalStyles.brandColor");if(chatSettings.offline.useCustomOfflineHeader){css+=addStyle("#insideChatPane.offline #insideChatPaneHeader","background-color","chatSettings.offline.headerBg"," !important");css+=addStyle("#insideChatPane.offline #insideChatPaneHeader","color","chatSettings.offline.headerIconColor"," !important")}css+=addStyle(".inside_progressbar .bar","background-color","chatSettings.generalStyles.brandColor");css+=addStyle(".message.file.visitor .bubble a, .message.file.visitor .bubble .icon-attach-icon, .message.file.visitor .bubble [class^='icon'], .message.file.visitor .bubble .fileSize","color","chatSettings.generalStyles.secondaryTextColor");css+=addStyle(".message.file.visitor .bubble a, .message.file.visitor .bubble .icon-attach-icon, .message.file.visitor .bubble [class^='icon'], .message.file.visitor .bubble .fileSize","color","chatSettings.chatPane.messages.visitorTextColor");css+=addStyle(".message.file.operator .bubble a, .message.file.operator .bubble .icon-attach-icon, .message.file.operator .bubble [class^='icon'], .message.file.operator .bubble .fileSize","color","chatSettings.generalStyles.primaryTextColor");css+=addStyle(".message.file.operator .bubble a, .message.file.operator .bubble .icon-attach-icon, .message.file.operator .bubble [class^='icon'], .message.file.operator .bubble .fileSize","color","chatSettings.chatPane.messages.operatorTextColor");css+=addStyle(".message.operator .inside_chat_product a","color","chatSettings.generalStyles.primaryTextColor");css+=insideChatPane.addStyle("#startANewChatButton .picklistOption:hover","background-color","getOpacityColor(chatSettings.generalStyles.brandColor, 0.1)");var operatorBackground=insideChatPane.settings.chatSettings.chatPane.messages.operatorBackground;if(operatorBackground&&operatorBackground.length>0&&operatorBackground!="#ffffff"){css+=insideChatPane.addStyle("#startANewChatButton .picklistOption","background-color","'white'");css+=insideChatPane.addStyle("#startANewChatButton .picklistOption","border-color","chatSettings.generalStyles.brandColor");css+=insideChatPane.addStyle("#startANewChatButton .picklistOption:hover","background-color","getRgbFromHexCode(chatSettings.generalStyles.brandColor, 10)");css+=insideChatPane.addStyle("#startANewChatButton .picklistOption","color","chatSettings.generalStyles.brandColor")}if(chatSettings.chatPane.notifications.radius&&chatSettings.chatPane.notifications.radius!=""){css+=".chatNotifImage{ border-radius: "+chatSettings.chatPane.notifications.radius+"px 0px 0px "+chatSettings.chatPane.notifications.radius+"px }";css+="#chatNotifications.style2 .chatNotifContent { border-radius: "+chatSettings.chatPane.notifications.radius+"px;}"}if(chatSettings.chatPane.notifications.shadow==false){css+=".chatNotification {box-shadow: none}";css+="#chatNotifications.style2 .chatNotifContent {box-shadow: none}";css+="#chatNotifications.style2 .chatNotifImage {box-shadow: none}"}if(chatSettings.chatPane.notifications.showUnread==false){css+="#chatNotifications .chatNotifNumber { display: none !important;}";css+="#chatNotifications .chatNotifContent { padding-right: 16px;}"}if(chatSettings.chatPane.header.shadow==true){css+="div#insideChatPaneHeader {box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.1)}"}if(chatSettings.chatPane.messages.shadow==true){css+=".message.operator .bubble, .message.cards .card {box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1)}"}if(chatSettings.chatPane.messages.visitorShadow==true){css+=".message.visitor .bubble {box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1)}"}if(chatSettings.chatPane.messages.showOperatorName==false){css+=".message.operator .fromName { display: none !important }"}if(chatSettings.chatPane.messages.showOperatorImage==false){css+=".message .inside_assistMessageFace, .message .fromImage { display: none !important }"}if(chatSettings.chatPane.messages.showTimestamps==false){insideChatPaneContent.classList.add("timestampHidden")}else{insideChatPaneContent.classList.remove("timestampHidden")}if(chatSettings.generalStyles.hideInputBorder==true){css+="#insideWorkflowFieldCell .inside-field, #chatInput, #emailInput { border-color: transparent !important; }"}if(chatSettings.chatPane.notifications.textPadding){css+=".chatNotification .chatNotifContent { padding: 0px 36px 0px "+chatSettings.chatPane.notifications.textPadding+"px; }"}if(chatSettings.chatPane.notifications.style==2){document.getElementById("chatNotifications").classList.add("style2")}else{document.getElementById("chatNotifications").classList.remove("style2")}if(chatSettings.chatPane.showCloseButton==true){css+="#insideChatPane.activechat #insideChatPaneCloseButton {display:inline-flex}"}if(chatSettings.chatPane.notifications.text){css+=".sk-fading-circle .sk-circle:before {background-color: "+chatSettings.chatPane.notifications.text+"}"}if(isIE){css+=".message.fullWidth .messageContent, .message.forceFullWidth .messageContent, .message.workflowHelpBubble .content, .message.workflowWelcomeMessage .content { width: "+((chatSettings.chatPane.width||400)-80)+"px}";css+=".message.fullWidth .content {width: 100%;}";css+=".message .messageContent, .message .content, .message.workflowMessage .messageContent, .message.workflowMessage .content, .message.workflowHelpBubble .content, .message.workflowWelcomeMessage .content {white-space: normal}";css+=".message.forceFullWidth .messageContent, .message.forceFullWidth .content, .message.workflowHelpBubble .content, .message.workflowWelcomeMessage .content, .message.welcomeGreeting .content {white-space: pre-line; word-wrap: break-word}";css+=".message.workflowMessage .picklist.vertical .picklistOption, .message.workflowMessage .insideSelect { max-width: calc(100% - 40px)}";css+=".message.workflowMessage .workflowLinks  { max-width: calc(100% - 40px)}";css+=".message.workflowMessage .picklist.wrapping { display: block }";css+=".message.workflowMessage.fullWidth .bubble, .message.workflowLinkMessage .bubble { width: auto }";css+=".message.workflowMessage .picklistOptions {white-space: normal}";css+=".message.workflowMessage .picklist.vertical {display: block}"}if(device==2){css+=addStyle("#insideChatPane.minimised.headerShowing #insideChatPaneHeader","border-top","chatSettings.generalStyles.primaryTextColor","","1px solid ")}addStyleString(css,"insideChatPaneStyles");var fontCSS="";if(chatSettings.chatPane.fonts){for(var i in chatSettings.chatPane.fonts){if(chatSettings.chatPane.fonts[i].family){fontCSS=addCustomFont(i,chatSettings.chatPane.fonts[i],fontCSS)}else{fontCSS=applyFontStyling(fontCSS,i,chatSettings.chatPane.fonts[i])}}}addStyleString(fontCSS,"insideChatPaneFonts");chatPane.querySelector("#chatPaneMenuContent").classList.remove("largeFont");var menuItemFontSize=parseInt($(chatPane).find("#chatPaneMenuContent .menuItem label").css("font-size"));if(menuItemFontSize>26){chatPane.querySelector("#chatPaneMenuContent").classList.add("largeFont")}setSVGTabColour(chatSettings.chatTab.onlineColor);if(chatSettings.chatPane.showInsideBranding==false){document.querySelector("#chatPaneMenuFooter").style.display="none"}else{document.querySelector("#chatPaneMenuFooter").style.display=""}if(!preview&&chatSettings.customCSS){loadCSS(customImageUrl+chatSettings.customCSS+"?"+_insideScriptVersion,"customcss",function(){console.log("custom css loaded")})}setTabOffsetPosition()}function setRTLChatpane(){if(isRTL){try{document.getElementById("inside_holder").classList.add("rtl");document.getElementById("insideChatPane").classList.add("rtl");document.getElementsByTagName("html")[0].setAttribute("dir","rtl")}catch(exp){console.log(exp)}}}function setTabOffsetPosition(){if(preview){return}var tabSideOffset=chatSettings.chatTab.offset.side;if(device>=2){tabSideOffset=chatSettings.chatTab.mobileOffset.side}if(tabSideOffset!=""){try{var inside_tabs=topWindow.document.querySelector("#inside_tabs");$("#inside_tabs").stop();var tabPosition=chatSettings.chatTab.position;if(device>=2){tabPosition=chatSettings.chatTab.mobileTabPosition}if(tabPosition=="3"||tabPosition=="6"||tabPosition=="9"){inside_tabs.style.right=tabSideOffset+"px"}else{inside_tabs.style.right="";inside_tabs.style.left=tabSideOffset+"px"}}catch(e){}}var tabVerticalOffset=chatSettings.chatTab.offset.vertical;if(device>=2){tabVerticalOffset=chatSettings.chatTab.mobileOffset.vertical}if(tabVerticalOffset!=""){try{var inside_tabs=topWindow.document.querySelector("#inside_tabs");var bottomOrMiddle=["4","6","7","9"];if(bottomOrMiddle.indexOf(chatSettings.chatTab.position)!=-1){inside_tabs.style.marginTop=-parseInt(tabVerticalOffset)+"px"}else{inside_tabs.style.marginTop=tabVerticalOffset+"px"}}catch(e){}}}function setChatHeader(_pane){var offline=(getAvailableAssistants().length===0);var pane=_pane||document.getElementById("insideChatPane");if(chatSettings.chatPane.header.backgroundImage&&chatSettings.chatPane.header.backgroundImage!=""){header.style.backgroundImage="url('"+customImageUrl+chatSettings.chatPane.header.backgroundImage+"')";header.style.backgroundSize="100% 100%"}else{header.style.backgroundImage=""}if(chatSettings.chatPane.header.alignment=="left"){pane.querySelector("#insideChatPaneHeaderImageWrapper").style.textAlign="left";pane.querySelector("#insideChatPaneHeaderImageWrapper").style.paddingLeft="20px"}else{pane.querySelector("#insideChatPaneHeaderImageWrapper").style.textAlign="";pane.querySelector("#insideChatPaneHeaderImageWrapper").style.paddingLeft=""}if((offline===true||chatPane.classList.contains("offline"))&&!(insideFrontInterface.chatLinkVisitor&&insideFrontInterface.canBeAssignedToOtherChannel)){if(chatSettings.offline.headerText&&chatSettings.offline.headerText.length>0){pane.querySelector("#insideChatPaneHeaderImageWrapper").innerText=getLanguageValue(chatSettings.offline.headerText)}if(chatSettings.offline.useCustomOfflineHeader&&chatSettings.offline.header.style=="none"){pane.querySelector("#insideChatPaneHeaderImageWrapper").innerText=""}else{if(chatSettings.offline.useCustomOfflineHeader&&chatSettings.offline.header.style=="image"&&getLanguageValue(chatSettings.offline.header.logo)!=""){pane.querySelector("#insideChatPaneHeaderImageWrapper").innerHTML="<span class='imageAlignHelper'></span><img src='"+customImageUrl+getLanguageValue(chatSettings.offline.header.logo)+"' />"}else{pane.querySelector("#insideChatPaneHeaderImageWrapper").innerText=translate("Chat Offline");if(chatSettings.offline.header.text){var str=getLanguageValue(chatSettings.offline.header.text);if(str!=""){pane.querySelector("#insideChatPaneHeaderImageWrapper").innerText=getLanguageValue(chatSettings.offline.header.text)}}}}if((chatSettings.offline.useCustomOfflineHeader&&chatSettings.offline.header.alignment=="left")||(!chatSettings.offline.useCustomOfflineHeader&&chatSettings.chatPane.header.alignment=="left")){if(isRTL){pane.querySelector("#insideChatPaneHeaderImageWrapper").style.textAlign="right";pane.querySelector("#insideChatPaneHeaderImageWrapper").style.paddingRight="20px"}else{pane.querySelector("#insideChatPaneHeaderImageWrapper").style.textAlign="left";pane.querySelector("#insideChatPaneHeaderImageWrapper").style.paddingLeft="20px"}}else{pane.querySelector("#insideChatPaneHeaderImageWrapper").style.textAlign="";pane.querySelector("#insideChatPaneHeaderImageWrapper").style.paddingLeft=""}if(chatSettings.offline.useCustomOfflineHeader&&chatSettings.offline.header.backgroundImage&&chatSettings.offline.header.backgroundImage!=""){header.style.backgroundImage="url("+customImageUrl+chatSettings.offline.header.backgroundImage+")";header.style.backgroundSize="100% 100%"}else{header.style.backgroundImage=""}}else{if(chatSettings.chatPane.header.style=="none"){pane.querySelector("#insideChatPaneHeaderImageWrapper").innerText=""}else{if(chatSettings.chatPane.header.style=="image"&&getLanguageValue(chatSettings.chatPane.header.logo)!=""){pane.querySelector("#insideChatPaneHeaderImageWrapper").innerHTML="<span class='imageAlignHelper'></span><img src='"+customImageUrl+getLanguageValue(chatSettings.chatPane.header.logo)+"' />"}else{pane.querySelector("#insideChatPaneHeaderImageWrapper").innerText=translate("Chat Now");if(chatSettings.chatPane.header.text){var str=getLanguageValue(chatSettings.chatPane.header.text);if(str!=""){pane.querySelector("#insideChatPaneHeaderImageWrapper").innerText=getLanguageValue(chatSettings.chatPane.header.text)}_frame.setAttribute("title",str)}else{_frame.setAttribute("title","Chat Now")}}}if(chatSettings.chatPane.header.alignment=="left"){if(isRTL){pane.querySelector("#insideChatPaneHeaderImageWrapper").style.textAlign="right";pane.querySelector("#insideChatPaneHeaderImageWrapper").style.paddingRight="20px"}else{pane.querySelector("#insideChatPaneHeaderImageWrapper").style.textAlign="left";pane.querySelector("#insideChatPaneHeaderImageWrapper").style.paddingLeft="20px"}}else{pane.querySelector("#insideChatPaneHeaderImageWrapper").style.textAlign=""}}}function setMessages(){setLabel(chatSettings.chatPane.emailButtonLabel,"#emailTranscriptItem label",{parentNodeTitle:true});setLabel(chatSettings.chatPane.printButtonLabel,"#printTranscriptItem label",{parentNodeTitle:true});setLabel(chatSettings.chatPane.attachButtonLabel,"#attachFileItem label",{parentNodeTitle:true});setLabel(chatSettings.chatPane.callmeButtonLabel,"#clickToCallItem label",{parentNodeTitle:true});setLabel(chatSettings.chatPane.joinTheCallLabel,"#joinTheCallItem label",{parentNodeTitle:true});setLabel(chatSettings.chatPane.chatToHumanLabel,"#chatToHuman label",{parentNodeTitle:true});setLabel((chatSettings.chatPane.leaveAMessageLabel||insideWorkflows.settings.leaveAMessageLabel||translate("Leave a Message")),"#leaveAMessageItem label",{parentNodeTitle:true});setLabel(chatSettings.chatPane.sendButtonLabel,"#chatSendButton",{setText:false})}function setLabel(val,selector,options){try{var str=getLanguageValue(val);var el=document.querySelector(selector);if(str!=""){if(typeof el.defaultValue!="string"){el.defaultValue=el.innerText}if(options.setText!=false){el.innerText=str}var titleNode=el;if(options.parentNodeTitle==true){titleNode=el.parentNode}titleNode.setAttribute("title",str);titleNode.setAttribute("aria-label",str)}else{if(typeof el.defaultValue=="string"){el.innerText=el.defaultValue}}}catch(e){}}this.setFrameHeight=setFrameHeight;function setFrameHeight(_force){if(preview){if(chatSettings.chatPane.height&&chatSettings.chatPane.height!=""){_frame.style.height=chatSettings.chatPane.height+"px"}else{_frame.style.height="550px"}if(chatPane.classList.contains("video")&&chatPane.classList.contains("desktopVideo")){if(chatSettings.chatPane.width){_frame.style.width=chatSettings.chatPane.width*2+"px"}else{_frame.style.width="800px"}}else{if(chatSettings.chatPane.width){_frame.style.width=chatSettings.chatPane.width+"px"}else{_frame.style.width="400px"}}return}var force=false;if(typeof _force!="undefined"&&_force==true){force=true}var viewport=_insideGraph.jQuery.inside.front.getViewPortSize();if(device==2&&!preview){_frame.style.width=viewport.width+"px"}if(!chatPaneOpen){return}if(iOSMobile&&keyboardOpen&&keyboardOpenSet&&force!=true){return}keyboardOpenSet=true;if(device==2&&!preview){if(iOSMobile&&document.activeElement.tagName=="INPUT"&&document.activeElement.getAttribute("type")=="email"){document.getElementById("insideChatPaneInputFooter").style.paddingBottom="50px"}else{document.getElementById("insideChatPaneInputFooter").style.paddingBottom=""}_frame.style.height=viewport.height+"px";_frame.style.width=viewport.width+"px"}else{if(!menuOpen&&document.querySelector("#inside_prechatForm")==null&&document.querySelector("#inside_leaveMessageForm")==null&&chatSettings.chatPane.dynamicHeight&&(availableAssistants.length>0||activeChat||visitorHasChatted||displayingPreviousSessionChat)){var scrollPos=$(insideChatPaneContent).scrollTop();chatPane.classList.add("dynamicheight");insideChatPaneContent.style.flex="none";var h=insideChatPaneContent.scrollHeight;insideChatPaneContent.style.flex="1 1 auto";h+=header.clientHeight;h+=footer.clientHeight;if(h>chatSettings.chatPane.height&&chatSettings.chatPane.height!=""){h=chatSettings.chatPane.height}if(h<220){h=220}var scheduling=document.getElementById("insideSchedulingContainer");if(scheduling){var sHeight=scheduling.clientHeight;if(sHeight>h){h=sHeight+100}}_frame.style.height=h+"px";$(insideChatPaneContent).scrollTop(scrollPos)}else{if(chatSettings.chatPane.height){_frame.style.height=chatSettings.chatPane.height+"px"}else{_frame.style.height="550px"}}var formShowing=document.querySelectorAll("#inside_prechatForm, #inside_leaveMessageForm, .surveyQuestionContainer.opened");if(formShowing.length>0&&chatSettings.chatPane.dynamicHeight&&!$.inside.videoChat){var form=formShowing[0];var formHeight=form.scrollHeight;formHeight+=header.clientHeight;formHeight+=footer.clientHeight;if(formHeight>chatSettings.chatPane.height&&chatSettings.chatPane.height!=""){formHeight=chatSettings.chatPane.height+20}if(formHeight<220){formHeight=220}if(formHeight>h){h=formHeight;_frame.style.height=h+"px";$(insideChatPaneContent).scrollTop(scrollPos)}}if(document.querySelector(".c2cContainer.opened")){var c2cHeight=document.querySelector(".c2cContainer.opened").getBoundingClientRect().height+36;if(h<c2cHeight+header.clientHeight){h=c2cHeight+header.clientHeight}_frame.style.height=h+"px"}if(document.getElementById("schedulingFrame")!=null){if(parseInt(_frame.style.height)<550){_frame.style.height="550px"}}if(chatSettings.chatPane.verticalOffset&&device!=2){_frame.style.maxHeight="calc(100vh - "+parseInt(chatSettings.chatPane.verticalOffset)+"px)"}}setFramePosition();clearTimeout(iosSetFrameHeightTimeout);if(!iosChrome&&iOSMobile&&iOSVersion<=9){chatInput.scrollIntoView();iosSetFrameHeightTimeout=setTimeout(function(){chatInput.scrollIntoView();$(topWindow).scrollTop($(topWindow).height());chatPaneContent.scrollTop=chatPaneContent.scrollHeight},500);$(topWindow).scrollTop($(topWindow).height())}else{if(device==2&&viewport&&viewport.height<screen.height-299){$(topWindow).scrollTop(0);iosSetFrameHeightTimeout=setTimeout(function(){$(topWindow).scrollTop(0)},500)}else{if(iOSMobile&&document.activeElement.tagName=="INPUT"){$(topWindow).scrollTop($(topWindow).height())}}}if(isIE){ieRenderFix();$(insideChatPaneContent).scrollTop(scrollPos)}if(device==2){insideFrontInterface.setMetaViewport()}}this.toggleMinisedIcon=toggleMinisedIcon;function toggleMinisedIcon(opened){iconset=chatSettings.chatPane.iconset;if(opened){if(chatSettings.chatPane.useCloseForMinimize==true&&chatSettings.chatPane.showCloseButton!=true){setIcons({insideChatPaneMinimiseButton:["chatSettings.chatPane.customIcons.close","chatSettings.chatPane.closeDefaultIcon","icon-close"]})}else{setIcons({insideChatPaneMinimiseButton:["chatSettings.chatPane.customIcons.minimize","chatSettings.chatPane.minimizeDefaultIcon","icon-minimize"]})}}else{setIcons({insideChatPaneMinimiseButton:["chatSettings.chatPane.customIcons.expand","chatSettings.chatPane.expandChatDefaultIcon","icon-expand"]})}}function setIcons(dic){iconset=chatSettings.chatPane.iconset;if(typeof(dic)=="undefined"){dic={insideChatPaneCloseButton:["chatSettings.chatPane.customIcons.close","chatSettings.chatPane.closeDefaultIcon","icon-close"],chatMenuCloseIcon:["chatSettings.chatPane.customIcons.close","chatSettings.chatPane.closeDefaultIcon","icon-close"],emailTranscriptItem:["chatSettings.chatPane.customIcons.emailTranscript","chatSettings.chatPane.emailTranscriptDefaultIcon","icon-email"],printTranscriptItem:["chatSettings.chatPane.customIcons.printTranscript","chatSettings.chatPane.printTranscriptDefaultIcon","icon-print"],attachFileItem:["chatSettings.chatPane.customIcons.attachment","chatSettings.chatPane.attachFileDefaultIcon","icon-attachment"],joinTheCallItem:["chatSettings.chatPane.customIcons.joinTheCall","chatSettings.chatPane.joinTheCallDefaultIcon","icon-join-the-call"],callMeItem:["chatSettings.chatPane.customIcons.callMe","chatSettings.chatPane.callMeDefaultIcon","icon-call-me"],chatToHuman:["chatSettings.chatPane.customIcons.talkToHuman","chatSettings.chatPane.talkToHumanDefaultIcon","icon-chat-to-human"],chatMenuIcon:["chatSettings.chatPane.customIcons.menu","chatSettings.chatPane.menuDefaultIcon","icon-menu"],attachButton:["chatSettings.chatPane.customIcons.attachment","chatSettings.chatPane.attachmentDefaultIcon","icon-attachment"],chatSendButton:["chatSettings.chatPane.customIcons.send","chatSettings.chatPane.sendDefaultIcon","icon-send"],endChatItem:["chatSettings.chatPane.customIcons.menuEndChat","chatSettings.chatPane.menuEndChatDefaultIcon","icon-end-chat"],leaveAMessageItem:["chatSettings.chatPane.customIcons.menuLeaveAMessage","chatSettings.chatPane.menuLeaveAMessageDefaultIcon","icon-leave-message"],requestVideoChat:["chatSettings.chatPane.customIcons.video",null,"icon-video-request"]}}if(device>1){dic.attachButton=["chatSettings.chatPane.customIcons.camera","chatSettings.chatPane.attachmentDefaultIcon","icon-camera"];dic.attachFileItem=["chatSettings.chatPane.customIcons.camera","chatSettings.chatPane.attachFileDefaultIcon","icon-camera"]}for(var iconContainerId in dic){try{var customIconVal=eval(dic[iconContainerId][0]);var defaultIconVal=eval(dic[iconContainerId][1]);var iconContainer=document.getElementById(iconContainerId);if(!iconContainer){continue}iconContainer.classList.remove("customIcon");$(iconContainer).find("img, span, svg").remove();$(iconContainer).css("background","");if(typeof(customIconVal)=="string"&&customIconVal.trim().length>0){iconContainer.classList.add("customIcon");if((isIE||isFirefox)&&$(iconContainer).hasClass("insideChatPaneHeaderButton")){$(iconContainer).css("background",'url("'+customImageUrl+customIconVal+'")');iconContainer.classList.add("customIconIE")}else{var imgUrl=customImageUrl+customIconVal;$(iconContainer).prepend("<img  src='"+imgUrl+"' alt='icon' />")}replaceSVGIcons(iconContainer)}else{if(typeof(defaultIconVal)=="string"&&defaultIconVal.trim().length>0){iconContainer.classList.add("customIcon");$(iconContainer).prepend("<span class='"+defaultIconVal+"'></span>")}else{$(iconContainer).prepend("<span class='"+dic[iconContainerId][2]+"'></span>")}}}catch(e){console.log("Error - "+e)}}for(var iconContainerId in dic){var iconContainer=document.getElementById(iconContainerId);if(!iconContainer){continue}var icon=iconContainer.querySelector("span");if(!icon){continue}for(var i=0;i<icon.classList.length;i++){if(icon.classList[i].indexOf("icon-")==0){icon.classList.remove(icon.classList[i]);icon.classList.add(dic[iconContainerId][2]+"-"+iconset)}}}}function setCustomIcons(message){var icons=["attachment","movie","download"];for(var i=0;i<icons.length;i++){var iconName=icons[i];if(chatSettings.chatPane.customIcons[iconName]&&chatSettings.chatPane.customIcons[iconName]!=""){$(message).find('[class*="icon-'+iconName+'"]').replaceWith('<img class="icon-'+iconName+'" alt="" aria-role="presentation" src="'+_insideCDN+"custom/"+chatSettings.chatPane.customIcons[iconName]+'">');replaceSVGIcons(message)}}}function replaceSVGIcons(selector){$(selector).find("img").filter(function(){return $(this).attr("src").toLowerCase().indexOf(".svg")>-1}).each(function(){var $img=$(this);var imgID=$img.attr("id");var imgClass=$img.attr("class");var imgURL=$img.attr("src");var fileName=imgURL.split("custom/")[1];$.get((preview?_insideLive:_insideSocialUrl)+"/api/websites/GetSvgContent?filename="+encodeURIComponent(fileName),function(svgContent){var $svg=$(svgContent);if(typeof imgID!=="undefined"){$svg=$svg.attr("id",imgID)}if(typeof imgClass!=="undefined"){$svg=$svg.attr("class",imgClass+" replaced-svg")}$svg=$svg.removeAttr("xmlns:a");$img.replaceWith($svg)})})}function setMenuItems(){var items=document.querySelectorAll(".menuItem");for(var i=0;i<items.length;i++){if(items[i].id=="endChatItem"){continue}items[i].style.display="none"}if(chatSettings.chatPane.menu){if(chatSettings.chatPane.menu.showPrint!=true||device==2&&chatSettings.chatPane.menu.disablePrintForMobile==true){if(!preview){removeElements("#printTranscriptItem")}else{document.getElementById("printTranscriptItem").display="none"}}if(chatSettings.chatPane.menu.showEmail!=true||device==2&&chatSettings.chatPane.menu.disableEmailForMobile==true){if(!preview){removeElements("#emailTranscriptItem")}else{document.getElementById("emailTranscriptItem").display="none"}}if(chatSettings.chatPane.menu.showAttachments==true&&settings.attachmentEnabled==true){document.getElementById("attachFileItem").style.display=""}else{if(!preview){removeElements("#attachButton")}else{document.getElementById("attachButton").style.display="none"}}if(chatSettings.chatPane.menu.showChatToHuman&&typeof(insideWorkflows)!="undefined"&&insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isActive&&insideWorkflows.currentWorkflow.isBot){document.getElementById("chatToHuman").style.display=""}if(!!insideFrontInterface.chat.canJoinTheCall){document.getElementById("joinTheCallItem").style.display=""}else{document.getElementById("joinTheCallItem").style.display="none"}if(insideFrontInterface.chat.clickToCallSettings){document.getElementById("clickToCallItem").style.display=""}else{document.getElementById("clickToCallItem").style.display="none"}if(typeof customInsideForms!="undefined"&&customInsideForms.allowVideoChatRequest&&availableAssistants.length>0){var showRequestVideo=false;for(var i=0;i<availableAssistants.length;i++){if(availableAssistants[i].id.indexOf("ch:")==0){var channelId=parseInt(availableAssistants[i].id.substring(3));if(customInsideForms.allowVideoChatRequest.indexOf(channelId)>=0){showRequestVideo=true;break}}}if(showRequestVideo){document.getElementById("requestVideoChat").style.display=""}}}if(activeChat||visitorHasChatted||displayingPreviousSessionChat){if(chatSettings.chatPane.menu.showEmail){if(document.getElementById("emailTranscriptItem")){document.getElementById("emailTranscriptItem").style.display="inline-block"}}if(chatSettings.chatPane.menu.showPrint){if(document.getElementById("printTranscriptItem")){document.getElementById("printTranscriptItem").style.display="inline-block"}}}if(availableAssistants.length===0||isWorkflowActive()){document.getElementById("attachFileItem").style.display="none"}if(insideWorkflows){insideWorkflows.showHideChatToHumanMenuButton()}if(preview&&chatSettings.chatPane.menu&&chatSettings.chatPane.menu.showChatToHuman){document.getElementById("chatToHuman").style.display=""}if(chatSettings.chatPane.menu.showLeaveAMessage===true&&(preview||(availableAssistants.length===0&&insideWorkflows&&insideWorkflows.settings&&insideWorkflows.settings.settingNoOpWorkflowId&&insideWorkflows.settings.settingNoOpWorkflowId!=="0"))){document.getElementById("leaveAMessageItem").style.display="inline-block"}else{document.getElementById("leaveAMessageItem").style.display="none"}setSendButton();setChatMenuButtonVisibility();if(menuOpen){refreshMenuHeight()}}function setFocusToMenu(){chatPane.querySelector("#chatPaneMenuContent").focus()}function refreshMenuHeight(){var menu=chatPane.querySelector("#chatPaneMenu");menu.classList.remove("transition");var prevH=menu.style.height;menu.style.height="auto";var h=menu.getBoundingClientRect().height;menu.style.height=prevH;menu.classList.add("transition");setTimeout(function(){menu.style.height=h+"px"},0)}function isWorkflowActive(){return typeof insideWorkflows!="undefined"&&insideWorkflows&&insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isActive}this.setSendButton=setSendButton;function setSendButton(){if(!chatFrameCreated){initChatPane()}if($(document.body).find("#insideWorkflowFieldCell:visible").length>0&&(insideWorkflows&&insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isActive&&!insideWorkflows.currentWorkflow.paused)){return}if($(document.body).find("#emailInputCell").is(":visible")||$(document.body).find("#chatInputCell").hasClass("insideEmailInput")){return}if(isWorkflowActive()&&chatInputCell.style.display=="none"){return}if(chatInput.value==""){setTimeout(function(){if(settings.attachmentEnabled==false||chatSettings.chatPane.menu.showAttachments==false||($(document.body).find("#insideWorkflowFieldCell:visible").length>0&&isWorkflowActive())){if(attachButton){attachButton.style.display="none"}}else{if($(document.body).find("#chatInputCell").is(":visible")){if(attachButton){attachButton.style.display="block"}}}},100);sendButton.style.display="none";chatInput.classList.add("empty")}else{if(attachButton){attachButton.style.display="none"}sendButton.classList.remove("disabled");sendButton.style.display="block";chatInput.classList.remove("empty")}}function setShadowAndBorder(){var enabled=device!=2&&!_frame.classList.contains("notificationMode");_frame.style.boxShadow=enabled&&chatSettings.chatPane.shadow?defaultBoxShadow:"none";_frame.style.border=enabled&&chatSettings.chatPane.border?"1px solid "+chatSettings.chatPane.border:"none"}this.addStyleString=addStyleString;function addStyleString(str,id){var head=document.head;if(typeof(id)!="undefined"&&head.querySelector("style#"+id)){$(head).find("style#"+id).remove()}var styleNode=$("<style>"+str+"</style>").appendTo(head);if(typeof(id)!="undefined"){styleNode.attr("id",id)}}function headerClick(){if(!chatPaneOpen){openChatPane()}}var menuOpen=false;function menuButtonClick(){if($(document.body).find("#emailInputCell").is(":visible")){clearEmailInputField();return}menuOpen=!menuOpen;if(menuOpen){if(device==2&&keyboardOpen){setTimeout(openMenu,500)}else{openMenu()}}else{closeMenu()}}this.scaleMenu=scaleMenu;function scaleMenu(){var menu=chatPane.querySelector("#chatPaneMenu");var currentH=menu.style.height;menu.classList.remove("transition");menu.style.height="auto";var h=menu.getBoundingClientRect().height;document.getElementById("menu_notifications").style.minHeight=chatPane.querySelector("#chatPaneMenu").getBoundingClientRect().height+"px";var h2=document.getElementById("menu_notifications").getBoundingClientRect().height;h=Math.max(h,h2);menu.style.height=currentH;menu.classList.add("transition");setFocusToMenu();setTimeout(function(){menu.style.height=h+"px"},100)}this.openMenu=openMenu;function openMenu(dontChangeIcon){if(insideWorkflows){insideWorkflows.showHideChatToHumanMenuButton()}insideChatPane.removeNotification("endchat");setMenuItems();var menu=chatPane.querySelector("#chatPaneMenu");menu.style.display="block";menu.classList.remove("transition");menu.style.height="auto";var h=menu.getBoundingClientRect().height;var h2=document.getElementById("menu_notifications").getBoundingClientRect().height+60;h=Math.max(h,h2);menu.style.height="0px";menu.classList.add("transition");setTimeout(function(){menu.style.height=h+"px"},0);chatPane.querySelector("#chatMenuIcon").classList.add("transitionHidden");chatPane.querySelector("#chatMenuCloseIcon").classList.remove("transitionHidden");chatPane.classList.add("menuOpen");menuOpen=true;setFocusToMenu();if(device==2){chatInput.style.pointerEvents="none"}setTimeout(function(){insideChatPane.scrollToBottom()},500);if(parseInt(_frame.style.height)<410){_frame.style.height="410px";_frame.style.top=getypos()+"px"}if(chatInProgress&&activeChat){if(insideChatPane.settings.onlyAllowOperatorToEndChat!=true||(insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isBot)){document.getElementById("endChatItem").style.display=""}else{document.getElementById("endChatItem").style.display="none"}}if(isIE){setTimeout(function(){document.querySelector("#insideChatFooterTable").style.margin="0px";setTimeout(function(){document.querySelector("#insideChatFooterTable").style.margin="-2px";insideChatPane.scrollToBottom()},0)},500)}}this.closeMenu=closeMenu;function closeMenu(time,dontChangeIcon){document.getElementById("menu_notifications").innerHTML="";var menu=chatPane.querySelector("#chatPaneMenu");if(time==0){menu.style.transition="none";menu.style.display="none"}else{menu.style.transition=""}if(dontChangeIcon!=true){chatPane.querySelector("#chatMenuIcon").classList.remove("transitionHidden");chatPane.querySelector("#chatMenuCloseIcon").classList.add("transitionHidden")}chatPane.classList.remove("menuOpen");menu.style.height="0px";menuOpen=false;keyboardOpenSet=false;chatInput.style.pointerEvents="";if(time!=0){setFrameHeight()}setTimeout(function(){menu.style.display="none"},500);if(isIE){setTimeout(function(){chatPaneContent.scrollTop=chatPaneContent.scrollHeight},0)}setTimeout(function(){insideChatPane.scrollToBottom()},500);setChatMenuButtonVisibility();if(device==1&&chatPaneOpen&&$(topWindow.document.activeElement).is("input")==false){chatInput.focus()}}this.showLeaveMessageForm=showLeaveMessageForm;function showLeaveMessageForm(force,method,langCode){if(chatInProgress){return}if(typeof customInsideForms=="undefined"&&typeof topWindow.customInsideForms!="undefined"){customInsideForms=topWindow.customInsideForms}if(typeof customInsideForms!="undefined"&&typeof customInsideForms.offlineForm=="function"&&!customInsideForms.offlineForm.added){console.log("Showing custom offline form");removeElements("#inside_leaveMessageForm, .custom_offline");customInsideForms.offlineForm.added=true;var customFormHolder=document.createElement("div");customFormHolder.className="customForm custom_offline";chatPane.appendChild(customFormHolder);customInsideForms.offlineForm(customFormHolder,$);return}if(typeof insideFrontInterface.showLeaveMessageForm=="function"){insideFrontInterface.showLeaveMessageForm(method,langCode);return}if(typeof insideForms=="undefined"){loadJS(_insideCDN+"/js/inside.front.forms.js?v="+_insideScriptVersion,"typeof insideForms != 'undefined'",function(){showLeaveMessageForm(force,method,langCode)});return}if(typeof insideOfflineForm=="undefined"){loadJS(_insideCDN+"/js/inside.front.offlineform.js?v="+_insideScriptVersion,"typeof insideOfflineForm != 'undefined'",function(){showLeaveMessageForm(force,method,langCode)});return}if(!force&&chatPane.classList.contains("offline")&&!preview){return}hideLeaveMessageForm();insideOfflineForm.init(_this,jQuery);insideOfflineForm.show(method,langCode);var headerHeight=header.getBoundingClientRect().height;document.querySelector("#inside_leaveMessageForm").style.top=headerHeight+"px";document.querySelector("#inside_leaveMessageForm").style.height="calc(100% - "+headerHeight+"px)";chatPane.classList.add("offline")}this.hideLeaveMessageForm=hideLeaveMessageForm;function hideLeaveMessageForm(){removeElements("#inside_leaveMessageForm, .custom_offline");chatPane.classList.remove("offline")}this.isOpen=isOpen;function isOpen(){return chatPaneOpen}function setMessageDeliveryStatus(){if(preview){return}if(!chatPaneOpen){return}if(messagesList&&messagesList.length>0){var messageIds=[];for(var i=0;i<messagesList.length;i++){if(messagesList[i].chatid==currentChatId&&messagesList[i].fromid.indexOf("assistant")==0&&messagesList[i].deliverystatus!=3){messageIds.push(messagesList[i].id);messagesList[i].deliverystatus=3}}if(messageIds.length>0){$.inside.sendCall("updateDeliveryStatus",[messageIds,currentChatId,3,""])}}}var wasVisible;var mobileScrollPosBeforeChatOpened=0;function hideParentBody(){mobileScrollPosBeforeChatOpened=$(topWindow).scrollTop();if($(topWindow.document).find("#inside_cobrowse").length>0){wasVisible=$(topWindow.document).find("#inside_cobrowse").hide()}else{wasVisible=$("body > *:visible:not('#inside_holder')");wasVisible.hide()}}function showParentBody(){if(wasVisible){wasVisible.show();setTimeout(function(){$(topWindow).scrollTop(mobileScrollPosBeforeChatOpened)},0)}wasVisible=null}this.open=openChatPane;function openChatPane(force,workflow,survey){if(chatPaneOpen||isBlocked){return}if(!chatFrameCreated){initChatPane()}availableAssistants=getAvailableAssistants();if(availableAssistants.length===0&&chatSettings.offline.enabled===false&&!activeChat&&!visitorHasChatted&&force!==true){return false}removeChatNotifications();chatPaneOpen=true;topInsideHolder.classList.remove("chatPaneMinimised");chatPane.classList.remove("minimised");toggleMinisedIcon(true);chatPane.classList.remove("closed");var abortWorkflow=false;var workflowInProgressId=0;if(!chatInProgress&&typeof(insideWorkflows)!="undefined"&&insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isActive){workflowInProgressId=insideWorkflows.currentWorkflow.workflowId;workflow=true;if(insideWorkflows.currentWorkflow.isPrechatWorkflow&&getAvailableAssistants().length===0){$(document.body).find("#inside_holder #insideChatPane .message.workflowMessage[wfid="+insideWorkflows.currentWorkflow.workflowId+"][stepid="+insideWorkflows.currentWorkflow.workflowStepId+"]").remove();insideWorkflows.abort();workflow=false;abortWorkflow=true}else{if(insideWorkflows.currentWorkflow.isOfflineWorkflow&&getAvailableAssistants().length>0){$(document.body).find("#inside_holder #insideChatPane .message.workflowMessage[wfid="+insideWorkflows.currentWorkflow.workflowId+"][stepid="+insideWorkflows.currentWorkflow.workflowStepId+"]").remove();insideWorkflows.abort();workflow=false;abortWorkflow=true}else{try{var offlineWorkflowId=_insideGraph.getCookie("inside-owfid");if(offlineWorkflowId==insideWorkflows.currentWorkflow.workflowId&&insideWorkflows.currentWorkflow.workflowId!=settings.chatSettings.offline.workflow){_insideGraph.deleteCookie("inside-owfid");workflow=false;abortWorkflow=true;$(document.body).find("#inside_holder #insideChatPane .message.workflowMessage[wfid="+insideWorkflows.currentWorkflow.workflowId+"][stepid="+insideWorkflows.currentWorkflow.workflowStepId+"]").remove()}else{var prechatWorkflowId=_insideGraph.getCookie("inside-pcwfid");if(prechatWorkflowId==insideWorkflows.currentWorkflow.workflowId&&insideWorkflows.currentWorkflow.workflowId!=settings.chatSettings.chatPane.preChatWorkflow){_insideGraph.deleteCookie("inside-pcwfid");workflow=false;abortWorkflow=true;$(document.body).find("#inside_holder #insideChatPane .message.workflowMessage[wfid="+insideWorkflows.currentWorkflow.workflowId+"][stepid="+insideWorkflows.currentWorkflow.workflowStepId+"]").remove()}}}catch(exp){}}}}var isNewWorkflowStarted=false;if(!preview&&!workflow){if(getAvailableAssistants().length>0){if(document.querySelector("#inside_leaveMessageForm")){var leaveForm=document.querySelector("#inside_leaveMessageForm");leaveForm.parentNode.removeChild(leaveForm)}if(!chatInProgress&&!survey){if(!document.getElementById("inside_prechatForm")){isNewWorkflowStarted=topWindow.insidePreChatForm.check(abortWorkflow,null,null,function(){if(settings.restrictPrintConversation==true||insideChatPane.settings.showPreviousChatSessionWithin!="currentsession"){$(document.body).find(".message:not(.welcomeGreeting)").remove()}})}}else{removeElements("#inside_prechatForm, .custom_prechat");chatPane.classList.remove("prechat")}}else{if(!insideFrontInterface.canBeAssignedToOtherChannel){if(insideFrontInterface.virtualassistant_enabled&&settings.chatSettings.offline&&settings.chatSettings.offline.enabled&&settings.chatSettings.offline.workflow&&settings.chatSettings.offline.method=="workflow"){if(!chatInProgress&&typeof(insideWorkflows)!="undefined"&&(!insideWorkflows.currentWorkflow||!insideWorkflows.currentWorkflow.isActive||(!insideWorkflows.currentWorkflow.isOfflineWorkflow&&!insideWorkflows.currentWorkflow.isLeaveMessageWorkflow))){if(insideChatPane.settings.showPreviousChatSessionWithin!="currentsession"){$(document.body).find(".message:not(.welcomeGreeting)").remove()}insideAPI.post("api/workflow/StartWorkflow",{workflowId:settings.chatSettings.offline.workflow,force:abortWorkflow},function(response){},showServerError);if(abortWorkflow){insideWorkflows.showWelcomeMessage()}isNewWorkflowStarted=true;chatEndedByCustomer=false;hideInputFooter()}}else{if((settings.chatSettings.offline.method=="form"||settings.chatSettings.offline.method=="message")&&!chatPane.querySelector("#inside_leaveMessageForm")&&!displayingPreviousSessionChat&&chatSettings.offline.enabled==true){if(!document.getElementById("inside_leaveMessageForm")&&!visitorHasChatted){showLeaveMessageForm()}removeElements(".startANewChatButton")}}}}}if(isNewWorkflowStarted){removeElements(".startANewChatButton")}if(!preview&&!isNewWorkflowStarted){showWelcomeMessage()}if(abortWorkflow&&!isNewWorkflowStarted&&workflowInProgressId>0){insideWorkflows.cancelWorkflowFromServer(workflowInProgressId)}if(!preview&&(!insideChatPane.settings.preChat||!insideChatPane.settings.preChat.enabled||(insideChatPane.settings.preChat.prechatSurveyExpiry!="chatend"))){loadPreviousChat()}setChatPaneState();setFrameHeight();setInputAvailability();_frame.style.display="block";if(chatSettings.chatPane.position=="top"){chatSettings.chatPane.position="3"}else{if(chatSettings.chatPane.position=="middle"){chatSettings.chatPane.position="6"}else{if(chatSettings.chatPane.position=="bottom"){chatSettings.chatPane.position="9"}}}_frame.classList.add("notransition");if(chatSettings.chatPane.position=="bottom"||chatSettings.chatPane.position=="7"||chatSettings.chatPane.position=="9"||showHeaderForTab){_frame.style.webkitTransform="translateY(100%)";_frame.style.transform="translateY(100%)"}else{if(chatSettings.chatPane.position=="3"||chatSettings.chatPane.position=="6"){_frame.style.webkitTransform="translateX(100%)";_frame.style.transform="translateX(100%)"}else{if(chatSettings.chatPane.position=="1"||chatSettings.chatPane.position=="4"){_frame.style.webkitTransform="translateX(-100%)";_frame.style.transform="translateX(-100%)"}}}setTimeout(function(){_frame.classList.remove("notransition");if(chatSettings.chatPane.position=="bottom"||chatSettings.chatPane.position=="7"||chatSettings.chatPane.position=="9"){_frame.style.webkitTransform="translateY(0%)";_frame.style.transform="translateY(0%)"}else{_frame.style.webkitTransform="translateX(0%)";_frame.style.transform="translateX(0%)"}setFrameHeight()},0);try{insideChatPane.hideTabs()}catch(e){}if(device==2){hideParentBody();if(chatSettings.chatPane.disableHashOnMobile!=true){if(topWindow.document.location.hash==""){topWindow.document.location.hash="insidechat"}else{if(topWindow.document.location.hash.indexOf("insidechat")==-1){topWindow.document.location.hash+="/insidechat"}}}}try{if(!workflow){if(typeof(_insideGraph)!="undefined"){_insideGraph.initModule("workflow")}insideWorkflows.showWorkflowIfNeeded()}if(typeof(insideWorkflows)!=="undefined"&&insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isActive){setTimeout(insideWorkflows.scaleInputField,10);setTimeout(insideWorkflows.scaleTextarea,10)}}catch(e){}chatPane.classList.add("open");setPortraitMode();document.getElementById("inside_holder").classList.add("chatOpen");setChatMenuButtonVisibility();setMessageDeliveryStatus();windowScale();scrollToBottom(0);if(isIE){setTimeout(function(){scrollToBottom(0)},100)}if(chatSettings.chatPane.dynamicHeight==true){setTimeout(scrollToBottom,100)}scaleChatInput();if(device===1){if(availableAssistants.length>0&&!insideWorkflows.currentWorkflow||!insideWorkflows.currentWorkflow){setTimeout(function(){if(insideFrontInterface.keyboardNavigation){focusOnHeaderIcon();insideFrontInterface.keyboardNavigation=false}else{if(document.querySelector("#inside_prechatForm")){document.querySelectorAll("#inside_prechatForm")[0].focus()}else{if(document.querySelector("#inside_leaveMessageForm")){document.querySelectorAll("#inside_leaveMessageForm")[0].focus()}else{if($(topWindow.document.activeElement).is("input")==false){chatInput.focus()}}}}},250)}else{$(document).find("input:visible, textarea:visible").focus()}}try{if(!preview){localStorage.setItem("insideChatPaneOpen",chatPaneOpen)}}catch(e){}checkCustomPrechat(survey);if(insideFrontInterface.chatLinkVisitor){try{setTimeout(function(){canBeAssignedToOtherChannel(insideFrontInterface.canBeAssignedToOtherChannel);if(insideFrontInterface.chatLinkVisitor.operators&&insideFrontInterface.chatLinkVisitor.operators.length>0){insideFrontInterface.chat.checkDepartmentSelector()}},500)}catch(e){console.error(e)}}topInsideHolder.classList.add("chatPaneOpen");topInsideHolder.classList[chatInProgress?"add":"remove"]("activeChat");if(chatInProgress&&($(topInsideHolder).hasClass("liveShowOpen")||$(topInsideHolder).hasClass("liveShowMinimised"))){topWindow.insideStreaming.positionNextToChatPane()}}function focusOnHeaderIcon(){var headerIcon=$(chatPane).find('#insideChatPaneButtons [role="button"]:visible:first');if(headerIcon.length>0){headerIcon.focus()}}function checkCustomPrechat(survey){if(typeof customInsideForms=="undefined"&&typeof topWindow.customInsideForms!="undefined"){customInsideForms=topWindow.customInsideForms}if(typeof customInsideForms!="undefined"){if(getAvailableAssistants().length>0&&!chatInProgress&&!survey&&typeof customInsideForms.preChat=="function"&&(!customFormShown||!customInsideForms.preChat.added)){console.log("Showing custom prechat form");customFormShown=true;if(typeof insideForms=="undefined"){loadJS(_insideCDN+"/js/inside.front.forms.js?v="+_insideScriptVersion,"typeof insideForms != 'undefined'",function(){})}removeElements("#inside_prechatForm, .custom_prechat");customInsideForms.preChat.added=true;var customFormHolder=document.createElement("div");customFormHolder.className="customForm custom_prechat";chatPane.appendChild(customFormHolder);customInsideForms.preChat(customFormHolder,$);insideChatPane.showInputFooter();return true}}return false}function closeClick(e){e.stopPropagation();if(chatInProgress||preview){showCloseChatMessage()}else{insideChatPane.close()}}function leaveShowClick(){showCloseChatMessage(false,"Are you sure you want to leave the show?",function(){topWindow.insideStreaming.leaveShow()})}function minimiseClick(e){if(_preview&&insideChatPane.minimiseLocked){return}e.stopPropagation();if(!chatPaneOpen){openChatPane();return}else{insideFrontInterface.chat.setChatMinimizedByCustomer(true);insideChatPane.close();if(device!=1&&topInsideHolder.classList.contains("videoChat")){topInsideHolder.classList.add("chatPaneMinimised")}}}this.showBotWelcomeMessage=showBotWelcomeMessage;function showBotWelcomeMessage(){if(insideWorkflows){insideWorkflows.showWelcomeMessage()}}var rescaleHeaderTab;function setHeaderTabPosition(){if(!chatPane){return}var headerHeight=header.getBoundingClientRect().height;if(chatPaneOpen||chatPane.classList.contains("notificationMode")){return}clearTimeout(rescaleHeaderTab);if(headerHeight==0){rescaleHeaderTab=setTimeout(function(){try{insideChatPane.removeTabs()}catch(e){}setHeaderTabPosition()},500)}if(!preview){if(isIE){_frame.style.webkitTransform="translateY("+(top.window.innerHeight-headerHeight)+"px)";_frame.style.transform="translateY("+(top.window.innerHeight-headerHeight)+"px)"}else{_frame.style.webkitTransform="translateY(calc(var(--inside-viewport-height, 100vh) - "+headerHeight+"px))";_frame.style.transform="translateY(calc(var(--inside-viewport-height, 100vh) - "+headerHeight+"px))"}}topInsideHolder.classList.add("chatPaneMinimised");chatPane.classList.add("minimised");chatPane.classList.add("headerShowing")}var animTimeout;this.showTabHeader=showTabHeader;function showTabHeader(){insideChatPane.showHeaderForTab=showHeaderForTab=true;insideChatPane.close()}this.close=closeChatPane;function closeChatPane(){if(!chatPane){return}if(_frame.style.visibility!=""){_frame.style.visibility=""}if(chatPaneOpen&&typeof insideWebApp!="undefined"&&insideWebApp==true){chatPaneOpen=false;_insideGraph.doEvent("closechat",false);return}if(chatPaneOpen){if($(topInsideHolder).hasClass("liveShowOpen")){topWindow.insideStreaming.chatPaneClosed()}}if(!preview){showHeaderForTab=showChatPaneHeaderForDevice(getAvailableAssistants().length===0)}insideChatPane.showHeaderForTab=showHeaderForTab;clearTimeout(animTimeout);chatPane.style.display="";chatPane.classList.remove("open");document.getElementById("inside_holder").classList.remove("chatOpen");chatPaneOpen=false;if(chatPane.classList.contains("video")&&chatPane.classList.contains("desktopVideo")){toggleMinisedIcon(false)}if(showHeaderForTab&&!chatPane.classList.contains("video")&&!chatPane.classList.contains("desktopVideo")){removeAllNotifications();_frame.style.display="";setHeaderTabPosition();animTimeout=setTimeout(function(){windowScale(true)},100);toggleMinisedIcon(false)}else{clearTimeout(rescaleHeaderTab);if(chatSettings.chatPane.position=="bottom"||chatSettings.chatPane.position=="7"||chatSettings.chatPane.position=="9"){animTimeout=setTimeout(function(){if(device==1&&chatSettings.chatPane.verticalOffset){_frame.style.transform="translateY(100%) translateY("+chatSettings.chatPane.verticalOffset+"px)";_frame.style.webkitTransform="translateY(calc(100% + "+chatSettings.chatPane.verticalOffset+"px))";_frame.style.transform="translateY(calc(100% + "+chatSettings.chatPane.verticalOffset+"px))"}else{_frame.style.webkitTransform="translateY(100%)";_frame.style.transform="translateY(100%)"}},0)}else{if(chatSettings.chatPane.position=="3"||chatSettings.chatPane.position=="6"){animTimeout=setTimeout(function(){_frame.style.webkitTransform="translateX(100%)";_frame.style.transform="translateX(100%)"},0)}else{if(chatSettings.chatPane.position=="1"||chatSettings.chatPane.position=="4"){animTimeout=setTimeout(function(){_frame.style.webkitTransform="translateX(-100%)";_frame.style.transform="translateX(-100%)"},0)}}}chatPane.classList.add("closed")}if(!preview){localStorage.setItem("insideChatPaneOpen",chatPaneOpen)}try{if(!showHeaderForTab&&!chatPane.classList.contains("notificationMode")){insideChatPane.showTabs();if(getAvailableAssistants().length===0&&messagesList.length>0){if(typeof(settings.offlineChat)!="undefined"&&settings.offlineChat.enabled){insideFrontInterface.chat.setOfflineChatTab()}else{insideFrontInterface.chat.setOnlineChatTab()}}}else{insideChatPane.hideTabs()}}catch(e){}if(device==2){showParentBody();if(topWindow.document.location.hash==="#insidechat"||topWindow.document.location.hash==="#insideform"||topWindow.document.location.hash==="#insidechat/insideform"){topWindow.document.location.hash=""}}if(isBlocked){insideChatPane.hideTabs();$("#insideChatFrame").hide()}closeMenu(0,$(document.body).find("#emailInputCell").is(":visible"));windowScale(true);if($(topWindow.document.activeElement).is("input")==false){if($(topInsideHolder).find("#inside_liveChatTab").is(":visible")){$(topInsideHolder).find("#inside_liveChatTab").focus()}else{$(topWindow).focus()}}if(device==2){insideFrontInterface.resetMetaViewport()}topInsideHolder.classList.remove("chatPaneOpen");topInsideHolder.classList[activeChat?"add":"remove"]("activeChat")}function showChatPaneHeaderForDevice(offline){var showHeaderAsTab=chatSettings.chatTab.showChatPaneHeaderAsChatTab;if(typeof(showHeaderAsTab)!="undefined"&&showHeaderAsTab){var offlineEnabled=chatSettings.offline&&chatSettings.offline.enabled&&chatSettings.offline.hideOnDevices.indexOf(device.toString())==-1;if(offlineEnabled!==true&&offline===true){return false}if(device===2){if(offline===true&&showHeaderAsTab.indexOf("mobile_offline")!==-1){return true}if(!offline&&!activeChat&&showHeaderAsTab.indexOf("mobile")!==-1){return true}if(!offline&&activeChat&&showHeaderAsTab.indexOf("mobile_active")!==-1){return true}}else{if(offline===true&&showHeaderAsTab.indexOf("desktop_offline")!==-1){return true}if(!offline&&!activeChat&&showHeaderAsTab.indexOf("desktop")!==-1){return true}if(!offline&&activeChat&&showHeaderAsTab.indexOf("desktop_active")!==-1){return true}}}return false}var welcomeMessageShown=false;function showWelcomeMessage(){if((getAvailableAssistants().length===0&&$(document.body).find(".message.workflowWelcomeMessage.offline").length>0)||(getAvailableAssistants().length>0&&$(document.body).find(".message.workflowWelcomeMessage.online").length>0)){welcomeMessageShown=true}if(welcomeMessageShown||chatInProgress||messageList.length>0){return}if(!preview&&insideFrontInterface.virtualassistant_enabled){if(getAvailableAssistants().length>0&&chatSettings.chatPane.preChatWorkflow){if($(document.body).find(".message.workflowWelcomeMessage.offline").length>0){console.log("Replacing offline > online welcome message");if(insideWorkflows.settings.botOnlineWelcomeMessage){$(document.body).find(".message.workflowWelcomeMessage.offline .content div").html(insideWorkflows.settings.botOnlineWelcomeMessage);$(document.body).find(".message.workflowWelcomeMessage.offline").removeClass("offline").addClass("online")}}return}if(getAvailableAssistants().length===0&&chatSettings.offline.workflow){if($(document.body).find(".message.workflowWelcomeMessage.online").length>0){console.log("Replacing online > offline welcome message");if(insideWorkflows.settings.botOfflineWelcomeMessage){$(document.body).find(".message.workflowWelcomeMessage.online .content div").html(insideWorkflows.settings.botOnlineWelcomeMessage);$(document.body).find(".message.workflowWelcomeMessage.online").removeClass("online").addClass("offline")}}return}}if(chatSettings.chatPane.showWelcomeMessage==false){return}welcomeMessageShown=true;if(chatSettings.chatPane.welcomeMessage&&chatSettings.chatPane.welcomeMessage!=""){var msg=document.querySelector(".welcomeGreeting");if(msg){msg.parentNode.removeChild(msg)}var opName=getOperatorName();if(chatSettings.chatPane.showWelcomeAsChat){var fromImage=getFaceURL(getAvailableAssistants()[0]);var msg=addMessage({text:getLanguageValue(chatSettings.chatPane.welcomeMessage),fromImageURL:fromImage,fromid:"assistant:welcomeGreeting",addClass:"welcomeGreeting",fromname:opName,date:new Date()})}else{var msg=showSystemMessage(getLanguageValue(chatSettings.chatPane.welcomeMessage),"welcomeGreeting");if(msg&&msg.length>0){msg.querySelector(".content").classList.add("heading")}}}}function getOperatorName(opid){if(preview){var opName=getLanguageValue(chatSettings.chatPane.operatorDescription)||translate("Operator")}else{opName=insideFrontInterface.getCurrentAssistantName(opid)}return opName}function getypos(){var viewport;try{viewport=_insideGraph.jQuery.inside.front.getViewPortSize()}catch(e){viewport={width:topWindow.innerWidth,height:topWindow.innerHeight}}if(showHeaderForTab&&!chatPaneOpen){}if(!chatPaneOpen&&showChatPaneHeaderForDevice(getAvailableAssistants().length==0)&&!chatPane.classList.contains("notificationMode")){return 0}var pos=0;if(chatPane.classList.contains("notificationMode")&&device==2){pos=viewport.height-window.innerHeight;if(chatSettings.chatPane.verticalOffset){pos-=parseInt(chatSettings.chatPane.verticalOffset)}}else{if(!iOSiPad&&((chatSettings.chatPane.position=="top"||chatSettings.chatPane.position=="1"||chatSettings.chatPane.position=="3")||device==2&&chatPaneOpen)){pos=0;if(chatSettings.chatPane.verticalOffset&&device!=2){pos+=parseInt(chatSettings.chatPane.verticalOffset)}}else{if(device==3||chatSettings.chatPane.position=="bottom"||chatSettings.chatPane.position=="7"||chatSettings.chatPane.position=="9"||chatPane.classList.contains("notificationMode")){pos=viewport.height-window.innerHeight;if(chatSettings.chatPane.verticalOffset){pos-=parseInt(chatSettings.chatPane.verticalOffset)}}else{pos=Math.floor(viewport.height*0.5-window.innerHeight*0.5);if(chatSettings.chatPane.verticalOffset){pos-=parseInt(chatSettings.chatPane.verticalOffset)}}}}if(pos<0){pos=0}return pos}var displayingPreviousSessionChat=false;var previousChatLoaded=false;this.loadPreviousChat=loadPreviousChat;function loadPreviousChat(){if(settings.restrictPrintConversation==true||previousChatLoaded||!insideChatPane.settings||insideChatPane.settings.showPreviousChatSessionWithin!="currentsession"||(insideChatPane.settings.preChat&&insideChatPane.settings.preChat.enabled&&(insideChatPane.settings.preChat.prechatSurveyExpiry=="chatend"||insideChatPane.settings.preChat.prechatSurveyExpiry=="sessionend")&&$("#inside_prechatForm").is(":visible"))){return}insideAPI.post("api/chat/GetSessionChat",{},function(response){if(response&&response.data&&response.data.length>0){displayingPreviousSessionChat=true;removeElements("#inside_leaveMessageForm, .custom_offline");var messages=response.data;if(!chatPanePreviousContent){chatPanePreviousContent=document.createElement("div");chatPanePreviousContent.setAttribute("id","insideChatPanePreviousContent");chatPaneContent.insertBefore(chatPanePreviousContent,chatPaneContent.firstChild)}prevChatId=messages[0].chatid;for(var i=0;i<messages.length;i++){addMessage(messages[i],undefined,true)}setMenuItems();setFrameHeight()}});previousChatLoaded=true}this.setPortraitMode=setPortraitMode;function setPortraitMode(){var disableChatOnVideoCall=insideFrontInterface.chat.settings.preChat&&insideFrontInterface.chat.settings.preChat.disableChatOnVideoCall==true&&typeof(videoChat)!="undefined"&&videoChat.disableChatOnVideoCall==true;if(top.window.innerHeight>top.window.innerWidth||disableChatOnVideoCall){chatPane.classList.add("portrait");top.document.getElementById("inside_holder").classList.add("portrait")}else{chatPane.classList.remove("portrait");top.document.getElementById("inside_holder").classList.remove("portrait")}}this.windowScale=windowScale;function windowScale(isWindowClose){if(preview){setFramePosition()}if(iOSMobile&&keyboardOpen){return}if(iOSiPad&&keyboardOpen){return}if(device>1){try{top.document.documentElement.style.setProperty("--inside-viewport-height",_insideGraph.jQuery.inside.front.getViewPortSize().height+"px")}catch(e){top.document.documentElement.style.removeProperty("--inside-viewport-height")}}var vidFrame=$(document).find("#vidcontainer iframe");var vidOverlay=$(document).find("#vidOverlay");if(vidFrame.length>0){if(vidOverlay.is(":visible")){vidOverlay.click()}vidFrame[0].contentWindow.postMessage({source:"inside",name:(insideChatPane.device==2||$(chatPane).hasClass("portrait"))&&!videoChat.disableChatOnVideoCall?"show_chat_button":"hide_chat_button",},"*")}if(device==2&&chatPaneOpen){setFrameHeight();if($(document.body).find("#inside_holder .insideSelectMenu").is(":visible")){scaleDropdown()}$(window).scrollTop(0);return}if(chatPaneOpen){setFrameHeight()}setFramePosition();setPortraitMode()}var setFramePositionTimeout;function setFramePosition(){if(preview){return}clearTimeout(setFramePositionTimeout);setFramePositionTimeout=setTimeout(setFramePosition2,0)}function setFramePosition2(){if(showHeaderForTab&&!chatPaneOpen){setHeaderTabPosition()}else{clearTimeout(rescaleHeaderTab)}_frame.style.top=getypos()+"px";var sideOffset=(device==1&&!preview&&chatSettings.chatPane.sideOffset)?chatSettings.chatPane.sideOffset:0;if(chatSettings.chatPane.position=="1"||chatSettings.chatPane.position=="4"||chatSettings.chatPane.position=="7"){_frame.style.left=sideOffset+"px";_frame.style.right="";chatPane.classList.add("left");_frame.classList.add("left")}else{_frame.style.left="";_frame.style.right=sideOffset+"px"}}function chatSendClick(){chatEndedByCustomer=false;if($(document.body).find("#insideWorkflowFieldCell").is(":visible")){insideWorkflows.submitWorkflowStep(null,1)}else{sendChat()}}function sendChat(){if(disconnected||document.querySelector("#inside_prechatForm")!=null){return}var str=chatInput.value;str=str.trim();if(str==""||$(document.body).find("#emailInputCell").is(":visible")){if($(document.body).find("#emailInputCell").is(":visible")){emailChatTranscript()}return}if(str.trim()==""){return}if(preview){addMessage({text:str,date:new Date(),fromid:"user:1:1",id:Math.random()})}else{if(settings.disable_cc_masking!=true){str=insideFrontInterface.chat.checkForCreditCardNumbers(str)}if(!chatInProgress){currentChatId=0}if(currentChatId==""){currentChatId=0}var clickedOnPopupEventId=parseInt($("#inside_liveChatTab").attr("clickedOnPopupEventId"));if(isNaN(clickedOnPopupEventId)){clickedOnPopupEventId=0}else{$("#inside_liveChatTab").removeAttr("clickedOnPopupEventId")}$.inside.sendCall("chat",[currentChatId,str,clickedOnPopupEventId],function(){removeNotification("chatLinkNoOpMessage");if(typeof(insideWorkflows)!="undefined"&&insideWorkflows&&insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isActive){insideWorkflows.cancelWorkflow()}},function(response){console.log("ERROR SENDING CHAT",response)},function(){})}chatInput.value="";if(!iOSMobile&&!iOSiPad){chatInput.focus()}scaleChatInput();checkChatStarted()}this.checkChatStarted=checkChatStarted;function checkChatStarted(){if(preview){return}if(!chatInProgress){setTimeout(showChatStartedText,1500);currentChatId=0}chatEndedByCustomer=false;removeDND();setSendButton();scrollToBottom(0);if(menuOpen){closeMenu()}}this.lastMessageFrom;this.lastMessage;var lastMessageData;this.addOpTypingMessage=addOpTypingMessage;function addOpTypingMessage(opid){var typingMessage=insideChatPane.chatPaneContent.querySelectorAll(".message.typing");if(typingMessage&&typingMessage.length>0){return}var msg=translate("typing...");if(settings.operatorTypingMessage&&getLanguageValue(settings.operatorTypingMessage)!=""){msg=getLanguageValue(settings.operatorTypingMessage)}var opName=getOperatorName(opid);var reg=/{operator}/gi;var msg=msg.replace(reg,opName);var messageHTML="<div class='wave'><span class='dot'></span><span class='dot'></span><span class='dot'></span></div></div>";var message=addMessage({text:messageHTML,date:new Date(),fromid:opid,fromname:opName||"",addClass:"typing"},true);if(message){message.classList.add("typing");message.querySelector(".date").innerText=msg;$(message).append('<div class="sr-only">Operator is typing</div>')}}this.removeOpTypingMessage=removeOpTypingMessage;function removeOpTypingMessage(){removeElements(".message.typing")}var addMessageStagger=false;var nextMessageTimeout;var staggerMessageList=[];this.staggerMessageList=staggerMessageList;function addNextStaggerMessage(){if(staggerMessageList.length>0){staggerMessageList[0].stagger=true;addMessage(staggerMessageList[0],false,false,true);staggerMessageList.splice(0,1)}if(staggerMessageList.length==0){addMessageStagger=false}else{setTimeout(addNextStaggerMessage,1000)}}var messageList=[];var liveStreamRequestNotif;this.addMessage=addMessage;function addMessage(data,hideImage,prevChat,staggerMessage){if(!chatFrameCreated){initChatPane()}if(data.fromid.indexOf("assistant:")==0){insideFrontInterface.lastMessageOperatorId=data.fromid}if(data.id){if(messageList.indexOf(data.id)!=-1){return}}var isCardsMessage=data.data&&data.data.cards&&data.data.cards.length>0;if(data.text==""&&!isCardsMessage){return}if(data.contentType=="text/inside.system"&&data.text.indexOf("/")==0||data.text=="/closechat"){return}if(data.contentType=="data/silent"){if(data.text=="Live Show Request Sent"&&topWindow.document.getElementById("insideStreamPopup")==null){var disclaimer="";if(data.data.Configuration&&data.data.Configuration.requestText){disclaimer=getLanguageValue(data.data.Configuration.requestText);disclaimer=disclaimer.replace("{show.name}",data.data.show.name).replace("{operator.name}",data.data.operatorName).replace("{show.location}",data.data.show.location)}if(disclaimer==""){disclaimer=translate("Join Live Show")}var yesText=translate("Accept");var noText=translate("Decline");var html="<div class='liveStreamRequest'><div class='liveStreamDisclaimerMsg'>"+disclaimer+"</div><span class='button liveStreamAcceptBtn'>"+yesText+"</span><span class='button cancel liveStreamRejectBtn'>"+noText+"</span></div>";if(disclaimer.length<300){liveStreamRequestNotif=showNotification(html,"livestream");bindLiveSteamRequestBtn(data.data.streamId,data.data.advisorId)}else{showSystemMessage(html,"livestream");var liveStreamRequestElement=document.querySelector("#insideChatPaneContent .message.livestream");var updateLiveStreamRequest=function(element){if(element==null){setTimeout(function(){updateLiveStreamRequest(document.querySelector("#insideChatPaneContent .message.livestream"))},200)}else{liveStreamRequestNotif=element;$(liveStreamRequestNotif).removeClass("system");liveStreamRequestNotif.close=function(){$(liveStreamRequestNotif).remove()};bindLiveSteamRequestBtn(data.data.streamId,data.data.advisorId)}};updateLiveStreamRequest(liveStreamRequestElement)}}else{if(data.text=="Live Show Request Cancelled"){$(liveStreamRequestNotif).remove()}}return}if(typeof data.date=="undefined"&&typeof data.age!="undefined"){data.date=new Date(new Date().valueOf()-data.age*1000)}var age=(new Date().valueOf()-new Date(data.date).valueOf())/1000;var anim=age<5&&!animationsDisabled||(data.anim==true);if(prevChat){anim=false}if(!prevChat){if((addMessageStagger&&data.stagger!=true)||(anim&&data.addClass!="typing"&&data.fromid.indexOf("user:")!=0&&data.stagger!=true&&((data.metadata&&data.metadata.workflowId>=0)||data.fromid=="system"))){data.anim=true;if(addMessageStagger==true){staggerMessageList.push(data);if(!data.addClass||(data.addClass.indexOf("typing")===-1&&data.addClass.indexOf("startANewChatButton")===-1)){if(device==2&&chatSettings.chatPane.notifications.enabledOnMobile==false){insideFrontInterface.chat.showChatTabNotification(null,setUnreadMessages())}else{if(!chatPaneOpen&&!preview&&data.fromid!="system"&&data.fromid.indexOf("user:")!=0&&data.deliverystatus!=3&&data.addClass!="welcomeGreeting"&&data.addClass!="welcomeGreeting"){showChatNotificationFromChat(data)}}}return}addMessageStagger=true;setTimeout(function(){addNextStaggerMessage();if(chatPaneOpen&&chatSettings.chatPane.dynamicHeight){setTimeout(setFrameHeight,200)}},1000)}}chatPaneContent.setAttribute("aria-live","polite");if(data.addClass&&data.addClass.indexOf("startANewChatButton")==0){if(document.querySelector(".startANewChatButton")!=null&&document.querySelector(".startANewChatButton")==document.getElementById("insideChatPaneContent").lastChild){return}removeElements(".startANewChatButton");if(chatInProgress){return}}var isWorkflowMessage=data.metadata&&data.metadata.workflowStepId>0?true:false;var isBroadcastExpiryMessage=data.metadata&&data.metadata.expiryMessageType===5;if(data.stagger){chatIsAtBottom=scrollIsAtBottom(100)}else{chatIsAtBottom=scrollIsAtBottom()}messagesList.push(data);if(data.metadata&&!isNaN(data.metadata.dataFieldId)){data.text=unescapeHtml(data.text)}parseMessage(data);if(data.chatid){currentChatId=data.chatid}if(typeof staggerMessage=="undefined"||!staggerMessage){insideFrontInterface.currentChatId=currentChatId}var operatorChat=data.fromid.indexOf("assistant:")==0;var visitorChat=data.fromid.indexOf("user:")==0;var messageHTML="<div class='messageContent'><div class='bubble' tabindex='2'><div class='fromImage'></div><div class='fromName title'></div><div class='content'></div>"+(isRTL?"<div class='date small'></div></div>":"</div><div class='date small'></div>");var message=document.createElement("div");if(isWorkflowMessage){message.className="message workflowMessage";message.setAttribute("wfid",data.metadata.workflowId);message.setAttribute("stepid",data.metadata.workflowStepId)}else{message.className="message"}message.setAttribute("mid",data.id);message.innerHTML=messageHTML;message.data=data;if(anim==false){message.classList.add("noanimation")}if(isBroadcastExpiryMessage){removeElements(".message.broadcastExpiryMsg");message.classList.add("broadcastExpiryMsg")}if(data.metadata&&data.metadata.links&&data.metadata.links.length>0){message.className="message workflowMessage workflowLinkMessage";if(typeof(_insideGraph)!="undefined"){_insideGraph.initModule("workflow")}message.querySelector(".content").innerHTML=insideFrontInterface.safeSanitizeHtml((data.text==="/nomessage"?"":data.text)+insideWorkflows.getWorkflowLinksHtml(data.metadata.links))}else{if(data.contentType=="text/plain"){message.querySelector(".content").innerText=data.text}else{if(typeof data.botId!="undefined"&&data.botId!=0&&data.botId!=""){message.querySelector(".content").innerHTML=data.text}else{message.querySelector(".content").innerHTML=insideFrontInterface.safeSanitizeHtml(data.text)}}}if(isCardsMessage){message.className="message cards";message.querySelector(".content").innerHTML=insideWorkflows.getCardsCarouselHtml(data.data.cards)}if(!containsHTML(data.text)&&!isWorkflowMessage){message.classList.add("plain")}if(data.metadata&&data.metadata.leaveMessage&&insideWorkflows.settings.settingNoOpWorkflowId>0){var node=document.createElement("div");node.classList.add("leaveMessageBtnHolder");node.innerHTML="<div class='btnLeaveMessage'>"+(insideWorkflows.settings.leaveAMessageLabel||chatSettings.chatPane.leaveAMessageLabel||translate("Leave a Message"))+"</div>";message.classList.add("leaveMessageNotification");message.classList.add("inbubble");message.querySelector(".content").appendChild(node);message.querySelector(".btnLeaveMessage").addEventListener("click",function(){insideAPI.post("api/workflow/LeaveAMessage",{chatId:currentChatId||0},function(response){$(message.querySelector(".leaveMessageBtnHolder")).remove();removeElements("#startANewChatButton")})})}if(isRTL&&data.metadata&&data.metadata.dataFieldId&&data.metadata.subType===3){message.setAttribute("dir","ltr")}var textHeadingWorkflowMessage=data.metadata&&data.metadata.style===1;if(textHeadingWorkflowMessage){message.classList.add("plain");message.classList.remove("grouped");hideImage=true}if(typeof data.botId!="undefined"&&data.botId!=0&&data.botId!=""){chatPane.classList.add("botchat");chatPane.setAttribute("botid",message.botId)}else{if(data.fromid.indexOf("assistant:")==0&&chatPane.classList.contains("botchat")){chatPane.classList.remove("botchat");chatPane.removeAttribute("botid")}}if(data.contentType=="data/image"){message.querySelector(".content").innerHTML="<img src='"+data.data.path+"?k="+insideFrontInterface.getAccessKey()+"&c="+_insideGraph.accessCheck+"' onclick='insideFrontInterface.chat.showImagePopup(\""+(data.data.path+"?k="+insideFrontInterface.getAccessKey()+"&c="+_insideGraph.accessCheck)+'", null, '+(device==2)+", "+(device==2)+")' />";message.classList.add("image")}if(data.contentType=="data/file"||data.contentType=="data/video"||data.contentType=="data/audio"){message.querySelector(".content").innerHTML="<table><tr><td><span class='"+fileUploader.getFileIconByExtension(data.data.path)+iconset+"'></span><span class='icon-download-"+iconset+"'></span></td><td><a download href='"+data.data.path+"?download&k="+insideFrontInterface.getAccessKey()+"&c="+_insideGraph.accessCheck+"' dir='ltr'>"+data.data.name+"</a><div class='fileSize' dir='ltr'>"+getFileSize(data.data.size)+"</div></td></tr></table>";setCustomIcons(message);message.classList.add("file")}if(message.querySelector(".inside_offerMessage")){message.classList.add("offer");$(message).find(".offer-container").removeAttr("style");$(message).find(".inside_offerMessage").removeAttr("style");$(message).find(".offer-image").removeAttr("style");if(message.querySelector(".offer-image-border")){$(message.querySelector(".offer-image-border")).remove()}if(message.querySelector(".offer-description")){message.querySelector(".offer-description").parentElement.innerHTML=message.querySelector(".offer-description").innerHTML;$(message).find(".offer-description-holder").removeAttr("style")}}if(!textHeadingWorkflowMessage){var fromName=fromName=data.fromname;var botName=insideWorkflows.getWorkflowBotName();if(isWorkflowMessage===true&&botName){fromName=botName}message.querySelector(".fromName").innerText=fromName||""}if(hideImage==true){message.querySelector(".fromImage").style.display="none"}if(typeof data.date!="undefined"){message.querySelector(".date").innerHTML=getTime(data.date)}else{if(typeof data.age!="undefined"){data.date=new Date(new Date().valueOf()-data.age*1000);message.querySelector(".date").innerHTML=getTime(data.date)}}message.querySelector(".date").date=data.date;if(operatorChat){if(!textHeadingWorkflowMessage){message.classList.add("operator")}removeOpTypingMessage();if(chatSettings.chatPane.hideWelcomeMessageWhenOperatorStartsChat==true){removeElements(".welcomeGreeting")}}if(visitorChat){if(!prevChat){activeChat=true;topInsideHolder.classList.add("activeChat");chatPane.classList.add("activechat");visitorHasChatted=true;insideChatPane.activeChat=activeChat;chatPane.classList.add("activechat");document.getElementById("insideChatPaneCloseButton").style.display=""}message.classList.add("visitor");if(chatSettings.chatPane.hideWelcomeMessageWhenVisitorStartsChat==true){removeElements(".welcomeGreeting")}}if(prevChat){chatPanePreviousContent.appendChild(message)}else{chatPaneContent.appendChild(message)}if(isIE){var width=message.querySelector(".content").clientWidth+1;if(width>((chatSettings.chatPane.width||400)-100)){message.classList.add("forceFullWidth")}}var systemMessage=isSystemMessage(data);var dontGroupAndSubsequent=isCardsMessage||(insideChatPane.lastMessage&&insideChatPane.lastMessage.classList.contains("cards"))||textHeadingWorkflowMessage||(lastMessageData&&lastMessageData.metadata&&lastMessageData.metadata.style===1);if(!systemMessage&&!dontGroupAndSubsequent&&insideChatPane.lastMessageFrom==data.fromid&&data.fromid!="-1"){var contentCheck=true;if(prevChat&&insideChatPane.lastMessage.parentNode!=document.getElementById("insideChatPanePreviousContent")){contentCheck=false}if(!prevChat&&insideChatPane.lastMessage.parentNode==document.getElementById("insideChatPanePreviousContent")){contentCheck=false}if(!lastMessageData){contentCheck=false}if(contentCheck&&data.addClass!=="typing"){var timeBetweenMessages=(new Date(data.date).valueOf()-new Date(lastMessageData.date).valueOf())/1000;if(timeBetweenMessages<150){message.querySelector(".fromName").style.display="none";message.querySelector(".fromImage").style.display="none";message.classList.add("subsequent");var time=0.5;if(!anim){time=0}var d=insideChatPane.lastMessage.querySelector(".date");d.style.lineHeight=d.getBoundingClientRect().height+"px";d.style.opacity=1;setTimeout(function(){d.style.lineHeight="0px";d.style.opacity=0},100);insideChatPane.lastMessage.classList.add("grouped")}}}if(systemMessage){message.classList.add("system");if(chatSettings.chatPane.messages.systemMessageStyle=="heading"){message.classList.add("plain")}else{message.classList.add("inbubble")}if(!message.classList.contains("leaveMessageNotification")){}}if(typeof data.addClass!="undefined"&&data.addClass!=""){var classes=data.addClass.split(" ");for(var i=0;i<classes.length;i++){message.classList.add(classes[i])}}if(data.fromid.indexOf("assistant:")==0){if(!preview&&(!data.metadata||typeof(data.metadata.workflowId)=="undefined"||data.metadata.workflowId==null||data.metadata.workflowId==0)&&(!data.metadata||!data.metadata.smalltalk)&&!message.classList.contains("typing")&&$(document.body).find("#insideWorkflowFieldCell:visible").length>0&&$(document.body).find(".message.workflowHelpBubble").length===0&&(insideWorkflows&&insideWorkflows.currentWorkflow&&insideWorkflows.currentWorkflow.isActive&&!insideWorkflows.currentWorkflow.paused&&!insideWorkflows.currentWorkflow.isBot)){if(!data.metadata){$(document.body).find(".message .flexButtonContainer").remove();var node=document.createElement("div");node.classList.add("flexButtonContainer");node.style.display="block";node.innerHTML='<div class="returnToOperatorBtn insideFlexButton">'+(insideWorkflows.settings.returnToOperatorLabel||"Ask Operator a Question")+"</div>";message.querySelector(".content").appendChild(node);message.querySelector(".returnToOperatorBtn").addEventListener("click",function(){insideAPI.post("api/workflow/PauseWorkflow",{chatId:currentChatId,workflowId:insideWorkflows.currentWorkflow.workflowId},function(response){if(response){$(message.querySelector(".flexButtonContainer")).remove();insideWorkflows.pauseWorkflow()}})})}}if(preview){if(typeof(chatSettings.chatPane.globalOperatorImage)!="undefined"&&chatSettings.chatPane.globalOperatorImage!=null&&chatSettings.chatPane.globalOperatorImage!=""){faceurl=customImageUrl+chatSettings.chatPane.globalOperatorImage}else{if(chatSettings.chatPane.defaultOperatorImage!=""){faceurl=customImageUrl+chatSettings.chatPane.defaultOperatorImage}else{faceurl=imageurl+"default-operator-photo.png"}}message.querySelector(".fromImage").innerHTML="<div class='inside_assistMessageFace'><img role='presentation' alt='' src='"+faceurl+"'</div>"}try{var assist;if(typeof insideFrontInterface!="undefined"&&insideFrontInterface.getAssistant){assist=insideFrontInterface.getAssistant(data.fromid)}if(message.id==-1){availableAssistants=getAvailableAssistants();if(availableAssistants&&availableAssistants.length>0){assist=availableAssistants[0]}}faceurl=getFaceURL(data);message.querySelector(".fromImage").innerHTML="<div class='inside_assistMessageFace'><img role='presentation' alt='' src='"+faceurl+"'</div>"}catch(e){}}if(data.fromImage){message.querySelector(".fromImage").innerHTML=data.fromImage}if(data.fromImageURL){message.querySelector(".fromImage").innerHTML="<div class='inside_assistMessageFace'><img role='presentation' alt='' src='"+data.fromImageURL+"'</div>"}if(anim){showMessage(message);if(data.contentType=="data/image"&&message.querySelector("img")!="null"){message.querySelector("img").onload=function(){setTimeout(function(){scrollToBottom()},1000)}}}else{makeMessageClickable(message);if(prevChat){scrollToBottom(0)}else{scrollToBottom()}}if(!message.classList.contains("typing")&&!message.classList.contains("startANewChatButton")){insideChatPane.lastMessageFrom=data.fromid;insideChatPane.lastMessage=message;lastMessageData=data}if(isWorkflowMessage&&insideWorkflows&&insideWorkflows.currentWorkflow&&data.id===insideWorkflows.currentWorkflow.messageId&&data.metadata.workflowId===insideWorkflows.currentWorkflow.workflowId&&data.metadata.workflowStepId===insideWorkflows.currentWorkflow.workflowStepId){insideWorkflows.showWorkflowIfNeeded()}if(isCardsMessage){insideWorkflows.bindCardsCarouselEvents(message)}if(data.id){messageList.push(data.id)}var links=message.querySelectorAll("a");for(var i=0;i<links.length;i++){if(!links[i].classList.contains("workflowLink")){if(links[i].getAttribute("target")!="_blank"){links[i].setAttribute("target","_top")}}if(links[i].classList.contains("scheduleAppointmentLink")){links[i].addEventListener("click",function(e){e.preventDefault();var href=this.getAttribute("href");var url=new insideFrontInterface.chat.Url(href);var teamId=this.getAttribute("data-schedulingteamid")||url.query["inside-teamId"];var subsiteId=this.getAttribute("data-schedulingsubsiteid")||url.query["inside-subsiteId"];insideScheduling.showInputForm(teamId,subsiteId);return false})}}try{addRefQueryString(message)}catch(e){}if(data.metadata&&data.metadata.relatedIntents&&data.metadata.relatedIntents.length>0){addRelatedIntentMessage(data)}return message}function bindLiveSteamRequestBtn(streamId,advisorId){var apiPath="/api/streaming/streams/"+streamId+"/connect/request/accept";document.querySelector(".liveStreamAcceptBtn").addEventListener("click",function(e){e.preventDefault();e.stopPropagation();if(topWindow.insideStreamingCheck.bundleLoaded){btnClick()}else{topWindow.insideStreamingCheck.loadStreamingBundle(btnClick)}function btnClick(){liveStreamRequestNotif.close();liveStreamRequestNotif=null;insideAPI.post(apiPath,{advisorId:advisorId,accept:true},function(data){})}});document.querySelector(".livestreamRejectBtn").addEventListener("click",function(e){if(liveStreamRequestNotif){liveStreamRequestNotif.close();liveStreamRequestNotif=null}insideAPI.post(apiPath,{advisorId:advisorId,accept:false})})}function addRefQueryString(message){if(typeof message=="undefined"){return}var querystring="utm_source=insidechat";if(typeof settings.chatLinkRefString!="undefined"&&settings.chatLinkRefString){querystring=settings.chatLinkRefString}var links=message.querySelectorAll("a");for(var i=0;i<links.length;i++){var a=links[i];if(a.getAttribute("skipencoding")!=null){return}var href=a.getAttribute("href");var patt=new RegExp(/%[0-9a-f]{2}/i);if(href&&href.indexOf("mailto:")!=0&&href.indexOf("tel:")!=0&&!patt.test(href)){var url=new Url(href);delete url.query.utm_source;delete url.query.utm_campaign;delete url.query.utm_term;delete url.query.utm_content;delete url.query.utm_medium;if(typeof settings.chatLinkRefString!="undefined"&&settings.chatLinkRefString){try{if(settings.chatLinkRefString.indexOf("=")==-1){return}url.query[settings.chatLinkRefString.split("=")[0]]=settings.chatLinkRefString.split("=")[1]}catch(e){}}else{if(typeof topWindow._inside.customRefString=="string"){try{url.query[topWindow._inside.customRefString.split("=")[0]]=_inside.customRefString.split("=")[1]}catch(e){}}else{url.query.utm_source="insidechat"}}a.href=url}}}this.addRelatedIntentMessage=addRelatedIntentMessage;function addRelatedIntentMessage(data){var relatedIntentsText=data.metadata.relatedIntentsText;var relatedIntents=data.metadata.relatedIntents;if(!relatedIntentsText||$.trim(relatedIntentsText).length==0){relatedIntentsText="Related:"}else{relatedIntentsText=insideFrontInterface.escapeHtml(relatedIntentsText);relatedIntentsText=relatedIntentsText.split("\n").join("<br>")}removeElements(".message.relatedIntents");var html="";for(var i=0;i<relatedIntents.length;i++){if(relatedIntents[i].text.indexOf("[workflowid:")>-1){continue}html+="<li><span class='icon-icon-context'></span><label iid='"+relatedIntents[i].intentId+"' onclick='insideChatPane.relatedIntentClick(this)'>"+relatedIntents[i].text+"</label></li>"}var messageHTML="<div class='inside_relatedintents'><label>"+relatedIntentsText+"</label><ul>"+html+"</ul></div>";var message=addMessage({text:messageHTML,date:new Date(),fromid:data.fromid,addClass:"relatedIntents"},true)}this.relatedIntentClick=relatedIntentClick;function relatedIntentClick(elem){var intentId=$(elem).attr("iid");$.inside.server.relatedIntents(intentId,insideFrontInterface.currentChatId);$(elem).parents(".message.relatedIntents").remove()}function getFileSize(size){var sizeKB=size/1024;if(parseInt(sizeKB)>1024){var sizeMB=sizeKB/1024;sizeStr=sizeMB.toFixed(2)+" MB"}else{sizeStr=sizeKB.toFixed(2)+" KB"}return sizeStr}function getFaceURL(data){var assist;var assistantId;if(data){assistantId=data.fromid||data.id||null}if(typeof insideFrontInterface!="undefined"&&insideFrontInterface.getAssistant){assist=insideFrontInterface.getAssistant(assistantId)}if(assist==null){var botPicture=insideWorkflows.getWorkflowBotImage();if(insideWorkflows&&assistantId==insideWorkflows.workflowBotId&&botPicture!=null&&botPicture!=""){faceurl=customImageUrl+botPicture}else{if(typeof(chatSettings.chatPane.globalOperatorImage)!="undefined"&&chatSettings.chatPane.globalOperatorImage!=null&&chatSettings.chatPane.globalOperatorImage!=""){faceurl=customImageUrl+chatSettings.chatPane.globalOperatorImage}else{if(assistantId!="undefined"&&assistantId!=null&&assistantId!=""&&assistantId!="assistant:999:999"){if(typeof(chatSettings.chatSettingsId)!="undefined"&&chatSettings.chatSettingsId>0){faceurl=_insideCDN+"images/operator/face?id="+assistantId+"&chatSettingsId="+chatSettings.chatSettingsId}else{faceurl=_insideCDN+"images/operator/face?id="+assistantId}}else{if(assistantId=="assistant:999:999"||typeof(chatSettings.chatPane.defaultOperatorImage)!="undefined"&&chatSettings.chatPane.defaultOperatorImage!=null&&chatSettings.chatPane.defaultOperatorImage!=""){if(chatSettings.chatPane.defaultOperatorImage!=""){faceurl=customImageUrl+chatSettings.chatPane.defaultOperatorImage}else{faceurl=imageurl+"default-operator-photo.png"}}else{if(preview){return imageurl+"inside_logo_face.png"}faceurl=_insideCDN+"images/operator/face?id="+assistantId}}}}}else{if(typeof(chatSettings.chatPane.globalOperatorImage)!="undefined"&&chatSettings.chatPane.globalOperatorImage!=null&&chatSettings.chatPane.globalOperatorImage!=""){faceurl=customImageUrl+chatSettings.chatPane.globalOperatorImage}else{if(assist.img1!="undefined"&&assist.img1!=null&&assist.img1!=""&&assist.img1!="custom/"){faceurl=customImageUrl+assist.img1}else{if(typeof(chatSettings.chatPane.defaultOperatorImage)!="undefined"&&chatSettings.chatPane.defaultOperatorImage!=""){faceurl=customImageUrl+chatSettings.chatPane.defaultOperatorImage}else{if(preview){return imageurl+"inside_logo_face.png"}faceurl=_insideCDN+"images/operator/face?id="+assistantId}}}}return faceurl}this.getTime=getTime;function getTime(date){if(typeof moment=="undefined"){initMoment();return"<span class='insideMomentDateReplace' date='"+date.valueOf()+"'></span>"}else{return moment(date).fromNow()}}var momentInited;function initMoment(){if(momentInited){return}momentInited=true;if(insideFrontInterface.chat.momentLoading==true){insideFrontInterface.chat.momentCallbacks.push(momentLoaded);return}insideFrontInterface.chat.momentLoading=true;loadJS(_insideCDN+"/js/inside.momentjs.js?","typeof insideFrontInterface.chat.moment != 'undefined'",function(){momentLoaded()})}function loadJS(src,instance,onload){var s=document.createElement("script");s.setAttribute("type","text/javascript");s.setAttribute("src",src);if(onload){loadCallback(instance,onload)}var head=document.getElementsByTagName("head")[0];if(head){head.appendChild(s)}else{document.body.appendChild(s)}}function loadCallback(check,callback){var interval=setInterval(function(){if(eval(check)){clearInterval(interval);callback()}},10)}function momentLoaded(){moment=insideFrontInterface.chat.moment;delete insideFrontInterface.chat.momentLoading;var enLocaleSettings={calendar:{lastDay:"[Yesterday,] LTS",sameDay:"LT",nextDay:"[Tomorrow at] LTS",lastWeek:"ddd[,] LTS",nextWeek:"ddd[,] LTS",sameElse:function(){return this.year()==moment().year()?"MMM DD[,] LTS":"MMM DD YYYY[,] LTS"}},relativeTime:{future:"in %s",past:"%s",s:"just now",ss:"%s secs ago",m:"1 min ago",mm:"%d mins ago",h:"an hour ago",hh:"%d hours ago",d:"a day ago",dd:"%d days ago",M:"a month ago",MM:"%d months ago",y:"a year ago",yy:"%d years ago"},longDateFormat:{LT:"h:mm a",LTS:"h:mm:ss a",L:"MM/DD/YYYY",LL:"MMMM Do YYYY",LLL:"MMMM Do YYYY LT",LLLL:"dddd, MMMM Do YYYY LT"}};moment.updateLocale("en",enLocaleSettings);moment.updateLocale("en-gb",enLocaleSettings);moment.updateLocale("en-au",enLocaleSettings);setLanguage();chatIsAtBottom=scrollIsAtBottom();var dateNodes=document.querySelectorAll(".insideMomentDateReplace");for(var i in dateNodes){v=dateNodes[i];if(typeof v!="object"){continue}try{var dateVal=v.getAttribute("date");if(!isNaN(dateVal)){dateVal=parseInt(dateVal)}v.parentNode.innerText=moment(new Date(dateVal)).fromNow()}catch(e){}}if(chatIsAtBottom){scrollToBottom(0)}}function setLanguage(){if(chatSettings.language&&chatSettings.language!=""&&chatSettings.language!="visitorDataMappings"){language=chatSettings.language}else{if(typeof insideFrontInterface!="undefined"&&insideFrontInterface.labelTranslations&&insideFrontInterface.labelTranslations.langCode){language=insideFrontInterface.labelTranslations.langCode}else{if(insideFrontInterface.language){language=insideFrontInterface.language}else{if(navigator.language){language=navigator.language}}}}var momentLang=language;if(momentLang=="zh"){momentLang="zh_cn"}else{if(momentLang=="no"){momentLang="nb"}}if(moment){moment.locale(momentLang)}langCode=language;this.langCode=langCode;insideFrontInterface.websiteLanguage=langCode}this.showPreviewMessages=showPreviewMessages;function showPreviewMessages(){var opName=getOperatorName();showWelcomeMessage();showSystemMessage(translate("This is a system message."),"",new Date(new Date().valueOf()-65000));addMessage({chatid:"1",text:translate("This is a test message from the visitor"),date:new Date(new Date().valueOf()-40000),fromid:"user:1:1",id:Math.random()});addMessage({chatid:"2",text:translate("This is a test message from the operator"),fromname:opName,date:new Date(),fromid:"assistant:999:999",id:Math.random()})}function clearMessages(){welcomeMessageShown=false;removeElements(".message")}this.showSystemMessage=showSystemMessage;function showSystemMessage(str,addClass,_date){if(str==""){return}var date=new Date();if(typeof(_date)!="undefined"){date=_date}try{if(chatSettings.chatPane.messages.systemMessageStyle=="heading"){addClass==""?addClass="plain":addClass+=" plain"}}catch(e){}return addMessage({text:str,date:date,fromid:"system",addClass:addClass})}this.showErrorBubble=showErrorBubble;function showErrorBubble(str,_addClass){var addClass="errorBubble";if(typeof _addClass!="undefined"){addClass+=" "+_addClass}return addMessage({text:str,fromname:translate("Oops!"),fromImage:'<span class="icon-error"></span>',date:new Date(),fromid:"formError",addClass:addClass})}this.showCloseChatMessage=showCloseChatMessage;function showCloseChatMessage(showInFooterMenu,message,callback){if(typeof message=="undefined"||message==""){message="Are you sure you want to end this chat?"}var className="";if(showInFooterMenu){className="heading"}else{closeMenu()}var notif=showNotification("<div class='"+className+"'>"+translate(message)+"</div><span class='button' id='endChatConfirm' tabindex='2' aria-label='End chat confirm' role='button'>"+translate("Yes")+"</span><span class='button cancel' id='endChatCancel' tabindex='2' aria-label='End chat cancel' role='button'>"+translate("No")+"</span>","endchat",showInFooterMenu);var confirmButton=notif.querySelector("#endChatConfirm");var cancelButton=notif.querySelector("#endChatCancel");notif.querySelector(".bubble").focus();confirmButton.addEventListener("click",function(e){if(preview){return}var videoChatFrame=document.getElementById("insideVideoFrame");if(videoChatFrame){$.inside.videoChat=false;insideAPI.post("/api/videochat/hangup_visitor",{})}var showSurvey=endChat();notif.close(0);activeChat=false;chatPane.classList.remove("activechat");topInsideHolder.classList.remove("activeChat");document.getElementById("endChatItem").style.display="none";insideChatPane.activeChat=activeChat;checkHeaderTabIsShowing();insideFrontInterface.chat.setMessageReceived(false);if(!insideWebApp){if(typeof($.inside.front.settings.showPostChatSurveyWhenVisitorEndsChat)=="undefined"||$.inside.front.settings.showPostChatSurveyWhenVisitorEndsChat==false||showSurvey==false){setTimeout(insideChatPane.close,100)}}if(typeof callback=="function"){callback()}});cancelButton.addEventListener("click",function(e){notif.close();setTimeout(scaleMenu,500)});$(confirmButton).clickableByKeyboard();$(cancelButton).clickableByKeyboard();if(!chatPaneOpen){openChatPane()}}function isSystemMessage(data){if(data.fromid=="system"){return true}var str=data.text;if(str&&(str.indexOf("/openchat")==0||str.indexOf("/closechat")==0||str.indexOf("/agree")==0||str.indexOf("/dept")==0||str.indexOf("/cobrowse")==0)){return true}return false}this.scrollToBottom=scrollToBottom;function scrollToBottom(time){var t=500;if(typeof time=="number"){t=time}if(t==0){try{chatPaneContent.thisTween.complete=true;chatPaneContent.scrollTop=chatPaneContent.scrollHeight}catch(e){}}else{try{scrollIt(chatPaneContent,chatPaneContent.scrollHeight,t)}catch(e){}}setMessageDeliveryStatus();clearUnreadMessageCount()}var scrollToMessageTimeout;this.scrollToMessage=scrollToMessage;function scrollToMessage(msg,time){if(!_preview&&!chatPaneOpen){return}if(msg.parentNode!=chatPaneContent){return}if(typeof(_insideGraph)!="undefined"&&_insideGraph.tabVisible==false){scrollIt(chatPaneContent,msg.offsetTop-100,0);return}var t=500;if(typeof time=="number"){t=time}if(msg.data&&msg.data.fromid.indexOf("user")==0){scrollIt(chatPaneContent,msg.offsetTop+msg.getBoundingClientRect().height,t);return}clearTimeout(scrollToMessageTimeout);scrollToMessageTimeout=setTimeout(function(){if(msg.parentNode!=chatPaneContent){return}if(msg.style.overflow=="hidden"){msg.style.overflow=""}var headerHeight=header.getBoundingClientRect().height;scrollIt(chatPaneContent,msg.offsetTop-headerHeight-10,t)},250)}function ieRenderFix(){chatPaneContent.style.flex="1 1 auto"}this.showMessage=showMessage;function showMessage(msg,delay){var msgContent=msg.querySelector(".messageContent");msg.style.display="block";box=msg.getBoundingClientRect();msgContent.style.transform="translateY(100%)";if(!iOSMobile){msg.style.overflow="hidden"}var rect=msg.getBoundingClientRect();msg.style.minHeight=box.height+"px";msg.classList.add("transition");setTimeout(function(){msgContent.style.transform="translateY(0%)"},100);setTimeout(function(){msg.style.overflow="";msg.style.minHeight="";msg.classList.remove("transition")},600);if(chatIsAtBottom){scrollToMessage(msg)}else{if(!msg.classList.contains("typing")){showUnreadMessageIndicator()}}setMenuItems();makeMessageClickable(msg);$(msg).find(".inside_chat_product").find("a").attr("target","_self")}function makeMessageClickable(message){var bubble=$(message).find(".bubble");var clickableElement=$(bubble).find('[role="button"], [role="menuitem"], .insideFlexButton');clickableElement.clickableByKeyboard();if(clickableElement.length==1){bubble.click(function(e){if($(e.target).hasClass("bubble")){clickableElement.click()}}).clickableByKeyboard()}$(bubble).find("a[href]").attr("tabindex",2)}var numUnread=0;function showUnreadMessageIndicator(){unreadMessageIndicator=document.getElementById("unreadMessageIndicator");unreadMessageIndicator.style.display="flex";numUnread++;var arrowIcon="<div class='minimiseIcon' role='button' aria-label='Minimise Unread Message Count'><span class='icon-minimise_2'></span></div>";if(isRTL){document.querySelector("#unreadMessageIndicator").innerHTML="<div class='unreadMessageText'>"+numUnread+" "+translate("New Message"+((numUnread>1)?"s":""))+"</div>"+arrowIcon}else{document.querySelector("#unreadMessageIndicator").innerHTML=arrowIcon+"<div class='unreadMessageText'>"+numUnread+" "+translate("New Message"+((numUnread>1)?"s":""))+"</div>"}}function clearUnreadMessageCount(){unreadMessageIndicator=document.getElementById("unreadMessageIndicator");unreadMessageIndicator.style.display="none";numUnread=0}function unreadMessageIndicatorClick(){scrollToBottom()}var chatIsAtBottom=true;function scrollIsAtBottom(_tolerance){var tolerance=200;if(typeof(_tolerance)!="undefined"){tolerance=_tolerance}scrollPosFromBottom=chatPaneContent.scrollHeight-chatPaneContent.scrollTop-chatPaneContent.offsetHeight;if(scrollPosFromBottom<=tolerance){chatIsAtBottom=true}else{chatIsAtBottom=false}return chatIsAtBottom}function addCustomFont(style,fontData,cssString){var font=fontData.family;if(!font||font==""||!font.name||font.name==""){return cssString}if(font.type=="other"){}else{if(font.url&&font.url!=""){var linkTag=document.createElement("link");linkTag.href=font.url;linkTag.rel="stylesheet";document.head.appendChild(linkTag)}else{if(font.files&&font.files.length>0){cssString+="@font-face {";cssString+="font-family: '"+font.name+"';";var fontsArr=[];for(var i=0;i<font.files.length;i++){fontsArr.push("url('"+font.files[i]+"') format('"+fontFileFormat(font.files[i])+"')")}cssString+="src: "+fontsArr.join(",");cssString+=";}"}}}cssString=applyFontStyling(cssString,style,fontData);return cssString}function applyFontStyling(cssString,style,fontData){var font=fontData.family;var messageSelector=".message .messageContent .content, .message .messageContent .content a, .chatNotifText, .message.system.plain.inbubble .content, .notification .button, #inside_leaveMessageForm input, #inside_leaveMessageForm textarea,.message .picklistOption, .message .content .btnLeaveMessage, .insideFlexButton, #workflows .picklistOption, #chatInput, #emailInput, #insideSelectListSearchInput, .inside-prechat-field selectinput, textarea, #insideWorkflowFieldCell input, #insideWorkflowFieldCell .inside-field input, #insideWorkflowFieldCell textarea, #insideWorkflowFieldCell .inside-field textarea, .insideSelectMenu h2, .insideSelectMenu li span.countryName, .countryCode .countryCodeText,.inside-field span.symbol, .insideSelect, .insideSelectMenu li,.c2cPhoneDiv, #insideChatPane .insideSubmitButton, .inside_label, #video_permissionForm p, #notifications .notification .bubble, .notification div, .message div, #inside_holder .c2cContainer input, .inside_formTitle, .message.cards .cardSubtitle, .message.cards .cardUrl, .inside_chatDisclaimer .formHeading, .inside_output, #insideChatPane .customForm input ";if(!style||style=="default"){cssString+="#insideChatPane, #insideChatPane input, #insideChatPane .insideSubmitButton, #inside_holder .insideSubmitButton, #insideChatPane textarea, div,#insideChatPane p, #insideWorkflowFieldCell input, #insideWorkflowFieldCell textarea, .inside-field span.symbol, .c2cform input, "+messageSelector+" { "+getFontStylesString(fontData)+"}\n"}else{if(style=="heading"){cssString+="#insideChatPane .heading, .message.system.plain .content, .message.workflowMessage.plain .content, h1, h2, h3, .inside_survey_header, .message.cards .cardTitle, .inside_formTitle, #insideChatPane .schedulingFormContainer #preSchedulingFormText {"+getFontStylesString(fontData)+"}\n"}else{if(style=="small"){cssString+="#insideChatPane .small { "+getFontStylesString(fontData)+"}\n"}else{if(style=="bold"){cssString+="#insideChatPane .bold, .insideSurveyQuestion { "+getFontStylesString(fontData)+"}\n"}else{if(style=="header"){cssString+="#insideChatPaneHeader, #insideChatPaneHeader div, #insideChatPane .schedulingFormContainer .schedulingFormHeaderText { "+getFontStylesString(fontData)+"}\n"}else{if(style=="title"){cssString+=".message .fromName, .title, .chatNotifTitle, .insideSurveyQuestion { "+getFontStylesString(fontData)+"}\n"}else{if(style=="messages"){cssString+=messageSelector+", #insideChatPane .schedulingFormContainer label, #insideChatPane .schedulingFormContainer input, #insideChatPane .schedulingFormContainer select { "+getFontStylesString(fontData)+"}\n"}else{if(style=="menu"){cssString+=".menuItem label { "+getFontStylesString(fontData)+"}\n"}}}}}}}}return cssString}this.getFontStylesString=getFontStylesString;function getFontStylesString(fontData){var str="";if(fontData.family!=""&&fontData.family.name!=""){str+="font-family: "+fontData.family.name+", 'Nunito Sans', sans-serif;"}if(typeof fontData.transform=="string"&&fontData.transform!=""){str+="text-transform: "+fontData.transform+";"}if(typeof fontData.letterSpacing!="undefined"&&fontData.letterSpacing!=""){str+="letter-spacing: "+fontData.letterSpacing+"px;"}if(typeof fontData.size!="undefined"&&fontData.size!=""){if(fontData.size.indexOf("em")!=-1){str+="font-size: "+fontData.size+";"}else{str+="font-size: "+parseInt(fontData.size)+"px;"}}if(typeof fontData.weight!="undefined"&&fontData.weight!=""){str+="font-weight: "+fontData.weight+";"}return str}function fontFileFormat(filename){if(filename.indexOf(".eot")!=-1){return"embedded-opentype"}else{if(filename.indexOf(".woff2")!=-1){return"woff2"}else{if(filename.indexOf(".woff")!=-1){return"woff"}else{if(filename.indexOf(".ttf")!=-1){return"truetype"}else{if(filename.indexOf(".svg")!=-1){return"svg"}else{return"opentype"}}}}}}function setDraggable(){var mousey=0;var mousex=0;var mouseIsDown=false;var isMacOs=["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(window.navigator.platform)>-1;header.style.cursor=isMacOs?"grab":"move";header.addEventListener("mousedown",mouseDownFrame);window.addEventListener("mouseup",mouseUp);topWindow.addEventListener("mouseup",mouseUp);window.addEventListener("mousemove",mouseMoveFrame);function mouseDownFrame(e){if(!chatPaneOpen){return}if(e.target.classList.contains("insideChatPaneHeaderButton")||e.target.className.toString().indexOf("SVGAnimatedString")>-1||e.target.className.toString().indexOf("icon-")==0){return}if(isMacOs){header.style.cursor="grabbing"}_frame.style.pointerEvents="none";_frame.classList.add("notransition");mousex=e.clientX;mousey=e.clientY;mouseIsDown=true;var rect=_frame.getBoundingClientRect();var initTransform=window.getComputedStyle(_frame).getPropertyValue("transform").match(/(-?[0-9\.]+)/g);initTransformX=parseInt(initTransform[4]);initTransformY=parseInt(initTransform[5])}function mouseUp(e){mouseIsDown=false;_frame.classList.remove("notransition");_frame.style.pointerEvents="";if(isMacOs){header.style.cursor="grab"}}function mouseMoveFrame(e){if(!mouseIsDown||!chatPaneOpen){return}var clientY=e.clientY;var clientX=e.clientX;if(typeof e.originalEvent!="undefined"&&typeof(e.originalEvent.touches)!="undefined"){clientY=e.originalEvent.touches[0].clientY;clientX=e.originalEvent.touches[0].clientX}var yDiff=(clientY-mousey);var xDiff=(clientX-mousex);var initTransform=window.getComputedStyle(_frame).getPropertyValue("transform").match(/(-?[0-9\.]+)/g);transformX=parseInt(initTransform[4]);transformY=parseInt(initTransform[5]);var xpos=transformX+xDiff;var ypos=transformY+yDiff;_frame.style.transform="translate("+xpos+"px,"+ypos+"px)";var rect=_frame.getBoundingClientRect();if(rect.left<0){xpos+=-rect.left}if(rect.left+rect.width>topWindow.document.body.clientWidth){xpos+=topWindow.document.body.clientWidth-(rect.left+rect.width)}if(rect.top<0){ypos+=-rect.top}if(rect.top+rect.height>topWindow.innerHeight){ypos+=topWindow.innerHeight-(rect.top+rect.height)}_frame.style.transform="translate("+xpos+"px,"+ypos+"px)"}function mouseMove(e){if(!mouseIsDown||!chatPaneOpen){return}var clientY=e.clientY;var clientX=e.clientX;if(typeof e.originalEvent!="undefined"&&typeof(e.originalEvent.touches)!="undefined"){clientY=e.originalEvent.touches[0].clientY;clientX=e.originalEvent.touches[0].clientX}var xpos=clientX-topWindow.innerWidth;var ypos=clientY-(parseInt(_frame.style.top)||0);_frame.style.transform="translate("+xpos+"px,"+ypos+"px)"}}this.translate=translate;if(typeof insideFrontInterface!="undefined"){insideFrontInterface.chat.translate=translate}function translate(str){if(typeof str!="string"){str=str[language]||str.en}if(typeof(str)=="undefined"||str==null){return""}if(insideFrontInterface.labelTranslations&&insideFrontInterface.labelTranslations.translations[str]){return insideFrontInterface.labelTranslations.translations[str]}if(insideFrontInterface.labelTranslations&&insideFrontInterface.labelTranslations.translations){var squareReplace=/\[(.*?)\]/gi;var squareReplace2=/\[(.*?)\]/i;var regExCharReplace=/[-[\]{}()*+?.,\\^$|#\s]/g;var clearStr=str.replace(/<br\s*[\/]?>/gi," ");for(var i in insideFrontInterface.labelTranslations.translations){if(i.indexOf("[")==-1){continue}var englishPhrase=i;var translation=insideFrontInterface.labelTranslations.translations[i];if(typeof(translation)=="undefined"){continue}var toMatch="";toMatch=englishPhrase.replace(squareReplace,"XREPLACEX");toMatch=toMatch.replace(regExCharReplace,"\\$&");toMatch=toMatch.split("XREPLACEX").join("(.*)");toMatch="^"+toMatch+"(.)*$";var regex=new RegExp(toMatch,"gi");var matches=clearStr.match(regex);if(matches!=null&&matches.length>0){var newStr=translation;if(typeof(translation)=="undefined"||translation==""){return str}var contentsOfBrackets;regex.lastIndex=0;var exec=regex.exec(clearStr);if(exec){contentsOfBrackets=exec[1]}if(exec&&exec.length>1){for(var i=1;i<exec.length;i++){newStr=newStr.replace(squareReplace2,exec[i])}}if(newStr){return newStr}}}}return str}this.showSurvey=showSurvey;function showSurvey(data){var surveyId=0;var force=false;if(typeof data=="string"||typeof data=="number"){surveyId=data}else{surveyId=data.settings.surveyid;force=data.settings.force}if(force){}else{if(chatSettings.postChatSurvey&&chatSettings.postChatSurvey!=""){surveyId=chatSettings.postChatSurvey}else{return}}if(surveyId==0){return}if(!insideSurvey2.showSurvey){_insideGraph.initModule("survey2")}setTimeout(function(){insideSurvey2.showSurvey(surveyId,data)},chatEndedByCustomer?0:3000)}var footerClosed=false;var hideFooterTimeout;this.hideInputFooter=hideInputFooter;function hideInputFooter(){hideFooterTimeout=setTimeout(hideFooter2,0)}function hideFooter2(){var footer=document.querySelector("#insideChatPaneInputFooter");footer.style.height=footer.getBoundingClientRect().height+"px";document.getElementById("insideChatPaneFooter").classList.add("inputHidden");footer.style.transition="height 0.3s";setTimeout(function(){footer.style.height="0px"});footer.classList.add("hidden");footerClosed=true;chatPane.classList.add("footerHidden");setTimeout(function(){chatIsAtBottom=scrollIsAtBottom();if(chatIsAtBottom){scrollToBottom()}},1000)}this.showInputFooter=showInputFooter;function showInputFooter(forceScrollToBottom){clearTimeout(hideFooterTimeout);if(footerClosed==false){return}var footer=document.querySelector("#insideChatPaneInputFooter");footer.style.display="";footer.style.height="";footer.classList.remove("hidden");var h=footer.getBoundingClientRect().height;footer.style.height="0px";setTimeout(function(){footer.style.height=h;scaleChatInput()},0);footerClosed=false;document.getElementById("insideChatPaneFooter").classList.remove("inputHidden");chatPane.classList.remove("footerHidden");var scrollPos=chatPaneContent.scrollTop;setTimeout(function(){footer.style.height="";chatIsAtBottom=scrollIsAtBottom();if(chatIsAtBottom||(forceScrollToBottom&&device==2)){scrollToBottom()}scaleChatInput()},1000);if(iOSMobile||iOSiPad){setTimeout(function(){var scrollPos=insideChatPaneContent.scrollTop;var display=footer.style.display;footer.style.display="none";setTimeout(function(){footer.style.display=display;insideChatPaneContent.scrollTop=scrollPos},0)},1000)}scaleChatInput()}function iosMenuRenderFix(){if(iOSMobile||iOSiPad){chatMenuButton.style.opacity="0.9";setTimeout(function(){chatMenuButton.style.opacity=""},100);setTimeout(function(){chatMenuButton.style.opacity="0.9";setTimeout(function(){chatMenuButton.style.opacity=""},1000)},1000)}}var svgTabColour="#1BB9DA";this.setSVGTabColour=setSVGTabColour;function setSVGTabColour(newColour){var svg=topWindow.document.querySelector("#inside_liveChatTab svg");if(!svg){return}var colourReplace=svg.querySelectorAll("[fill='"+svgTabColour+"']");for(var i=0;i<colourReplace.length;i++){colourReplace[i].setAttribute("fill",newColour)}svgTabColour=newColour}function loadCSS(href,id,callback){if(document.getElementById(id)){document.getElementById(id).parentNode.removeChild(document.getElementById(id))}var d=document;var s=d.createElement("link");s.setAttribute("rel","stylesheet");s.setAttribute("type","text/css");s.setAttribute("media","all");s.setAttribute("href",href);s.setAttribute("id",id);if(callback){defer(callback,function(){for(var i in d.styleSheets){if(d.styleSheets[i].href==href){return true}}return false})}var head=d.getElementsByTagName("head")[0];if(head){head.appendChild(s)}else{d.body.appendChild(s)}}function defer(callback,test,interval){if(test()){callback();return}var _ramp=(typeof(interval)=="undefined");var _interval=_ramp?10:interval;var _spin=function(){if(test()){callback()}else{if(_ramp){_interval=_interval>=1000?1000:_interval*2}setTimeout(_spin,_interval)}};setTimeout(_spin,_interval)}function bodyScrollLock(targetElement){if(!targetElement){return}targetElement.ontouchstart=function(event){if(event.targetTouches.length===1){targetElement.initialClientY=event.targetTouches[0].clientY}};targetElement.ontouchmove=function(event){if(event.targetTouches.length===1){handleScroll(event,targetElement)}}}function handleScroll(event,targetElement){var clientY=event.targetTouches[0].clientY-targetElement.initialClientY;if(targetElement&&targetElement.scrollTop===0&&clientY>0){return event.preventDefault()}if(isTargetElementTotallyScrolled(targetElement)&&clientY<0){return event.preventDefault()}event.stopPropagation();return true}function isTargetElementTotallyScrolled(targetElement){return targetElement?targetElement.scrollHeight-targetElement.scrollTop<=targetElement.clientHeight:false}function toDataUrl(url,callback){var xhr=new XMLHttpRequest();xhr.onload=function(){var reader=new FileReader();reader.onloadend=function(){callback(reader.result)};reader.readAsDataURL(xhr.response)};xhr.open("GET",url);xhr.responseType="blob";xhr.send()}this.replaceAllBackgroundImagesWithBase64=replaceAllBackgroundImagesWithBase64;function replaceAllBackgroundImagesWithBase64(callback){var elements=document.querySelectorAll("#insideChatPaneHeader");var num=elements.length;for(var i=0;i<elements.length;i++){var el=elements[i];if(el.style.backgroundImage&&el.style.backgroundImage!="none"){var imageURL=el.style.backgroundImage.split('url("').join("").split('")').join("");imageURL=imageURL.split(_insideCDN).join(_insideLive);toDataUrl(imageURL,function(response){el.style.backgroundImage="url("+response+")";imageDone()})}else{setTimeout(imageDone,0)}}var count=0;function imageDone(){count++;if(count>=num){if(typeof callback=="function"){callback()}}}}this.getAllVisibleConversationIds=getAllVisibleConversationIds;function getAllVisibleConversationIds(){var chatids=[];var els=document.querySelectorAll(".message");for(var i=0;i<els.length;i++){if(typeof els[i].data!="undefined"&&els[i].data.chatid){if(chatids.indexOf(els[i].data.chatid)==-1){chatids.push(els[i].data.chatid)}}}return chatids}this.offlineFormMessageOnly=offlineFormMessageOnly;function offlineFormMessageOnly(data){isMessageOnly=data}function checkOperatorExsits(id){var found=false;for(var i=0;i<availableAssistants.length;i++){if(availableAssistants[i].id.indexOf("assistant:")!=-1){if(availableAssistants[i].id.substring(availableAssistants[i].id.lastIndexOf(":")+1,availableAssistants[i].id.length)==id){found=true;break}}}return found}function canBeAssignedToOtherChannel(data){if($(".joinVideoChat").length==0&&$(".videoChatRequest").length==0&&$("#insideVideoFrame").length==0){if(settingsData&&settingsData.video){return}var showScheduling=false;insideFrontInterface.canBeAssignedToOtherChannel=data;if(insideFrontInterface.canBeAssignedToOtherChannel){if(insideFrontInterface.chatLinkVisitor.operators&&insideFrontInterface.chatLinkVisitor.operators.length>0&&!insideFrontInterface.chatLinkVisitor.allowconnectotheroperator){removeStartANewChatButton();insideAPI.post("/api/chatlinks/track",{key:insideFrontInterface.chatLinkVisitor.key,action:5});if(typeof(settings.offlineChat)!="undefined"&&settings.offlineChat.enabled){chatlinkOfflineForm()}else{if(insideFrontInterface.chatLinkVisitor.operators&&insideFrontInterface.chatLinkVisitor.operators.length>0){setTimeout(function(){if(insideFrontInterface.chatLinkVisitor.offlinemessage){showNotification(insideFrontInterface.chatLinkVisitor.offlinemessage,"chatLinkNoOpMessage")}disableInput();document.getElementById("chatMenuButton").classList.add("disabled");removeElements("#inside_prechatForm, .custom_prechat")},0)}}showScheduling=true}else{var message="";if(insideFrontInterface.chatLinkVisitor.operatoravailablemessage&&insideFrontInterface.chatLinkVisitor.operatoravailablemessage!=""){message=insideFrontInterface.chatLinkVisitor.operatoravailablemessage}else{if(insideFrontInterface.chatLinkVisitor.offlinemessage){message=insideFrontInterface.chatLinkVisitor.offlinemessage}}enableInput();document.getElementById("chatMenuButton").classList.remove("disabled");if(message!=""){removeNotification("chatLinkNoOpMessage");setTimeout(function(){showNotification(message,"chatLinkNoOpMessage")},1000)}}}else{if(getAvailableAssistants().length>0){if(!insideFrontInterface.canBeAssignedToOtherChannel){removeNotification("chatLinkNoOpMessage");enableInput();document.getElementById("chatMenuButton").classList.remove("disabled")}}else{removeStartANewChatButton();insideAPI.post("/api/chatlinks/track",{key:insideFrontInterface.chatLinkVisitor.key,action:5});if(insideFrontInterface.chatLinkVisitor.offlinemessage){setTimeout(function(){showNotification(insideFrontInterface.chatLinkVisitor.offlinemessage,"chatLinkNoOpMessage");if(settings.offlineChat.enabled&&isMessageOnly){setTimeout(function(){$(document.body).find("#inside_leaveMessageForm").css("padding-top",($(document.body).find("#notifications").outerHeight()+20)+"px")},600)}},1000);removeElements("#inside_prechatForm, .custom_prechat")}showScheduling=true}}removeAllNotifications();setTabOffsetPosition();setInputAvailability();if(insideFrontInterface.chat.data&&insideFrontInterface.chat.data.schedulingOperators&&insideFrontInterface.chat.data.schedulingOperators.length){if(showScheduling||new URLSearchParams(location.search).has("insideschedule")){setTimeout(function(){insideScheduling.showInputForm(undefined,_insideGraph.current.subsiteId)},1000)}}if(!showScheduling&&!(new URLSearchParams(location.search).has("insideschedule"))){insideScheduling.closeInputForm()}}else{removeNotification("chatLinkNoOpMessage")}}function chatlinkOfflineForm(){if(insideFrontInterface.virtualassistant_enabled&&settings.chatSettings.offline&&settings.chatSettings.offline.enabled&&settings.chatSettings.offline.workflow&&settings.chatSettings.offline.method=="workflow"){if(!chatInProgress&&typeof(insideWorkflows)!="undefined"&&(!insideWorkflows.currentWorkflow||!insideWorkflows.currentWorkflow.isActive||(!insideWorkflows.currentWorkflow.isOfflineWorkflow&&!insideWorkflows.currentWorkflow.isLeaveMessageWorkflow))){if(settings.restrictPrintConversation==true||insideChatPane.settings.showPreviousChatSessionWithin!="currentsession"){$(document.body).find(".message:not(.welcomeGreeting)").remove()}insideAPI.post("api/workflow/StartWorkflow",{workflowId:settings.chatSettings.offline.workflow,force:false},function(response){},showServerError);chatEndedByCustomer=false;hideInputFooter()}}else{if((settings.chatSettings.offline.method=="form"||settings.chatSettings.offline.method=="message")&&!chatPane.querySelector("#inside_leaveMessageForm")&&!displayingPreviousSessionChat&&chatSettings.offline.enabled==true){if(!document.getElementById("inside_leaveMessageForm")&&!visitorHasChatted){showLeaveMessageForm()}removeElements(".startANewChatButton")}}}this.requestVideoChat=requestVideoChat;function requestVideoChat(customHolder,channelGroupIds){var html="<form id='request_video_form'><div class='inside_formTitle'>Please enter your details</div><label for='nameInput' style='display:none;'>Name</label><input type='text' name='nameInput' id='nameInput' placeholder='Name' aria-label='Enter Name' required><label style='display:none;'>Agree to Disclaimer</label><div class='disclaimer formScrollerText'><label>Disclaimer</label><p class='disclaimerText'></p></div><div class='customFormSubmitButtons'>	<div class='insideSubmitButton popupFormSubmit'>Accept & Continue</div></div></form>";var popupForm=showPopupForm(html,submitRequestVideoChat,customHolder);popupForm.querySelector(".disclaimerText").innerHTML=insideChatPane.settings.videoChatDisclaimer;function submitRequestVideoChat(){var args={name:popupForm.querySelector("#nameInput").value,silentMessage:true,priority:3,silentMessageText:"Video chat requested from chat menu",messageData:{commands:[{name:"SetAssignment",parameters:{channelGroupIds:(channelGroupIds||[])}},{name:"SetVideoChat",parameters:{value:true}}]}};insideFrontInterface.videoChatRequested=true;console.log("submitting",args);insideAPI.post("/api/visitor/InsertPrechat",args,function(data){console.log("submitted",data)})}}function showPopupForm(formHTML,submitFunction,customHolder){if(typeof insideForms=="undefined"){loadJS(_insideCDN+"/js/inside.front.forms.js?v="+_insideScriptVersion,"typeof insideForms != 'undefined'",function(){})}var popupForm=document.createElement("div");popupForm.innerHTML=formHTML;popupForm.classList.add("popupForm");var closeButton=document.createElement("div");closeButton.className="closeButton";closeButton.innerHTML="<span class='icon-close'></span>";popupForm.append(closeButton);closeButton.addEventListener("click",closeForm);if(customHolder){popupForm.classList.remove("popupForm");customHolder.append(popupForm)}else{chatPane.appendChild(popupForm);popupForm.style.transform="translateY(100%)";setTimeout(function(){popupForm.style.transform="translateY(0%)"},0)}var submitButton=popupForm.querySelector(".popupFormSubmit");submitButton.addEventListener("click",function(e){submitClick()});function submitClick(){submitButton.classList.add("disabled");if(typeof insideForms=="undefined"){setTimeout(function(){submitClick()},1000);return}var validate=insideForms.validateForm(popupForm);if(validate.valid){submitFunction(popupForm);if(!customHolder){closeForm()}}else{submitButton.classList.remove("disabled")}}function closeForm(){popupForm.style.transform="translateY(100%)";setTimeout(function(){popupForm.parentNode.removeChild(popupForm)},300)}return popupForm}this.showVideoChatAwaitingMessage=showVideoChatAwaitingMessage;function showVideoChatAwaitingMessage(response){var msg="";if(settings.awaitVideoMessage&&settings.awaitVideoMessage!=null){var videomsg=getLanguageValue(settings.awaitVideoMessage);if(videomsg.length>0){msg=videomsg}else{msg=insideFrontInterface.chat.translate("Connecting")}}else{msg=insideFrontInterface.chat.translate("Connecting")}if(msg&&msg.length>0){showNotification(msg,"queue",false,false,true)}}};if(document.readyState=="complete"||document.readyState=="interactive"){insideChatPane.init()}else{document.addEventListener("DOMContentLoaded",function(){setTimeout(insideChatPane.init,0)})}var insideSurvey2=new function(){function a(i){var h=document.createElement("div");h.appendChild(document.createTextNode(i));return h.innerHTML}this.showSurvey=d;function d(o,j){insideWorkflows.setStyles();insideAPI.post("api/surveys/getSurvey",{surveyId:o},function(p){if(p.data==null){return}if(!insideChatPane.isOpen()){insideChatPane.open(undefined,undefined,true)}n(p.data);setTimeout(insideChatPane.setFrameHeight,300)});var i;function n(F,D,G){D=D||0;i=F.questions[D];i.text=c(i.text);var y=F.settings.nextButtonText||"Next";var E=F.settings.submitButtonText||"Submit";if(!G){$("#inside_holder .surveyQuestionContainer").remove();var G=document.createElement("div");G.setAttribute("aria-live","polite");G.setAttribute("tabindex","2");G.className="surveyQuestionContainer";G.innerHTML="<span tabindex='2' class='icon-close' aria-label='close'></span><div class='questionText'></div><div class='questionControl'></div><button class='surveyNextButton insideSubmitButton' tabindex='2'>"+a(y)+"</button>";document.getElementById("inside_holder").appendChild(G);$(G).find(".icon-close").click(function(J){G.classList.remove("opened");setTimeout(function(){G.parentNode.removeChild(G)},300);if(typeof(j)!="undefined"&&j.stickyid!="undefined"&&j.stickyid>0){$.inside.server.unstick(j.stickyid)}}).clickableByKeyboard();var q=[];G.getElementsByClassName("surveyNextButton")[0].addEventListener("click",function(L){var K=k(F.id,i,G);q.push(K);D++;G.surveyNextButton.style.opacity=0;if(D<F.questions.length){G.questionText.style.opacity=0;G.questionControl.style.opacity=0;if(K.link&&K.link!=""&&K.link!="undefined"){if(typeof(j.chatid)!="undefined"){K.chatid=j.chatid}if(q.length>1){var J={answers:q};if(typeof(j.chatid)!="undefined"){J.chatid=j.chatid}insideAPI.post("api/surveys/AnswerSurveyQuestions",J,function(){})}else{insideAPI.post("/api/surveys/AnswerSurveyQuestion",K,function(){})}if(typeof(j)!="undefined"&&j.stickyid!="undefined"&&j.stickyid>0){$.inside.server.unstick(j.stickyid)}G.classList.remove("opened");setTimeout(function(){G.parentNode.removeChild(G)},300);d(K.link,{})}else{setTimeout(function(){G.classList.remove("dropDown","freeText","nps","starRating","singleSelect","multiSelect","smiley");n(F,D,G);if(D==(F.questions.length-1)){G.surveyNextButton.innerHTML=a(E)}},300)}}else{var J={answers:q};if(typeof(j.chatid)!="undefined"){J.chatid=j.chatid}insideAPI.post("api/surveys/AnswerSurveyQuestions",J,function(){setTimeout(function(){var M=m(F,G);if(insideFrontInterface.chat.settings.salesforceEnable&&insideFrontInterface.chat.settings.salesforceSurveyResults&&!M){insideAPI.post("api/salesforce/InsertInsideSurvey",{surveyid:F.id,chatid:j.chatid,visitorid:j.pid},function(N){})}},300)});if(typeof(j)!="undefined"&&j.stickyid!="undefined"&&j.stickyid>0){$.inside.server.unstick(j.stickyid)}}});$(G).find(".surveyNextButton").clickableByKeyboard()}G.questionControl=G.getElementsByClassName("questionControl")[0];G.questionText=G.getElementsByClassName("questionText")[0];G.surveyNextButton=G.getElementsByClassName("surveyNextButton")[0];G.setAttribute("qid",i.id);G.questionText.innerHTML=a(i.text);G.questionControl.innerHTML="";var s="";if(i.type=="drop down"){var C="Select";if(i.settings&&i.settings.placeholder){C=a(i.settings.placeholder)}G.classList.add("dropDown");G.questionControl.innerHTML='<div class="insideSelectBox"><label>'+C+'</label><span class="icon icon-minimise_2"></span></div>';$(document).find(".insideSelectBox").click(function(){if($(document.body).find("#inside_holder .insideSelectMenu").length===0){$(document.body).find("#inside_holder").append("<div class='insideSelectMenu'><div><h2>Choose a Category</h2><span tabindex='2' class='icon-close insideSelectMenuClose' aria-label='close'></span></div><div class='insideSelectList'>"+s+"</div></div>");$(document.body).find("#inside_holder .insideSelectMenu").show();$(document.body).find("#inside_holder .insideSelectMenu .icon-close").click(function(){$(G).show();h(true)}).clickableByKeyboard();$(document.body).find("#inside_holder .insideSelectMenu li").click(function(){$(document.body).find("#inside_holder .insideSelectMenu li.selected").removeClass("selected");$(this).addClass("selected");$(document).find(".insideSelectBox label").html(a($(this).text()));$(document).find(".insideSelectBox label").attr("link",$(this).attr("link")).attr("answerid",$(this).attr("answerid"));$(G).show();h(true);if(!!i.settings.mandatory){G.surveyNextButton.disabled=false}});$(G).hide();l()}else{$(G).hide();l()}})}for(var w=0;w<i.answers.length;w++){var p=i.answers[w];if(i.type=="free text"){var C="Enter your answer here";if(p.text!=undefined&&p.text!=""){C=p.text}G.classList.add("freeText");G.questionControl.innerHTML='<textarea aria-label="'+a(i.text)+'" style="width:100%;" value="'+w+'" id="ans_'+i.id+"_"+w+'" name="ans_'+i.id+'"></textarea>';$(G.questionControl).find("textarea").attr("placeholder",C);if(!!i.settings.mandatory){$(G).find("textarea").keyup(function(){if($.trim($(this).val()).length>0){G.surveyNextButton.disabled=false}else{G.surveyNextButton.disabled=true}})}}else{if(i.type=="drop down"){if(w==0){s="<ul>"}s+="<li link='"+p.link+"' answerid='"+w+"'>"+a(p.text)+"</li>";if(w>0&&w==i.answers.length-1){s+="</ul>"}}else{if(i.type=="checkbox"){if(w==0){s="<div class='picklist vertical multiple'><div class='picklistOptions'>"}s+='<div tabindex="2" class="picklistOption" value="'+w+'" answerid="'+w+'" id="ans_'+w+'" name="ans_'+i.id+'"><span class="icon-add"></span>'+a(p.text)+"</div>";if(w>0&&w==i.answers.length-1){s+="</div></div>";G.classList.add("multiSelect");G.questionControl.innerHTML=s;$(G).find(".picklistOptions .picklistOption").click(function(){$(this).toggleClass("selected");if($(this).hasClass("selected")){$(this).find("span").removeClass("icon-add").addClass("icon-tick")}else{$(this).find("span").removeClass("icon-tick").addClass("icon-add")}if(!!i.settings.mandatory){var J=$(G).find(".picklistOptions .picklistOption span.icon-tick").length;if(J>0){G.surveyNextButton.disabled=false}else{G.surveyNextButton.disabled=true}}}).clickableByKeyboard()}}else{if(i.type=="star rating"){G.classList.add("starRating");G.questionControl.innerHTML="<div class='starSelectHolder'  a='"+w+"'></div>";$(G).find(".starSelectHolder").each(function(){var J=new $.inside.front.starSelector({holder:$(this)});$(this)[0].starSelector=J});$(G).find(".starSelectHolder .icon-star").click(function(){if(!!i.settings.mandatory){G.surveyNextButton.disabled=false}}).clickableByKeyboard()}else{if(i.type=="yes/no image selection"){var H="<span class='icon-feeling-happy brandColorFont'></span>";var z="<span class='icon-feeling-sad brandColorFont'></span>";if(i.settings.img1!=undefined&&i.settings.img1!=""){H="<img src='"+_insideCDN+i.settings.img1+"' />"}if(i.settings.img2!=undefined&&i.settings.img2!=""){z="<img src='"+_insideCDN+i.settings.img2+"' />"}G.classList.add("smiley");var A="";if(i.settings.noLink&&i.settings.noLink!=""){A="link='"+i.settings.noLink+"'"}var I="";if(i.settings.yesLink&&i.settings.yesLink!=""){I="link='"+i.settings.yesLink+"'"}G.questionControl.innerHTML="<div tabindex='2' aria-label='"+f("Yes")+"' class='insideSurveyQuestionImage2Yes' "+I+">"+H+"</div><div tabindex='2' aria-label='"+f("No")+"' class='insideSurveyQuestionImage2No' "+A+">"+z+"</div>";$(G).find(".insideSurveyQuestionImage2Yes, .insideSurveyQuestionImage2No").click(function(){$(G).find(".insideSurveyQuestionImage2Yes, .insideSurveyQuestionImage2No").removeClass("selected");$(this).addClass("selected");if(!!i.settings.mandatory){G.surveyNextButton.disabled=false}var J=$(this).attr("link");if(!!J&&!isNaN(J)){$(G).attr("link",$(this).attr("link"))}}).clickableByKeyboard()}else{if(i.type=="NPS"){var u='<div class="npsContainer"><ul class="notranslate">';for(var w=0;w<=10;w++){u+='<li tabindex="2" value="'+w+'">'+w+"</li>"}u+='</ul><input type="hidden" ></div>';G.questionControl.innerHTML=u;var x="Not At All Likely";var t="Extremely Likely";var B=G.questionControl.getElementsByClassName("npsContainer")[0];if(typeof(i.settings.lowDesc)!="undefined"){x=a(i.settings.lowDesc);t=a(i.settings.highDesc)}B.innerHTML+='<span class="lowDesc" aria-live="off">'+x+"</span>";B.innerHTML+='<span class="highDesc" aria-live="off">'+t+"</span>";$(B).find("li:first").attr("aria-label","0, "+x);$(B).find("li:last").attr("aria-label","10, "+t);G.classList.add("nps");$(B).find("li").click(function(){var J=$(this).parent();J.find("li").removeClass("selected");J.next("input").val($(this).attr("value"));$(this).addClass("selected");G.surveyNextButton.disabled=false}).clickableByKeyboard()}else{if(w==0){s="<div class='picklist vertical'><div class='picklistOptions'>"}s+='<div tabindex="2" class="picklistOption" link="'+i.answers[w].link+'" value="'+w+'" answerid="'+w+'" id="ans_'+w+'" name="ans_'+i.id+'" s="'+(p.score||"")+'">'+a(p.text)+"</div>";if(w>0&&w==i.answers.length-1){s+="</div></div>";G.classList.add("singleSelect");G.questionControl.innerHTML=s;$(G).find(".picklistOptions .picklistOption").click(function(){$(this).parent().children().removeClass("selected");$(this).addClass("selected");if(!!i.settings.mandatory){G.surveyNextButton.disabled=false}var J=$(this).attr("link");if(!!J&&!isNaN(J)){$(G).attr("link",$(this).attr("link"))}}).clickableByKeyboard()}}}}}}}}if(!!i.settings.mandatory){G.surveyNextButton.disabled=true}if(G.classList.contains("opened")){setTimeout(function(){G.questionText.style.opacity=1;G.questionControl.style.opacity=1;G.surveyNextButton.style.opacity=1},0)}else{setTimeout(function(){G.classList.add("opened")},0)}setTimeout(function(){G.focus()},300)}function h(p){$(document.body).find("#inside_holder .insideSelectMenu .insideSelectList").css("height","0px");setTimeout(function(){if(p){$(document.body).find("#inside_holder .insideSelectMenu").remove()}else{$(document.body).find("#inside_holder .insideSelectMenu").hide()}},200)}function l(){var p=$(document.body).find("#inside_holder .insideSelectMenu");var s=$(document.body).find(".insideSelectMenu .insideSelectList");s.css({height:""});p.css({bottom:"-2000px"}).show();var t=$(document.body).find("#insideChatPane").outerHeight()-$(document.body).find("#insideChatPane #insideChatPaneHeader").outerHeight()-40-57;var q=p.find("ul").outerHeight();p.hide().css("bottom","0px");s.css("height",(q<t?q+24:t)+"px");p.show();setTimeout(function(){p.css({"min-height":"300px"})},300)}function k(u,t,w){var s={surveyid:u,questionid:t.id};if(t.type=="free text"){s.answer=w.questionControl.querySelector("textarea").value.trim()}else{if(t.type=="drop down"){var p=w.questionControl.querySelector(".insideSelectBox label").getAttribute("answerid");var x=w.questionControl.querySelector(".insideSelectBox label").innerText;s.answer=x}else{if(t.type=="checkbox"){s.answer=[];$(w).find(".picklistOptions .picklistOption.selected").each(function(){s.answer.push($(this).text())});s.answer=s.answer.join(", ")}else{if(t.type=="star rating"){s.answer=$(w).find(".starSelectHolder")[0].starSelector.value();s.score=parseInt(s.answer)}else{if(t.type=="yes/no image selection"){s.answer=$(w).find(".insideSurveyQuestionImage2Yes").hasClass("selected")?"yes":"no";s.score=s.answer=="yes"?10:-10;var q=$(w).find(".selected");s.link=q.attr("link")}else{if(t.type=="NPS"){s.answer=$(w).find(".npsContainer input").val();s.score=parseInt(s.answer)}else{var q=$(w).find(".picklistOptions .picklistOption.selected");s.answer=q.text();s.score=parseInt(q.attr("s"));s.link=q.attr("link")}}}}}}return s}function m(s,t){var p="Thanks for the feedback!";if(typeof(s.settings.completionMessage)!="undefined"&&s.settings.completionMessage!=""){p=s.settings.completionMessage}t.removeChild(t.questionControl);t.removeChild(t.surveyNextButton);t.questionText.classList.add("completionMessage");t.questionText.innerHTML=p;t.questionText.style.opacity=1;t.questionControl.style.opacity=1;t.surveyNextButton.style.opacity=1;var q=$(t).attr("link");if(!!q&&!isNaN(q)){t.classList.remove("opened");t.parentNode.removeChild(t);$(t).removeAttr("link");d(q,j)}else{setTimeout(function(){t.classList.remove("opened");setTimeout(function(){t.parentNode.removeChild(t)},300)},2000)}if(typeof insideFrontInterface.surveyCompleteCallback=="function"){insideFrontInterface.surveyCompleteCallback(q)}return q}}function f(h){if(insideFrontInterface&&insideFrontInterface.chat.translate){return insideFrontInterface.chat.translate(h)}else{return h}}var c=(function(){var i=/&(amp);/g,h={amp:"&",},j=function(k,l){return h[l]};return function(k){return k.replace(i,j)}})()};var fileUploader=new function(){this.init=i;function i(){document.getElementById("attachFileItem").addEventListener("click",function(m){document.getElementById("inside_attachmentDropperInput").click();insideChatPane.closeMenu()});if(document.getElementById("attachButton")){document.getElementById("attachButton").addEventListener("click",function(m){insideChatPane.closeMenu();document.getElementById("inside_attachmentDropperInput").click()})}document.getElementById("inside_attachmentDropperInput").addEventListener("change",function(){var t=$(this)[0].files;for(var w=0;w<t.length;w++){var q="."+t[w].name.toLowerCase().split(".").pop();var n=insideChatPane.settings.mimeTypes.split(",");if($.inArray(q,n)<0){var u=n.length>8;var x=insideFrontInterface.chat.translate("The file you attempted to upload ("+q+") <br> is not allowed.");var p=u?insideFrontInterface.chat.translate(' <span><a href="#">Click here</a> to show list of allowed file types.</span>'):"";var o=" <span "+(u?'style="display:none;"':"")+">Allowed file types: "+n.join(", ")+"</span>";var y=k(x+p+o);$(y).find("a").click(function(){$(this).parent().hide().next().show();return false});$(document.getElementById("inside_attachmentDropperInput")).val("")}else{if(t[w].size<(25*1024*1024)){var s=new FormData();s.append("file",t[w]);var z=new c(t[w]);var m=j(s,z);z.ajaxRequest=m}else{alert(insideFrontInterface.chat.translate("Cannot upload files greater than 25 MB"))}}}})}function k(m){var n=insideChatPane.showNotification("<div class='inside_chatMessageFile'><div class='inside_chatMessageFileIconContainer'>"+m+'</div><span style="margin: 0;" class="button">Okay</span></div>',"fileUploadNotification");n.querySelector("span.button").addEventListener("click",function(){insideChatPane.removeNotification("fileUploadNotification")});return n}var a=0;function c(o){var m=this;this.attachmentBubbleId="attachment_"+a++;l({chatid:currentChatId,contentType:"data/uploadprogress",files:[],id:this.attachmentBubbleId,opid:0,pid:$.connection.hub.id,security:0,text:o.name});var n=document.querySelector("#"+this.attachmentBubbleId);var u=document.querySelector("#"+this.attachmentBubbleId+" .inside_progressbar");var s=document.querySelector("#"+this.attachmentBubbleId+" .inside_chatMessageFile");var p=document.querySelector("#"+this.attachmentBubbleId+" .filesize");var q=document.querySelector("#"+this.attachmentBubbleId+" .fileUploadCancelButton");q.addEventListener("click",function(){m.ajaxRequest.abort();m.setProgress(100)});p.innerText=t(o);function t(w){var z="";var x=w.size/1024;if(parseInt(x)>1024){var y=x/1024;z=y.toFixed(2)+" MB"}else{z=x.toFixed(2)+" KB"}return z}this.setProgress=function(x,w){s.querySelector(".bar").style.width=x+"%";if(s.querySelector(".uploadPercent")){s.querySelector(".uploadPercent").innerText=x+"%"}if(parseInt(x)>=100){n.close()}};this.showError=function(){s.querySelector(".uploadPercent").remove();p.innerText=insideFrontInterface.chat.translate("An error has occurred while uploading a file.")};this.setAbort=function(w){var x=this.statusbar}}try{insideFrontInterface.chat.showAttachmentProgressBubble=l}catch(d){}function l(n){var p=h(n.text);var m="<div class='inside_chatMessageFile'><div class='inside_chatMessageFileIconContainer'>"+insideFrontInterface.chat.translate("Uploading File")+"</div><div class='fileUploadCancelButton'><span class='icon-close'></span></div><div class='inside_fileNameContainer'><div class='inside_fileName' dir='ltr'>"+n.text+"</div></div><div class='inside_progressbar'><div class='bar'></div></div><div class='inside_fileDetails' dir='ltr'><div class='fileSize'></div><div class='uploadPercent'></div></div></div>";var o=insideChatPane.showNotification(m);o.id=n.id}function f(){return _insideGraph.current.account+":"+_insideGraph.pid+":"+_insideGraph.accessKey}function j(t,u){var q=!!chatInProgress;var n=f();var m=_insideGraph.accessCheck;var w=_insideSocialUrl+"api/visitor/sendfile?folder=attachments&platform=0";var s={};var p={url:w,beforeSend:function(x){x.setRequestHeader("accesskey",n);x.setRequestHeader("accesscheck",m)},data:t,type:"POST",contentType:false,processData:false,cache:false,xhr:function(){var x=$.ajaxSettings.xhr();if(x.upload){x.upload.addEventListener("progress",function(y){var z=0;var A=y.loaded||y.position;var B=y.total;if(y.lengthComputable){z=Math.ceil(A/B*99)}u.setProgress(z)},false)}return x},success:function(x){if(!q){insideChatPane.showChatStartedText()}u.setProgress(100)},error:function(x){u.showError()}};var o=insideAPI.ajax(p);return o}this.getFileIconByExtension=h;function h(o){var m="";var n=o.toLowerCase().split(".").pop();if(n=="mov"||n=="mp4"||n=="wmv"||n=="webm"||n=="flv"||n=="wma"){m="icon-movie-"}else{m="icon-attachment-"}return m}};var insideAPI={};(function(l,a){a.xhrPool=[];a.xhrPool.abortAll=function(){a(this).each(function(m,n){n.abort()});a.xhrPool=[]};a.ajaxSetup({beforeSend:function(m){a.xhrPool.push(m)},complete:function(n){var m=a.xhrPool.indexOf(n);if(m>-1){a.xhrPool.splice(m,1)}}});function d(t,q,A,x,s,B,w,u){if(typeof(s)=="undefined"){s=true}if(typeof(B)=="undefined"){B="POST"}if(typeof(w)=="undefined"){w="json"}if(typeof(u)=="undefined"){u="application/json"}var D="";if(typeof(_insideGraph)!="undefined"){var o=_insideGraph.current.account+":"+_insideGraph.pid+":"+_insideGraph.accessKey;var n=_insideGraph.accessCheck;q.accesskey=o;q.accesscheck=n;var z={};z.accesskey=o;z.accesscheck=n;D=a.param(z)}var C;if(typeof(_insideSocialUrl)!="undefined"){C=_insideSocialUrl}else{C=_insideLive}var m=(function(){if(navigator.appVersion.indexOf("MSIE")!=-1){var F=parseFloat(navigator.appVersion.split("MSIE")[1]);if(F<10){return true}}return false})();if(m&&"XDomainRequest"in l&&l.XDomainRequest!==null){var E=new XDomainRequest();E.open("post",C+"api/api_call.aspx?call="+t+((D!="")?"&"+D:""));E.onload=function(){var F=new ActiveXObject("Microsoft.XMLDOM");var G=a.parseJSON(E.responseText);F.async=s;if(G==null||typeof(G)=="undefined"){G=a.parseJSON(data.firstChild.textContent)}if(typeof(A)=="function"){A(G)}};E.onerror=function(){_result=false};q=JSON.stringify(q);E.onprogress=function(){};E.ontimeout=function(){};setTimeout(function(){E.send(q)},0);return E}else{if(navigator.userAgent.indexOf("MSIE")!=-1&&parseInt(navigator.userAgent.match(/MSIE ([\d.]+)/)[1],10)<8){return false}else{if(B=="POST"){q=JSON.stringify(q)}var y={};if(typeof(_insideCsrfToken)!="undefined"&&_insideCsrfToken!=null){y.RequestVerificationToken=_insideCsrfToken}var p=a.ajax({type:B,url:C+"api/api_call.aspx?call="+t+((D!="")?"&"+D:""),dataType:w,data:q,contentType:u,async:s,headers:y,success:function(G){if(!_insideIsLive){if(typeof(a.inside)!="undefined"&&a.inside.logging==true){try{console.info("API CALL '"+t+"' success");console.info("API args: ",q);console.info(G)}catch(F){console.log("API CALL '"+t+"' success");console.log("API args: ",q);console.log(G)}}}if(typeof(A)=="function"){A(G)}},error:function(G){if(!_insideIsLive){console.log(G)}if(typeof(x)=="function"){try{console.log("API CALL '"+t+"' error");console.log("API args: ",D);x(G)}catch(F){}}}});return p}}}function f(){var m=_insideLive;if(typeof(_insideLive)=="boolean"&&_insideSocialUrl){m=_insideSocialUrl}return m}insideAPI.prepareApiUrl=j;function j(m){var n=f();return n+m}function k(m){if(typeof(_insideGraph)!="undefined"){m.setRequestHeader("accesskey",_insideGraph.current.account+":"+_insideGraph.pid+":"+_insideGraph.accessKey);m.setRequestHeader("accesscheck",_insideGraph.accessCheck)}else{if(typeof(assistantData)!="undefined"&&assistantData.sessionId){m.setRequestHeader("stoken",assistantData.sessionId)}}}function i(m,n,p,o){if(typeof(o)=="undefined"){o=null}var q=j(m);return a.ajax({type:"post",url:q,beforeSend:function(s){k(s)},dataType:"json",data:JSON.stringify(n),contentType:"application/json",async:true,success:p,error:function(t,w,s){var u=f();if(u==_insideLive&&t&&t.status===403&&(!a.connection.hub||a.connection.hub.state===a.signalR.connectionState.disconnected)){connected=false;virtualStore.showLoadingDialog(insideLanguage.translatePhrase("You have been disconnected from INSIDE, redirecting to login screen...")+"<span class='loadingIcon'></span>");setTimeout("window.location.reload()",4000)}else{if(o){o(t,w,s)}}}})}insideAPI.handlePostError=h;function h(q,p,o,m){var n;if(q.responseJSON&&q.responseJSON.msg&&q.responseJSON.msg!==""){n=q.responseJSON.msg}else{if(q.responseText&&q.responseText!==""){n=q.responseText}else{if(o){n=o}else{n=insideLanguage.translatePhrase("Invalid data provided")}}}if(!m){m=""}if(q.status===403){if(q.getResponseHeader("server")==="awselb/2.0"){insidePopup.showAlert("This action cannot be performed as it failed to satisfy security rules.","ok",null,true,{title:(m?m:"Denied"),anim:false})}else{insidePopup.showAlert("Access denied","ok",null,true,{title:(m?m:"Forbidden"),anim:false});setTimeout(location.reload.bind(location),5000)}}else{insidePopup.showAlert(n,"ok",null,true,{title:m,anim:false})}}function c(m){return a.ajax(m)}insideAPI.call=d;insideAPI.post=i;insideAPI.ajax=c})(window,typeof(_insideGraph)!="undefined"?_insideGraph.jQuery:$);try{insideFrontInterface.chat.parseMessage=parseMessage}catch(e){}function parseMessage(l){if(!l.text||l.text===""){return}if(l.parsed){return l}l.parsed=true;l.unparsedText=l.text;if(l.text.indexOf("/brb")==0){l.text=l.text.substring(5)}if(l.contentType!="text/inside.legacy"&&l.text.indexOf("<div")==-1&&l.text.indexOf("<a href")==-1&&l.text.indexOf("/link")==-1&&l.text.indexOf("<link>")==-1&&l.text.indexOf("http://")==-1&&l.text.indexOf("https://")==-1){var d=replaceEmoticons(l.text);if(d!=l.text){l.contentType="text/html"}l.text=d}if(l.contentType=="text/inside.legacy"){l.text=$("<span></span>").html(l.text).text();var d=replaceEmoticons(l.text);if(d!=l.text){l.contentType="text/html"}l.text=d}else{if(l.contentType=="text/inside.products"){try{l.contentType="text/html";l.containsType="products";var q="";var o=JSON.parse(l.text);for(var h=0;h<o.length;h++){var n=o[h];q+="<a target='_blank' href='"+n.url+"'><div class='inside-product"+(h==o.length-1?" last":"")+"'><div class='inside-product-image'><img src='"+n.img+"' /></div><div class='inside-product-detail'><span class='inside-product-name'>"+n.name+"</span></div></div></a>"}l.text="<div class='inside-products'><div class='inside-products-scroller'>"+q+"</div></div>"}catch(f){console.log("Product render error: ",f);l.contentType="text/plain";l.text="Sorry, I've been unable get those products for you"}}}try{var a=typeof l.botId!="undefined"&&l.botId!=0&&l.botId!="";if(!a&&l.contentType=="text/html"){l.text=insideFrontInterface.safeSanitizeHtml(l.text)}}catch(c){}if(l.contentType&&l.contentType.search("data/")==-1){if(l.text.indexOf("<link>")!=-1){var p=/<link>[\S\s]*?<\/link>/gi;while((result=p.exec(l.text))!==null){var k=result[0];var m=k.split("<link>").join("").split("</link>").join("");var t=m.split("::");var s="_self";if(t[1].indexOf(window.location.host)==-1){s="_blank"}l.contentType="text/html";l.text=l.text.replace(k,"<a href='"+t[1]+"' target='"+s+"'>"+t[0]+"</a>")}}else{if(l.text.indexOf("/link::")!=0){var j=linkify(unquoteAttr(l.text),l.fromid.indexOf("assistant")==0);if(j!=l.text){l.contentType="text/html"}l.text=j}}}l.text=checkMacros(l.text);return l}var dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var dayNamesShort=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var dayNamesMin=["Su","Mo","Tu","We","Th","Fr","Sa"];function checkMacros(c){var a=new Date();c=c.split("{dayofweek}").join(dayNames[a.getDay()]);return c}function RegExpEscape(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function replaceEmoticons(f,a){emoticons={":D":"<img class='emojiReplace' width='24px' height='24px' text=':D' src='"+imageurl+"/emoji/bigsmile.svg' />",":)":"<img class='emojiReplace' width='24px' height='24px' text=':)' src='"+imageurl+"/emoji/slightly-smiling.svg' />",":-)":"<img class='emojiReplace' width='24px' height='24px' text=':-)' src='"+imageurl+"/emoji/bigsmile.svg' />",";)":"<img class='emojiReplace' width='24px' height='24px' text=';)' src='"+imageurl+"/emoji/wink-smile.svg' />",":(":"<img class='emojiReplace' width='24px' height='24px' text=':(' src='"+imageurl+"/emoji/sad.svg' />",":-P":"<img class='emojiReplace' width='24px' height='24px' text=':-P' src='"+imageurl+"/emoji/tongue.svg' />",":'(":"<img class='emojiReplace' width='24px' height='24px' text=\":'(\" src='"+imageurl+"/emoji/crying.svg' />",":-D":"<img class='emojiReplace' width='24px' height='24px' text=':-D' src='"+imageurl+"/emoji/bigsmilegrin.svg' />","<3":"<img class='emojiReplace' width='24px' height='24px' text='<3' src='"+imageurl+"/emoji/love.svg' />","&lt;3":"<img class='emojiReplace' width='24px' height='24px' text='<3' src='"+imageurl+"/emoji/love.svg' />","~OK~":"<img class='emojiReplace' width='24px' height='24px' text='~OK~' src='"+imageurl+"/emoji/thumbsup.svg' />",":o":"<img class='emojiReplace' width='24px' height='24px' text=':o' src='"+imageurl+"/emoji/surprised.svg' />",":-(":"<img class='emojiReplace' width='24px' height='24px' text=':-(' src='"+imageurl+"/emoji/verysad.svg' />","\uD83D\uDE00":"<img class='emojiReplace' width='24px' height='24px' text=':D' src='"+imageurl+"/emoji/bigsmile.svg' />","\uD83D\uDE42":"<img class='emojiReplace' width='24px' height='24px' text=':)' src='"+imageurl+"/emoji/slightly-smiling.svg' />","\uD83D\uDE03":"<img class='emojiReplace' width='24px' height='24px' text=':-)' src='"+imageurl+"/emoji/bigsmile.svg' />","\uD83D\uDE09":"<img class='emojiReplace' width='24px' height='24px' text=';)' src='"+imageurl+"/emoji/wink-smile.svg' />","\uD83D\uDE41":"<img class='emojiReplace' width='24px' height='24px' text=':(' src='"+imageurl+"/emoji/sad.svg' />","\uD83D\uDE1B":"<img class='emojiReplace' width='24px' height='24px' text=':-P' src='"+imageurl+"/emoji/tongue.svg' />","\uD83D\uDE22":"<img class='emojiReplace' width='24px' height='24px' text=\":'(\" src='"+imageurl+"/emoji/crying.svg' />","\uD83D\uDE01":"<img class='emojiReplace' width='24px' height='24px' text=':-D' src='"+imageurl+"/emoji/bigsmilegrin.svg' />","\uD83D\uDE0B":"<img class='emojiReplace' width='24px' height='24px' text=':-P' src='"+imageurl+"/emoji/tongue.svg' />","\uD83D\uDE0D":"<img class='emojiReplace' width='24px' height='24px' text='<3' src='"+imageurl+"/emoji/love.svg' />","\uD83D\uDC4C":"<img class='emojiReplace' width='24px' height='24px' text='~OK~' src='"+imageurl+"/emoji/thumbsup.svg' />","\uD83D\uDE32":"<img class='emojiReplace' width='24px' height='24px' text=':o' src='"+imageurl+"/emoji/surprised.svg' />","\uD83D\uDE1E":"<img class='emojiReplace' width='24px' height='24px' text=':-(' src='"+imageurl+"/emoji/verysad.svg' />"};var h=imageurl+"/smileys/";var d=f;var c;for(emotcode in emoticons){c=new RegExp(RegExpEscape(emotcode),"g");d=d.replace(/&nbsp;/gi," ").replace(c,function(j,k,m){var i=false;if(m.length==j.length){i=true}else{if(m.indexOf(j)>-1){i=true}else{if(k==0&&m[k+j.length].trim().length==0){i=true}else{if(k>0&&m[k-1].trim().length==0&&((k+j.length)>=m.length||m[k+j.length].trim().length==0)){i=true}}}}if(i){var l=emoticons[j];if(l!=undefined){return'<span class="emoji">'+l+"</span>"}}return j})}return d}function linkify(c,k){if(typeof(k)=="undefined"){k=true}var f,h,i,j;if(k){var d=/https?:\/\/.*?\.(?:png|jpg|jpeg|gif)/ig;var a=/\.(png|jpg|jpeg|gif)$/;if(c.match(a)){c=c.replace(d,'<img src="$&"/>');return c}}h=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%\*?=~_|!:,.;\[\](]*[-A-Z0-9+&@#\/%=~_|)][^\ {])/gim;f=replaceTxtNotInA(c,h,'<a href="$1" target="_blank">$1</a>');i=/(\b(www\.)[-A-Z0-9+&@#\/%?=~_|!:,.;\[\](]*[-A-Z0-9+&@#\/%=~_|)][^\ {])/gi;f=replaceTxtNotInA(f,i,'<a href="http://$1" target="_blank">$1</a>');return f}function replaceParenthesis(a){linkInParen=/[\(\[\{](www.).*[\)\]\}]|[\(\[\{](http).*[\)\]\}]/gim;a=a.replace(linkInParen,function(c,d){var h="";var f=c.charAt(0);if(f=="["){h="SQ"}if(f=="{"){h="CU"}return"~"+h+"PARENOPEN~ "+c.substring(1,c.length-1)+" ~"+h+"PARENCLOSE~"});return a}function replaceTxtNotInA(a,l,m){var d=/([\(\{\[]\b(https?|ftp)?(:\/\/)[-A-Z0-9+&@#\/%\*?=~_|!:,.;\[\](]*[-A-Z0-9+&@#\/%=~_|][\)\]\}])/gim;linkIsInParenthesis=d.test(a);if(linkIsInParenthesis){a=replaceParenthesis(a)}else{var f=/([\(\{\[]\b(www\.)[-A-Z0-9+&@#\/%\*?=~_|!:,.;\[\](]*[-A-Z0-9+&@#\/%=~_|)][\)\]\}])/gim;linkIsInParenthesis=f.test(a);if(linkIsInParenthesis){a=replaceParenthesis(a)}}a=">"+a+"<";var k=/(\a href=)(.*?)[<]br[^>]*[>](?=<.a)/gi;var h=a.match(k);if(h){for(var c=0;c<h.length;c++){var j=h[c];a=a.replace(j,j.replace(/[<]br[^>]*[>]/gi,"~BREAK~"))}}a=a.replace(/>([^<>]+)(?!<\/a)</g,function(i,n){return">"+n.replace(l,m)+"<"});a=a.replace(/~BREAK~/g,"<br>");if(linkIsInParenthesis){a=a.split("~PARENOPEN~ ").join("(");a=a.split(" ~PARENCLOSE~").join(")");a=a.split("~SQPARENOPEN~ ").join("[");a=a.split(" ~SQPARENCLOSE~").join("]");a=a.split("~CUPARENOPEN~ ").join("{");a=a.split(" ~CUPARENCLOSE~").join("}")}return a.substring(1,a.length-1)}function chat_string_create_urls(c,f){if(typeof(f)=="undefined"){f=true}var d=/https?:\/\/.*?\.(?:png|jpg|jpeg|gif)/ig;var a=/\.(png|jpg|jpeg|gif)$/;c=c.replace(/(\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|])/gim,function(h){if(f&&h.match(a)){return(h.replace(d,'<img src="$&"/>'))}else{return('<a href="'+h+'" class="autolink" target="_blank">'+h+"</a>")}});return c}function unquoteAttr(c,a){return(""+c).split("&amp;").join("&").replace(/&apos;/g,"").replace(/&quot;/g,'"').replace(/&#10;/g,"\r\n").replace(/&#39;/g,"'").replace(/&nbsp;/g," ").replace(/&#13;/g,"\r\n")}function stripHTML(c){var a=document.createElement("p");a.innerHTML=c;return a.innerText}function containsHTML(a){return/<\/?[a-z][\s\S]*>/.test(a)}function unescapeHtml(d){var c=document.createElement("div");c.innerHTML=d;var a=c.childNodes[0];return a?a.nodeValue:""}(function(a){if(typeof module==="object"&&module.exports){module.exports=a(require("jquery"),window,document)}else{if(typeof define==="function"&&define.amd){define(["jquery"],function(c){a(c,window,document)})}else{a(jQuery,window,document)}}})(function(a,y,m,x){var j=[["Afghanistan ()","af","93"],["Albania (Shqipri)","al","355"],["Algeria ()","dz","213"],["American Samoa","as","1684"],["Andorra","ad","376"],["Angola","ao","244"],["Anguilla","ai","1264"],["Antigua and Barbuda","ag","1268"],["Argentina","ar","54"],["Armenia ()","am","374"],["Aruba","aw","297"],["Australia","au","61",0],["Austria (sterreich)","at","43"],["Azerbaijan (Azrbaycan)","az","994"],["Bahamas","bs","1242"],["Bahrain ()","bh","973"],["Bangladesh ()","bd","880"],["Barbados","bb","1246"],["Belarus ()","by","375"],["Belgium (Belgi)","be","32"],["Belize","bz","501"],["Benin (Bnin)","bj","229"],["Bermuda","bm","1441"],["Bhutan ()","bt","975"],["Bolivia","bo","591"],["Bosnia and Herzegovina (  )","ba","387"],["Botswana","bw","267"],["Brazil (Brasil)","br","55"],["British Indian Ocean Territory","io","246"],["British Virgin Islands","vg","1284"],["Brunei","bn","673"],["Bulgaria ()","bg","359"],["Burkina Faso","bf","226"],["Burundi (Uburundi)","bi","257"],["Cambodia ()","kh","855"],["Cameroon (Cameroun)","cm","237"],["Canada","ca","1",1,["204","226","236","249","250","289","306","343","365","387","403","416","418","431","437","438","450","506","514","519","548","579","581","587","604","613","639","647","672","705","709","742","778","780","782","807","819","825","867","873","902","905"]],["Cape Verde (Kabu Verdi)","cv","238"],["Caribbean Netherlands","bq","599",1],["Cayman Islands","ky","1345"],["Central African Republic (Rpublique centrafricaine)","cf","236"],["Chad (Tchad)","td","235"],["Chile","cl","56"],["Chinese Mainland ()","cn","86"],["Christmas Island","cx","61",2],["Cocos (Keeling) Islands","cc","61",1],["Colombia","co","57"],["Comoros ( )","km","269"],["Congo (DRC) (Jamhuri ya Kidemokrasia ya Kongo)","cd","243"],["Congo (Republic) (Congo-Brazzaville)","cg","242"],["Cook Islands","ck","682"],["Costa Rica","cr","506"],["Cte dIvoire","ci","225"],["Croatia (Hrvatska)","hr","385"],["Cuba","cu","53"],["Curaao","cw","599",0],["Cyprus ()","cy","357"],["Czech Republic (esk republika)","cz","420"],["Denmark (Danmark)","dk","45"],["Djibouti","dj","253"],["Dominica","dm","1767"],["Dominican Republic (Repblica Dominicana)","do","1",2,["809","829","849"]],["Ecuador","ec","593"],["Egypt ()","eg","20"],["El Salvador","sv","503"],["Equatorial Guinea (Guinea Ecuatorial)","gq","240"],["Eritrea","er","291"],["Estonia (Eesti)","ee","372"],["Ethiopia","et","251"],["Falkland Islands (Islas Malvinas)","fk","500"],["Faroe Islands (Froyar)","fo","298"],["Fiji","fj","679"],["Finland (Suomi)","fi","358",0],["France","fr","33"],["French Guiana (Guyane franaise)","gf","594"],["French Polynesia (Polynsie franaise)","pf","689"],["Gabon","ga","241"],["Gambia","gm","220"],["Georgia ()","ge","995"],["Germany (Deutschland)","de","49"],["Ghana (Gaana)","gh","233"],["Gibraltar","gi","350"],["Greece ()","gr","30"],["Greenland (Kalaallit Nunaat)","gl","299"],["Grenada","gd","1473"],["Guadeloupe","gp","590",0],["Guam","gu","1671"],["Guatemala","gt","502"],["Guernsey","gg","44",1],["Guinea (Guine)","gn","224"],["Guinea-Bissau (Guin Bissau)","gw","245"],["Guyana","gy","592"],["Haiti","ht","509"],["Honduras","hn","504"],["Hong Kong SAR ()","hk","852"],["Hungary (Magyarorszg)","hu","36"],["Iceland (sland)","is","354"],["India ()","in","91"],["Indonesia","id","62"],["Iran ()","ir","98"],["Iraq ()","iq","964"],["Ireland","ie","353"],["Isle of Man","im","44",2],["Israel ()","il","972"],["Italy (Italia)","it","39",0],["Jamaica","jm","1",4,["876","658"]],["Japan ()","jp","81"],["Jersey","je","44",3],["Jordan ()","jo","962"],["Kazakhstan ()","kz","7",1],["Kenya","ke","254"],["Kiribati","ki","686"],["Kosovo","xk","383"],["Kuwait ()","kw","965"],["Kyrgyzstan ()","kg","996"],["Laos ()","la","856"],["Latvia (Latvija)","lv","371"],["Lebanon ()","lb","961"],["Lesotho","ls","266"],["Liberia","lr","231"],["Libya ()","ly","218"],["Liechtenstein","li","423"],["Lithuania (Lietuva)","lt","370"],["Luxembourg","lu","352"],["Macau SAR ()","mo","853"],["Macedonia (FYROM) ()","mk","389"],["Madagascar (Madagasikara)","mg","261"],["Malawi","mw","265"],["Malaysia","my","60"],["Maldives","mv","960"],["Mali","ml","223"],["Malta","mt","356"],["Marshall Islands","mh","692"],["Martinique","mq","596"],["Mauritania ()","mr","222"],["Mauritius (Moris)","mu","230"],["Mayotte","yt","262",1],["Mexico (Mxico)","mx","52"],["Micronesia","fm","691"],["Moldova (Republica Moldova)","md","373"],["Monaco","mc","377"],["Mongolia ()","mn","976"],["Montenegro (Crna Gora)","me","382"],["Montserrat","ms","1664"],["Morocco ()","ma","212",0],["Mozambique (Moambique)","mz","258"],["Myanmar (Burma) ()","mm","95"],["Namibia (Namibi)","na","264"],["Nauru","nr","674"],["Nepal ()","np","977"],["Netherlands (Nederland)","nl","31"],["New Caledonia (Nouvelle-Caldonie)","nc","687"],["New Zealand","nz","64"],["Nicaragua","ni","505"],["Niger (Nijar)","ne","227"],["Nigeria","ng","234"],["Niue","nu","683"],["Norfolk Island","nf","672"],["North Korea (   )","kp","850"],["Northern Mariana Islands","mp","1670"],["Norway (Norge)","no","47",0],["Oman ()","om","968"],["Pakistan ()","pk","92"],["Palau","pw","680"],["Palestine ()","ps","970"],["Panama (Panam)","pa","507"],["Papua New Guinea","pg","675"],["Paraguay","py","595"],["Peru (Per)","pe","51"],["Philippines","ph","63"],["Poland (Polska)","pl","48"],["Portugal","pt","351"],["Puerto Rico","pr","1",3,["787","939"]],["Qatar ()","qa","974"],["Runion (La Runion)","re","262",0],["Romania (Romnia)","ro","40"],["Russia ()","ru","7",0],["Rwanda","rw","250"],["Saint Barthlemy","bl","590",1],["Saint Helena","sh","290"],["Saint Kitts and Nevis","kn","1869"],["Saint Lucia","lc","1758"],["Saint Martin (Saint-Martin (partie franaise))","mf","590",2],["Saint Pierre and Miquelon (Saint-Pierre-et-Miquelon)","pm","508"],["Saint Vincent and the Grenadines","vc","1784"],["Samoa","ws","685"],["San Marino","sm","378"],["So Tom and Prncipe (So Tom e Prncipe)","st","239"],["Saudi Arabia (  )","sa","966"],["Senegal (Sngal)","sn","221"],["Serbia ()","rs","381"],["Seychelles","sc","248"],["Sierra Leone","sl","232"],["Singapore","sg","65"],["Sint Maarten","sx","1721"],["Slovakia (Slovensko)","sk","421"],["Slovenia (Slovenija)","si","386"],["Solomon Islands","sb","677"],["Somalia (Soomaaliya)","so","252"],["South Africa","za","27"],["South Korea ()","kr","82"],["South Sudan ( )","ss","211"],["Spain (Espaa)","es","34"],["Sri Lanka ( )","lk","94"],["Sudan ()","sd","249"],["Suriname","sr","597"],["Svalbard and Jan Mayen","sj","47",1],["Swaziland","sz","268"],["Sweden (Sverige)","se","46"],["Switzerland (Schweiz)","ch","41"],["Syria ()","sy","963"],["Taiwan Region ()","tw","886"],["Tajikistan","tj","992"],["Tanzania","tz","255"],["Thailand ()","th","66"],["Timor-Leste","tl","670"],["Togo","tg","228"],["Tokelau","tk","690"],["Tonga","to","676"],["Trinidad and Tobago","tt","1868"],["Tunisia ()","tn","216"],["Turkey (Trkiye)","tr","90"],["Turkmenistan","tm","993"],["Turks and Caicos Islands","tc","1649"],["Tuvalu","tv","688"],["U.S. Virgin Islands","vi","1340"],["Uganda","ug","256"],["Ukraine ()","ua","380"],["United Arab Emirates (  )","ae","971"],["United Kingdom","gb","44",0],["United States","us","1",0],["Uruguay","uy","598"],["Uzbekistan (Ozbekiston)","uz","998"],["Vanuatu","vu","678"],["Vatican City (Citt del Vaticano)","va","39",1],["Venezuela","ve","58"],["Vietnam (Vit Nam)","vn","84"],["Wallis and Futuna (Wallis-et-Futuna)","wf","681"],["Western Sahara ( )","eh","212",1],["Yemen ()","ye","967"],["Zambia","zm","260"],["Zimbabwe","zw","263"],["land Islands","ax","358",1]];for(var p=0;p<j.length;p++){var k=j[p];j[p]={name:k[0],iso2:k[1],dialCode:k[2],priority:k[3]||0,areaCodes:k[4]||null}}"use strict";function d(i,c){if(!(i instanceof c)){throw new TypeError("Cannot call a class as a function")}}function h(B,A){for(var z=0;z<A.length;z++){var c=A[z];c.enumerable=c.enumerable||false;c.configurable=true;if("value"in c){c.writable=true}Object.defineProperty(B,c.key,c)}}function f(c,i,z){if(i){h(c.prototype,i)}if(z){h(c,z)}return c}y.intlTelInputGlobals={instances:{}};var q=0;var l={allowDropdown:true,autoHideDialCode:true,autoPlaceholder:"polite",customPlaceholder:null,dropdownContainer:null,excludeCountries:[],formatOnDisplay:true,geoIpLookup:null,hiddenInput:"",initialCountry:"",localizedCountries:null,nationalMode:true,onlyCountries:[],placeholderNumberType:"MOBILE",preferredCountries:["us","gb"],separateDialCode:false,utilsScript:""};var w=["800","822","833","844","855","866","877","880","881","882","883","884","885","886","887","888","889"];y.addEventListener("load",function(){y.intlTelInputGlobals.windowLoaded=true});var o=function o(B,c){var A=Object.keys(B);for(var z=0;z<A.length;z++){c(A[z],B[A[z]])}};var n=function n(c){o(y.intlTelInputGlobals.instances,function(i){y.intlTelInputGlobals.instances[i][c]()})};var t=function(){function aE(aK,aL){var aI=this;d(this,aE);this.id=q++;this.telInput=aK;this.activeItem=null;this.highlightedItem=null;var aJ=aL||{};this.options={};o(l,function(aM,aN){aI.options[aM]=aJ.hasOwnProperty(aM)?aJ[aM]:aN});this.hadInitialPlaceholder=Boolean(aK.getAttribute("placeholder"))}f(aE,[{key:"_init",value:function P(){var aI=this;if(this.options.nationalMode){this.options.autoHideDialCode=false}if(this.options.separateDialCode){this.options.autoHideDialCode=this.options.nationalMode=false}this.isMobile=/Android|iPad|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(this.isMobile){m.body.classList.add("iti-mobile");if(!this.options.dropdownContainer){this.options.dropdownContainer=m.body}}if(typeof Promise!=="undefined"){var aJ=new Promise(function(aM,aL){aI.resolveAutoCountryPromise=aM;aI.rejectAutoCountryPromise=aL});var aK=new Promise(function(aM,aL){aI.resolveUtilsScriptPromise=aM;aI.rejectUtilsScriptPromise=aL});this.promise=Promise.all([aJ,aK])}else{this.resolveAutoCountryPromise=this.rejectAutoCountryPromise=function(){};this.resolveUtilsScriptPromise=this.rejectUtilsScriptPromise=function(){}}this.selectedCountryData={};this._processCountryData();this._generateMarkup();this._setInitialState();this._initListeners();this._initRequests()}},{key:"_processCountryData",value:function aa(){this._processAllCountries();this._processCountryCodes();this._processPreferredCountries();if(this.options.localizedCountries){this._translateCountriesByLocale()}if(this.options.onlyCountries.length||this.options.localizedCountries){this.countries.sort(this._countryNameSort)}}},{key:"_addCountryCode",value:function c(aK,aI,aL){if(!this.countryCodes.hasOwnProperty(aI)){this.countryCodes[aI]=[]}var aJ=aL||0;this.countryCodes[aI][aJ]=aK}},{key:"_processAllCountries",value:function Y(){if(this.options.onlyCountries.length){var aJ=this.options.onlyCountries.map(function(aK){return aK.toLowerCase()});this.countries=j.filter(function(aK){return aJ.indexOf(aK.iso2)>-1})}else{if(this.options.excludeCountries.length){var aI=this.options.excludeCountries.map(function(aK){return aK.toLowerCase()});this.countries=j.filter(function(aK){return aI.indexOf(aK.iso2)===-1})}else{this.countries=j}}}},{key:"_translateCountriesByLocale",value:function am(){for(var aI=0;aI<this.countries.length;aI++){var aJ=this.countries[aI].iso2.toLowerCase();if(this.options.localizedCountries.hasOwnProperty(aJ)){this.countries[aI].name=this.options.localizedCountries[aJ]}}}},{key:"_countryNameSort",value:function D(aI,aJ){return aI.name.localeCompare(aJ.name)}},{key:"_processCountryCodes",value:function Z(){this.countryCodes={};for(var aJ=0;aJ<this.countries.length;aJ++){var aI=this.countries[aJ];this._addCountryCode(aI.iso2,aI.dialCode,aI.priority);if(aI.areaCodes){for(var aK=0;aK<aI.areaCodes.length;aK++){this._addCountryCode(aI.iso2,aI.dialCode+aI.areaCodes[aK])}}}}},{key:"_processPreferredCountries",value:function ab(){this.preferredCountries=[];for(var aK=0;aK<this.options.preferredCountries.length;aK++){var aI=this.options.preferredCountries[aK].toLowerCase();var aJ=this._getCountryData(aI,false,true);if(aJ){this.preferredCountries.push(aJ)}}}},{key:"_createEl",value:function E(aL,aI,aJ){var aK=m.createElement(aL);if(aI){o(aI,function(aM,aN){return aK.setAttribute(aM,aN)})}if(aJ){aJ.appendChild(aK)}return aK}},{key:"_generateMarkup",value:function F(){this.telInput.setAttribute("autocomplete","off");var aL="intl-tel-input";if(this.options.allowDropdown){aL+=" allow-dropdown"}if(this.options.separateDialCode){aL+=" separate-dial-code"}var aM=this._createEl("div",{"class":aL});this.telInput.parentNode.insertBefore(aM,this.telInput);this.flagsContainer=this._createEl("div",{"class":"flag-container"},aM);aM.appendChild(this.telInput);this.selectedFlag=this._createEl("div",{"class":"selected-flag",role:"combobox","aria-owns":"country-listbox"},this.flagsContainer);this.selectedFlagInner=this._createEl("div",{"class":"iti-flag"},this.selectedFlag);if(this.options.separateDialCode){this.selectedDialCode=this._createEl("div",{"class":"selected-dial-code"},this.selectedFlag)}if(this.options.allowDropdown){this.selectedFlag.setAttribute("tabindex","0");this.dropdownArrow=this._createEl("div",{"class":"iti-arrow"},this.selectedFlag);this.countryList=this._createEl("ul",{"class":"country-list hide mediumscroll",id:"country-listbox","aria-expanded":"false",role:"listbox"});if(this.preferredCountries.length){this._appendListItems(this.preferredCountries,"preferred");this._createEl("li",{"class":"divider",role:"separator","aria-disabled":"true"},this.countryList)}this._appendListItems(this.countries,"standard");if(this.options.dropdownContainer){this.dropdown=this._createEl("div",{"class":"intl-tel-input iti-container"});this.dropdown.appendChild(this.countryList)}else{this.flagsContainer.appendChild(this.countryList)}}if(this.options.hiddenInput){var aI=this.options.hiddenInput;var aK=this.telInput.getAttribute("name");if(aK){var aJ=aK.lastIndexOf("[");if(aJ!==-1){aI="".concat(aK.substr(0,aJ),"[").concat(aI,"]")}}this.hiddenInput=this._createEl("input",{type:"hidden",name:aI});aM.appendChild(this.hiddenInput)}}},{key:"_appendListItems",value:function i(aK,aJ){var aM="";for(var aL=0;aL<aK.length;aL++){var aI=aK[aL];aM+="<li class='country ".concat(aJ,"' id='iti-item-").concat(aI.iso2,"' role='option' data-dial-code='").concat(aI.dialCode,"' data-country-code='").concat(aI.iso2,"'>");aM+="<div class='flag-box'><div class='iti-flag ".concat(aI.iso2,"'></div></div>");aM+="<span class='country-name'>".concat(aI.name,"</span>");aM+="<span class='dial-code'>+".concat(aI.dialCode,"</span>");aM+="</li>"}this.countryList.insertAdjacentHTML("beforeend",aM)}},{key:"_setInitialState",value:function ai(){var aP=this.telInput.value;var aK=this._getDialCode(aP);var aM=this._isRegionlessNanp(aP);var aI=this.options,aL=aI.initialCountry,aN=aI.nationalMode,aJ=aI.autoHideDialCode,aO=aI.separateDialCode;if(aK&&!aM){this._updateFlagFromNumber(aP)}else{if(aL!=="auto"){if(aL){this._setFlag(aL.toLowerCase())}else{if(aK&&aM){this._setFlag("us")}else{this.defaultCountry=this.preferredCountries.length?this.preferredCountries[0].iso2:this.countries[0].iso2;if(!aP){this._setFlag(this.defaultCountry)}}}if(!aP&&!aN&&!aJ&&!aO){this.telInput.value="+".concat(this.selectedCountryData.dialCode)}}}if(aP){this._updateValFromNumber(aP)}}},{key:"_initListeners",value:function U(){this._initKeyListeners();if(this.options.autoHideDialCode){this._initFocusListeners()}if(this.options.allowDropdown){this._initDropdownListeners()}if(this.hiddenInput){this._initHiddenInputListener()}}},{key:"_initHiddenInputListener",value:function S(){var aI=this;this._handleHiddenInputSubmit=function(){aI.hiddenInput.value=aI.getNumber()};if(this.telInput.form){this.telInput.form.addEventListener("submit",this._handleHiddenInputSubmit)}}},{key:"_getClosestLabel",value:function G(){var aI=this.telInput;while(aI&&aI.tagName!=="LABEL"){aI=aI.parentNode}return aI}},{key:"_initDropdownListeners",value:function Q(){var aI=this;this._handleLabelClick=function(aK){if(aI.countryList.classList.contains("hide")){aI.telInput.focus()}else{aK.preventDefault()}};var aJ=this._getClosestLabel();if(aJ){aJ.addEventListener("click",this._handleLabelClick)}this._handleClickSelectedFlag=function(){if(aI.countryList.classList.contains("hide")&&!aI.telInput.disabled&&!aI.telInput.readOnly){aI._showDropdown()}};this.selectedFlag.addEventListener("click",this._handleClickSelectedFlag);this._handleFlagsContainerKeydown=function(aK){var aL=aI.countryList.classList.contains("hide");if(aL&&["ArrowUp","ArrowDown"," ","Enter"].indexOf(aK.key)!==-1){aK.preventDefault();aK.stopPropagation();aI._showDropdown()}if(aK.key==="Tab"){aI._closeDropdown()}};this.flagsContainer.addEventListener("keydown",this._handleFlagsContainerKeydown)}},{key:"_initRequests",value:function V(){var aI=this;if(this.options.utilsScript&&!y.intlTelInputUtils){if(y.intlTelInputGlobals.windowLoaded){y.intlTelInputGlobals.loadUtils(this.options.utilsScript)}else{y.addEventListener("load",function(){y.intlTelInputGlobals.loadUtils(aI.options.utilsScript)})}}else{this.resolveUtilsScriptPromise()}if(this.options.initialCountry==="auto"){this._loadAutoCountry()}else{this.resolveAutoCountryPromise()}}},{key:"_loadAutoCountry",value:function X(){if(y.intlTelInputGlobals.autoCountry){this.handleAutoCountry()}else{if(!y.intlTelInputGlobals.startedLoadingAutoCountry){y.intlTelInputGlobals.startedLoadingAutoCountry=true;if(typeof this.options.geoIpLookup==="function"){this.options.geoIpLookup(function(aI){y.intlTelInputGlobals.autoCountry=aI.toLowerCase();setTimeout(function(){return n("handleAutoCountry")})},function(){return n("rejectAutoCountryPromise")})}}}}},{key:"_initKeyListeners",value:function T(){var aI=this;this._handleKeyupEvent=function(){if(aI._updateFlagFromNumber(aI.telInput.value)){aI._triggerCountryChange()}};this.telInput.addEventListener("keyup",this._handleKeyupEvent);this._handleClipboardEvent=function(){setTimeout(aI._handleKeyupEvent)};this.telInput.addEventListener("cut",this._handleClipboardEvent);this.telInput.addEventListener("paste",this._handleClipboardEvent)}},{key:"_cap",value:function B(aJ){var aI=this.telInput.getAttribute("maxlength");return aI&&aJ.length>aI?aJ.substr(0,aI):aJ}},{key:"_initFocusListeners",value:function R(){var aI=this;this._handleMousedownFocusEvent=function(aJ){if(aI.telInput!==m.activeElement&&!aI.telInput.value){aJ.preventDefault();aI.telInput.focus()}};this.telInput.addEventListener("mousedown",this._handleMousedownFocusEvent);this._handleKeypressPlusEvent=function(aJ){if(aJ.key==="+"){aI.telInput.value=""}};this._handleFocusEvent=function(){if(!aI.telInput.value&&!aI.telInput.readOnly&&aI.selectedCountryData.dialCode){aI.telInput.value="+".concat(aI.selectedCountryData.dialCode);aI.telInput.addEventListener("keypress",aI._handleKeypressPlusEvent);setTimeout(function(){var aJ=aI.telInput.value.length;aI.telInput.setSelectionRange(aJ,aJ)})}};this.telInput.addEventListener("focus",this._handleFocusEvent);this._handleSubmitOrBlurEvent=function(){aI._removeEmptyDialCode()};if(this.telInput.form){this.telInput.form.addEventListener("submit",this._handleSubmitOrBlurEvent)}this.telInput.addEventListener("blur",this._handleSubmitOrBlurEvent)}},{key:"_removeEmptyDialCode",value:function ac(){var aJ=this.telInput.value.charAt(0)==="+";if(aJ){var aI=this._getNumeric(this.telInput.value);if(!aI||this.selectedCountryData.dialCode===aI){this.telInput.value=""}}this.telInput.removeEventListener("keypress",this._handleKeypressPlusEvent)}},{key:"_getNumeric",value:function L(aI){return aI.replace(/\D/g,"")}},{key:"_trigger",value:function an(aJ){var aI=m.createEvent("Event");aI.initEvent(aJ,true,true);this.telInput.dispatchEvent(aI)}},{key:"_showDropdown",value:function aj(){this.countryList.classList.remove("hide");this.countryList.setAttribute("aria-expanded","true");this._setDropdownPosition();if(this.activeItem){this._highlightListItem(this.activeItem);this._scrollTo(this.activeItem)}this._bindDropdownListeners();this.dropdownArrow.classList.add("up");this._trigger("open:countrydropdown");var aJ=this.telInput.offsetWidth;var aI=a(this.telInput).closest(".field-container");if(aI.length>0){aJ=aI[0].offsetWidth}a(this.countryList).outerWidth(aJ).find(".country-name").each(function(){if(this.scrollWidth>this.offsetWidth){this.title=this.innerText}})}},{key:"_toggleClass",value:function al(aJ,aI,aK){if(aK&&!aJ.classList.contains(aI)){aJ.classList.add(aI)}else{if(!aK&&aJ.classList.contains(aI)){aJ.classList.remove(aI)}}}},{key:"_setDropdownPosition",value:function ag(){var aI=this;if(this.options.dropdownContainer){this.options.dropdownContainer.appendChild(this.dropdown)}if(!this.isMobile){var aO=this.telInput.getBoundingClientRect();var aP=y.pageYOffset||m.documentElement.scrollTop;var aN=aO.top+aP;var aL=this.countryList.offsetHeight;var aK=aN+this.telInput.offsetHeight+aL<aP+y.innerHeight;var aJ=aN-aL>aP;this._toggleClass(this.countryList,"dropup",!aK&&aJ);if(this.options.dropdownContainer){var aM=!aK&&aJ?0:this.telInput.offsetHeight;this.dropdown.style.top="".concat(aN+aM,"px");this.dropdown.style.left="".concat(aO.left+m.body.scrollLeft,"px");this._handleWindowScroll=function(){return aI._closeDropdown()};y.addEventListener("scroll",this._handleWindowScroll)}}}},{key:"_getClosestListItem",value:function H(aJ){var aI=aJ;while(aI&&aI!==this.countryList&&!aI.classList.contains("country")){aI=aI.parentNode}return aI===this.countryList?null:aI}},{key:"_bindDropdownListeners",value:function A(){var aI=this;this._handleMouseoverCountryList=function(aM){var aN=aI._getClosestListItem(aM.target);if(aN){aI._highlightListItem(aN)}};this.countryList.addEventListener("mouseover",this._handleMouseoverCountryList);this._handleClickCountryList=function(aM){var aN=aI._getClosestListItem(aM.target);if(aN){aI._selectListItem(aN)}};this.countryList.addEventListener("click",this._handleClickCountryList);var aJ=true;this._handleClickOffToClose=function(){if(!aJ){aI._closeDropdown()}aJ=false};m.documentElement.addEventListener("click",this._handleClickOffToClose);var aK="";var aL=null;this._handleKeydownOnDropdown=function(aM){aM.preventDefault();if(aM.key==="ArrowUp"||aM.key==="ArrowDown"){aI._handleUpDownKey(aM.key)}else{if(aM.key==="Enter"){aI._handleEnterKey()}else{if(aM.key==="Escape"){aI._closeDropdown()}else{if(/^[a-zA-Z- ]$/.test(aM.key)){if(aL){clearTimeout(aL)}aK+=aM.key.toLowerCase();aI._searchForCountry(aK);aL=setTimeout(function(){aK=""},1000)}}}}};m.addEventListener("keydown",this._handleKeydownOnDropdown)}},{key:"_handleUpDownKey",value:function N(aI){var aJ=aI==="ArrowUp"?this.highlightedItem.previousElementSibling:this.highlightedItem.nextElementSibling;if(aJ){if(aJ.classList.contains("divider")){aJ=aI==="ArrowUp"?aJ.previousElementSibling:aJ.nextElementSibling}this._highlightListItem(aJ);this._scrollTo(aJ)}}},{key:"_handleEnterKey",value:function M(){if(this.highlightedItem){this._selectListItem(this.highlightedItem)}}},{key:"_searchForCountry",value:function ae(aK){for(var aI=0;aI<this.countries.length;aI++){if(this._startsWith(this.countries[aI].name,aK)){var aJ=this.countryList.querySelector("#iti-item-".concat(this.countries[aI].iso2));this._highlightListItem(aJ);this._scrollTo(aJ,true);break}}}},{key:"_startsWith",value:function ak(aI,aJ){return aI.substr(0,aJ.length).toLowerCase()===aJ}},{key:"_updateValFromNumber",value:function at(aN){var aM=aN;if(this.options.formatOnDisplay&&y.intlTelInputUtils&&this.selectedCountryData){var aO=!this.options.separateDialCode&&(this.options.nationalMode||aM.charAt(0)!=="+");var aI=intlTelInputUtils.numberFormat,aL=aI.NATIONAL,aK=aI.INTERNATIONAL;var aJ=aO?aL:aK;aM=intlTelInputUtils.formatNumber(aM,this.selectedCountryData.iso2,aJ)}aM=this._beforeSetNumber(aM);this.telInput.value=aM}},{key:"_updateFlagFromNumber",value:function aq(aS){var aQ=aS;var aM=this.selectedCountryData.dialCode==="1";if(aQ&&this.options.nationalMode&&aM&&aQ.charAt(0)!=="+"){if(aQ.charAt(0)!=="1"){aQ="1".concat(aQ)}aQ="+".concat(aQ)}var aL=this._getDialCode(aQ);var aR=this._getNumeric(aQ);var aJ=null;if(aL){var aK=this.countryCodes[this._getNumeric(aL)];var aI=aK.indexOf(this.selectedCountryData.iso2)!==-1;var aN=aL==="+1"&&aR.length>=4;var aO=this.selectedCountryData.dialCode==="1"&&this._isRegionlessNanp(aR);if(!aO&&(!aI||aN)){for(var aP=0;aP<aK.length;aP++){if(aK[aP]){aJ=aK[aP];break}}}}else{if(aQ.charAt(0)==="+"&&aR.length){aJ=""}else{if(!aQ||aQ==="+"){aJ=this.defaultCountry}}}if(aJ!==null){return this._setFlag(aJ)}return false}},{key:"_isRegionlessNanp",value:function W(aJ){var aK=this._getNumeric(aJ);if(aK.charAt(0)==="1"){var aI=aK.substr(1,3);return w.indexOf(aI)!==-1}return false}},{key:"_highlightListItem",value:function O(aI){var aJ=this.highlightedItem;if(aJ){aJ.classList.remove("highlight")}this.highlightedItem=aI;this.highlightedItem.classList.add("highlight")}},{key:"_getCountryData",value:function I(aJ,aM,aI){var aK=aM?j:this.countries;for(var aL=0;aL<aK.length;aL++){if(aK[aL].iso2===aJ){return aK[aL]}}if(aI){return null}throw new Error("No country data for '".concat(aJ,"'"))}},{key:"_setFlag",value:function ah(aI){var aM=this.selectedCountryData.iso2?this.selectedCountryData:{};this.selectedCountryData=aI?this._getCountryData(aI,false,false):{};if(this.selectedCountryData.iso2){this.defaultCountry=this.selectedCountryData.iso2}this.selectedFlagInner.setAttribute("class","iti-flag ".concat(aI));var aO=aI?"".concat(this.selectedCountryData.name,": +").concat(this.selectedCountryData.dialCode):"Unknown";this.selectedFlag.setAttribute("title",aO);if(this.options.separateDialCode){var aJ=this.selectedCountryData.dialCode?"+".concat(this.selectedCountryData.dialCode):"";var aL=this.telInput.parentNode;if(aM.dialCode){aL.classList.remove("iti-sdc-".concat(aM.dialCode.length+1))}if(aJ){aL.classList.add("iti-sdc-".concat(aJ.length))}this.selectedDialCode.innerHTML=aJ}this._updatePlaceholder();if(this.options.allowDropdown){var aN=this.activeItem;if(aN){aN.classList.remove("active");aN.setAttribute("aria-selected","false")}if(aI){var aK=this.countryList.querySelector("#iti-item-".concat(aI));aK.setAttribute("aria-selected","true");aK.classList.add("active");this.activeItem=aK;this.countryList.setAttribute("aria-activedescendant",aK.getAttribute("id"))}}return aM.iso2!==aI}},{key:"_updatePlaceholder",value:function ar(){var aK=this.options.autoPlaceholder==="aggressive"||!this.hadInitialPlaceholder&&this.options.autoPlaceholder==="polite";if(y.intlTelInputUtils&&aK){var aI=intlTelInputUtils.numberType[this.options.placeholderNumberType];var aJ=this.selectedCountryData.iso2?intlTelInputUtils.getExampleNumber(this.selectedCountryData.iso2,this.options.nationalMode,aI):"";aJ=this._beforeSetNumber(aJ);if(typeof this.options.customPlaceholder==="function"){aJ=this.options.customPlaceholder(aJ,this.selectedCountryData)}this.telInput.setAttribute("placeholder",aJ.replace(/\d/g,"x"))}}},{key:"_selectListItem",value:function af(aK){var aI=this._setFlag(aK.getAttribute("data-country-code"));this._closeDropdown();this._updateDialCode(aK.getAttribute("data-dial-code"),true);this.telInput.focus();var aJ=this.telInput.value.length;this.telInput.setSelectionRange(aJ,aJ);if(aI){this._triggerCountryChange()}}},{key:"_closeDropdown",value:function C(){this.countryList.classList.add("hide");this.countryList.setAttribute("aria-expanded","false");this.dropdownArrow.classList.remove("up");m.removeEventListener("keydown",this._handleKeydownOnDropdown);m.documentElement.removeEventListener("click",this._handleClickOffToClose);this.countryList.removeEventListener("mouseover",this._handleMouseoverCountryList);this.countryList.removeEventListener("click",this._handleClickCountryList);if(this.options.dropdownContainer){if(!this.isMobile){y.removeEventListener("scroll",this._handleWindowScroll)}if(this.dropdown.parentNode){this.dropdown.parentNode.removeChild(this.dropdown)}}this._trigger("close:countrydropdown")}},{key:"_scrollTo",value:function ad(aM,aR){var aI=this.countryList;var aU=y.pageYOffset||m.documentElement.scrollTop;var aK=aI.offsetHeight;var aL=aI.getBoundingClientRect().top+aU;var aJ=aL+aK;var aO=aM.offsetHeight;var aP=aM.getBoundingClientRect().top+aU;var aN=aP+aO;var aT=aP-aL+aI.scrollTop;var aS=aK/2-aO/2;if(aP<aL){if(aR){aT-=aS}aI.scrollTop=aT}else{if(aN>aJ){if(aR){aT+=aS}var aQ=aK-aO;aI.scrollTop=aT-aQ}}}},{key:"_updateDialCode",value:function ap(aL,aI){var aJ=this.telInput.value;var aK="+".concat(aL);var aM;if(aJ.charAt(0)==="+"){var aN=this._getDialCode(aJ);if(aN){aM=aJ.replace(aN,aK)}else{aM=aK}}else{if(this.options.nationalMode||this.options.separateDialCode){return}else{if(aJ){aM=aK+aJ}else{if(aI||!this.options.autoHideDialCode){aM=aK}else{return}}}}this.telInput.value=aM}},{key:"_getDialCode",value:function J(aL){var aJ="";if(aL.charAt(0)==="+"){var aM="";for(var aK=0;aK<aL.length;aK++){var aI=aL.charAt(aK);if(!isNaN(parseInt(aI,10))){aM+=aI;if(this.countryCodes[aM]){aJ=aL.substr(0,aK+1)}if(aM.length===4){break}}}}return aJ}},{key:"_getFullNumber",value:function K(){var aM=this.telInput.value.trim();var aI=this.selectedCountryData.dialCode;var aL;var aK=this._getNumeric(aM);var aJ=aK.charAt(0)==="1"?aK:"1".concat(aK);if(this.options.separateDialCode){aL="+".concat(aI)}else{if(aM&&aM.charAt(0)!=="+"&&aM.charAt(0)!=="1"&&aI&&aI.charAt(0)==="1"&&aI.length===4&&aI!==aJ.substr(0,4)){aL=aI.substr(1)}else{aL=""}}return aL+aM}},{key:"_beforeSetNumber",value:function z(aK){var aJ=aK;if(this.options.separateDialCode){var aI=this._getDialCode(aJ);if(aI){if(this.selectedCountryData.areaCodes!==null){aI="+".concat(this.selectedCountryData.dialCode)}var aL=aJ[aI.length]===" "||aJ[aI.length]==="-"?aI.length+1:aI.length;aJ=aJ.substr(aL)}}return this._cap(aJ)}},{key:"_triggerCountryChange",value:function ao(){this._trigger("countrychange")}},{key:"handleAutoCountry",value:function aB(){if(this.options.initialCountry==="auto"){this.defaultCountry=y.intlTelInputGlobals.autoCountry;if(!this.telInput.value){this.setCountry(this.defaultCountry)}this.resolveAutoCountryPromise()}}},{key:"handleUtils",value:function aC(){if(y.intlTelInputUtils){if(this.telInput.value){this._updateValFromNumber(this.telInput.value)}this._updatePlaceholder()}this.resolveUtilsScriptPromise()}},{key:"destroy",value:function au(){var aI=this.telInput.form;if(this.options.allowDropdown){this._closeDropdown();this.selectedFlag.removeEventListener("click",this._handleClickSelectedFlag);this.flagsContainer.removeEventListener("keydown",this._handleFlagsContainerKeydown);var aJ=this._getClosestLabel();if(aJ){aJ.removeEventListener("click",this._handleLabelClick)}}if(this.hiddenInput&&aI){aI.removeEventListener("submit",this._handleHiddenInputSubmit)}if(this.options.autoHideDialCode){this.telInput.removeEventListener("mousedown",this._handleMousedownFocusEvent);this.telInput.removeEventListener("focus",this._handleFocusEvent);if(aI){aI.removeEventListener("submit",this._handleSubmitOrBlurEvent)}this.telInput.removeEventListener("blur",this._handleSubmitOrBlurEvent)}this.telInput.removeEventListener("keyup",this._handleKeyupEvent);this.telInput.removeEventListener("cut",this._handleClipboardEvent);this.telInput.removeEventListener("paste",this._handleClipboardEvent);var aK=this.telInput.parentNode;aK.parentNode.insertBefore(this.telInput,aK);aK.parentNode.removeChild(aK);delete y.intlTelInputGlobals.instances[this.id]}},{key:"getExtension",value:function aw(){if(y.intlTelInputUtils){return intlTelInputUtils.getExtension(this._getFullNumber(),this.selectedCountryData.iso2)}return""}},{key:"getNumber",value:function ax(aI){if(y.intlTelInputUtils){var aJ=this.selectedCountryData.iso2;return intlTelInputUtils.formatNumber(this._getFullNumber(),aJ,aI)}return""}},{key:"getNumberType",value:function ay(){if(y.intlTelInputUtils){return intlTelInputUtils.getNumberType(this._getFullNumber(),this.selectedCountryData.iso2)}return-99}},{key:"getSelectedCountryData",value:function az(){return this.selectedCountryData}},{key:"getValidationError",value:function aA(){if(y.intlTelInputUtils){var aI=this.selectedCountryData.iso2;return intlTelInputUtils.getValidationError(this._getFullNumber(),aI)}return-99}},{key:"isValidNumber",value:function aD(){var aJ=this._getFullNumber().trim();var aI=this.options.nationalMode?this.selectedCountryData.iso2:"";return y.intlTelInputUtils?intlTelInputUtils.isValidNumber(aJ,aI):null}},{key:"setCountry",value:function aF(aJ){var aI=aJ.toLowerCase();if(!this.selectedFlagInner.classList.contains(aI)){this._setFlag(aI);this._updateDialCode(this.selectedCountryData.dialCode,false);this._triggerCountryChange();this._updatePlaceholder()}}},{key:"setNumber",value:function aG(aJ){var aI=this._updateFlagFromNumber(aJ);this._updateValFromNumber(aJ);if(aI){this._triggerCountryChange()}}},{key:"getAllCountries",value:function av(){return j}},{key:"setPlaceholderNumberType",value:function aH(aI){this.options.placeholderNumberType=aI;this._updatePlaceholder()}}]);return aE}();y.intlTelInputGlobals.getCountryData=function(){return j};y.intlTelInputGlobals.getCountryFromDialCode=function(c){if(c){if(c.charAt(0)=="+"){c=c.substr(1)}for(var z=0;z<j.length;z++){if(j[z].dialCode==c){return j[z]}}}return null};var s=function s(z,i,c){var A=m.createElement("script");A.onload=function(){n("handleUtils");if(i){i()}};A.onerror=function(){n("rejectUtilsScriptPromise");if(c){c()}};A.className="iti-load-utils";A.async=true;A.src=z;m.body.appendChild(A)};y.intlTelInputGlobals.loadUtils=function(c){if(!y.intlTelInputUtils&&!y.intlTelInputGlobals.startedLoadingUtilsScript){y.intlTelInputGlobals.startedLoadingUtilsScript=true;if(typeof Promise!=="undefined"){return new Promise(function(z,i){return s(c,z,i)})}s(c)}return null};y.intlTelInputGlobals.defaults=l;y.intlTelInputGlobals.version="14.0.5";var u="intlTelInput";a.fn[u]=function(i){var c=arguments;if(i===x||typeof i==="object"){return this.each(function(){if(!a.data(this,"plugin_"+u)){var A=new t(this,i);A._init();y.intlTelInputGlobals.instances[A.id]=A;a.data(this,"plugin_"+u,A)}})}else{if(typeof i==="string"&&i[0]!=="_"){var z;this.each(function(){var A=a.data(this,"plugin_"+u);if(A instanceof t&&typeof A[i]==="function"){z=A[i].apply(A,Array.prototype.slice.call(c,1))}if(i==="destroy"){a.data(this,"plugin_"+u,null)}});return z!==x?z:this}}}});String.prototype.replaceAll=function(c,a){var d=this;return d.replace(new RegExp(c,"g"),a)};var videoChat=new function(){var a;var x;var X;var al;var m;var ae;var ag=null;var z=false;var A=false;var F=false;var Z=false;var aa=false;var ab=false;var ac=false;var ad=false;var c=this;var y=false;var G=false;var d;c.disableChatOnVideoCall=false;insideChatPane.videoChat=this;this.init=w;function w(an){m=document.getElementById("insideChatPane");x=document.getElementById("inside_holder");a=insideChatPane.jQuery;j()}function j(){a.inside.bind("startVideoChat",U);a.inside.bind("videoRequest",aj);a.inside.bind("videoAccepted",Y);a.inside.bind("endVideoChat",o);a.inside.bind("resetToggles",M);a.inside.bind("screenShareRequest",Q);a.inside.bind("screenAccepted",P);a.inside.bind("endScreenShare",q);a.inside.bind("videoResume",ak);a.inside.bind("videoOnHold",ai);a.inside.bind("transferBasket",W);a.inside.bind("callEstablished",l);a.inside.bind("liveStreamAccepted",B);a.inside.bind("liveStreamDisconnected",C);a.inside.bind("liveStreamLeaveRoom",C);a.inside.bind("liveStreamEnded",C);a.inside.bind("errorNotification",s);a.inside.bind("videoChatTimer",af)}this.setupVideoChat=S;function S(an){if(typeof(settingsData)!="undefined"&&settingsData.video){c.disableChatOnVideoCall=settingsData.video.disableChatOnVideoCall;insideFrontInterface.openChatPane();z=settingsData.video.isScreenShare||settingsData.video.screenShareAccepted;if(typeof(insideFrontInterface.videoChat)=="undefined"){insideFrontInterface.videoChat={disableChatOnVideoCall:c.disableChatOnVideoCall}}H(settingsData.video.name,settingsData.video.token,an);Z=true;A=settingsData.video.screenShareAccepted&&!settingsData.video.isScreenShare}else{if(typeof(settingsData)!="undefined"&&settingsData.videoRequest&&settingsData.videoRequest>0){aj()}else{if(typeof(settingsData)!="undefined"&&settingsData.screenRequest&&settingsData.screenRequest>0){Q()}}}}this.openVideoChat=H;function H(ap,aq,ao){a.inside.videoChat=true;a.inside.videoChatStarting=false;if(ao&&X){if(X.parentNode){X.parentNode.removeChild(X)}m.classList.remove("video");a("#insideVideoFrame").remove()}if(!ap||!aq||a("#insideVideoFrame").length>0){return}ag={roomName:ap,token:aq};X=document.createElement("div");X.id="vidcontainer";m.appendChild(X);var an="camera; ";if(!z){an="camera; "}var ar=_insideSocialUrl+"videochat?w="+_insideGraph.current.account+"&v="+((new Date().getTime()*10000)+6.21355968e+17);X.innerHTML="<iframe id='insideVideoFrame' src='"+ar+"' style='width:100%; height:100%' allow='"+an+"microphone; autoplay' />";al=X.querySelector("iframe");window.addEventListener("message",K);a("#inside_holder #vidOverlay").remove();vidOverlay=document.createElement("div");m.appendChild(vidOverlay);vidOverlay.id="vidOverlay";vidOverlay.addEventListener("click",am);m.classList.add("video");setTimeout(insideChatPane.windowScale,200);setTimeout(function(){if(!top.document.getElementById("inside_holder").classList.contains("portrait")){insideChatPane.setPortraitMode()}},600);top.document.getElementById("inside_holder").classList.add("videoChat");if(insideChatPane.device==1||insideChatPane.device==3){m.classList.add("desktopVideo");insideChatPane.setFrameHeight();if(a(x).hasClass("chatOpen")==false){insideChatPane.toggleMinisedIcon(false)}}}function U(an){if(an.name&&an.token&&insideFrontInterface&&insideFrontInterface.videoChatRequested==true){insideChatPane.removeQueueMessage();c.disableChatOnVideoCall=an.disableChatOnVideoCall;if(typeof(insideFrontInterface.videoChat)=="undefined"){insideFrontInterface.videoChat={disableChatOnVideoCall:c.disableChatOnVideoCall}}H(an.name,an.token,false);if(an.onHold){setTimeout(f,2000)}}}function o(){ag=null;if(X&&X.parentNode){X.parentNode.removeChild(X)}m.classList.remove("video");window.removeEventListener("message",K);insideChatPane.scrollToBottom();L();top.document.getElementById("inside_holder").classList.remove("videoChat");insideChatPane.windowScale();Z=false;insideFrontInterface.videoChatRequested=false;z=false;A=false;y=false;p()}function p(){if(c.disableChatOnVideoCall){insideChatPane.close();insideChatPane.chatPane.classList.remove("disableChatOnVideoCall")}c.disableChatOnVideoCall=false;if(typeof(insideFrontInterface.videoChat)!="undefined"){insideFrontInterface.videoChat={disableChatOnVideoCall:false}}insideChatPane.removeQueueMessage()}function B(){J(true,true);y=true;document.getElementById("vidcontainer").classList.remove("video_on_hold")}function C(){if(!ad){J(false)}y=false;setTimeout(function(){if(G){f()}},5)}function Q(an){an.isScreenShare=true;aj(an)}this.videoRequest=aj;function aj(ap){z=false;if(ap&&ap.isScreenShare){z=ap.isScreenShare}L();joinVideoChatText=insideFrontInterface.chat.translate("Join Video Chat");if(insideFrontInterface&&insideFrontInterface.chat&&insideFrontInterface.chat.data&&insideFrontInterface.chat.data.settings&&insideFrontInterface.chat.data.settings.voiceOnly){joinVideoChatText=insideFrontInterface.chat.translate("Join Voice Chat")}if(z){joinVideoChatText=insideFrontInterface.chat.translate("Join Screen Share")}var ar="";if(insideFrontInterface&&insideFrontInterface.chat&&insideFrontInterface.chat.data&&insideFrontInterface.chat.data.chatSettings&&insideFrontInterface.chat.data.chatSettings.chatPane&&insideFrontInterface.chat.data.chatSettings.chatPane.videoChatDisclaimer){ar=insideFrontInterface.chat.data.chatSettings.chatPane.videoChatDisclaimer}if(z){ar="";if(insideFrontInterface&&insideFrontInterface.chat&&insideFrontInterface.chat.data&&insideFrontInterface.chat.data.chatSettings&&insideFrontInterface.chat.data.chatSettings.chatPane&&insideFrontInterface.chat.data.chatSettings.chatPane.screenShareDisclaimer){ar=insideFrontInterface.chat.data.chatSettings.chatPane.screenShareDisclaimer}if(ar==""){ar=insideFrontInterface.chat.translate("{Operator} would like to share their screen. Would you like to accept?")}var ao=ap&&ap.fromname?ap.fromname:"Operator";ar=ar.replace("{Operator}",ao)}yesText=insideFrontInterface.chat.translate("Accept");NoText=insideFrontInterface.chat.translate("Decline");var an="<div class='videoChatRequest'><div class='videoChatRequestMsg notificationTitle'>"+joinVideoChatText+"</div><div class='videoChatDisclaimerMsg'>"+ar+"</div><span class='button videoChatAcceptBtn'>"+yesText+"</span><span class='button cancel videoChatRejectBtn'>"+NoText+"</span></div>";insideFrontInterface.openChatPane();if(ar.length<300){ae=insideChatPane.showNotification(an,"videochat");k()}else{insideChatPane.showSystemMessage(an,"videochat");var at=document.querySelector("#insideChatPaneContent .message.videochat");var aq=function(au){if(au==null){setTimeout(function(){aq(document.querySelector("#insideChatPaneContent .message.videochat"))},200)}else{ae=au;a(ae).removeClass("system");ae.close=function(){a(ae).remove()};k()}};aq(at)}}function k(){document.querySelector(".videoChatAcceptBtn").addEventListener("click",function(ao){L();ao.preventDefault();ao.stopPropagation();a.inside.videoChatStarting=true;var an=!z?"/api/videochat/accept":"/api/videochat/screenshare/accept";insideAPI.post(an,{},function(ap){if(ap&&ap.name&&ap.token){c.disableChatOnVideoCall=ap.disableChatOnVideoCall;if(ap.isScreenShareInVideo){A=ap.isScreenShareInVideo}if(!z||!ap.isScreenShareInVideo){H(ap.name,ap.token,false);if(ap.onHold){setTimeout(f,2000)}}}})});document.querySelector(".videoChatRejectBtn").addEventListener("click",function(ao){a.inside.videoChat=false;a.inside.videoChatStarting=false;L();var an=!z?"/api/videochat/hangup_visitor":"/api/videochat/screenshare/hangup_visitor";insideAPI.post(an,{})})}function Y(){L();a(document.body).find(".message.broadcastExpiryMsg").remove()}function P(){L();if(A){R()}else{setTimeout(R,2000)}}function L(){if(ae){ae.close();ae=null}}function q(an){z=false;A=false;var ao=[];ao.videochat_visitor_voiceOnly=insideFrontInterface.chat.data.settings.videochat_visitor_voiceOnly;ao.videochat_operator_voiceOnly=insideFrontInterface.chat.data.settings.videochat_operator_voiceOnly;ao.videochat_visitor_cameraAtStart=insideFrontInterface.chat.data.settings.videochat_visitor_cameraAtStart;ao.videochat_operator_cameraAtStart=insideFrontInterface.chat.data.settings.videochat_operator_cameraAtStart;ao.videochat_operator_hideVisitorLastViewDuringVideoChat=insideFrontInterface.chat.data.settings.videochat_operator_hideVisitorLastViewDuringVideoChat;ao.videochat_operator_backgroundImage=insideFrontInterface.chat.data.settings.videochat_operator_backgroundImage;ao.videoChatToken=ag;aa=ao.videochat_operator_audio_muted=an.OperatorAudioMuted;ab=ao.videochat_operator_video_muted=an.OperatorVideoMuted;ac=ao.videochat_visitor_audio_muted=an.VisitorAudioMuted;ad=ao.videochat_visitor_video_muted=an.VisitorVideoMuted;ao.disableChatOnVideoCall=c.disableChatOnVideoCall;al.contentWindow.postMessage({source:"inside",name:"visitor-screenshare-ended",payload:ao},"*");L();c.disableChatOnVideoCall=false;if(typeof(insideFrontInterface.videoChat)!="undefined"){insideFrontInterface.videoChat={disableChatOnVideoCall:false}}}function ak(){document.getElementById("vidcontainer").classList.remove("video_on_hold");G=false;al.contentWindow.postMessage({source:"inside",name:"visitorResume",payload:{}},"*")}function ai(){if(typeof al=="undefined"){return}G=true;al.contentWindow.postMessage({source:"inside",name:"visitorOnHold",payload:{}},"*")}function l(an){if(typeof al=="undefined"){return}al.contentWindow.postMessage({source:"inside",name:"callEstablished",payload:{datetime:an.datetime}},"*")}function W(ao){var an=ao.basket;console.log(an);if(typeof _insideScreenShare!="undefined"){_insideScreenShare.addCartItems(an)}else{if(window.top._insideScreenShare&&window.top._insideScreenShare.addCartItems){window.top._insideScreenShare.addCartItems(an)}else{if(window.parent._insideScreenShare&&window.parent._insideScreenShare.addCartItems){window.parent._insideScreenShare.addCartItems(an)}}}}function K(an){var az=an.data;if(az.source&&az.name){if(az.source==="inside-video"){if(az.name=="ready"){ag.isScreenShareInVideo=A;ag.device=insideChatPane.device;al.contentWindow.postMessage({source:"inside",name:"join_room",payload:ag},"*");if((insideChatPane.device==2||a(document).find("#insideChatPane").hasClass("portrait"))&&!c.disableChatOnVideoCall){al.contentWindow.postMessage({source:"inside",name:"show_chat_button",},"*")}}else{if(az.name=="settings-opened"){a(document).find("#insideChatPane").addClass("videoSettingsOpened")}else{if(az.name=="settings-closed"){a(document).find("#insideChatPane").removeClass("videoSettingsOpened")}else{if(az.name==="reset-toggles"){insideAPI.post("/api/videochat/resetstoragevisitor")}else{if(az.name=="visitorclosed"){insideAPI.post("/api/videochat/hangup_visitor",{});o()}else{if(az.name=="get-settings"){var ax=[];ax.videochat_visitor_voiceOnly=insideFrontInterface.chat.data.settings.videochat_visitor_voiceOnly;ax.videochat_operator_voiceOnly=insideFrontInterface.chat.data.settings.videochat_operator_voiceOnly;ax.videochat_visitor_cameraAtStart=insideFrontInterface.chat.data.settings.videochat_visitor_cameraAtStart;ax.videochat_operator_cameraAtStart=insideFrontInterface.chat.data.settings.videochat_operator_cameraAtStart;ax.videochat_operator_hideVisitorLastViewDuringVideoChat=insideFrontInterface.chat.data.settings.videochat_operator_hideVisitorLastViewDuringVideoChat;ax.videochat_operator_backgroundImage=insideFrontInterface.chat.data.settings.videochat_operator_backgroundImage;ax.videochat_force=Z;ax.isScreenShareInVideo=A;ax.onHold=Z&&settingsData&&settingsData.video&&settingsData.video.onHold;aa=ax.videochat_operator_audio_muted=Z&&settingsData&&settingsData.video&&settingsData.video.OperatorAudioMuted;ab=ax.videochat_operator_video_muted=Z&&settingsData&&settingsData.video&&settingsData.video.OperatorVideoMuted;ac=ax.videochat_visitor_audio_muted=Z&&settingsData&&settingsData.video&&settingsData.video.VisitorAudioMuted;ad=ax.videochat_visitor_video_muted=Z&&settingsData&&settingsData.video&&settingsData.video.VisitorVideoMuted;ax.device=insideChatPane.device;ax.status=insideFrontInterface.chat.translate("You are viewing agent's screen");ax.translatedText=t();ax.disableChatOnVideoCall=c.disableChatOnVideoCall;al.contentWindow.postMessage({source:"inside",name:z?"receive-screenshare-started":"receive-settings",payload:ax},"*")}else{if(az.name=="get-loading"){var ay=z?"Screen Share":"call";var ar=insideFrontInterface.chat.translate("Starting "+ay);var ap="<div class='loadingContainer'><div class='loadingIcon'></div><span class='loadingText'>"+ar+"</span></div>";al.contentWindow.postMessage({source:"inside",name:"receive-loading",payload:ap},"*");setTimeout(function(){if(Z&&settingsData.video.onHold){f()}},5)}else{if(az.name=="chat-button-click"){if(insideChatPane.device==2||a(document).find("#insideChatPane").hasClass("portrait")){E();al.contentWindow.postMessage({source:"inside",name:"chat-button-click-visitor",payload:{isScreenShare:z,device:insideChatPane.device}},"*")}}else{if(az.name=="screenshare-started"){al.contentWindow.postMessage({source:"inside",name:"receive-loading",payload:ap},"*")}else{if(az.name=="resumeVideo"){ah(false)}else{if(az.name=="pauseVideo"){ah(true)}else{if(az.name=="resumeAudio"){i(false)}else{if(az.name=="pauseAudio"){i(true)}else{if(az.name=="participantDisconnected"){insideAPI.post("/api/videochat/disconnected_operator",{})}else{if(az.name=="removeCallOnHold"){document.getElementById("vidcontainer").classList.remove("video_on_hold");G=false}else{if(az.name=="media-permission-error"){var aq=insideFrontInterface.chat.data.settings.videochat_visitor_voiceOnly?"Microphone":"Microphone and Camera";var au=insideFrontInterface.chat.translate("To make this call successfully, permission is needed to use your "+aq);var av=insideFrontInterface.chat.translate("To grant permissions, go to Site Settings in the Browser.");var ao="<div><div>"+au+"</div><div>"+av+"</div></div>";ae=insideChatPane.showNotification(ao,"videochat",null,true);insideAPI.post("/api/videochat/permission/denied",{})}else{if(az.name=="removeNotification"){L()}else{if(az.name=="duplicate-identity"){o();var at=insideFrontInterface.chat.translate("Video started in another browser tab");var aw=insideChatPane.showNotification(at,"videochat",null,true);insideAPI.post("/api/videochat/mediaerror_visitor",{error:at,broadast:false});insideAPI.post("/api/videochat/addmessage_visitor",{message:at})}else{if(az.name=="media-processing-error"){insideAPI.post("/api/videochat/mediaerror_visitor",{error:insideFrontInterface.chat.translate(az.payload.message)})}else{if(az.name=="call-established"){insideAPI.post("/api/videochat/addmessage_visitor",{message:insideFrontInterface.chat.translate("Call Started."),isCallEstablished:true})}else{if(az.name=="add-stats-log"){h(az.payload)}else{if(az.name=="showChatPane"){insideChatPane.showInputFooter(true)}}}}}}}}}}}}}}}}}}}}}}}else{if(az.name=="streams-advisor-speaking"){if(topWindow.insideStreaming&&topWindow.insideStreaming.currentStream&&topWindow.insideStreaming.currentStream!=""){topWindow.insideStreaming.lowerVolume()}}else{if(az.name=="streams-advisor-stopped-speaking"){if(typeof(topWindow.insideStreaming)!="undefined"&&topWindow.insideStreaming&&topWindow.insideStreaming.currentStream&&topWindow.insideStreaming.currentStream!=""){topWindow.insideStreaming.returnVolume()}}}}}}function M(an){if(al){a.inside.videoChat=false;a.inside.videoChatStarting=false;var ao=[];ao.videochat_visitor_cameraAtStart=insideFrontInterface.chat.data.settings.videochat_visitor_cameraAtStart;ao.videochat_operator_cameraAtStart=insideFrontInterface.chat.data.settings.videochat_operator_cameraAtStart;ao.videochat_operator_hideVisitorLastViewDuringVideoChat=insideFrontInterface.chat.data.settings.videochat_operator_hideVisitorLastViewDuringVideoChat;ao.isOperator=an;al.contentWindow.postMessage({source:"inside",name:"reset-toggles",payload:ao},"*")}Z=false;z=false;A=false;aa=false;ab=false;ac=false;ad=false;c.audioMuted=false;L()}function am(an){if(F){an.preventDefault();an.stopPropagation();N();al.contentWindow.postMessage({source:"inside",name:"restore-screen-visitor",payload:{isScreenShare:z,device:insideChatPane.device}},"*")}}this.minimise=this.minimize=E;function E(){F=true;vidcontainer.classList.add("minimised");vidOverlay.style.display="block"}this.restore=N;function N(){F=false;vidcontainer.classList.remove("minimised");vidOverlay.style.display="none"}this.onHold=G;function G(){al.contentWindow.postMessage({source:"inside",name:"operatorOnHold",payload:{}},"*")}this.resumeCall=O;function O(){al.contentWindow.postMessage({source:"inside",name:"operatorResume",payload:{}},"*")}function R(){var an=insideFrontInterface.chat.translate("Starting Screen Share");ag.loadingPayload="<div class='loadingContainer'><div class='loadingIcon'></div><span class='loadingText'>"+an+"</span></div>";al.contentWindow.postMessage({source:"inside",name:"visitor-screenshare-started",payload:ag},"*")}this.showChatNotification=T;function T(){al.contentWindow.postMessage({source:"inside",name:"showChatNotification",payload:"+1"},"*")}var D;this.getUserMedia=u;function u(ao,an,ap){if(typeof(ap)=="undefined"){ap=true}if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia({audio:true,video:ap}).then(function(aq){D=aq;c.localstream=aq;V();if(typeof ao=="function"){ao()}})["catch"](function(aq){console.log(aq);if(typeof an=="function"){an(aq)}})}else{console.log("navigator.mediaDevices or navigator.mediaDevices.getUserMedia is undefined");if(typeof an=="function"){an()}}}this.stopStream=V;function V(){if(D){try{var ap=D.getTracks();for(var ao in ap){ap[ao].stop()}}catch(an){}}}this.checkIfPermissionsAlreadyGranted=n;function n(ap,an){var ao=false;navigator.mediaDevices.enumerateDevices().then(function(aq){aq.forEach(function(ar){if(ar.label&&ar.label!=""){ao=true}else{ao=false}});if(ao){if(typeof ap=="function"){ap()}}else{if(typeof an=="function"){an()}}})["catch"](function(aq){if(typeof an=="function"){an(aq)}})}function ah(an){ad=an;insideAPI.post("/api/videochat/videomuted_visitor",{val:an})}function i(an){ac=an;insideAPI.post("/api/videochat/audiomuted_visitor",{val:an});c.audioMuted=an}this.pauseAudio=I;function I(ap,ao){c.audioMuted=ap;if(typeof ao=="undefined"){ao=false}var an=ap===true?"pause-audio":"resume-audio";al.contentWindow.postMessage({source:"inside",name:an,payload:{skipUpdate:ao}},"*")}this.pauseVideo=J;function J(ap,ao){if(typeof al=="undefined"){return}if(typeof ao=="undefined"){ao=false}var an=ap===true?"pause-video":"resume-video";al.contentWindow.postMessage({source:"inside",name:an,payload:{skipUpdate:ao}},"*")}function f(){var an="Call on hold...";if(z||A){an="Screen share on hold..."}var ao=document.getElementById("vidcontainer");if(ao){ao.setAttribute("data-before-content",insideFrontInterface.chat.translate(an));ao.classList.add("video_on_hold")}}function s(an){var ao="<div><div>"+insideFrontInterface.chat.translate(an.error)+"</div></div>";setTimeout(function(){ae=insideChatPane.showNotification(ao,"videochat",null,true,null,(typeof(an.disableChatOnVideoCall)!="undefined"&&an.disableChatOnVideoCall?insideChatPane.close:null))},500)}function h(an){if(insideFrontInterface.chat.data.settings.videochat_stats_log){insideAPI.post("/api/videochat/addstats",an)}}function t(){var an=insideFrontInterface.chat.translate("No one can hear you");var ao=insideFrontInterface.chat.translate("No one can see you");var ar=insideFrontInterface.chat.translate("Poor Connection");var aw=insideFrontInterface.chat.translate("Your connection is poor");var av=insideFrontInterface.chat.translate("Visitor's connection is poor");var aq=insideFrontInterface.chat.translate("Operator's connection is poor");var ap=insideFrontInterface.chat.translate("Operator");var au=insideFrontInterface.chat.translate("Visitor");var at={noOneCanHearYou:an,noOneCanSeeYou:ao,poorConnection:ar,yourConnectionIsPoor:aw,visitorConnectionIsPoor:av,operatorConnectionIsPoor:aq,operator:ap,visitor:au};return at}function af(an){setTimeout(function(){insideChatPane.showVideoChatAwaitingMessage(an)},500);if(an.disableChatOnVideoCall){c.disableChatOnVideoCall=an.disableChatOnVideoCall}}};var clickToCall=new function(){this.setClickToCall=d;function d(h){if(!!h){document.getElementById("clickToCallItem").style.display=""}else{document.getElementById("clickToCallItem").style.display="none"}}this.showClickToCallConnectingPopup=f;function f(k){var h=insideFrontInterface.chat.clickToCallSettings;var j=h&&h.connectingForm?h.connectingForm:{};var m=j.title||insideFrontInterface.chat.translate("CONNECTING YOU");var l="";if(k===true){if(j.text1){l=j.text1}else{l="Thanks, please stand by. An expert will be calling you soon."}}else{if(k==false){if(j.text2){l=j.text2}else{l="Sorry, we could not place your request. Please try later."}}else{l="Please wait, while we place your request."}}$(document.body).find(".c2cContainer h2").text(m);$(document.body).find(".c2cMessageLabel label").text(l);var i=$(document.body).find(".c2cContainer").outerHeight();$(document.body).find(".c2cForm, .c2cContainer h3 + p,.c2cContainer h3").fadeOut(function(){$(document.body).find(".c2cContainer").css("height",i);$(document.body).find(".c2cMessageLabel").fadeIn()})}this.clickToCall=a;insideChatPane.clickToCall=a;function a(){if($(document).find(".c2cContainer.opened").is(":visible")){return}var B;try{B=_insideGraph.getVisitorDetails()||{}}catch(l){B={}}var m=B.firstname||"";var o=B.lastname||"";var s=B.phone||"";var t="";var w="";var u="";var A="";if(s.length>10){t=s.substr(0,3);w=s.substr(3,7);u=s.substr(10)}else{if(s.length>7){t=s.substr(0,3);w=s.substr(3)}else{w=s}}if(t&&t.length>0){var p=window.intlTelInputGlobals.getCountryFromDialCode(t);if(p&&p.iso2){A=p.iso2}}var i=insideFrontInterface.chat.clickToCallSettings;var x=i&&i.requestForm?i.requestForm:{};var z=x.title||"HAVE US CALL YOU BACK";var n=x.heading||"Talk to an Expert now";var h=x.buttonlabel||"CALL ME NOW";var y="";if(m||o||w){if(x.text2){y=x.text2}else{y="Please verify your name and phone number."}}else{if(x.text1){y=x.text1}else{y="Please enter your name and phone number."}}var k=document.createElement("div");k.className="c2cContainer";k.innerHTML="<h2>"+z+"</h2><h3>"+n+"</h3><p insidelabel>"+y+"</p><span class='icon-close'></span><div class='c2cform'><input id='c2cFirstName' type='text' placeholder='First Name'><input id='c2cLastName' type='text' placeholder='Last Name'><div class='c2cPhoneDiv'><span class='c2cCountryCodeSpan'>+1</span><span class='icon-minmize-1'></span><input type='number' class='c2cPhoneInp'></div><input class='c2cPhoneExt' type='number' placeholder='Ext'></div><div class='c2cMessageLabel' style='display:none;'><label></label></div><span class='c2cConfirmButton insideSubmitButton' insidelabel>"+h+"</span>";document.getElementById("inside_holder").appendChild(k);$(document.body).find("#c2cFirstName").val(m);$(document.body).find("#c2cLastName").val(o);$(document.body).find(".c2cContainer .c2cPhoneInp").val(w);$(document.body).find(".c2cContainer .c2cPhoneExt").val(u);var j=function(){k.classList.remove("opened");setTimeout(function(){k.parentNode.removeChild(k)},300)};$(document.body).find("#c2cFirstName").off("blur").blur(function(){$(this).css("border-color","");if($.trim($(this).val()).length==0){$(this).css("border-color",insideFrontInterface.chatSettings.generalStyles.formErrorColor)}else{$(this).css("border-color",insideFrontInterface.chatSettings.generalStyles.formSuccessColor)}});$(document.body).find("#c2cLastName").off("blur").blur(function(){$(this).css("border-color","");if($.trim($(this).val()).length>0){$(this).css("border-color",insideFrontInterface.chatSettings.generalStyles.formSuccessColor)}});k.getElementsByClassName("c2cConfirmButton")[0].addEventListener("click",function(D){var E=true;var C={script:insideFrontInterface.clickToCallScript,firstname:$(document.body).find("#c2cFirstName").val().trim(),lastname:$(document.body).find("#c2cLastName").val().trim(),phonecode:$(document.body).find(".c2cContainer .c2cCountryCodeSpan").text().trim(),phonenum:$(document.body).find(".c2cContainer .c2cPhoneInp").val().trim(),phoneext:$(document.body).find(".c2cContainer .c2cPhoneExt").val().trim()};$(document.body).find("#c2cFirstName").css("border-color","");$(document.body).find(".c2cContainer .c2cPhoneDiv").css("border-color","");if(C.firstname.length==0){$(document.body).find("#c2cFirstName").css("border-color",insideFrontInterface.chatSettings.generalStyles.formErrorColor);E=false}if(C.phonenum.length==0){$(document.body).find(".c2cContainer .c2cPhoneDiv").css("border-color",insideFrontInterface.chatSettings.generalStyles.formErrorColor);E=false}if(!E){return}function G(H){if(H&&(H.status!="Success"||!H.data)){return F(H)}f(true);isClickToCallRequestSent=true}function F(H){f(false)}$(document.body).find(".c2cConfirmButton").css("visibility","hidden");f();insideAPI.post("/api/visitor/clicktocall",C,G,onerror)});k.getElementsByClassName("icon-close")[0].addEventListener("click",function(C){j()});k.getElementsByClassName("c2cPhoneInp")[0].addEventListener("click",function(C){k.getElementsByClassName("c2cPhoneDiv")[0].style.borderColor=insideFrontInterface.chatSettings.generalStyles.brandColor});k.getElementsByClassName("c2cPhoneInp")[0].addEventListener("blur",function(C){$(this).parent(".c2cPhoneDiv").css("border-color","");if($.trim($(this).val()).length==0){$(this).parent(".c2cPhoneDiv").css("border-color",insideFrontInterface.chatSettings.generalStyles.formErrorColor)}else{$(this).parent(".c2cPhoneDiv").css("border-color",insideFrontInterface.chatSettings.generalStyles.formSuccessColor)}});insideChatPane.setupCountryCodeDropdown(function(){c(k,A)});var q=function(C){insideChatPane.showCountryCodeDropdown(null,".c2cPhoneDiv .c2cCountryCodeSpan",".c2cPhoneDiv .c2cPhoneInp")};k.getElementsByClassName("c2cCountryCodeSpan")[0].addEventListener("click",q);k.getElementsByClassName("icon-minmize-1")[0].addEventListener("click",q);setTimeout(function(){k.classList.add("opened");c(k,A);insideChatPane.setFrameHeight()},0)}function c(h,i){$(document.body).find(".insideSelectMenu li.selected").removeClass("selected");if(typeof(i)!="string"||i.length==0){i=insideFrontInterface.getUserCC()}$(document.body).find("#hdnCCPhoneField").intlTelInput("setCountry",i);var j=$(document.body).find("#hdnCCPhoneField").intlTelInput("getSelectedCountryData").dialCode;h.getElementsByClassName("c2cCountryCodeSpan")[0].innerText="+"+j;var k=$(document.body).find("#hdnCCPhoneField").attr("placeholder");if(typeof(k)=="string"){h.getElementsByClassName("c2cPhoneInp")[0].placeholder=$(document.body).find("#hdnCCPhoneField").attr("placeholder")}}};var insideScheduling=new function(){insideChatPane.insideScheduling=this;var d={};var l=null;var k=null;function i(t){var q=$(document.body).find("#inside_holder #schedulingFormOperator");if(t.length!==1){q.append($("<option value=''>"+insideFrontInterface.chat.translate("Anyone")+"</option>"))}for(var s=0;s<t.length;s++){var p=$("<option>").val(t[s].id).text(t[s].name);q.append(p)}}this.closeInputForm=c;function c(){$(document.body).find("#inside_holder .schedulingFormContainer").find(".icon-close").click()}this.showInputForm=m;function m(s,q){if($(document.body).find("#inside_holder .schedulingFrameContainer").length>0){return}l=s&&parseInt(s)?parseInt(s):null;k=q&&parseInt(q)?parseInt(q):null;if(!l&&insideFrontInterface.chat.data.chatlinkvisitor&&insideFrontInterface.chat.data.chatlinkvisitor.teams&&insideFrontInterface.chat.data.chatlinkvisitor.teams.length){l=insideFrontInterface.chat.data.chatlinkvisitor.teams[0]}$(document.body).find("#inside_holder .schedulingFrameContainer").remove();if($(document.body).find("#inside_holder .schedulingFormContainer").length){$(document.body).find("#inside_holder .insideSchedulingContainer").show();$(document.body).find("#inside_holder .insideSelectMenu").show()}else{var p=document.createElement("div");p.className="schedulingFormContainer";p.innerHTML="<div id='insideSchedulingContainer' class='insideSelectMenu'><div class='schedulingFormHeader'><span class='schedulingFormHeaderText'>"+insideFrontInterface.chat.translate("Schedule Appointment")+"</span><span tabindex='-1' class='icon-close' aria-label='close'></span></div><div class='schedulingForm'><div class='schedulingFormRow'><label for='schedulingFormName'>"+insideFrontInterface.chat.translate("Your name?")+"</label><input type='text' id='schedulingFormName' /></div><div class='schedulingFormRow'><label for='schedulingFormEmail'>"+insideFrontInterface.chat.translate("Email for Appointment Confirmation?")+"</label><input type='text' id='schedulingFormEmail' /></div><div class='schedulingFormRow schedulingFormOperatorRow'><label for='schedulingFormOperator'>"+insideFrontInterface.chat.translate("Who would you like to speak to?")+"</label><select class='' id='schedulingFormOperator'></select></div><div class='schedulingFormFooter'></div><div class='schedulingButtonRow'><button class='insideSubmitButton schedulingButton' tabindex='-1'>"+insideFrontInterface.chat.translate("Next")+"</button></div></div></div>";document.getElementById("insideChatPane").appendChild(p);$(document.body).find("#inside_holder .icon-close").click(function(){$(document.body).find("#inside_holder .insideSelectMenu").hide()});$(document.body).find("#inside_holder .schedulingButton").click(function(){if(!o()){return}insideScheduling.showSchedulingFrame();$(document.body).find("#inside_holder").find(".insideSchedulingLoadingContainer").remove();$(document.body).find("#inside_holder").append("<div class='insideSchedulingLoadingContainer'></div>");var t='<div class="sk-fading-circle"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>';$(document.body).find("#inside_holder").find(".insideSchedulingLoadingContainer").append(t);$(document.body).find("#inside_holder .insideSelectMenu").hide()});$(document.body).find("#inside_holder .insideSelectMenu").show();if(insideFrontInterface.chat.data.schedulingOperators&&insideFrontInterface.chat.data.schedulingOperators.length){i(insideFrontInterface.chat.data.schedulingOperators)}else{insideAPI.post("api/live/teams/get/scheduling",{teamId:l,subsiteId:q},function(t){i(t,k)})}if(insideFrontInterface.chat.settings.dynamicHeight){insideChatPane.setFrameHeight()}a()}}function o(){var t=true;var p=$(document.body).find("#inside_holder .schedulingForm");p.find("input").removeClass("invalid");var s=p.find("#schedulingFormName");if(!s||!s.val()||!insideValidation.validate(s.val())){s.addClass("invalid");t=false}var q=p.find("#schedulingFormEmail");if(!q||!q.val()||!insideValidation.validate(q.val(),{email:true})){q.addClass("invalid");t=false}if(t){d.name=s.val();d.email=q.val();d.operator=p.find("#schedulingFormOperator").val()}return t}this.showSchedulingFrame=n;function n(){$(document.body).find("#inside_holder .schedulingFrameContainer").remove();var p=document.createElement("div");p.className="schedulingFrameContainer";p.innerHTML="<iframe id='schedulingFrame'></iframe>";document.getElementById("insideChatPane").appendChild(p);$(document.body).find("#inside_holder .schedulingFrameContainer").show();document.getElementById("schedulingFrame").src=insideFrontInterface.chat.data.schedulingBaseUrl;if(window.addEventListener){window.addEventListener("message",j,false)}else{if(window.attachEvent){window.attachEvent("onmessage",j,false)}}}function f(p){var u=new Date(p);var q=JSON.parse(insideFrontInterface.labelTranslations.daysOfWeek)[u.getDay()];var t=JSON.parse(insideFrontInterface.labelTranslations.months);var s=t[u.getMonth()];return q+", "+s+" "+u.getDate()}function h(){var t=[],p;var q=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var s=0;s<q.length;s++){p=q[s].split("=");t.push(p[0]);t[p[0]]=p[1]}return t}function j(q){if(q.data.type==="PfEvent"){if(q.data.name==="scheduling_ready"){var u={name:d.name,email:d.email,lang:insideChatPane.settings.chatSettings.langCode,id:insideFrontInterface.chat.userid};var t={styles:{buttonBorderRadius:insideFrontInterface.chatSettings.generalStyles.buttonCornerRadius+"px",primaryTextColor:insideFrontInterface.chatSettings.generalStyles.primaryTextColor,secondaryTextColor:insideFrontInterface.chatSettings.generalStyles.secondaryTextColor,primaryColor:insideFrontInterface.chatSettings.generalStyles.brandColor,successColor:insideFrontInterface.chatSettings.generalStyles.formSuccessColor,errorColor:insideFrontInterface.chatSettings.generalStyles.formErrorColor,fonts:insideFrontInterface.chatSettings.chatPane.fonts["default"]}};if(d.operator!==""){document.getElementById("schedulingFrame").contentWindow.postMessage({type:"PfEvent",name:"scheduling_init",page:"AGENT",data:{source:"inside",companyId:_insideGraph.current.account,agentId:d.operator,subsiteId:k,user:u,settings:t}},"*")}else{document.getElementById("schedulingFrame").contentWindow.postMessage({type:"PfEvent",name:"scheduling_init",page:"LOCATION",data:{source:"inside",companyId:_insideGraph.current.account,locationId:l,subsiteId:k,user:u,settings:t}},"*")}setTimeout(function(){$(document.body).find("#inside_holder").find(".insideSchedulingLoadingContainer").remove()},1000)}if(q.data.name==="scheduling_canceled"||q.data.name==="scheduling_complete"){$(document.body).find("#inside_holder .schedulingFrameContainer").hide();if(window.removeEventListener){window.removeEventListener("message",j,false)}else{if(window.detachEvent){window.detachEvent("onmessage",j,false)}}var p=(h()["insideschedule"]!="true");if(p){if(q.data.name==="scheduling_complete"&&q.data.data){var s="<div>"+insideFrontInterface.chat.translate("Appointment has been scheduled for:")+"</div>";s+='<div style="margin: 10px; background: url('+insideFrontInterface.chat.data.schedulingBaseUrl+'/assets/email/email-calendar.png); background-size: 51px 54px; background-position: left center;background-repeat: no-repeat;  height: 54px;width: 100%">';s+='<div style="margin-left: 81px; text-align: left;padding-top: 2px">';s+='<div style="font-weight: bold;white-space:nowrap">'+f(q.data.data.schedule.startTime*1000)+"</div>";s+="<div>"+q.data.data.schedule.timeString+"</div></div></div>";insideChatPane.addMessage({text:s,fromid:"system",addClass:"appointmentScheduled",date:new Date()})}}else{insideFrontInterface.chat.closeChatPane()}}}}function a(){}};var insideValidation=new function(){insideChatPane.insideValidation=this;var a={allowNull:false,allowEmpty:false,alphaNumeric:true,email:false,};var c=/^((?![!.,?@#$%^&*(){};:\"<>[]).)*$/;var d=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;this.validate=f;function f(m,l){if(!l){l=a}if(!l.allowNull&&!m){return false}if(!l.allowEmpty&&!k(m)){return false}if(l.alphaNumeric&&!h(m)){return false}if(l.email&&!j(m)){return false}return true}function k(l){return(l.trim().length>0)}function i(m,l){return l.test(m)}function h(l){return i(l,c)}function j(l){return i(l,d)}};