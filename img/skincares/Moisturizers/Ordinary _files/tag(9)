BrightTag.site('QMQtIZJ',function(s){
s.script('//s.btstatic.com/lib/32cbe8765a6a41d0553df50d1cff9556f184d138.js?v\x3d2').script('//s.btstatic.com/lib/75f5ddb198f7bc466a45081bd722f04984b8b24c.js?v\x3d2').script('//s.btstatic.com/forex.js').script('//s.btstatic.com/lib/b08d27c0e961566e2db56eefcece4b22642eee13.js?v\x3d2').script('//s.btstatic.com/lib/79676213ec9fde90c38c3c4bf096b87855980e05.js?v\x3d2').script('//s.btstatic.com/lib/35396449d4c62aaa8d3087ef954e60e52c5576b3.js?v\x3d2').script('//s.btstatic.com/lib/09c66e2842be260b28f52f1d8d179af2ecfde242.js?v\x3d2').script('//s.btstatic.com/lib/a8690a7205f632257b83009d90ceb4f6da291ff7.js?v\x3d2').script('//s.btstatic.com/lib/699533cffadeca7b9569edc758ea21467e5b4f2c.js?v\x3d2').wait(function(){
s.dbe('async :: certona audience id', 'null;',{pageId:4070462});
s.dbe('page :: certona audience id', 'digitalData.page.attributes.externalRecommendations.audienceId ? \x27certona_\x27 + digitalData.page.attributes.externalRecommendations.audienceId : null;',{pageId:4070462});
s.dbe('link :: validation error messages', '(function () {\r\n  if (typeof eventObject \x3d\x3d\x3d \x27undefined\x27) {\r\n    return;\r\n  }\r\n  var errors \x3d Sephora.analytics.utils.getMostRecentEventProperty({ \r\n    eventObject: eventObject || {},\r\n    pathToProperty: \x27eventInfo.attributes.validationErrorMessages\x27, \r\n    fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n  });\r\n  return (errors || []).join(\x22,\x22) || null; \r\n}());',{pageId:4070462});
s.dbe('ccpa :: consent accept cookies', '(function () {\r\n  if (Sephora.configurationSettings.CCPABannerEnabled) {\r\n     return bt_cookie(\x27ccpaConsentCookie\x27);\r\n  } else {\r\n    return 0;\r\n  }\r\n})();',{pageId:4070462});
s.dbe('page :: search results algorithm type', 'digitalData.page.attributes.search \x26\x26 digitalData.page.attributes.search.searchAlgorithmType;',{pageId:4070462});
s.dbe('page :: referrer', 'digitalData.page.pageInfo.referringURL || document.referrer',{pageId:4070462});
s.dbe('pixel :: braze :: campaign name', '(function () {\r\n  return Sephora.campaign_name;\r\n})();',{pageId:4070462});
s.dbe('user :: accepted advertising cookies', '(function () {\r\n  var adString \x3d \x27advertising cookies:\x27;\r\n  if (bt_cookie(\x27ccpaConsentCookie\x27)\x3d\x3d\x3d\x271\x27) {\r\n     adString+\x3d\x27off\x27;\r\n  } else {\r\n     adString+\x3d\x27on\x27;\r\n  }\r\n  return adString;\r\n})();',{pageId:4070462});
s.dbe('page :: certona impression', 'digitalData.page.attributes.externalRecommendations.vendor ? digitalData.page.attributes.externalRecommendations.vendor + \x27_impression\x27 : null;',{pageId:4070462});
s.dbe('pixel :: braze :: variation name', 'Sephora.variation_name;',{pageId:4070462});
s.dbe('pixel :: braze :: user id', 'Sephora.user_id_for_braze',{pageId:4070462});
s.events.bind('double click footer',window,'DIRECT/doubleClickFooter',{pageId:4070462}).dbe('user :: play status','(function() {\r\n    var country \x3d Sephora.renderQueryParams.country;\r\n    \r\n    if (country \x26\x26 country.toLowerCase() \x3d\x3d\x3d \x27us\x27) {\r\n        return digitalData.user[0].segment.playStatus;\r\n    }\r\n})();').dbe('pixel :: first five recommended pids','(function(){\r\n     return digitalData.page.attributes.externalRecommendations.firstFivePIDs || null;\r\n}())');
s.events.bind('double click category page',window,'DIRECT/doubleClickCategoryPage',{pageId:4070462});
s.events.bind('snapchat product page view event',window,'DIRECT/snapchatProductPageViewEvent',{pageId:4070462}).dbe('double click :: product page :: product type',' digitalData.product[0].attributes.typeForPixel;').dbe('double click :: product page :: sku id','digitalData.product[0].attributes.skuId').dbe('double click :: product page :: sku price','(function(){ \r\n\r\nvar price \x3d\x270.00\x27;\r\n\r\n// return null if digitalData.product null (e.g.: Samples tab)\r\nif (digitalData.product !\x3d\x3d null) {\r\n    price \x3d digitalData.product[0].attributes.price;\r\n}\r\n\r\nvar safelyConvertToUSD \x3d function(price) { /* Remove any currency from the front or back of the string */ price \x3d price.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0]; /* Remove any commas because they break the convertToUSD method */ /* Adding decimals in place of commas for CA/FR */ if (digitalData.page.pageInfo.language.toLowerCase() \x3d\x3d\x3d \x27fr\x27) { price \x3d price.replace(\x27,\x27, \x27.\x27); } else { price \x3d price.replace(\x27,\x27, \x27\x27); } /* Convert to USD using Signal Library */ price \x3d Sephora.analytics.utils.convertToUSD(price); return price; }; return safelyConvertToUSD(price); })();');
s.events.bind('pinterest product page view event',window,'DIRECT/pinterestProductPageViewEvent',{pageId:4070462}).dbe('double click :: product page :: sku id','digitalData.product[0].attributes.skuId').dbe('double click :: product page :: sku price','(function(){\r\n\r\nvar price \x3d \x270.00\x27;\r\n\r\nif (digitalData.product !\x3d\x3d null) {\r\n    price \x3d digitalData.product[0].attributes.price;\r\n}\r\n\r\nvar safelyConvertToUSD \x3d function(price) { /* Remove any currency from the front or back of the string */ price \x3d price.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0]; /* Remove any commas because they break the convertToUSD method */ /* Adding decimals in place of commas for CA/FR */ if (digitalData.page.pageInfo.language.toLowerCase() \x3d\x3d\x3d \x27fr\x27) { price \x3d price.replace(\x27,\x27, \x27.\x27); } else { price \x3d price.replace(\x27,\x27, \x27\x27); } /* Convert to USD using Signal Library */ price \x3d Sephora.analytics.utils.convertToUSD(price); return price; }; return safelyConvertToUSD(price); })();').dbe('double click :: product page :: product type','digitalData.product[0].attributes.typeForPixel;');
s.events.bind('pinterest base pixel initialized',window,'DIRECT/PinterestBasePixelInitialized',{pageId:4070462});
s.events.bind('successfully signed up for credit card',window,'DIRECT/creditCardSignup',{pageId:4070462}).dbe('user :: bi status','(function(){\r\n   return digitalData.user[0].segment.biStatus;\r\n})()').dbe('pixel :: credit card :: status','eventObject.detail.status');
s.events.bind('async page load',window,'DIRECT/asyncPageLoad',{pageId:4070462}).dbe('async :: page :: type','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n        var pageType \x3d anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.pageType || null;\r\n\r\n       /* s.pageType doesn\x27t seem to get updated unless we do the following*/\r\n       s.pageType \x3d pageType;\r\n\r\n\treturn pageType;\r\n}())').dbe('pixel :: facebook :: bi status','digitalData.user[0].segment.fbBiStatus;').dbe('pixel :: facebook :: stringified sku array','(function () { \r\nvar arrVal \x3d Sephora.analytics.utils.getMostRecentEventProperty({ eventObject: eventObject, pathToProperty: \x27eventInfo.attributes.skuId\x27, fallBackEventName: Sephora.analytics.constants.ASYNC_PAGE_LOAD });  return [arrVal]}());').dbe('async product strings','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\treturn anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.productStrings;\r\n}())').dbe('async :: user :: sign in status','digitalData.user[0].segment.signInStatus;').dbe('async previous page name','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\treturn anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.previousPageName || digitalData.page.attributes.sephoraPageInfo.pageName;\r\n}());').dbe('async :: world','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\r\n\treturn anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.world || \x27n/a\x27;\r\n}())').dbe('async previous navigation information','(function(){\r\n\t\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\t\treturn anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.navigationInfo || null;\r\n}());\r\n').dbe('async internal campaign string','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\tvar interCamp \x3d anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.internalCampaign || \x27\x27;\r\nconsole.log(\x27ASYNC INTERNAL CAMPAIGN \x3d\x3d\x3d\x3d\x3d\x3d \x27, interCamp);\r\nreturn interCamp; \r\n}())').dbe('bi account number','digitalData.user[0].segment.biAccountId').dbe('page :: certona placement :: quicklooks','(function () { return Sephora.analytics.utils.getMostRecentEventProperty({ pathToProperty: \x27eventInfo.attributes.certonaContainerName\x27, fallBackEventName: Sephora.analytics.constants.ASYNC_PAGE_LOAD }); }());').dbe('page :: audience segmentation','digitalData.page.attributes.audienceSegmentation;').dbe('page :: number of results','digitalData.page.attributes.search \x26\x26 digitalData.page.attributes.search.numberOfResults;').dbe('async event strings','(function(){\r\n/* This must be nulled out when not present */\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\r\n\tvar events \x3d anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.eventStrings;\r\n    \r\n    var returnVal \x3d (events || []).join(\x27,\x27);\r\n\r\n    if(!returnVal){\r\n    \treturnVal \x3d null;\r\n    }\r\n\r\n    return returnVal;\r\n}())').dbe('async :: category filters','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\treturn (anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.categoryFilters || []).join(\x27,\x27) || null;\r\n}())').dbe('async page name','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\treturn anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.pageName;\r\n}())').dbe('async :: page load time','digitalData.page.renderTime\r\n').dbe('async :: event detail object','eventObject.detail;').dbe('user :: play status','(function() {\r\n    var country \x3d Sephora.renderQueryParams.country;\r\n    \r\n    if (country \x26\x26 country.toLowerCase() \x3d\x3d\x3d \x27us\x27) {\r\n        return digitalData.user[0].segment.playStatus;\r\n    }\r\n})();').dbe('page :: experience store id','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\treturn anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.storeId;\r\n}())').dbe('async action info','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\treturn anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.actionInfo;\r\n}())').dbe('product discovery page','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\r\n\treturn anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.discoveryPageName;\r\n}())').dbe('async previous link data','(function () {\r\n    var anaConsts \x3d Sephora.analytics.constants;\r\n    var linkData \x3d \x27\x27;\r\n\r\n    /* Use if directly set in event */\r\n    linkData \x3d anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.linkData;\r\n\r\n    /* Otherwise use if it was set in previous page data */\r\n    if (!linkData) {\r\n        linkData \x3d digitalData.page.attributes.previousPageData.linkData;\r\n        /* Otherwise return emtpy string so we clear out what was stored from other events */\r\n        if (!linkData) {linkData \x3d \x27\x27;}\r\n    }\r\n\r\n    return linkData;\r\n}());').dbe('async :: user :: bi status','digitalData.user[0].segment.biStatus;').dbe('async :: certona audience id','(function () { return Sephora.analytics.utils.getMostRecentEventProperty({ pathToProperty: \x27eventInfo.attributes.certonaAudienceId\x27, fallBackEventName: Sephora.analytics.constants.ASYNC_PAGE_LOAD }); }());').dbe('async :: page :: page detail','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\treturn anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.pageDetail || null;\r\n}())').dbe('async :: user :: atg id','(function(){\r\n\t/* Don\x27t report profile ID if the user is unrecognized */\r\n\tif (digitalData.user[0].profile[0].profileInfo.signInStatus \x3d\x3d\x3d \x27unrecognized\x27) {\r\n\t\treturn \x27\x27;\r\n\t} else {\r\n\t\treturn digitalData.user[0].profile[0].profileInfo.profileID;\r\n\t}\r\n}())').dbe('async feature strings','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\treturn anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.featureStrings;\r\n}())').dbe('async :: page :: content country','digitalData.page.attributes.sephoraPageInfo.contentCountry.toLowerCase()').dbe('async :: user :: biflash','digitalData.user[0].segment.biPlusFlash;').dbe('async :: dynamic category filter','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\tvar filters \x3d anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.categoryFilters || [];\r\n\t\r\n\tif (filters.length\x3e0) {\r\n\t\treturn \x22D\x3dv56\x22;\r\n\t} else {\r\n                return null\r\n       }\r\n}())\r\n').dbe('pixel :: page url for doubleclick','(function() {\r\n    var url \x3d window.location.href;\r\n    if ((url.indexOf(\x27@\x27) \x3e -1) || (url.indexOf(\x27%40\x27) \x3e -1)) {\r\n        return \x27\x27;\r\n    } else {\r\n        return url;\r\n    }\r\n} ())').dbe('async :: page :: credit card status','(function(){\r\n\tvar anaConsts \x3d Sephora.analytics.constants;\r\n\treturn anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD).eventInfo.attributes.creditCardStatus;\r\n}())').dbe('async previous page type','    (function() {\r\n        var anaConsts \x3d Sephora.analytics.constants;\r\n        var recentEvent \x3d anaConsts.GET_MOST_RECENT_EVENT(anaConsts.ASYNC_PAGE_LOAD);\r\n        var pageName \x3d recentEvent \x26\x26 recentEvent.eventInfo \x26\x26 recentEvent.eventInfo.attributes.previousPageName || digitalData.page.attributes.sephoraPageInfo.pageName;\r\n        return pageName.split(\x27:\x27, 1).pop();\r\n    }());').dbe('page :: search term','digitalData.page.attributes.search \x26\x26 digitalData.page.attributes.search.searchTerm;');
s.events.bind('add to basket',window,'DIRECT/add_to_basket',{pageId:4070462}).dbe('pixel :: google analytics :: sku name','eventObject.detail.name').dbe('pixel :: facebook :: currency','eventObject.detail.currency').dbe('pixel :: google analytics :: product id','eventObject.detail.id').dbe('pixel :: google analytics :: sku variant','eventObject.detail.variant').dbe('pixel :: facebook :: event id','(function () {return digitalData.user[0].profile[0].profileInfo.profileID + digitalData.page.attributes.date.timestamp ; })();').dbe('pixel :: google analytics :: sku quantity','eventObject.detail.quantity').dbe('pixel :: google analytics :: sku type','eventObject.detail.skuType').dbe('pixel :: google analytics :: product category','eventObject.detail.category').dbe('pixel :: facebook :: stringified sku array','eventObject.detail.id').dbe('pixel :: facebook :: contents','JSON.stringify({\r\n\tid: eventObject.detail.id,\r\n\tquantity: eventObject.detail.quantity\r\n})').dbe('pixel :: google analytics :: sku price','(function() {\r\n    return eventObject.detail.price\r\n})();').dbe('pixel :: facebook :: value','eventObject.detail.price').dbe('pixel :: google analytics :: sku brand','eventObject.detail.brand');
s.events.bind('add to wishlist',window,'DIRECT/ga_add_to_wishlist',{pageId:4070462}).dbe('pixel :: google analytics :: product id','eventObject.detail.id').dbe('pixel :: google analytics :: sku name','eventObject.detail.name').dbe('pixel :: google analytics :: sku variant','eventObject.detail.variant').dbe('pixel :: google analytics :: sku brand','eventObject.detail.brand').dbe('pixel :: google analytics :: sku price','eventObject.detail.price');
s.events.bind('pixel :: community profile creation success',window,'DIRECT/communityProfileCreationSuccess',{pageId:4070462});
s.events.bind('facebook base pixel initialized',window,'DIRECT/FacebookBasePixelInitialized',{pageId:4070462}).dbe('page :: type','digitalData.page.category.pageType').dbe('page info :: page name','digitalData.page.pageInfo.pageName');
s.events.bind('snapchat quicklook event',window,'DIRECT/snapchatQuickLoadEvent',{pageId:4070462}).dbe('double click :: product page :: product type','digitalData.product[0].attributes.typeForPixel;').dbe('double click :: product page :: sku price','(function(){\r\n\r\nvar price \x3d\x270.00\x27;\r\n\r\n// return null if digitalData.product null (e.g.: Samples tab)\r\nif (digitalData.product !\x3d\x3d null) {\r\n    price \x3d digitalData.product[0].attributes.price;\r\n}\r\n\r\nvar safelyConvertToUSD \x3d function(price) { /* Remove any currency from the front or back of the string */ price \x3d price.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0]; /* Remove any commas because they break the convertToUSD method */ /* Adding decimals in place of commas for CA/FR */ if (digitalData.page.pageInfo.language.toLowerCase() \x3d\x3d\x3d \x27fr\x27) { price \x3d price.replace(\x27,\x27, \x27.\x27); } else { price \x3d price.replace(\x27,\x27, \x27\x27); } /* Convert to USD using Signal Library */ price \x3d Sephora.analytics.utils.convertToUSD(price); return price; }; return safelyConvertToUSD(price); })();').dbe('double click :: product page :: sku id','digitalData.product[0].attributes.skuId');
s.events.bind('pinterest addtocart event',window,'DIRECT/pinterestAddToCartEvent',{pageId:4070462}).dbe('pixel :: pinterest :: addtocart :: quantity','eventObject.detail.quantity').dbe('pixel :: pinterest :: addtocart :: totalamont','eventObject.detail.totalAmount').dbe('pixel :: pinterest :: addtocart :: lineitems','(function () { return JSON.stringify(eventObject.detail.lineItems) })()');
s.events.bind('removefrombasket',window,'DIRECT/RemoveFromBasket',{pageId:4070462}).dbe('pixel :: google analytics :: sku price','(function() {\r\n    var price \x3d eventObject.detail.price;\r\n    if (price) {\r\n        price \x3d price.replace(\x27,\x27, \x27.\x27);\r\n        price \x3d price.replace(\x27 $\x27, \x27\x27);\r\n    }\r\n    return price;\r\n})();').dbe('pixel :: google analytics :: sku name','eventObject.detail.name').dbe('pixel :: google analytics :: sku variant','eventObject.detail.variant').dbe('pixel :: google analytics :: sku brand','eventObject.detail.brand').dbe('pixel :: google analytics :: product category','eventObject.detail.category').dbe('pixel :: google analytics :: sku type','eventObject.detail.skuType').dbe('pixel :: google analytics :: sku quantity','eventObject.detail.quantity').dbe('pixel :: google analytics :: product id','eventObject.detail.id');
s.events.bind('sign in success',window,'DIRECT/signInSuccess',{pageId:4070462}).dbe('pixel :: first five recommended pids','(function(){ return digitalData.page.attributes.externalRecommendations.firstFivePIDs || null; }())').dbe('user :: bi points','eventObject.detail.data.biPoints;').dbe('bi account number','eventObject.detail.data.biAccountNumber;').dbe('user :: bi status','eventObject.detail.data.biStatus;').dbe('async :: user :: atg id','eventObject.detail.data.profileId;');
s.events.bind('page load',window,'DIRECT/pageLoadEvent',{pageId:4070462}).dbe('pixel :: double click :: sample ids (piped)','(function(){\r\n  let sampleIds \x3d [];\r\n  let itemSkus \x3d digitalData.transaction.attributes.skuIds;\r\n  let itemSkuTypes \x3d digitalData.transaction.attributes.skuTypes;\r\n\r\n  itemSkus.map(\r\n    function(item, index) {\r\n    \tif (\x27Sample\x27 \x3d\x3d\x3d itemSkuTypes[index]) {\r\n    \t\tsampleIds.push(item);\r\n    \t}\r\n    } \r\n  );\r\n  return sampleIds.join(\x27|\x27); \r\n})();').dbe('pixel :: facebook conversion :: contents','(function(){\r\n    var skuIds \x3d digitalData.transaction.attributes.skuIds;\r\n    if (skuIds.length \x3d\x3d\x3d 1) {\r\n        return skuIds[0];\r\n    } else {\r\n        return JSON.stringify(skuIds);\r\n    }\r\n})()').dbe('pixel :: pinterest :: order subtotal','(function(){\r\n    /*\r\n    ** This is a temporary fix needed becuase we are getting NaN for transactionSubtotalInUSD.\r\n    ** The permanent fix should probably be for back end to send us a pure Javascript Number \r\n    ** without any symbols or currency to use instead.\r\n    */\r\n    \r\n    var subtotalInUSD \x3d digitalData.transaction.total.transactionSubtotalInUSD;\r\n\r\n    /* This runs on all pages, so don\x27t do anything unless we have something */\r\n\r\n    if(subtotalInUSD) {\r\n        /*Remove whitespace - FR/CA uses spaces*/\r\n        subtotalInUSD \x3d digitalData.transaction.total.transactionSubtotal.replace(/\\s+/g, \x22\x22);\r\n        /* Remove any currency from the front or back of the string */\r\n        subtotalInUSD \x3d subtotalInUSD.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0];\r\n        /* Remove any commas because they break the convertToUSD method */\r\n        if (digitalData.page.pageInfo.language.toLowerCase() \x3d\x3d\x3d \x22fr\x22) {\r\n            subtotalInUSD \x3d subtotalInUSD.replace(\x27,\x27, \x27.\x27);\r\n        } else {\r\n            subtotalInUSD \x3d subtotalInUSD.replace(\x27,\x27, \x27\x27);\r\n        }\r\n\r\n        var itemList \x3d digitalData.transaction.item;\r\n        itemList.map((item) \x3d\x3e {\r\n        \tif (item.sku.type \x3d\x3d \x27Flash SKU\x27 || item.sku.type \x3d\x3d \x27Gift Card\x27) {\r\n        \t\tvar skuPrice \x3d item.sku.salePrice || item.sku.listPrice;\r\n        \t\tskuPrice \x3d  skuPrice.replace(/\\s+/g, \x22\x22);\r\n        \t\tskuPrice \x3d  Sephora.analytics.utils.removeCurrencySymbol(skuPrice);\r\n        \t\tsubtotalInUSD \x3d subtotalInUSD - skuPrice;\r\n        \t}\r\n        });\r\n        /* Convert to USD using Signal Library */\r\n        subtotalInUSD \x3d Sephora.analytics.utils.convertToUSD(subtotalInUSD); \r\n        \r\n        return subtotalInUSD;\r\n    }\r\n\r\n}());').dbe('pixel :: facebook :: bi status','digitalData.user[0].segment.fbBiStatus;').dbe('pixel :: double click :: order confirmation :: categories (piped)','(function(){ var categories \x3d digitalData.transaction.attributes.categories \x26\x26 digitalData.transaction.attributes.categories.join(\x27|\x27); return categories; }())').dbe('page :: community user id','digitalData.page.attributes.othersCommunityProfileId;').dbe('pixel :: linkshare :: amtlist','(function () {\r\n\tlet itemCost \x3d [];\r\n\tlet priceArray \x3d digitalData.transaction.attributes.itemPrice;\r\n\tpriceArray \x26\x26 priceArray.map(function (price, index) {\r\n\t\titemCost.push(price.replace(\x27,\x27, \x27.\x27).match(/\\d*\\.\\d{0,2}/) * 100);\r\n\t});\r\n\treturn itemCost.join(\x27|\x27);\r\n})()').dbe('pixel :: double click :: dfa :: category','(function () {\r\n\tlet channel \x3d digitalData.page.pageInfo.sysEnv;\r\n\treturn (channel \x3d\x3d\x3d \x27mobile\x27) ? \x27mobsa382\x27 : \x27sepho787\x27;\r\n})()').dbe('page :: event strings','(digitalData.page.attributes.eventStrings || []).join(\x27,\x27);').dbe('page :: beauty talk navigation info','digitalData.page.attributes.previousPageData.beautyTalkNavigationInfo').dbe('facebook :: order :: payment method','digitalData.transaction.attributes.paymentMethod.split(\x27,\x27);').dbe('page :: product :: nthlevelcategory','(function() { if (digitalData.product \x26\x26 digitalData.product[0]) { return digitalData.product[0].attributes \x26\x26 digitalData.product[0].attributes.nthLevelCategory || \x27no category\x27; } }())').dbe('user :: bi points','digitalData.user[0].segment.biPoints').dbe('pixel :: double click :: order confirmation :: subcategories (piped)','(function(){ var subcategories \x3d digitalData.transaction.attributes.subCategories \x26\x26 digitalData.transaction.attributes.subCategories.join(\x27|\x27); return subcategories; }())').dbe('pixel :: order subtotal usd','(function(){\r\n    subtotalInUSD \x3d digitalData.transaction.total.transactionSubtotalInUSD;\r\n\r\n    /* Currently ROW orders will have NaN for subtotalInUSD \r\n    ** This is a temporary fix needed becuase we are getting NaN for transactionSubtotalInUSD.\r\n    ** The permanent fix should probably be for back end to send us a pure Javascript Number \r\n    ** without any symbols or currency to use instead.\r\n    */\r\n    if (subtotalInUSD \x3d\x3d\x3d \x27NaN\x27) {\r\n        /* Remove any currency from the front or back of the string */\r\n        subtotalInUSD \x3d digitalData.transaction.total.transactionSubtotal.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0];\r\n        /* Remove any commas because they break the convertToUSD method */\r\n        subtotalInUSD \x3d subtotalInUSD.replace(\x27,\x27, \x27\x27);\r\n        /* Convert to USD using Signal Library */\r\n        subtotalInUSD \x3d Sephora.analytics.utils.convertToUSD(subtotalInUSD); \r\n    }\r\n\r\n    return subtotalInUSD;\r\n\r\n}());').dbe('user :: bi status','digitalData.user[0].segment.biStatus;').dbe('page :: number of results','digitalData.page.attributes.search \x26\x26 digitalData.page.attributes.search.numberOfResults;').dbe('page :: is apple pay eligible','digitalData.page.attributes.eligibility.applePayEligibility;').dbe('pixel :: sku type list (piped)','digitalData.transaction.attributes.skuTypes \x26\x26 digitalData.transaction.attributes.skuTypes.join(\x27|\x27);').dbe('pixel :: linkshare :: siteid','(wa.getCookie(\x22siteId\x22) || 0);').dbe('page :: search results algorithm type','digitalData.page.attributes.search \x26\x26 digitalData.page.attributes.search.searchAlgorithmType;').dbe('pixel :: linkshare :: qlist','digitalData.transaction.attributes.itemQty \x26\x26 digitalData.transaction.attributes.itemQty.join(\x27|\x27);').dbe('page :: previous navigation information','(digitalData.page.attributes.previousPageData.navigationInfo || \x27\x27).toLowerCase()').dbe('campaign :: bluecore campaign id','digitalData.page.attributes.campaigns.bluecoreCampaignId;').dbe('internal campaign','digitalData.page.attributes.internalCampaign || digitalData.page.attributes.previousPageData.eVar75;').dbe('page :: order :: payment method','digitalData.transaction.attributes.paymentMethod').dbe('page :: order :: shipping method','digitalData.transaction.total.shippingMethod;').dbe('pixel :: double click :: order subtotal','(function(){\r\n    var subtotalInUSD \x3d Number(digitalData.transaction.total.transactionSubtotalInUSD).toFixed(2);\r\n    if (subtotalInUSD \x26\x26 subtotalInUSD !\x3d\x3d \x27NaN\x27) {\r\n        return subtotalInUSD;\r\n    }\r\n}());').dbe('page :: audience segmentation','digitalData.page.attributes.audienceSegmentation;').dbe('pixel :: double click :: brand names (piped)','(function(){\r\nfunction addSlashes(string) {\r\n        return string.replace(/\\\\/g, \x27\\\\\\\\\x27).\r\n            replace(/\\u0008/g, \x27\\\\b\x27).\r\n            replace(/\\t/g, \x27\\\\t\x27).\r\n            replace(/\\n/g, \x27\\\\n\x27).\r\n            replace(/\\f/g, \x27\\\\f\x27).\r\n            replace(/\\r/g, \x27\\\\r\x27).\r\n            replace(/\x27/g, \x27\\\\\\\x27\x27).\r\n            replace(/\x22/g, \x27\\\\\x22\x27);\r\n    }\r\nvar brandNames \x3d digitalData.transaction.attributes.brandNames \x26\x26 digitalData.transaction.attributes.brandNames.join(\x27|\x27);\r\nreturn addSlashes(brandNames);\r\n}())').dbe('pixel :: double click :: confirm :: flash category','Sephora.analytics.utils.getDoubleClickCategory(\x27flash\x27);').dbe('async :: country','Sephora.renderQueryParams.country.toLowerCase();').dbe('user :: biflash','digitalData.user[0].segment.biPlusFlash').dbe('user :: play status','(function() {\r\n    var country \x3d Sephora.renderQueryParams.country;\r\n    \r\n    if (country \x26\x26 country.toLowerCase() \x3d\x3d\x3d \x27us\x27) {\r\n        return digitalData.user[0].segment.playStatus;\r\n    }\r\n})();').dbe('pixel :: order subtotal','digitalData.transaction.total.transactionSubtotal;').dbe('page :: atg version','digitalData.page.attributes.atgVersion;').dbe('page :: order total','digitalData.transaction.total.transactionTotal;\t\r\n').dbe('user :: email :: chipher','digitalData.user[0].profile[0].profileInfo.webAnalyticsCipher;').dbe('campaign :: urs :: channel','digitalData.page.attributes.campaigns.ursTrackingCode;').dbe('doubleclick :: category','digitalData.page.category.doubleClickCategory').dbe('page :: url','window.location.href').dbe('pixel :: page url for doubleclick','(function() {\r\n    var url \x3d window.location.href;\r\n    if ((url.indexOf(\x27@\x27) \x3e -1) || (url.indexOf(\x27%40\x27) \x3e -1)) {\r\n        return \x27\x27;\r\n    } else {\r\n        return url;\r\n    }\r\n} ())').dbe('pixel :: linkshare :: landingtime','(function(){\r\n  var landingTime;\r\n \r\n  if( wa.getCookie(\x22linkShareTime\x22) ){\r\n    landingTime \x3d wa.getCookie(\x22linkShareTime\x22).split(\x22%7C\x22)[0];\r\n    \r\n  var year \x3d landingTime.substring(0, 4);\r\n  var month \x3d landingTime.substring(4, 6);\r\n  var day \x3d landingTime.substring(6, 8);\r\n  var hour \x3d landingTime.substring(9, 11);\r\n  var minutes \x3d landingTime.substring(11, 13);\r\n  return year+month+day+\x27_\x27+hour+minutes;\r\n  }\r\n  \r\n}());').dbe('pixel :: twitter :: order subtotal','(function(){ \r\n    /* ** itemShort is the list of items excluding \r\n    GWP, Samples, Flash, Play, Gift Cards, and Rewards values */ \r\n    if (digitalData.transaction.itemShort \x26\x26 digitalData.transaction.itemShort.length) {\r\n        var orderTotal \x3d 0;\r\n        var parsedTotal \x3d 0;\r\n        var products \x3d digitalData.transaction.itemShort;\r\n        for (var i \x3d 0; i \x3c products.length; i++) {\r\n            orderTotal+\x3d(products[i].price*products[i].quantity);\r\n        }\r\n        parsedTotal \x3d +(Math.round(orderTotal + \x27e+2\x27) + \x27e-2\x27);\r\n        return parsedTotal;\r\n    } else {\r\n        return 0;\r\n    }\r\n}());').dbe('page :: search :: search term','(function() {\r\n    if (digitalData.page.attributes.previousPageData.prevSearchType) {\r\n        return \x27D\x3dc4\x27;\r\n    }\r\n\r\n    return null;\r\n}())').dbe('pixel :: sku variationvalue list (piped)','(function(){\r\n    var skuVariationValue \x3d digitalData.transaction.attributes.skuVariationValue \x26\x26 digitalData.transaction.attributes.skuVariationValue.join(\x27|\x27) || \x27none\x27;\r\n    /* Encode \x22/\x22 and remove single quote which breaks the pixel code */\r\n    return skuVariationValue.replace(/\x27/g, \x22\x22);\r\n}())').dbe('page :: day of week','digitalData.page.attributes.date.dayName;').dbe('doubleclick :: user :: bi status','(function(){ \r\n    var biStatus \x3d (digitalData.user[0].segment.biStatus || \x22\x22).toLowerCase(); \r\n\r\n    if (typeof digitalData.user[0].profile[0].profileInfo.profileStatus \x3d\x3d\x3d \x27undefined\x27 || digitalData.user[0].profile[0].profileInfo.profileStatus \x3d\x3d\x3d 0) { \r\n        biStatus \x3d \x27\x27; \r\n    } \r\n\r\n    return biStatus; \r\n})()').dbe('pixel :: double click :: categories (piped)','(function(){ var categories \x3d digitalData.cart.attributes.categories \x26\x26 digitalData.cart.attributes.categories.join(\x27|\x27); return categories; }())').dbe('product string :: on-load','digitalData.page.attributes.productStrings;').dbe('pixel :: double click :: dfa :: type','(function () {\r\n\tlet channel \x3d digitalData.page.pageInfo.sysEnv;\r\n\treturn (channel \x3d\x3d\x3d \x27mobile\x27) ? \x27mobil017\x27 : \x27check392\x27;\r\n})()').dbe('page :: order :: delivery option','(function() {\r\n\tvar sys_env \x3d digitalData.page.pageInfo.sysEnv;\r\n\tvar page_name \x3d digitalData.page.pageInfo.pageName;\r\n\tif (page_name.indexOf(\x27reserve-confirmation\x27) \x3e -1) {\r\n\t\treturn \x27ropis\x27;\r\n\t} else if (page_name.indexOf(\x27bopis-confirmation\x27) \x3e -1) {\r\n\t\treturn \x27bopis\x27;\r\n\t} else {\r\n\t\treturn \x27delivery\x27;\r\n\t}\r\n})();').dbe('user :: email :: hash','digitalData.user[0].profile[0].profileInfo.webAnalyticsHash;').dbe('page :: search term dynamic var','(function() {\r\n    if (digitalData.page.category.pageType !\x3d \x22basket\x22) {\r\n        return \x27D\x3dc4\x27;\r\n    }\r\n}())').dbe('user :: atg id','(function(){\r\n\t/* Don\x27t report profile ID if the user is unrecognized */\r\n\tif (digitalData.user[0].profile[0].profileInfo.signInStatus \x3d\x3d\x3d \x27unrecognized\x27) {\r\n\t\treturn \x27\x27;\r\n\t} else {\r\n\t\treturn digitalData.user[0].profile[0].profileInfo.profileID;\r\n\t}\r\n}())').dbe('pixel :: twitter :: order num items','(function(){ \r\n    /* ** itemShort is the list of items excluding \r\n    GWP, Samples, Flash, Play, Gift Cards, and Rewards values */ \r\n    if (digitalData.transaction.itemShort \x26\x26 digitalData.transaction.itemShort.length) {\r\n        var numItems \x3d 0;\r\n        var items \x3d digitalData.transaction.itemShort;\r\n        for (var i \x3d 0; i \x3c items.length; i++) {\r\n            numItems +\x3d items[i].quantity;\r\n        }\r\n        return numItems;\r\n    } else {\r\n        return 0;\r\n    }\r\n}());').dbe('pixel :: liveramp hashed email','digitalData.user[0].profile[0].profileInfo.webAnalyticsHash').dbe('pixel :: breadcrumbs','(function(){\r\nvar crumbs \x3d digitalData.page.pageInfo.breadcrumbs;\r\n if (crumbs.length) { \r\n     if (typeof crumbs[0] \x3d\x3d\x3d \x27string\x27) { \r\n         return crumbs.join(\x27:\x27);\r\n     } else { \r\n     return crumbs.map(function(crumb){ \r\n         if( crumb.displayName.toLowerCase() \x3d\x3d\x3d \x27hidden category\x27)\r\n            return \x27null\x27;\r\n         else\r\n            return crumb.displayName; }).join(\x27:\x27);\r\n    } \r\n} else if (location.href.indexOf(\x22sephora.com/sale\x22) !\x3d -1) { \r\n    return \x27sale\x27; \r\n} \r\n}())').dbe('page :: language/locale','digitalData.page.attributes.languageLocale.toLowerCase();').dbe('page :: previous link data','digitalData.page.attributes.previousPageData.linkData || digitalData.page.attributes.previousPageData.prop55;').dbe('order subtotal in usd :: no currency symbol','(function(){\r\n/*\r\n** This is a temporary fix needed becuase we are getting NaN for transactionSubtotalInUSD.\r\n** The permanent fix should probably be for back end to send us a pure Javascript Number \r\n** without any symbols or currency to use instead.\r\n*/\r\n\r\nsubtotalInUSD \x3d digitalData.transaction.total.transactionSubtotalInUSD;\r\n\r\n/* This runs on all pages, so don\x27t do anything unless we have something */\r\n\r\nif(subtotalInUSD) {\r\n/* Remove any currency from the front or back of the string */\r\nsubtotalInUSD \x3d digitalData.transaction.total.transactionSubtotalInUSD.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0];\r\n/* Remove any commas because they break the convertToUSD method */\r\nsubtotalInUSD \x3d subtotalInUSD.replace(\x27,\x27, \x27\x27); \r\n\r\nreturn parseFloat(subtotalInUSD).toFixed(2);\r\n}\r\n\r\n}());').dbe('page :: isflashorder','(function () {\r\n\tlet flashPIDs \x3d [\x27P379518\x27, \x27P380686\x27];\r\n\tlet isFlashPresent \x3d false;\r\n\tfor (let i \x3d 0; i \x3c flashPIDs.length; i++) {\r\n\t    if (digitalData.transaction.attributes.productIds.indexOf(flashPIDs[i]) \x3e -1) { \r\n\t    \tisFlashPresent \x3d  true; \r\n\t    }\r\n\t};\r\n\treturn isFlashPresent;\r\n})()').dbe('pixel :: double click :: items short','(function(){ return JSON.stringify(digitalData.transaction.itemShort) })();').dbe('pixel :: linkshare :: discount','digitalData.transaction.total.promotionDiscount \x26\x26 Math.round(digitalData.transaction.total.promotionDiscount*100)').dbe('page :: url :: no query','window.location.href.split(\x27?\x27)[0];').dbe('page :: search type','(function() {\r\n    if (digitalData.page.attributes.previousPageData.prevSearchType) {\r\n        return digitalData.page.attributes.previousPageData.prevSearchType;\r\n    } else if (digitalData.page.category.pageType \x3d\x3d\x3d \x27search\x27) {\r\n        return location.search.indexOf(\x27deep_link\x3dtrue\x27) !\x3d\x3d -1 ? \x27deep-linked\x27 :\x27not defined\x27;\r\n    }\r\n}())\r\n').dbe('page :: page detail','digitalData.page.pageInfo.pageName.toLowerCase();').dbe('user :: sign in status','digitalData.user[0].segment.signInStatus;').dbe('pixel :: sku variationtype list (piped)','digitalData.transaction.attributes.skuVariationTypes \x26\x26 digitalData.transaction.attributes.skuVariationTypes.join(\x27|\x27);').dbe('campaign :: email harmony deployment id','digitalData.page.attributes.campaigns.emailHarmonyDeploymentId;').dbe('campaign :: marketing channel','digitalData.page.attributes.campaigns.marketingChannel;').dbe('page :: content country','digitalData.page.attributes.sephoraPageInfo.contentCountry.toLowerCase();').dbe('page :: bichiptype','digitalData.page.attributes.previousPageData.biChipType;').dbe('pixel :: facebook :: order subtotal','(function(){ \r\n    /* ** \r\n    This is a temporary fix needed becuase we are getting NaN for transactionSubtotalInUSD. \r\n    ** The permanent fix should probably be for back end to send us a \r\n    pure Javascript Number ** without any symbols or currency to use instead. */ \r\n    var subtotalInUSD \x3d digitalData.transaction.total.transactionSubtotalInUSD; \r\n    var transactionTotal \x3d digitalData.transaction.total.transactionSubtotal;\r\n    var promotionDiscount \x3d parseFloat(digitalData.transaction.total.promotionDiscount); \r\n    /* This runs on all pages, so don\x27t do anything unless we have something */ \r\n    var isCanada \x3d digitalData.page.pageInfo.country \x3d\x3d\x3d \x27CA\x27 ? true : false; \r\n    if(!isCanada \x26\x26 subtotalInUSD) {\r\n        /* Remove any currency from the front or back of the string */ \r\n        subtotalInUSD \x3d digitalData.transaction.total.transactionSubtotalInUSD.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0]; \r\n        /* Remove any commas because they break the convertToUSD method */ \r\n        subtotalInUSD \x3d subtotalInUSD.replace(\x27,\x27, \x27\x27); \r\n        return parseFloat(subtotalInUSD) - promotionDiscount;\r\n    } \r\n    else { \r\n        if (transactionTotal) { \r\n        /* Remove any currency from the front or back of the string */ \r\n        transactionTotal \x3d digitalData.transaction.total.transactionSubtotal.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0]; \r\n        /* Remove any commas because they break the convertToUSD method */ \r\n        transactionTotal \x3d transactionTotal.replace(\x27,\x27, \x27\x27); \r\n        return parseFloat(transactionTotal) - promotionDiscount; \r\n        } \r\n    } \r\n}());').dbe('page :: promo code','digitalData.transaction.attributes.promoCode;').dbe('page :: experience bookingid','digitalData.page.attributes.experienceDetails \x26\x26 digitalData.page.attributes.experienceDetails.bookingId ').dbe('campaign :: harmony link id','digitalData.page.attributes.campaigns.emailHarmonyLinkId;').dbe('page :: world','(digitalData.page.attributes.world || \x27n/a\x27).toLowerCase();').dbe('transaction :: iso :: currency','digitalData.transaction.attributes.isoCurrency;').dbe('pixel :: sku list :: piped','digitalData.transaction.attributes.skuIds \x26\x26 digitalData.transaction.attributes.skuIds.join(\x27|\x27)').dbe('pixel :: double click :: subcategories (piped)','(function(){ var subCategories \x3d digitalData.cart.attributes.subCategories \x26\x26 digitalData.cart.attributes.subCategories.join(\x27|\x27); return subCategories; }())').dbe('sitecatalyst :: account id','digitalData.page.attributes.reportSuiteId;').dbe('page :: search term','digitalData.page.attributes.search \x26\x26 digitalData.page.attributes.search.searchTerm;').dbe('page :: search products','digitalData.page.attributes.search \x26\x26 digitalData.page.attributes.search.productsDisplayed;').dbe('page :: previous page type','digitalData.page.attributes.previousPageData.pageName.split(\x27:\x27, 1).pop();').dbe('test :: brand names','(function(){\r\nvar brandNames \x3d digitalData.transaction.attributes.brandNames \x26\x26 digitalData.transaction.attributes.brandNames.join(\x27|\x27);\r\n\r\nreturn brandNames;\r\n}())').dbe('campaign :: harmony customer key','digitalData.page.attributes.campaigns.emailHarmonyCustomerKey;').dbe('page :: date','digitalData.page.attributes.date.localDate;').dbe('campaign :: affiliate id','digitalData.page.attributes.campaigns.affiliateId').dbe('page :: variant keys','digitalData.page.attributes.featureVariantKeys.join(\x27,\x27);').dbe('page :: name','digitalData.page.attributes.sephoraPageInfo.pageName;').dbe('page :: breakpoint','digitalData.page.attributes.breakpoint').dbe('page :: referrer','digitalData.page.pageInfo.referringURL || document.referrer').dbe('page :: certona placement :: productpage tracking','(function(){\r\nif(digitalData.page.attributes.previousPageData.recInfo.isExternalRec \x3d\x3d\x3d \x27certona\x27 \x26\x26 digitalData.page.attributes.previousPageData.pageName.indexOf(\x27quicklook\x27) \x3d\x3d\x3d -1) {\r\n return digitalData.page.attributes.previousPageData.recInfo.certonaContainerName;\r\n}\r\n}())').dbe('page :: previous page name','digitalData.page.attributes.previousPageData.pageName;').dbe('page :: experience','digitalData.page.attributes.experience;').dbe('page :: platform','digitalData.page.attributes.platform;').dbe('async :: user :: atg id','(function(){\r\n\t/* Don\x27t report profile ID if the user is unrecognized */\r\n\tif (digitalData.user[0].profile[0].profileInfo.signInStatus \x3d\x3d\x3d \x27unrecognized\x27) {\r\n\t\treturn \x27\x27;\r\n\t} else {\r\n\t\treturn digitalData.user[0].profile[0].profileInfo.profileID;\r\n\t}\r\n}())').dbe('pixel :: double click :: confirm :: category','(function() {\r\n\tvar sys_env \x3d digitalData.page.pageInfo.sysEnv;\r\n\tvar page_name \x3d digitalData.page.pageInfo.pageName;\r\n\tif ((page_name.indexOf(\x27reserve-confirmation\x27) \x3e -1) \x26 (sys_env.indexOf(\x27full site\x27) \x3e -1)) {\r\n\t\treturn \x22ropis0\x22;\r\n\t} else if ((page_name.indexOf(\x27reserve-confirmation\x27) \x3e -1) \x26 (sys_env.indexOf(\x27mobile\x27) \x3e -1)) {\r\n\t\treturn \x22ropis00\x22;\r\n\t} else if ((page_name.indexOf(\x27bopis-confirmation\x27) \x3e -1) \x26 (sys_env.indexOf(\x27full site\x27) \x3e -1)) {\r\n\t\treturn \x22bopis0\x22;\r\n\t} else if ((page_name.indexOf(\x27bopis-confirmation\x27) \x3e -1) \x26 (sys_env.indexOf(\x27mobile\x27) \x3e -1)) {\r\n\t\treturn \x22bopis00\x22;\r\n\t} else {\r\n\t\treturn digitalData.page.category.doubleClickCategory;\r\n\t}\r\n}())').dbe('pixel :: iso shipping currency','digitalData.transaction.attributes.isoCurrency').dbe('campaign :: epsilon audience id','digitalData.page.attributes.campaigns.epsilonAudienceId;').dbe('page :: shipping zip','digitalData.transaction.total.shippingZip;').dbe('pixel :: double click :: product ratings (piped)','digitalData.transaction.attributes.rating \x26\x26 digitalData.transaction.attributes.rating.join(\x27|\x27);').dbe('page :: page name for evar6','digitalData.page.category.pageType \x3d\x3d\x3d \x27rewards\x27 ?\r\n\tdigitalData.page.attributes.sephoraPageInfo.productFindingMethod : \x27D\x3dpageName\x27;').dbe('pixel :: double click :: price list merch totals (piped)','(function(){\r\n    var skuPrices \x3d [];\r\n    var skuPricesStr; \r\n    var itemCost \x3d digitalData.transaction.attributes.itemPrice;\r\n    var itemSkus \x3d digitalData.transaction.attributes.skuIds;\r\n    var firstOnlineTransaction \x3d digitalData.transaction.attributes.firstTransactionOnline;\r\n    var GIFT_WRAP_SKUS \x3d [\x271169945\x27, \x271169937\x27];\r\n    var PLAY_SKU_ID \x3d \x271001\x27;\r\n\r\n    var safelyConvertToUSD \x3d function(price) {\r\n        /* Remove any currency from the front or back of the string */\r\n        price \x3d price.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/);\r\n        if (price \x26\x26 price.length) {\r\n            price \x3d price[0];\r\n\r\n             /* Remove any commas because they break the convertToUSD method */\r\n            /* Adding decimals in place of commas for CA/FR */\r\n            if (digitalData.page.pageInfo.language \x3d\x3d\x3d \x27FR\x27) {\r\n                price \x3d price.replace(\x27,\x27, \x27.\x27);\r\n            } else {\r\n                price \x3d price.replace(\x27,\x27, \x27\x27);\r\n            }\r\n        }\r\n\r\n        /* Convert to USD using Signal Library */\r\n        price \x3d Sephora.analytics.utils.convertToUSD(price);\r\n        return price;\r\n    };\r\n\r\n  \r\n    itemCost.map( \r\n      function(price, index) {\r\n        var id \x3d itemSkus[index];\r\n        var isReward \x3d (price.toLowerCase().indexOf(\x27points\x27) !\x3d- 1);\r\n        var isGiftWrapSku \x3d GIFT_WRAP_SKUS.indexOf(id) \x3e -1;\r\n    \r\n        // Do not include gift wrap skus\r\n        if (isGiftWrapSku) {\r\n          return; \r\n        }\r\n  \r\n        // Hard code price for play subscription per comments in https://jira.sephora.com/browse/ILLUPH-63077\r\n        if (id \x3d\x3d\x3d PLAY_SKU_ID){\r\n          //Play Sku Price is $10.00\r\n          skuPrices.push(\x2710.00\x27);\r\n        } else {\r\n            if (isReward || price \x3d\x3d\x3d \x27FREE\x27) {\r\n                skuPrices.push(\x270.00\x27);\r\n            } else {\r\n                skuPrices.push(safelyConvertToUSD(price));\r\n            }\r\n        }\r\n      } \r\n    ); \r\n  \r\n    if (firstOnlineTransaction) {\r\n       skuPricesStr \x3d skuPrices.join(\x27|\x27)+\x27|0\x27;\r\n    } else {\r\n     skuPricesStr \x3d skuPrices.join(\x27|\x27);\r\n    }\r\n    return skuPricesStr; \r\n  })();').dbe('campaign : email atg id','digitalData.page.attributes.campaigns.emailATGID;').dbe('page :: order number','digitalData.transaction.transactionID;\t').dbe('page :: type','digitalData.page.category.pageType;').dbe('pixel :: double click :: price list (piped)','(function(){\r\n    var skuPrices \x3d [];\r\n    var skuPricesStr;\r\n    var items \x3d digitalData.transaction.item;\r\n    var itemPrices;\r\n    var itemSkus \x3d digitalData.transaction.attributes.skuIds;\r\n    var firstOnlineTransaction \x3d digitalData.transaction.attributes.firstTransactionOnline;\r\n    var GIFT_WRAP_SKUS \x3d [\x271169945\x27, \x271169937\x27];\r\n    var PLAY_SKU_ID \x3d \x271001\x27;\r\n\r\n    var safelyConvertToUSD \x3d function(price) {\r\n        /* Remove any currency from the front or back of the string */\r\n        price \x3d price.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/);\r\n\r\n        if (price \x26\x26 price.length) {\r\n            price \x3d price[0];\r\n\r\n             /* Remove any commas because they break the convertToUSD method */\r\n            /* Adding decimals in place of commas for CA/FR */\r\n            if (digitalData.page.pageInfo.language.toLowerCase() \x3d\x3d\x3d \x27fr\x27) {\r\n                price \x3d price.replace(\x27,\x27, \x27.\x27);\r\n            } else {\r\n                price \x3d price.replace(\x27,\x27, \x27\x27);\r\n            }\r\n        }\r\n\r\n        /* Convert to USD using Signal Library */\r\n        price \x3d Sephora.analytics.utils.convertToUSD(price); \r\n        return price;\r\n    };\r\n\r\n    items.map( \r\n      function(item, index) {\r\n        var id \x3d itemSkus[index];\r\n        var price \x3d item.sku.salePrice ? item.sku.salePrice : item.sku.listPrice;\r\n        var isReward \x3d (price.toLowerCase().indexOf(\x27points\x27) !\x3d- 1);\r\n        var isGiftWrapSku \x3d GIFT_WRAP_SKUS.indexOf(id) \x3e -1;\r\n    \r\n        // Do not include gift wrap skus\r\n        if (isGiftWrapSku) {\r\n          return; \r\n        }\r\n  \r\n        // Hard code price for play subscription per comments in https://jira.sephora.com/browse/ILLUPH-63077\r\n        if (id \x3d\x3d\x3d PLAY_SKU_ID){\r\n          //Play Sku Price is $10.00\r\n          skuPrices.push(\x2710.00\x27);\r\n        } else {\r\n            if (isReward || price \x3d\x3d\x3d \x27FREE\x27) {\r\n                skuPrices.push(\x270.00\x27);\r\n            } else {\r\n                skuPrices.push(safelyConvertToUSD(price));\r\n            }\r\n        }\r\n      } \r\n    ); \r\n  \r\n    if (firstOnlineTransaction) {\r\n       skuPricesStr \x3d skuPrices.join(\x27|\x27)+\x27|0\x27;\r\n    } else {\r\n     skuPricesStr \x3d skuPrices.join(\x27|\x27);\r\n    }\r\n    return skuPricesStr; \r\n  })();').dbe('page :: experience store id','digitalData.page.attributes.experienceDetails \x26\x26 digitalData.page.attributes.experienceDetails.storeId ').dbe('channel','digitalData.page.pageInfo.sysEnv;').dbe('pixel :: linkshare :: namelist','digitalData.transaction.attributes.itemName \x26\x26 digitalData.transaction.attributes.itemName.join(\x27|\x27).replace(/[\\\x22\x22]/g, \x27\\\\\x22\x27);').dbe('pixel :: page url','encodeURIComponent(window.location.href)').dbe('pixel :: pinterest :: itemprice (piped)','(function() {\r\n    var skuPrices \x3d [];\r\n    var skuPricesStr;\r\n    var items \x3d digitalData.transaction.item;\r\n    var itemPrices;\r\n    var itemSkus \x3d digitalData.transaction.attributes.skuIds;\r\n    var firstOnlineTransaction \x3d digitalData.transaction.attributes.firstTransactionOnline;\r\n    var GIFT_WRAP_SKUS \x3d [\x271169945\x27, \x271169937\x27];\r\n    var PLAY_SKU_ID \x3d \x271001\x27;\r\n\r\n    var safelyConvertToUSD \x3d function(price) {\r\n        /* Remove any currency from the front or back of the string */\r\n        price \x3d price.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/);\r\n\r\n        if (price \x26\x26 price.length) {\r\n            price \x3d price[0];\r\n\r\n            /* Remove any commas because they break the convertToUSD method */\r\n            /* Adding decimals in place of commas for CA/FR */\r\n            if (digitalData.page.pageInfo.language.toLowerCase() \x3d\x3d\x3d \x27fr\x27) {\r\n                price \x3d price.replace(\x27,\x27, \x27.\x27);\r\n            } else {\r\n                price \x3d price.replace(\x27,\x27, \x27\x27);\r\n            }\r\n        }\r\n\r\n        /* Convert to USD using Signal Library */\r\n        price \x3d Sephora.analytics.utils.convertToUSD(price);\r\n        return price;\r\n    };\r\n\r\n    items.map(\r\n        function(item, index) {\r\n            var id \x3d itemSkus[index];\r\n            var price \x3d item.sku.salePrice || item.sku.listPrice;\r\n            var isReward \x3d (price.toLowerCase().indexOf(\x27points\x27) !\x3d -1);\r\n            var isGiftWrapSku \x3d GIFT_WRAP_SKUS.indexOf(id) \x3e -1;\r\n\r\n            // Do not include gift wrap skus\r\n            if (isGiftWrapSku) {\r\n                return;\r\n            }\r\n\r\n            // Hard code price for play subscription per comments in https://jira.sephora.com/browse/ILLUPH-63077\r\n            if (id \x3d\x3d\x3d PLAY_SKU_ID) {\r\n                //Play Sku Price is $10.00\r\n                skuPrices.push(\x2710.00\x27);\r\n            } else {\r\n                if (isReward || price \x3d\x3d\x3d \x27FREE\x27) {\r\n                    skuPrices.push(\x270.00\x27);\r\n                } else {\r\n                    skuPrices.push(safelyConvertToUSD(price));\r\n                }\r\n            }\r\n        }\r\n    );\r\n\r\n    if (firstOnlineTransaction) {\r\n        skuPricesStr \x3d skuPrices.join(\x27|\x27) + \x27|0\x27;\r\n    } else {\r\n        skuPricesStr \x3d skuPrices.join(\x27|\x27);\r\n    }\r\n    return skuPricesStr;\r\n})();').dbe('doubleclick ::  payment method :: piped','digitalData.transaction.attributes.paymentMethod.replace(\x22,\x22,\x22|\x22);').dbe('event :: last refresh','digitalData.lastRefresh \x3d\x3d\x3d \x27soft\x27 ? \x27soft:spa page load\x27 : \x27hard:regular page load\x27').dbe('page :: country','digitalData.page.pageInfo.country;').dbe('page :: experience type','digitalData.page.attributes.experienceType;');
s.events.bind('facebook add to basket',window,'DIRECT/facebook_add_to_basket',{pageId:4070462}).dbe('pixel :: facebook :: currency','eventObject.detail.currency').dbe('pixel :: facebook :: stringified sku array','eventObject.detail.id').dbe('pixel :: facebook :: value','eventObject.detail.price').dbe('pixel :: facebook :: contents','JSON.stringify({\r\n\tid: eventObject.detail.id,\r\n\tquantity: eventObject.detail.quantity\r\n})').dbe('pixel :: facebook :: event id','(function () { return digitalData.user[0].profile[0].profileInfo.profileID + digitalData.page.attributes.date.timestamp ; })();');
s.events.bind('post page load',window,'DIRECT/postPageLoad',{pageId:4070462}).dbe('double click :: category :: id','(function () {\r\n    var catId \x3d Sephora.analytics.utils.getDoubleClickCategory(\x27category\x27);\r\n\r\n    if (catId.indexOf(\x27undefined\x27) !\x3d -1) {\r\n        catId \x3d catId.split(\x27undefined\x27)[0];\r\n\r\n        if (digitalData.page.category.pageType \x3d\x3d\x3d \x22search\x22) {\r\n            catId +\x3d \x276\x27;\r\n        }\r\n    }\r\n\r\n    return catId;\r\n}())').dbe('pixel :: double click :: confirm :: flash category','Sephora.analytics.utils.getDoubleClickCategory(\x27flash\x27);');
s.events.bind('add to loves list',window,'DIRECT/addToLovesList',{pageId:4070462}).dbe('pixel :: facebook :: event id','(function () {return digitalData.user[0].profile[0].profileInfo.profileID + digitalData.page.attributes.date.timestamp ; })();').dbe('pixel :: facebook :: stringified sku array','eventObject.detail.data.sku').dbe('pixel :: facebook :: bi status','digitalData.user[0].segment.fbBiStatus;').dbe('pixel :: user :: login status','window.localStorage.getItem(\x27createdNewUser\x27) ? \r\nJSON.parse(window.localStorage.getItem(\x27createdNewUser\x27)).data\x3d\x3d\x3d\x27fromStore\x27? \x27store\x27:\x27new\x27\r\n: window.localStorage.getItem(\x27hasPreviouslyLoggedIn\x27) ? \x27existing\x27 : \x27unrecognizable\x27;');
s.events.bind('successfully registered for bi',window,'DIRECT/registeredForBI',{pageId:4070462}).dbe('pixel :: first five recommended pids','(function(){ return digitalData.page.attributes.externalRecommendations.firstFivePIDs || null; }())').dbe('user :: atg id','digitalData.user[0].profile[0].profileInfo.profileID;').dbe('pixel :: user :: login status','window.localStorage.getItem(\x27createdNewUser\x27) ? JSON.parse(window.localStorage.getItem(\x27createdNewUser\x27)).data\x3d\x3d\x3d\x27fromStore\x27? \x27store\x27:\x27new\x27 : window.localStorage.getItem(\x27hasPreviouslyLoggedIn\x27) ? \x27existing\x27 : \x27unrecognizable\x27;').dbe('user :: bi status','digitalData.user[0].segment.biStatus;').dbe('user :: bi points','digitalData.user[0].segment.biPoints;').dbe('page :: name','digitalData.page.attributes.sephoraPageInfo.pageName;').dbe('pixel :: page url for doubleclick','(function() {\r\n    var url \x3d window.location.href;\r\n    if ((url.indexOf(\x27@\x27) \x3e -1) || (url.indexOf(\x27%40\x27) \x3e -1)) {\r\n        return \x27\x27;\r\n    } else {\r\n        return url;\r\n    }\r\n} ())').dbe('bi account number','digitalData.user[0].segment.biAccountId');
s.events.bind('profile updated',window,'DIRECT/ProfileUpdated',{pageId:4070462});
s.events.bind('link tracking event',window,'DIRECT/linkTrackingEvent',{pageId:4070462}).dbe('link :: video name','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.videoName\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());\r\n').dbe('link :: error messages','(function () {\r\n    var errors \x3d Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.errorMessages\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n    return (errors || []).join(\x22,\x22) || null;\r\n}());').dbe('link :: action info','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.actionInfo\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('link :: field errors','(function () {\r\n    var fieldErrors \x3d Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.fieldErrors\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n\r\n    return (fieldErrors || []).join(\x22,\x22) || null;\r\n}());').dbe('link :: sku type','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.biRewardType\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('color iq :: save to profile','(function () {\r\n    var colorIQCode \x3d  Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.colorIQ\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n    if (colorIQCode) {\r\n        return \x27save to profile:\x27 + colorIQCode;\r\n    }\r\n}());\r\n').dbe('link :: user input','(function () { return Sephora.analytics.utils.getMostRecentEventProperty({ eventObject: eventObject, pathToProperty: \x27eventInfo.attributes.userInput\x27, fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT }); }());').dbe('link :: validation error messages','(function () { var errors \x3d Sephora.analytics.utils.getMostRecentEventProperty({ eventObject: eventObject || {}, pathToProperty: \x27eventInfo.attributes.validationErrorMessages\x27, fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT }); return (errors || []).join(\x22,\x22) || null; }());').dbe('pixel :: braze :: campaign name','(function () {\r\n  return Sephora.campaign_name;\r\n})();').dbe('link :: page detail','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.pageDetail\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('pixel :: braze :: user id','(function() { return Sephora.user_id_for_braze })();').dbe('link :: filter selections','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.filterSelections\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('pixel :: braze :: variation name','(function(){ return Sephora.variation_name })();').dbe('link :: add to basket location','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.addToBasketLocation\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('link :: happening filters','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.selectedFilter\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('link :: evar63','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.eVar63\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());\r\n').dbe('link :: language locale','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.languageLocale\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    }).toLowerCase();\r\n}());\r\n').dbe('link :: product strings','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.productStrings\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());\r\n').dbe('link :: previous navigation information','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.navigationInfo\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());\r\n').dbe('link :: product answers keyword','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.searchAnswersKeyword\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('link :: search criteria','(function () { return Sephora.analytics.utils.getMostRecentEventProperty({ eventObject: eventObject, pathToProperty: \x27eventInfo.attributes.searchCriteria\x27, fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT }); }());').dbe('link :: internal campaign string','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.internalCampaign\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('link :: bichiptype','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.biChipType\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());\r\n').dbe('link :: platform','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.platform\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());\r\n').dbe('link :: external recommendation info','(function () {\r\n    var audienceId \x3d Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.audienceId\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n\r\n    return audienceId \x26\x26 !Sephora.campaign_name ? \x22certona_\x22 + audienceId : null;\r\n}());').dbe('link :: page type','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.pageType\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('link :: link name','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.linkName\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('beauty board :: photo id','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.photoId\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('link :: link label','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.linkName\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    }) || \x22event71\x22;\r\n}());').dbe('link :: experience','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.experience\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('link :: page world','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.pageWorld\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    }).toLowerCase();\r\n}());\r\n').dbe('link :: server response','(function () { \r\n\treturn Sephora.analytics.utils.getMostRecentEventProperty({\r\n\t\teventObject: eventObject, \r\n\t\tpathToProperty: \x27eventInfo.attributes.serverResponse\x27,\r\n\t\tfallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n\t});\r\n}());').dbe('link :: bi real-time point status','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.biRealTimePointStatus\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('link :: page name','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.pageName\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('link :: channel','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.channel\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());').dbe('link :: previous page','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.previousPage\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());\r\n').dbe('link :: event detail object','eventObject.detail;').dbe('link :: event strings','(function () {\r\n    var events \x3d Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.eventStrings\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n    if (!Array.isArray(events)) {\r\n        events \x3d [events];\r\n    }\r\n    \r\n    return (events || []).join(\x22,\x22) || null;\r\n}());').dbe('link :: url without query string','(function () {\r\n    return Sephora.analytics.utils.getMostRecentEventProperty({\r\n        eventObject: eventObject,\r\n        pathToProperty: \x27eventInfo.attributes.urlWithoutQuery\x27,\r\n        fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT\r\n    });\r\n}());\r\n');
s.events.bind('flash banner add to cart',window,'DIRECT/flashBannerAddToCart',{pageId:4070462}).dbe('pixel :: facebook :: stringified sku array','1530070').dbe('pixel :: user :: login status','window.localStorage.getItem(\x27createdNewUser\x27) ? \r\nJSON.parse(window.localStorage.getItem(\x27createdNewUser\x27)).data\x3d\x3d\x3d\x27fromStore\x27? \x27store\x27:\x27new\x27\r\n: window.localStorage.getItem(\x27hasPreviouslyLoggedIn\x27) ? \x27existing\x27 : \x27unrecognizable\x27;');
s.events.bind('pixel :: register button click',window,'DIRECT/joinCommunityButtonClick',{pageId:4070462});
s.events.bind('quick look load',window,'DIRECT/quickLookLoad',{pageId:4070462}).dbe('double click :: product page :: sku id','digitalData.product[0].attributes.skuId;').dbe('double click :: product page :: sku price','(function(){\r\n\r\nvar price \x3d\x270.00\x27;\r\n\r\n// return null if digitalData.product null (e.g.: Samples tab)\r\nif (digitalData.product !\x3d\x3d null) {\r\n    if (digitalData.product[0].attributes.price !\x3d\x3d \x27FREE\x27) {\r\n        price \x3d digitalData.product[0].attributes.price;\r\n    }\r\n}\r\n\r\nvar safelyConvertToUSD \x3d function(price) {\r\n    /* Remove any currency from the front or back of the string */\r\n    price \x3d price.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0];\r\n    /* Remove any commas because they break the convertToUSD method */\r\n    /* Adding decimals in place of commas for CA/FR */\r\n    if (digitalData.page.pageInfo.language.toLowerCase() \x3d\x3d\x3d \x27fr\x27) {\r\n        price \x3d price.replace(\x27,\x27, \x27.\x27);\r\n    } else {\r\n        price \x3d price.replace(\x27,\x27, \x27\x27);\r\n    }\r\n    /* Convert to USD using Signal Library */\r\n    price \x3d Sephora.analytics.utils.convertToUSD(price); \r\n    return price;\r\n};\r\n\r\nreturn safelyConvertToUSD(price); \r\n})();').dbe('double click :: product page :: product type','digitalData.product[0].attributes.typeForPixel;').dbe('pixel :: user :: login status','window.localStorage.getItem(\x27createdNewUser\x27) ? \r\nJSON.parse(window.localStorage.getItem(\x27createdNewUser\x27)).data\x3d\x3d\x3d\x27fromStore\x27? \x27store\x27:\x27new\x27\r\n: window.localStorage.getItem(\x27hasPreviouslyLoggedIn\x27) ? \x27existing\x27 : \x27unrecognizable\x27;').dbe('pixel :: facebook :: event id','(function () {\r\n    var timeStamp \x3d digitalData.page.attributes.date.timestamp;\r\n    var profileId \x3d digitalData.user[0].profile[0].profileInfo.profileID;\r\n\r\n    return profileId + timeStamp;\r\n})();');
s.events.bind('pinterest quicklook event',window,'DIRECT/pinterestQuickLoadEvent',{pageId:4070462}).dbe('double click :: product page :: sku price','(function(){ \r\n\r\nvar price \x3d \x270.00\x27;\r\n\r\nif (digitalData.product !\x3d\x3d null) {\r\n    price \x3d digitalData.product[0].attributes.price; \r\n}\r\n\r\nvar safelyConvertToUSD \x3d function(price) { /* Remove any currency from the front or back of the string */ price \x3d price.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0]; /* Remove any commas because they break the convertToUSD method */ /* Adding decimals in place of commas for CA/FR */ if (digitalData.page.pageInfo.language.toLowerCase() \x3d\x3d\x3d \x27fr\x27) { price \x3d price.replace(\x27,\x27, \x27.\x27); } else { price \x3d price.replace(\x27,\x27, \x27\x27); } /* Convert to USD using Signal Library */ price \x3d Sephora.analytics.utils.convertToUSD(price); return price; }; return safelyConvertToUSD(price); })();').dbe('double click :: product page :: sku id','digitalData.product[0].attributes.skuId').dbe('double click :: product page :: product type','digitalData.product[0].attributes.typeForPixel;');
s.events.bind('product page load event',window,'DIRECT/productPageLoad',{pageId:4070462}).dbe('pixel :: facebook :: stringified sku array','digitalData.product[0].attributes.skuId;').dbe('page :: page name for evar6','digitalData.page.attributes.sephoraPageInfo.productFindingMethod;').dbe('double click :: product page :: sku id','digitalData.product[0].attributes.skuId').dbe('page :: number of results','digitalData.page.attributes.previousPageData.searchTerm ? \x27redirect\x27 : \x22\x22;');
s.events.bind('double click product page',window,'DIRECT/doubleClickProductPage',{pageId:4070462}).dbe('double click :: product page :: sku id','digitalData.product[0].attributes.skuId;').dbe('double click :: product page :: complete sku price','(function() {\r\n if (digitalData.product \x3d\x3d\x3d null) { \r\n   return null; \r\n  } else {\r\n return digitalData.product[0].attributes.price; \r\n} })();').dbe('double click :: product page :: product variation value','(digitalData.product[0].attributes.variationValue || \x27none\x27).toLowerCase();').dbe('double click :: product page :: product name','digitalData.product[0].productInfo.productName').dbe('double click :: product page ::brand name','(digitalData.product[0].productInfo.manufacturer || \x27none\x27).toLowerCase();').dbe('double click :: product page :: category','Sephora.isDesktop() ? \x27deskt00\x27 : \x27mobil00\x27;').dbe('double click :: product page :: sku price','(function(){\r\n\r\nvar price \x3d \x270.00\x27;\r\n\r\nif (digitalData.product !\x3d\x3d null) {\r\n    price \x3d digitalData.product[0].attributes.price;\r\n}\r\n\r\n\r\nvar safelyConvertToUSD \x3d function(price) {\r\n    /* Remove any currency from the front or back of the string */\r\n    price \x3d price.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0];\r\n    /* Remove any commas because they break the convertToUSD method */\r\n    /* Adding decimals in place of commas for CA/FR */\r\n    if (digitalData.page.pageInfo.language.toLowerCase() \x3d\x3d\x3d \x27fr\x27) {\r\n        price \x3d price.replace(\x27,\x27, \x27.\x27);\r\n    } else {\r\n        price \x3d price.replace(\x27,\x27, \x27\x27);\r\n    }\r\n    /* Convert to USD using Signal Library */\r\n    price \x3d Sephora.analytics.utils.convertToUSD(price); \r\n    return price;\r\n};\r\n\r\nreturn safelyConvertToUSD(price); \r\n})();').dbe('double click :: product page :: rating','digitalData.product[0].attributes.rating').dbe('double click :: product page :: product type','digitalData.product[0].attributes.typeForPixel;').dbe('double click :: product page :: subcategory','digitalData.page.pageInfo.breadcrumbs.length \x3e\x3d 2 ? digitalData.page.pageInfo.breadcrumbs[1].displayName.toLowerCase() : \x27none\x27;').dbe('double click :: product page :: top category','digitalData.page.pageInfo.breadcrumbs.length ? \r\ndigitalData.page.pageInfo.breadcrumbs[0].displayName !\x3d\x3d \x27Hidden Category\x27 ?    digitalData.page.pageInfo.breadcrumbs[0].displayName.toLowerCase() : \x27none\x27 : \x27none\x27;').dbe('double click :: product page :: product variation','(digitalData.product[0].attributes.variationType || \x27none\x27).toLowerCase();').dbe('double click :: product page :: world','(digitalData.product[0].attributes.world || \x27n/a\x27).toLowerCase();');
s.events.on('async page load').fire(7512311);
s.events.on('link tracking event').evaluate('(function(){\n    var event \x3d new CustomEvent(\x22signalTagFired\x22, {detail: bt_data(\x27link :: event detail object\x27)});\n    window.dispatchEvent(event);\n    console.log(bt_data(\x27Link :: Action Info\x27.toLowerCase()));\n    return true;\n}())').fire(7512312);
s.events.on('page load').fire(7512313);
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('page load').fire(7512316);
});
s.events.on('post page load').evaluate('bt_data(\x27page :: name\x27) \x3d\x3d \x22basket:basket:n/a:*\x22').fire(7512321);
s.events.on('post page load').evaluate('(bt_data(\x27page :: name\x27).indexOf(\x22categorylevel\x22) \x3e -1 || bt_data(\x27page :: name\x27).indexOf(\x22toplevel\x22) \x3e -1 || bt_data(\x27page :: name\x27).indexOf(\x22nthlevel\x22) \x3e -1)').fire(7512322);
s.events.on('async page load').evaluate('(bt_data(\x27page :: name\x27).indexOf(\x22categorylevel\x22) \x3e -1 || bt_data(\x27page :: name\x27).indexOf(\x22toplevel\x22) \x3e -1 || bt_data(\x27page :: name\x27).indexOf(\x22nthlevel\x22) \x3e -1)').fire(7512322);
s.events.on('post page load').evaluate('bt_data(\x27page :: name\x27).indexOf(\x22product:\x22) \x3e -1').fire(7512323);
s.events.on('post page load').evaluate('bt_data(\x27page :: name\x27) \x3d\x3d \x22user profile:creditcard:n/a:*\x22').fire(7512324);
s.events.on('post page load').evaluate('bt_data(\x27page :: name\x27) \x3d\x3d \x22home page:home page:n/a:*\x22').fire(7512325);
s.events.on('profile updated').evaluate('bt_data(\x27page :: url\x27).indexOf(\x22profile/me\x22) \x3e -1').fire(7512327);
s.events.on('async page load').evaluate('bt_data(\x27async page name\x27).indexOf(\x22reviews-submit\x22) \x3e -1').fire(7512328);
s.events.on('post page load').evaluate('bt_data(\x27async page name\x27).indexOf(\x22reviews-submit\x22) \x3e -1').fire(7512328);
s.events.on('post page load').evaluate('bt_data(\x27page :: name\x27) \x3d\x3d \x22search:results-sale:n/a:*\x22').fire(7512329);
s.events.on('post page load').fire(7512331);
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('successfully registered for bi').fire(7512332);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('double click category page').evaluate('digitalData.page.attributes.path[0] \x3d\x3d\x3d \x22category\x22 || (location.href.indexOf(\x27sephora.com/sale\x27) !\x3d -1);').fire(7512333);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('pixel :: community profile creation success').fire(7512334);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('successfully signed up for credit card').fire(7512335);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('sign in success').fire(7512336);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('double click footer').fire(7512338);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('pixel :: register button click').fire(7512339);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('double click product page').fire(7512340);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('facebook base pixel initialized').evaluate('(bt_data(\x27page info :: page name\x27) \x3d\x3d \x22book an event-rsvp\x22 || bt_data(\x27page info :: page name\x27) \x3d\x3d \x22book a class-confirmation\x22 || bt_data(\x27page info :: page name\x27) \x3d\x3d \x22book a service-confirmation\x22)').fire(7512342);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('flash banner add to cart').fire(7512346);
s.events.on('facebook add to basket').fire(7512346);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('add to loves list').fire(7512347);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('successfully registered for bi').fire(7512349);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('facebook base pixel initialized').evaluate('bt_data(\x27page :: type\x27) \x3d\x3d \x22product\x22').fire(7512352);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('quick look load').fire(7512353);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('facebook base pixel initialized').evaluate('(bt_data(\x27page info :: page name\x27) \x3d\x3d \x22book an event-rsvp\x22 || bt_data(\x27page info :: page name\x27) \x3d\x3d \x22book a class-confirmation\x22 || bt_data(\x27page info :: page name\x27) \x3d\x3d \x22book a service-confirmation\x22)').fire(7512355);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('successfully signed up for credit card').fire(7512357);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('facebook base pixel initialized').evaluate('(bt_data(\x27page :: type\x27) \x3d\x3d \x22categorylevel\x22 || bt_data(\x27page :: type\x27) \x3d\x3d \x22nthlevel\x22 || bt_data(\x27page :: type\x27) \x3d\x3d \x22toplevel\x22)').fire(7512358);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('add to basket').fire(7512361);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('add to wishlist').fire(7512362);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('successfully signed up for credit card').fire(7512364);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('pixel :: community profile creation success').fire(7512365);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('sign in success').fire(7512366);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('successfully registered for bi').fire(7512369);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('pixel :: register button click').fire(7512370);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('post page load').fire(7512371);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('double click product page').fire(7512372);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('removefrombasket').fire(7512373);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('facebook base pixel initialized').evaluate('(bt_data(\x27page info :: page name\x27) \x3d\x3d \x22book an event-rsvp\x22 || bt_data(\x27page info :: page name\x27) \x3d\x3d \x22book a class-confirmation\x22 || bt_data(\x27page info :: page name\x27) \x3d\x3d \x22book a service-confirmation\x22)').fire(7512374);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('page load').fire(7512380);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('pinterest addtocart event').fire(7512381);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('successfully registered for bi').fire(7512382);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('pinterest base pixel initialized').evaluate('bt_data(\x27page :: type\x27) \x3d\x3d \x22product\x22').fire(7512384);
s.events.on('pinterest product page view event').evaluate('bt_data(\x27page :: type\x27) \x3d\x3d \x22product\x22').fire(7512384);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('pinterest quicklook event').fire(7512385);
s.events.on('quick look load').fire(7512385);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('page load').fire(7512387);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('page load').fire(7512388);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('product page load event').fire(7512390);
s.events.on('snapchat product page view event').fire(7512390);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('quick look load').fire(7512391);
s.events.on('snapchat quicklook event').fire(7512391);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('successfully registered for bi').fire(7512392);
});
s.events.on('link tracking event').fire(7512393);
s.events.on('post page load').evaluate('bt_data(\x27page :: type\x27) \x3d\x3d \x22product\x22').fire(7512394);
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('page load').fire(7512396);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('successfully registered for bi').fire(7512398);
});
s.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1',function(){
s.events.on('successfully registered for bi').fire(7512401);
});
s.domready(function(){
s.tag('\x3cscript\x3e\n(function(){\n    var getPriceAsInt \x3d function(price) {\n        if (isNaN(parseFloat(price))) {\n            return price;\n        }\n        // Remove currency symbol and commas\n        price \x3d price.match(/\\d+(?:\\.\\d+|\\,\\d+\\.\\d+|\\,\\d+)|\\d+/)[0];\n        price \x3d price.replace(\x27,\x27, \x27\x27);\n        price \x3d Sephora.analytics.utils.convertToUSD(price);\n        return parseFloat(price);\n    };\n\n    window.addEventListener(\x27RemoveFromBasket\x27, function(){\n        if (appboy) {\n            appboy.logCustomEvent(\x27removeFromBasket\x27);\n        }\n    });\n\n    window.addEventListener(\x27PromocodeRedeemed\x27, function() {\n        if (appboy) {\n            appboy.logCustomEvent(\x27promocodeRedeemed\x27);\n        }\n    });\n\n    var trackPurchases \x3d function() {\n        bt_log(\x27trackingPurchases\x27);\n        var items \x3d digitalData.transaction.item;\n        var birthdayGiftRedemmed \x3d false;\n        var birhdayGitfProductId \x3d \x27\x27;\n        for (var i \x3d 0; i \x3c items.length; i++) {\n            var currentItem \x3d items[i];\n            appboy.logPurchase(currentItem.sku.productId, getPriceAsInt(currentItem.sku.listPrice), digitalData.transaction.attributes.isoCurrency, currentItem.qty);\n            if (currentItem.sku.biType \x3d\x3d\x3d \x27Birthday Gift\x27) {\n                birthdayGiftRedemmed \x3d true;\n                birhdayGitfProductId \x3d currentItem.sku.productId;\n            }\n        }\n\n        if (birthdayGiftRedemmed) {\n            appboy.logCustomEvent(\x27BirthdayGiftRedeemed\x27,\n                { \x27productId\x27: birhdayGitfProductId }\n            )\n        }\n    };\n\n    // Acquisition Functions\n    var getUrlParameter \x3d function(name) {\n        name \x3d name.replace(/[\\[]/, \x27\\\\[\x27).replace(/[\\]]/, \x27\\\\]\x27);\n        var regex \x3d new RegExp(\x27[\\\\?\x26]\x27 + name + \x27\x3d([^\x26#]*)\x27);\n        var results \x3d regex.exec(location.search);\n        return results \x3d\x3d\x3d null ? \x27\x27 : decodeURIComponent(results[1].replace(/\\+/g, \x27 \x27));\n    };\n\n    var isPaidReferrer \x3d function(omMmcParam) {\n        const paidReferrers \x3d [\x27ppc\x27, \x27us_search\x27, \x27ca_search\x27, \x27google\x27, \x27ytsrch\x27, \x27gsp\x27, \x27esv\x27];\n\n        for (var i\x3d0; i \x3c paidReferrers.length; i++){\n            if (omMmcParam.indexOf(paidReferrers[i]) !\x3d\x3d -1) {\n                return true;\n            }\n        }\n    };\n\n    var getReferringChannel \x3d function(omMmc) {\n        if (!omMmc || typeof omMmc !\x3d\x3d \x27string\x27) {\n            return \x27organic\x27;\n        }\n\n        if (omMmc.indexOf(\x27aff\x27) \x3d\x3d\x3d 0) {\n            return \x27affiliate\x27;\n        } else if (omMmc.indexOf(\x27ret\x27) \x3d\x3d\x3d 0 || omMmc.indexOf(\x27tr\x27) \x3d\x3d\x3d 0) {\n           return \x27email\x27;\n        } else if (isPaidReferrer(omMmc)) {\n            return \x27paid\x27;\n        } else {\n            return \x27organic\x27;\n        }\n    };\n\n    window.addEventListener(\x27postPageLoad\x27, function() {\n        var getRealValueForIsPushPermissionGranted;\n        bt_log(\x27Braze: postPageLoad occurred\x27);\n        bt_log(\x22Loading Braze SDK\x22);\n\n        // Start - Load Braze SDK\n        +function(a,p,P,b,y){appboy\x3d{};appboyQueue\x3d[];for(var s\x3d\x22initialize destroy getDeviceId toggleAppboyLogging setLogger openSession changeUser requestImmediateDataFlush requestFeedRefresh subscribeToFeedUpdates logCardImpressions logCardClick logFeedDisplayed requestInAppMessageRefresh logInAppMessageImpression logInAppMessageClick logInAppMessageButtonClick logInAppMessageHtmlClick subscribeToNewInAppMessages removeSubscription removeAllSubscriptions logCustomEvent logPurchase isPushSupported isPushBlocked isPushGranted isPushPermissionGranted registerAppboyPushMessages unregisterAppboyPushMessages submitFeedback trackLocation stopWebTracking resumeWebTracking wipeData ab ab.User ab.User.Genders ab.User.NotificationSubscriptionTypes ab.User.prototype.getUserId ab.User.prototype.setFirstName ab.User.prototype.setLastName ab.User.prototype.setEmail ab.User.prototype.setGender ab.User.prototype.setDateOfBirth ab.User.prototype.setCountry ab.User.prototype.setHomeCity ab.User.prototype.setLanguage ab.User.prototype.setEmailNotificationSubscriptionType ab.User.prototype.setPushNotificationSubscriptionType ab.User.prototype.setPhoneNumber ab.User.prototype.setAvatarImageUrl ab.User.prototype.setLastKnownLocation ab.User.prototype.setUserAttribute ab.User.prototype.setCustomUserAttribute ab.User.prototype.addToCustomAttributeArray ab.User.prototype.removeFromCustomAttributeArray ab.User.prototype.incrementCustomUserAttribute ab.User.prototype.addAlias ab.InAppMessage ab.InAppMessage.SlideFrom ab.InAppMessage.ClickAction ab.InAppMessage.DismissType ab.InAppMessage.OpenTarget ab.InAppMessage.ImageStyle ab.InAppMessage.TextAlignment ab.InAppMessage.Orientation ab.InAppMessage.CropType ab.InAppMessage.prototype.subscribeToClickedEvent ab.InAppMessage.prototype.subscribeToDismissedEvent ab.InAppMessage.prototype.removeSubscription ab.InAppMessage.prototype.removeAllSubscriptions ab.InAppMessage.Button ab.InAppMessage.Button.prototype.subscribeToClickedEvent ab.InAppMessage.Button.prototype.removeSubscription ab.InAppMessage.Button.prototype.removeAllSubscriptions ab.SlideUpMessage ab.ModalMessage ab.FullScreenMessage ab.HtmlMessage ab.ControlMessage ab.Feed ab.Feed.prototype.getUnreadCardCount ab.Card ab.ClassicCard ab.CaptionedImage ab.Banner ab.WindowUtils display display.automaticallyShowNewInAppMessages display.showInAppMessage display.showFeed display.destroyFeed sharedLib\x22.split(\x22 \x22),i\x3d0;i\x3cs.length;i++){for(var m\x3ds[i],k\x3dappboy,l\x3dm.split(\x22.\x22),j\x3d0;j\x3cl.length-1;j++)k\x3dk[l[j]];k[l[j]]\x3d(new Function(\x22return function \x22+m.replace(/\\./g,\x22_\x22)+\x22(){appboyQueue.push(arguments); return true}\x22))()}appboy.getUser\x3dfunction(){return new appboy.ab.User};appboy.getCachedFeed\x3dfunction(){return new appboy.ab.Feed};(y\x3dp.createElement(P)).type\x3d\x27text/javascript\x27;y.src\x3d\x27https://js.appboycdn.com/web-sdk/2.7/appboy.min.js\x27;y.async\x3d1;(b\x3dp.getElementsByTagName(P)[0]).parentNode.insertBefore(y,b)}(window,document,\x27script\x27);\n        // END - Load Braze SDK\n\n        var localRE \x3d /local.*sephora.com/;\n        var QaRE \x3d /qa.*sephora.com/;\n        var environment \x3d QaRE.test(location.hostname) || localRE.test(location.hostname) ? \x27staging\x27 : \x27production\x27;\n        var apiKey \x3d {\n            staging: \x27c8a4108b-1bbc-48d3-b502-f5acad999b78\x27,\n            production: \x27476615b3-3386-4e1c-a9fd-7e174eb9b8de\x27\n        };\n\n        appboy.initialize(apiKey[environment], {\n            enableLogging: false,\n            enableHtmlInAppMessages: true,\n            safariWebsitePushId: \x27web.com.sephora\x27\n        });\n\n        /*\n        Poll appboy.isPushPermissionGranted b/c appboy.isPushPermissionGranted()\n        is unreliable, returns true first then false afterward. If after 1\n        second it\x27s still true, then trust it\x27s true. If it ever returns false,\n        immediately trust it\x27s false \x26 show opt-in message if not already shown\n        this session.\n        */\n        tryToCallRegisterAppboyMessages \x3d function (tries) {\n            if (!appboy.isPushPermissionGranted()) {\n                // Prevent opt-in messages from showing on every page load\n                if (!(window.sessionStorage \x26\x26 window.sessionStorage.getItem(\x22brazePromptWasShownThisSession\x22))) {\n                    window.sessionStorage \x26\x26 window.sessionStorage.setItem(\x22brazePromptWasShownThisSession\x22, \x22true\x22);\n                    appboy.registerAppboyPushMessages();\n                }\n            } else {\n                if (tries \x3d\x3d\x3d 10) {\n                    // isPushPermissionGranted really is true, so allow popups to show\n                    appboy.registerAppboyPushMessages();\n                } else {\n                    // Wait a tenth of a second and then check again\n                    window.setTimeout(function(){\n                        tryToCallRegisterAppboyMessages(++tries);\n                    }, 100);\n                }\n            }\n        };\n\n        // Determine whether\n        tryToCallRegisterAppboyMessages(1);\n\n        // If we haven\x27t already cached the data, cache it\n        // todo: consider removing country and platform keys below\n        if (window.sessionStorage \x26\x26 window.sessionStorage.getItem(\x27lastDataForBraze\x27) \x3d\x3d\x3d null) {\n            var stubData \x3d {\n                \x27user_id\x27: \x27\x27,\n                \x27brazeEmail\x27: \x27\x27,\n                \x27current_points\x27: 0,\n                \x27ytd_spend_amount\x27: 0,\n                \x27flash_membership_status\x27: \x27\x27,\n                \x27birth\x27: \x27\x27,\n                \x27country\x27: \x27\x27,\n                \x27platform\x27: \x27\x27,\n                \x27biStatus\x27: \x27\x27,\n                \x27itemsInBasket\x27: 0\n            };\n            window.sessionStorage.setItem(\x27lastDataForBraze\x27, JSON.stringify(stubData));\n        }\n\n        var cachedData \x3d window.sessionStorage.getItem(\x27lastDataForBraze\x27);\n        var jsonCachedData \x3d JSON.parse(cachedData);\n        var isJsonUpdated \x3d false;\n\n        var isNewData \x3d function(key, value) {\n            var cachedData \x3d window.sessionStorage.getItem(\x27lastDataForBraze\x27);\n            var jsonCachedData \x3d JSON.parse(cachedData);\n            if (jsonCachedData[key] !\x3d\x3d value) {\n                return true;\n            }\n            return false;\n        };\n\n        var setNewData \x3d function(key, value) {\n            if (isNewData(key, value)) {\n                isJsonUpdated \x3d true;\n                jsonCachedData[key] \x3d value;\n                return true;\n            }\n            return false;\n        };\n\n        var userData \x3d null;\n        var profileStatus \x3d 0;\n        var birthDay \x3d null;\n        var birthMonth \x3d null;\n        var birthYear \x3d null;\n        var vibSpendingForYear \x3d null;\n        var biPoints \x3d 0;\n        var subscriptionPrograms \x3d null;\n        var isEnrolledInFlash \x3d null;\n        var flashEndDate \x3d null;\n        var flashCancelDate \x3d null;\n        var SHORTENED_MONTHS \x3d [\x27Jan\x27, \x27Feb\x27, \x27Mar\x27, \x27Apr\x27, \x27May\x27, \x27Jun\x27, \x27Jul\x27,\n    \x27Aug\x27, \x27Sep\x27, \x27Oct\x27, \x27Nov\x27, \x27Dec\x27];\n\n        function formatFlashDate(date) {\n            var dateArray \x3d date.split(\x27/\x27);\n            var month \x3d SHORTENED_MONTHS[parseInt(dateArray[0]) - 1];\n            var day \x3d dateArray[1];\n            var year \x3d \x2720\x27 + dateArray[2];\n            return month + \x27 \x27 + day + \x27 \x27 + year;\n        }\n\n        // Get cached representation of user data\n        if (window.localStorage \x26\x26 window.localStorage.getItem(\x27UserData\x27)) {\n            userData \x3d JSON.parse(window.localStorage.getItem(\x27UserData\x27));\n            userData \x3d userData.data;\n        }\n\n        if (userData !\x3d\x3d null) {\n            if (userData.profile) {\n                if (userData.profile.beautyInsiderAccount) {\n                    var bi \x3d userData.profile.beautyInsiderAccount;\n                    if (bi !\x3d\x3d null) {\n                        birthDay \x3d bi.birthDay;\n                        birthMonth \x3d bi.birthMonth;\n                        birthYear \x3d bi.birthYear;\n                        vibSpendingForYear \x3d bi.vibSpendingForYear ? bi.vibSpendingForYear : null;\n                        biPoints \x3d bi.promotionPoints ? bi.promotionPoints : 0;\n                    }\n                }\n                subscriptionPrograms \x3d userData.profile.subscriptionPrograms || null;\n                if (subscriptionPrograms) {\n                    if (subscriptionPrograms.flash) {\n                        isEnrolledInFlash \x3d  subscriptionPrograms.flash.isActive \x3d\x3d\x3d true;\n                        flashEndDate \x3d subscriptionPrograms.flash.endDate ? formatFlashDate(subscriptionPrograms.flash.endDate) : null;\n                        flashCancelDate \x3d subscriptionPrograms.flash.cancelDate ? formatFlashDate(subscriptionPrograms.flash.cancelDate) : null;\n                    }\n                }\n            }\n            profileStatus \x3d userData.profile \x26\x26 userData.profile.profileStatus ? userData.profile.profileStatus : 0;\n        }\n\n        var atgId \x3d digitalData.user[0].profile[0].profileInfo.profileID;\n        var biStatus \x3d digitalData.user[0].segment.biStatus;\n\n        var platform \x3d digitalData.page.attributes.experience;\n        var brazeEmail \x3d digitalData.user[0].profile[0].profileInfo.email;\n        // Warning: Use pageInfoCountry, because country is already defined as a variable by appboy\n        // todo: consider removing pageInfoCountry below\n        var pageInfoCountry \x3d digitalData.page.pageInfo \x26\x26 digitalData.page.pageInfo.country ? digitalData.page.pageInfo.country : null;\n\n        var pageCountryLang \x3d digitalData.page.pageInfo \x26\x26 digitalData.page.pageInfo.country \x3d\x3d\x3d \x27CA\x27 ?\n            digitalData.page.pageInfo.language \x3d\x3d\x3d \x27FR\x27 ? \x27fr_CA\x27 : \x27en_CA\x27 : \x27en_US\x27;\n\n        /*\n        If you have a unique identifier for this user (e.g. they are logged\n        into your site) it\x27s a good idea to call changeUser here. See\n        https://js.appboycdn.com/web-sdk/latest/doc/module-appboy.html#.changeUser\n        for more information. Do not send atgId for anonymous users.\n        */\n        if (atgId !\x3d\x3d \x27\x27) {\n            if(setNewData(\x27user_id\x27, atgId)) {\n                appboy.changeUser(atgId);\n            }\n        }\n\n        var abUser \x3d appboy.getUser();\n\n        // todo: check if country and platform should be removed below\n        if (setNewData(\x27country\x27, pageInfoCountry)) {\n            abUser.setCustomUserAttribute(\x27country\x27, pageInfoCountry);\n        }\n        if (setNewData(\x27platform\x27, platform)) {\n            abUser.setCustomUserAttribute(\x27platform\x27, platform);\n        }\n        if (setNewData(\x27clientLocale\x27, pageCountryLang)) {\n            abUser.setCustomUserAttribute(\x27clientLocale\x27, pageCountryLang);\n        }\n        if (profileStatus \x3e 0 \x26\x26 setNewData(\x27biStatus\x27, biStatus)) {\n            abUser.setCustomUserAttribute(\x27biStatus\x27, biStatus);\n        }\n        if (profileStatus \x3e 0 \x26\x26 biStatus !\x3d\x3d \x27non-bi\x27 \x26\x26 setNewData(\x27biStatus\x27, biStatus)) {\n            if (biStatus !\x3d\x3d \x27bi\x27) {\n                var uppercaseBiStatus \x3d biStatus.toUpperCase();\n                appboy.logCustomEvent(\x27tierMigrated\x27, {\x27tier\x27: uppercaseBiStatus});\n            } else {\n                appboy.logCustomEvent(\x27tierMigrated\x27, {\x27tier\x27: \x27Registration\x27});\n            }\n        }\n        if (profileStatus \x3e 0 \x26\x26 vibSpendingForYear !\x3d\x3d null \x26\x26 setNewData(\x27ytd_spend_amount\x27, vibSpendingForYear)) {\n            abUser.setCustomUserAttribute(\x27ytd_spend_amount\x27, vibSpendingForYear);\n        }\n        if (profileStatus \x3e 0 \x26\x26 biPoints !\x3d\x3d null \x26\x26 setNewData(\x27current_points\x27, biPoints)) {\n            abUser.setCustomUserAttribute(\x27current_points\x27, biPoints);\n        }\n        if (profileStatus \x3e 0 \x26\x26 birthYear !\x3d\x3d null \x26\x26 birthYear !\x3d\x3d \x271800\x27) {\n            if (setNewData(\x27birth\x27, birthYear+birthMonth+birthDay)) {\n                abUser.setDateOfBirth(parseInt(birthYear), parseInt(birthMonth), parseInt(birthDay));\n            }\n        }\n        if (profileStatus \x3e 0 \x26\x26 subscriptionPrograms !\x3d\x3d null) {\n            if (isEnrolledInFlash) {\n                if (setNewData(\x27flash_membership_status\x27, \x27SUBSCRIBED\x27)) {\n                    abUser.setCustomUserAttribute(\x27flash_membership_status\x27, \x27SUBSCRIBED\x27);\n                }\n                if (setNewData(\x27flash_membership_expiry_date\x27, flashEndDate)) {\n                    abUser.setCustomUserAttribute(\x27flash_membership_expiry_date\x27, flashEndDate);\n                }\n            } else {\n                if (flashCancelDate !\x3d\x3d null) {\n                    if (setNewData(\x27flash_membership_status\x27, \x27CANCELLED\x27)) {\n                        abUser.setCustomUserAttribute(\x27flash_membership_status\x27, \x27CANCELLED\x27);\n                    }\n                    if (setNewData(\x27flash_membership_cancel_date\x27, flashCancelDate)) {\n                        abUser.setCustomUserAttribute(\x27flash_membership_cancel_date\x27, flashCancelDate);\n                    }\n                }\n                if (flashEndDate !\x3d\x3d null) {\n                    if (setNewData(\x27flash_membership_status\x27, \x27EXPIRED\x27)) {\n                        abUser.setCustomUserAttribute(\x27flash_membership_status\x27, \x27EXPIRED\x27);\n                    }\n                    if (setNewData(\x27flash_membership_expiry_date\x27, flashEndDate)) {\n                        abUser.setCustomUserAttribute(\x27flash_membership_expiry_date\x27, flashEndDate);\n                    }\n                }\n            }\n        }\n\n        if (isJsonUpdated) {\n            var stringCachedData \x3d JSON.stringify(jsonCachedData);\n            window.sessionStorage.setItem(\x27lastDataForBraze\x27, stringCachedData);\n        }\n\n        // Send Acquisition Events\n        var omMmc \x3d getUrlParameter(\x27om_mmc\x27) || null;\n        var utmCampaign \x3d getUrlParameter(\x27utm_campaign\x27);\n        var referringChannel \x3d getReferringChannel(omMmc);\n\n        if (referringChannel) {\n            appboy.logCustomEvent(\x27referringChannel\x27, {\x27referringChannel\x27: referringChannel});\n        }\n        if (utmCampaign) {\n            appboy.logCustomEvent(\x27referralParameter\x27, {\x27referralParameter\x27: utmCampaign});\n        }\n        // Track Purchases\n        if (digitalData.page.pageInfo.pageName \x3d\x3d\x3d \x27order-confirmation\x27) {\n            trackPurchases();\n        }\n        \n        // Track view of Rewards Bazaar page: /rewards\n        if (digitalData.page.pageInfo.pageName \x3d\x3d\x3d \x27rewards bazaar\x27) {\n            appboy.logCustomEvent(\x27bazaarPageView\x27);\n        }\n        \n        // Track view of Beauty Offers page: /beauty/beauty-offers\n        if (digitalData.page.pageInfo.pageName \x3d\x3d\x3d \x27beauty offers\x27) {\n            appboy.logCustomEvent(\x27beautyoffersPageView\x27);\n        }\n\n        appboy.openSession();\n        appboy.logCustomEvent(\x22prime-for-push\x22);\n        \n        // begin: code added for uts-581\n        appboy.subscribeToNewInAppMessages(function(inAppMessage) {\n            var shouldDisplay \x3d true;\n            \n            // If Sephora modal is open, then do not show Braze modal\n            var modalRoot \x3d document.getElementById(\x27modal-root\x27);\n            if (modalRoot !\x3d\x3d null) {\n                if (modalRoot.children.length \x3e 0) {\n                    shouldDisplay \x3d false;\n                }\n            }\n            \n            if (inAppMessage[0] instanceof appboy.ab.InAppMessage) {\n                // Read the key-value pair for msg-id\n                var msgId \x3d inAppMessage[0].extras[\x22msg-id\x22];\n                //console.log(\x27msgId \x3d \x27 + msgId);\n                // If this is our push primer message\n                if (msgId \x3d\x3d \x22push-primer\x22) {\n                    // We don\x27t want to display the soft push prompt to users on browsers that don\x27t support push, or if the user\n                    // has already granted/blocked permission\n                    if (!appboy.isPushSupported() || appboy.isPushPermissionGranted() || appboy.isPushBlocked()) {\n                        shouldDisplay \x3d false;\n                    }\n                    if (inAppMessage[0].buttons[0] !\x3d null) {\n                        // Prompt the user when the first button is clicked\n                        inAppMessage[0].buttons[0].subscribeToClickedEvent(function() {\n                            appboy.registerAppboyPushMessages();\n                        });\n                    }\n                }\n            }\n        \n            // Display the message\n            if (shouldDisplay) {\n                appboy.display.showInAppMessage(inAppMessage[0]);\n            }\n        });\n        // end: code added for uts-581\n\n        // Allow Sephora code to proceed with Braze actions\n        if (Sephora.analytics.resolvePromises.brazeIsReady) {\n            Sephora.analytics.resolvePromises.brazeIsReady();\n        }\n    });\n\n}());\n\x3c/script\x3e',{tagId:7512330});
s.secondary(function(c){
c.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1').fire(7512320);
c.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1').fire(7512345);
c.when('bt_data(\x27ccpa :: consent accept cookies\x27) !\x3d 1').fire(7512399);
c.when('(function(){\n\n/* Temp Fix for 2017.5 - https://jira.sephora.com/browse/ILLUPH-94714\n** Remove after 2017.6 is live.\n**/\nif(window.location.href.indexOf(\x22community/gallery\x22) !\x3d-1){\n    digitalData.page.category.pageType \x3d \x22cmnty\x22;\n}\n/* End Temp Fix */\n\tsetTimeout(function(){\nbt_log(\x22TMS ready\x22);\n\t    Sephora.analytics.resolvePromises.tagManagementSystemReady();\n\n\n\t}, 1000)\n}())').fire(7512402);
});
});
});
});
